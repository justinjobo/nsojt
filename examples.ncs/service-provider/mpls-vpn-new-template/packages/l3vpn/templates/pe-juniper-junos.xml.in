<configuration xmlns="http://xml.juniper.net/xnm/1.1/xnm">
  <interfaces>
    <interface tags="nocreate">
      <name>{$PE_INT_NAME}</name>
      <no-traps tags="merge"></no-traps>
      <vlan-tagging tags="merge"></vlan-tagging>
      <unit tags="merge">
        <name>{$VLAN_ID}</name>
        <description>Link to CE / {$CE} - {$CE_INT_NAME}</description>
        <vlan-id>{$VLAN_ID}</vlan-id>
        <family>
          <inet>
            <address>
              <name>{$LINK_PE_ADR}/{$LINK_PREFIX}</name>
            </address>
          </inet>
        </family>
      </unit>
    </interface>
  </interfaces>
  <routing-instances>
    <instance>
      <name>{/name}</name>
      <instance-type>vrf</instance-type>
      <interface>
        <name>{$PE_INT_NAME}.{$VLAN_ID}</name>
      </interface>
      <route-distinguisher>
        <rd-type>{/route-distinguisher}:1</rd-type>
      </route-distinguisher>
      <vrf-import>{/name}-IMP</vrf-import>
      <vrf-export>{/name}-EXP</vrf-export>
      <vrf-table-label>
      </vrf-table-label>
      <protocols>
        <bgp>
          <group>
            <name>{$CE}-{/name}</name>
            <local-address>{$LINK_PE_ADR}</local-address>
            <peer-as>{$CE_AS_NUM}</peer-as>
            <local-as>
              <as-number>100</as-number>
            </local-as>
            <neighbor>
              <name>{$LINK_CE_ADR}</name>
            </neighbor>
          </group>
        </bgp>
      </protocols>
    </instance>
  </routing-instances>
  <policy-options>
    <policy-statement>
      <name>{/name}-EXP</name>
      <from>
        <protocol>bgp</protocol>
      </from>
      <then>
        <community>
          <key1>add</key1>
          <community-name>{/name}-comm-exp</community-name>
        </community>
        <accept/>
      </then>
    </policy-statement>
    <policy-statement>
      <name>{/name}-IMP</name>
      <from>
        <protocol>bgp</protocol>
        <community>{/name}-comm-imp</community>
      </from>
      <then>
        <accept/>
      </then>
    </policy-statement>
    <community>
      <name>{/name}-comm-imp</name>
      <members>target:{/route-distinguisher}:1</members>
    </community>
    <community>
      <name>{/name}-comm-exp</name>
      <members>target:{/route-distinguisher}:1</members>
    </community>
  </policy-options>
  <class-of-service>
    <interfaces>
      <interface>
        <name>{$PE_INT_NAME}</name>
        <unit>
          <name>{$VLAN_ID}</name>
          <shaping-rate>
            <rate>{$BW}</rate>
          </shaping-rate>
        </unit>
      </interface>
    </interfaces>
  </class-of-service>
</configuration>
