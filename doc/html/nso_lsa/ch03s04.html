<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      
      <title>Example Walkthrough -  - Layered Service Architecture</title>
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="index.html" title="Layered Service Architecture" />
      <link rel="up" href="ncs_lsa.lsa_setup.html" title="Deploying LSA" />
      <link rel="prev" href="ch03s03.html" title="Device Compiled RFS Services" />
      <link rel="next" href="ch03s05.html" title="Migration and Upgrades" />
      <meta xmlns="" name="Section-title" content="Example Walkthrough" /><script xmlns="" type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-1069";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><link xmlns="" rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
      <link xmlns="" rel="stylesheet" type="text/css" href="common/css/positioning.css" />
      <link xmlns="" rel="stylesheet" type="text/css" href="common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css" />
      <link xmlns="" rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><style xmlns="" type="text/css">
      
      #noscript{
      font-weight:bold;
      background-color: #55AA55;
      font-weight: bold;
      height: 25spx;
      z-index: 3000;
      top:0px;
      width:100%;
      position: relative;
      border-bottom: solid 5px black;
      text-align:center;
      color: white;
      }
      
      input {
      margin-bottom: 5px;
      margin-top: 2px;
      }
      .folder {
      display: block;
      height: 22px;
      padding-left: 20px;
      background: transparent url(common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
      }
      span.contentsTab {
      padding-left: 20px;
      background: url(common/images/toc-icon.png) no-repeat 0 center;
      }
      span.searchTab {
      padding-left: 20px;
      background: url(common/images/search-icon.png) no-repeat 0 center;
      }
      
      /* Overide jquery treeview's defaults for ul. */
      .treeview ul {
      background-color: transparent;
      margin-top: 4px;
      }		
      #webhelp-currentid {
      /* background-color: #D8D8D8 !important; */
      background-color: #D8D8D8;
      }
      .treeview .hover { color: black; }
      .filetree li span a { text-decoration: none; font-size: 12px; color: #517291; }
      
      /* Override jquery-ui's default css customizations. These are supposed to take precedence over those.*/
      .ui-widget-content {
      border: 0px; 
      background: none; 
      color: none;     
      }
      .ui-widget-header {
      color: #e9e8e9;
      border-left: 1px solid #e5e5e5;
      border-right: 1px solid #e5e5e5;
      border-bottom: 1px solid #bbc4c5;
      border-top: 4px solid #e5e5e5;
      border: medium none;
      background: #F4F4F4; /* old browsers */
      background: -moz-linear-gradient(top, #F4F4F4 0%, #E6E4E5 100%); /* firefox */
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#F4F4F4), color-stop(100%,#E6E4E5)); /* webkit */    
      font-weight: none;
      }
      .ui-widget-header a { color: none; }
      .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default { 
      border: none; background: none; font-weight: none; color: none; }
      .ui-state-default a, .ui-state-default a:link, .ui-state-default a:visited { color: black; text-decoration: none; }
      .ui-state-hover, .ui-widget-content .ui-state-hover, .ui-widget-header .ui-state-hover, .ui-state-focus, .ui-widget-content .ui-state-focus, .ui-widget-header .ui-state-focus { border: none; background: none; font-weight: none; color: none; }
      
      .ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active { border: none; background: none; font-weight: none; color: none; }
      .ui-state-active a, .ui-state-active a:link, .ui-state-active a:visited { 
      color: black; text-decoration: none; 	
      background: #C6C6C6; /* old browsers */
      background: -moz-linear-gradient(top, #C6C6C6 0%, #D8D8D8 100%); /* firefox */
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#C6C6C6), color-stop(100%,#D8D8D8)); /* webkit */
      -webkit-border-radius:15px; -moz-border-radius:10px;
      border: 1px solid #f1f1f1;
      }    
      .ui-corner-all { border-radius: 0 0 0 0; }
      
      .ui-tabs { padding: .2em;}
      .ui-tabs .ui-tabs-nav li { top: 0px; margin: -2px 0 1px; text-transform: uppercase; font-size: 10.5px;}
      .ui-tabs .ui-tabs-nav li a { padding: .25em 2em .25em 1em; margin: .5em; text-shadow: 0 1px 0 rgba(255,255,255,.5); }
      /**
      *	Basic Layout Theme
      * 
      *	This theme uses the default layout class-names for all classes
      *	Add any 'custom class-names', from options: paneClass, resizerClass, togglerClass
      */
      
      .ui-layout-pane { /* all 'panes' */ 
      background: #FFF; 
      border: 1px solid #BBB; 
      padding: 05x; 
      overflow: auto;
      } 
      
      .ui-layout-resizer { /* all 'resizer-bars' */ 
      background: #DDD; 
      top:100px
      } 
      
      .ui-layout-toggler { /* all 'toggler-buttons' */ 
      background: #AAA; 
      } 
      
    </style>
      <!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]--><script xmlns="" type="text/javascript" src="common/browserDetect.js">
         <!----></script><script xmlns="" type="text/javascript" src="common/jquery/jquery-1.7.2.min.js">
         <!----></script><script xmlns="" type="text/javascript" src="common/jquery/jquery.ui.all.js">
         <!----></script><script xmlns="" type="text/javascript" src="common/jquery/jquery.cookie.js">
         <!----></script><script xmlns="" type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js">
         <!----></script><script xmlns="" type="text/javascript" src="common/jquery/layout/jquery.layout.js">
         <!----></script><style type="text/css">
      
      #header {
      /* background: url("../images/header-bg.png") scroll top left repeat-x #4d8c83; */
      background: transparent;
      }
      #leftnavigation {
      /* background-color: #ededed!important; */
      background-color: transparent;
      }
      #navheader {
      visibility: hidden;
      }
      #webhelp-currentid {
      /* background-color: #D8D8D8 !important; */
      background-color: #FFFFFF; /*but must be changed in main.js as well*/
      }
      .filetree span.file {
      /* background: url(images/file.gif) 0 0 no-repeat; */
      background: initial;
      }
      .filetree span.folder, .filetree span.file {
      padding: 1px 0 1px 7px;
      display: block;
      }

      /* borrowed from cisco: clientlib.css */
      .footer {
      margin: 28px 30px 0 15px;
      font-size: 80%;
      line-height: 120%;
      border-top: 1px solid #ccc;
      padding-top: 7px;
      color: #999;
      }
      .footer #footer-legal{display:inline;padding-bottom:18px}
      #framework-footer{margin:0;padding:0 0 15px 0;min-width:900px;width:100%}
      .footer a,.footer a:visited{color:#999}

      /* from ccimr.css */
      a:active  { color: #3366CC}
      a:hover   { color: #3366CC}
      a:link    { color: #3366CC}
      a:visited { color: #3366CC}

      #header img {
      float: left;
      margin-left: 20px;
      margin-top: 0px;
      }

      #header h1 {
      color: #336666;
      margin-top: 4px;
      }
      #content h1, #content h2 {
      color: #336666;
      }
      .title {
      color: #336666;
      }
      p, pre {
      margin-left: 0.1in;
      }
      p, ul, ol, li {
        font-size: 95%;
        font-family: Arial, Helvetica, sans-serif;
        margin-top: 1px;
      }
      body {
        font: 80.5% Arial, Helvetica, sans-serif;
      }
      ol {
      display: block;
      list-style-type: decimal;
      -webkit-margin-before: 1em;
      -webkit-margin-after: 1em;
      -webkit-margin-start: 0px;
      -webkit-margin-end: 0px;
      -webkit-padding-start: 40px;
      border: 1;
      }
    </style></head>
   <body>
      <noscript>
         <div id="noscript">JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.</div>
      </noscript>
      <div id="header"><a href="index.html"><img style="margin-right: 2px; width: 110; height: 73; padding-right: 25px; padding-top: 8px" align="right" src="common/images/logo.gif" alt="Cisco Systems, Inc." /></a><h1>Layered Service Architecture<br />Deploying LSA
         </h1>
         <div id="navheader">
            <!---->
            <table class="navLinks">
               <tr>
                  <td><a id="showHideButton" href="#" onclick="myLayout.toggle('west')" class="pointLeft" tabindex="5" title="Hide TOC tree">Sidebar
                                                    </a></td>
                  <td><a accesskey="p" class="navLinkPrevious" tabindex="5" href="ch03s03.html">Prev</a>
                                                             |
                                                             <a accesskey="u" class="navLinkUp" tabindex="5" href="ncs_lsa.lsa_setup.html">Up</a>
                                                         |
                                                         <a accesskey="n" class="navLinkNext" tabindex="5" href="ch03s05.html">Next</a></td>
               </tr>
            </table>
         </div>
      </div>
      <div id="content">
         <div class="sect1">
            <div xmlns="" class="titlepage">
               <div>
                  <div>
                     <h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="d0e875"></a>Example Walkthrough
                     </h2>
                  </div>
               </div>
            </div>
            <p>
                     You can see all the required setup steps for a single version deployment
                     performed in the example
                     <code class="filename">examples.ncs/getting-started/developing-with-ncs/22-lsa-single-version-deployment</code>
                     and the
                     <code class="filename">examples.ncs/getting-started/developing-with-ncs/28-lsa-multi-version-deployment</code>
                     has the steps for the multi version one. The two are quite similar
                     but the multi version deployment has additional steps, so it is
                     the one described here.
                   
            </p>
            <p>
                     First, build the example for manual setup.
                   
            </p>
            <div class="informalexample"><pre class="screen">$ make clean manual
$ make start-manual
$ make cli-upper-nso</pre></div>
            <p>
                     Then configure the nodes in the cluster. This is needed so that the
                     upper CFS node can receive notifications from the lower RFS node
                     and prepare the upper CFS node to be used with the commit-queue.
                   
            </p>
            <div class="informalexample"><pre class="screen">&gt; configure

% set cluster device-notifications enabled
% set cluster remote-node lower-nso-1 authgroup default username admin
% set cluster remote-node lower-nso-1 address 127.0.0.1 port 2023
% set cluster remote-node lower-nso-2 authgroup default username admin
% set cluster remote-node lower-nso-2 address 127.0.0.1 port 2024
% set cluster commit-queue enabled
% commit
% request cluster remote-node lower-nso-* ssh fetch-host-keys</pre></div>
            <p>
                     To be able to handle the lower NSO node as an LSA node, the correct
                     version of the cisco-nso-nc package needs to be installed. In this
                     example 5.4 is used.
                   
            </p>
            <p>
                     Create a link to the cisco-nso package in the packages directory
                     of the upper CFS node:
                   
            </p>
            <div class="informalexample"><pre class="screen">$ ln -sf ${NCS_DIR}/packages/lsa/cisco-nso-nc-5.4 upper-nso/packages</pre></div>
            <p>
                     Reload the packages:
                   
            </p>
            <div class="informalexample"><pre class="screen">% exit
&gt; request packages reload

e&gt;&gt;&gt; System upgrade is starting.
&gt;&gt;&gt; Sessions in configure mode must exit to operational mode.
&gt;&gt;&gt; No configuration changes can be performed until upgrade has completed.
&gt;&gt;&gt; System upgrade has completed successfully.
reload-result {
    package cisco-nso-nc-5.4
    result true
}</pre></div>
            <p>
                     Now when the cisco-nso-nc package is in place, configure the two
                     lower NSO nodes and sync-from them:
                   
            </p>
            <div class="informalexample"><pre class="screen">&gt; configure
Entering configuration mode private

% set devices device lower-nso-1 device-type netconf ned-id cisco-nso-nc-5.4
% set devices device lower-nso-1 authgroup default
% set devices device lower-nso-1 lsa-remote-node lower-nso-1
% set devices device lower-nso-1 state admin-state unlocked
% set devices device lower-nso-2 device-type netconf ned-id cisco-nso-nc-5.4
% set devices device lower-nso-2 authgroup default
% set devices device lower-nso-2 lsa-remote-node lower-nso-2
% set devices device lower-nso-2 state admin-state unlocked

% commit
Commit complete.

% request devices fetch-ssh-host-keys
fetch-result {
    device lower-nso-1
    result updated
    fingerprint {
        algorithm ssh-ed25519
        value 4a:c6:5d:91:6d:4a:69:7a:4e:0d:dc:4e:51:51:ee:e2
    }
}
fetch-result {
    device lower-nso-2
    result updated
    fingerprint {
        algorithm ssh-ed25519
        value 4a:c6:5d:91:6d:4a:69:7a:4e:0d:dc:4e:51:51:ee:e2
    }
}

% request devices sync-from
sync-result {
    device lower-nso-1
    result true
}
sync-result {
    device lower-nso-2
    result true
}</pre></div>
            <p>
                     Now, for example, the configured devices of the lower nodes can be
                     viewed:
                   
            </p>
            <div class="informalexample"><pre class="screen">% show devices device config devices device | display xpath | display-level 5

/devices/device[name='lower-nso-1']/config/ncs:devices/device[name='ex0']
/devices/device[name='lower-nso-1']/config/ncs:devices/device[name='ex1']
/devices/device[name='lower-nso-1']/config/ncs:devices/device[name='ex2']
/devices/device[name='lower-nso-2']/config/ncs:devices/device[name='ex3']
/devices/device[name='lower-nso-2']/config/ncs:devices/device[name='ex4']
/devices/device[name='lower-nso-2']/config/ncs:devices/device[name='ex5']</pre></div>
            <p>
                     or alarms inspected:
                   
            </p>
            <div class="informalexample"><pre class="screen">% run show devices device lower-nso-1 live-status alarms summary

live-status alarms summary indeterminates 0
live-status alarms summary criticals 0
live-status alarms summary majors 0
live-status alarms summary minors 0
live-status alarms summary warnings 0</pre></div>
            <p>
                     Now, create a netconf package on the upper CFS node which can be
                     used towards the rfs-vlan service on the lower RFS node, in the
                     shell terminal window do the following:
                   
            </p>
            <div class="informalexample"><pre class="screen">$ ncs-make-package --no-netsim --no-java --no-python                \
    --lsa-netconf-ned package-store/rfs-vlan/src/yang               \
    --lsa-lower-nso cisco-nso-nc-5.4                                \
    --package-version 5.4 --dest upper-nso/packages/rfs-vlan-nc-5.4 \
    --build rfs-vlan-nc-5.4</pre></div>
            <p>
                     The created NED is an lsa-netconf NED based on the YANG files of
                     the rfs-vlan service:
                   
            </p>
            <div class="informalexample"><pre class="screen">--lsa-netconf-ned package-store/rfs-vlan/src/yang</pre></div>
            <p>
                     The version of the NED reflects the version of the nso on the lower
                     node:
                   
            </p>
            <div class="informalexample"><pre class="screen">--package-version 5.4</pre></div>
            <p>
                     The package will be generated in the packages directory of the
                     upper NSO CFS node:
                   
            </p>
            <div class="informalexample"><pre class="screen">--dest upper-nso/packages/rfs-vlan-nc-5.4</pre></div>
            <p>
                     and the name of the package will be:
                   
            </p>
            <div class="informalexample"><pre class="screen">rfs-vlan-nc-5.4</pre></div>
            <p>
                     Install the cfs-vlan service on the upper CFS node. In the shell
                     terminal window do the following:
                   
            </p>
            <div class="informalexample"><pre class="screen">$ ln -sf ../../package-store/cfs-vlan     upper-nso/packages</pre></div>
            <p>
                     Reload the packages once more to get the cfs-vlan package. In
                     the CLI terminal window do the following:
                   
            </p>
            <div class="informalexample"><pre class="screen">% exit

&gt; request packages reload

&gt;&gt;&gt; System upgrade is starting.
&gt;&gt;&gt; Sessions in configure mode must exit to operational mode.
&gt;&gt;&gt; No configuration changes can be performed until upgrade has completed.
&gt;&gt;&gt; System upgrade has completed successfully.
reload-result {
    package cfs-vlan
    result true
}
reload-result {
    package cisco-nso-nc-5.4
    result true
}
reload-result {
    package rfs-vlan-nc-5.4
    result true
}

&gt; configure
Entering configuration mode private</pre></div>
            <p>
                     Now, when all packages are in place a cfs-vlan service can be
                     configured. The cfs-vlan service will dispatch service data to
                     the right lower RFS node depending on the device names used in
                     the service.
                   
            </p>
            <p>
                     In the CLI terminal window verify the service:
                   
            </p>
            <div class="informalexample"><pre class="screen">% set cfs-vlan v1 a-router ex0 z-router ex5 iface eth3 unit 3 vid 77

% commit dry-run
.....
    local-node {
        data  devices {
                  device lower-nso-1 {
                      config {
                          services {
             +                vlan v1 {
             +                    router ex0;
             +                    iface eth3;
             +                    unit 3;
             +                    vid 77;
             +                    description "Interface owned by CFS: v1";
             +                }
                          }
                      }
                  }
                  device lower-nso-2 {
                      config {
                          services {
             +                vlan v1 {
             +                    router ex5;
             +                    iface eth3;
             +                    unit 3;
             +                    vid 77;
             +                    description "Interface owned by CFS: v1";
             +                }
                          }
                      }
                  }
              }
.....</pre></div>
            <p>
                     As ex0 resides on lower-nso-1 that part of the configuration goes
                     there and the ex5 part goes to lower-nso-2.
                   
            </p>
         </div><script type="text/javascript" src="common/main.js">
            <!----></script><script type="text/javascript" src="common/splitterInit.js">
            <!----></script><div class="footer" id="footer-legal">
            <div class="footer-legal framework-footer-cq">
               <div id="framework-footer">
                  <div id="footer-legal"><a href="http://www.cisco.com/web/siteassets/legal/terms_condition.html">Terms &amp; Conditions</a> |
                                 <a href="http://www.cisco.com/web/siteassets/legal/privacy.html">Privacy Statement</a> |
                                 <a href="http://www.cisco.com/web/siteassets/legal/privacy.html#cookies">Cookie Policy</a> |
                                 <a href="http://www.cisco.com/web/siteassets/legal/trademark.html">Trademarks</a></div>
               </div>
            </div>
         </div>
      </div>
      <div id="sidebar">
         <div id="leftnavigation" style="padding-top:3px;">
            <div id="tabs">
               <ul style="visibility: hidden;"></ul>
               <div id="treeDiv"><img src="common/images/loading.gif" alt="loading table of contents..." id="tocLoading" style="display:block;" /><div id="ulTreeDiv" style="display:none">
                     <ul id="tree" class="filetree">
                        <li><span class="file"><a href="ncs_lsa.intro.html" tabindex="1">LSA Overview</a></span><ul>
                              <li><span class="file"><a href="ch01s01.html" tabindex="1">Going Big</a></span></li>
                              <li><span class="file"><a href="ch01s02.html" tabindex="1">Is LSA for Me?</a></span></li>
                              <li><span class="file"><a href="ch01s03.html" tabindex="1">Layered Service Design</a></span><ul>
                                    <li><span class="file"><a href="ch01s03s01.html" tabindex="1">New, green field design</a></span></li>
                                    <li><span class="file"><a href="ch01s03s02.html" tabindex="1">Existing monolithic application with stacked services</a></span></li>
                                    <li><span class="file"><a href="ch01s03s03.html" tabindex="1">Existing monolithic application</a></span></li>
                                 </ul>
                              </li>
                              <li><span class="file"><a href="ch01s04.html" tabindex="1">Orchestrating the Work</a></span></li>
                              <li><span class="file"><a href="ch01s05.html" tabindex="1">Provisioning of an LSA Service Request</a></span></li>
                              <li><span class="file"><a href="ch01s06.html" tabindex="1">Implementation Considerations</a></span></li>
                           </ul>
                        </li>
                        <li><span class="file"><a href="ncs_lsa.lsa.html" tabindex="1">LSA examples</a></span><ul>
                              <li><span class="file"><a href="ch02s01.html" tabindex="1">Greenfield LSA Application</a></span></li>
                              <li><span class="file"><a href="ch02s02.html" tabindex="1">Greenfield LSA Application Designed for Easy Scaling</a></span></li>
                              <li><span class="file"><a href="ch02s03.html" tabindex="1">Rearchitecting an Existing VPN Application for LSA</a></span></li>
                              <li><span class="file"><a href="ch02s04.html" tabindex="1">Rearchitecting Details</a></span></li>
                           </ul>
                        </li>
                        <li><span class="file"><a href="ncs_lsa.lsa_setup.html" tabindex="1">Deploying LSA</a></span><ul>
                              <li><span class="file"><a href="ch03s01.html" tabindex="1">RFS Nodes Setup</a></span></li>
                              <li><span class="file"><a href="ch03s02.html" tabindex="1">CFS Node Setup</a></span><ul>
                                    <li><span class="file"><a href="ncs_lsa.lsa_setup.multi_version.html" tabindex="1">Multi Version Deployment</a></span></li>
                                 </ul>
                              </li>
                              <li><span class="file"><a href="ch03s03.html" tabindex="1">Device Compiled RFS Services</a></span></li>
                              <li id="webhelp-currentid"><span class="file"><a href="ch03s04.html" tabindex="1">Example Walkthrough</a></span></li>
                              <li><span class="file"><a href="ch03s05.html" tabindex="1">Migration and Upgrades</a></span></li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>