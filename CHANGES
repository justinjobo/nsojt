NSO-6.2.5 [May 14, 2024]
========================
Security:

Known Issues:

Non-backwards compatible corrections:

  - restconf: When fetching data that includes the origin attribute in JSON,
    the attribute was represented as, e.g.
    "{ "ietf-origin:intended"}" instead of the correct "{"origin":
    "ietf-origin:intended"}", i.e., the following changes have been made:
    1. The attribute type and the attribute value were represented as one
    string instead of two strings separated by a colon, which is how
    key-value pairs are represented in JSON.
    2. The attribute type was represented as the module name, which was
    either ietf-origin or, if you defined your own identity, it was the name
    of the module where that identity was defined, e.g., my-origin. This is
    incorrect, it should always be the attribute type, which is just
    "origin", to conform with how other attributes are represented.
    3. Since origin is an instance-identifier, the value should be prefixed
    by the module name.

    (ENG-34147)

Enhancements:

  - ncs: Fixed an issue where alarms that were sent or cleared during an
    upgrade or when in read-only mode would be lost. Alarms will now be
    queued when they cannot be immediately sent/cleared, and once the node
    goes back to a state in which alarms can be handled again, any
    outstanding alarms will be triggered.

    (ENG-32006)

  - documentation: Added a guide for migrating to the juniper-junos_nc-gen
    NED from the legacy juniper-junos NED. As Junos YANG modules can be
    downloaded from the device and used directly in NSO, the NED can provide
    full coverage immediately when the device is updated instead of waiting
    for a new legacy NED release. See the Development Guide chapter NED
    Development section Migrating to the juniper-junos_nc-gen NED.

    (ENG-33942)

  - documentation: Updated the Deployment chapter in the Administrator Guide
    to use both HA Raft and rule-based HA. A step to recommend compacting
    the CDB files write log when performing an NSO version upgrade was added
    to the Upgrade chapter.

    (ENG-33934, CSCwi67392, BEMS01701412)

  - documentation: Restructured and improved the content of the Services
    chapter in the Development Guide, adding a number of supporting
    examples.

    (ENG-27247)

  - examples: Added a new perf-setvals example to support the latest
    documentation in the Development Guide chapter Scaling and Performance
    Optimization on using the MAAPI shared_set_values() function for large
    configs from a service create callback.

    (ENG-34499)

Corrections:

  - ncs: ENG-29868 introduced a performance regression finding the previous
    node in ordered-by user (OBU) lists. This degradation impacted services
    manipulating large OBU lists.

    (ENG-34417, CSCwj51995, BEMS01728055)

  - ncs: When enabling read-only mode, NSO will ensure that all system
    internal components are set to read-only mode, regardless of the
    interface that triggers the transition. This means that, for example,
    the commit queue will always be stopped before NSO allows the transition
    and will not try to write back results when the node is in read-only
    mode.
    Furthermore, during the HA upgrade, the node will not be set to
    read-only mode anymore, and if the upgrade fails, the node will, from
    now on, be read-write.

    (ENG-34191)

  - aaa: For external authentication, external token validation, and
    external multi-factor authentication, an invalid group name with `\n` is
    now handled gracefully instead of causing a crash error.

    (ENG-31581, CSCwf04917, BEMS01583800)

  - cdb: If an incorrectly created list node was detected in runtime, NSO
    would attempt to recreate the list. If no compaction was performed after
    such an incident, invalid WAL operations could remain in the CDB,
    preventing NSO from booting up.
    CDB now resolves invalid list nodes during startup and ensures they are
    removed by automatically compacting the WAL files.

    (ENG-34628)

  - cdb-capi: Improved the cdb_capi cache to address a  prepare phase
    subscriber cdb_get_values() performance issue.

    (ENG-31067, RT:50198, PS-45330, CSCwe50761)

  - cli: The AAA authorization callback for set commands in J-style CLI now
    works as expected with logging and security checks after the set
    commands were modified in ENG-20247.

    (ENG-34689, RT:51266, PS-46381, CSCwj66799)

  - cli: When a leaf with type leafref is set with a value that does not
    match the pattern of the referenced leaf, the CLI now rejects it and
    asks for a new input in the autowizard instead of raising an internal
    error.

    (ENG-34354, RT:51185, PS-46306, CSCwj29877)

  - cli: Unescape special characters when showing running-config.

    (ENG-32474, RT:50621, PS-45758, CSCwh14606)

  - cli: The CLI now verifies the input to `commit confirmed X` is a
    positive integer.

    (ENG-32411, RT:50593, PS-45730, CSCwh01444)

  - cli: load-merge: Do not add leaf-list default during load-merge if there
    is other configuration for that leaf-list

    (ENG-32392, RT:50574, PS-45710, CSCwf97249)

  - cli: Corrected typo in the description for
    /ncs-config/ssh/algorithms/kex.

    (ENG-30755, RT:50081, RT:50301, PS-45208, PS-45435)

  - cs_trans: Fixed missing validation when using wildcards in 'must'
    statements.

    (ENG-32577)

  - erlang-api: In each transaction accessing (reading or making changes to)
    data with a callpoint implemented by an econfd application, NSO would
    leak an internal resource (a lightweight process and its associated
    data). These internal resources would be noticeable over time for an
    Erlang package as the ncs.smp process increases memory use.
    Now, all processes are correctly linked, preventing resources from being
    left behind.

    (ENG-34463, RT:51210, PS-46331, CSCwj43018)

  - java-api: Removed the snmp-notification-receiver debug logging message
    that included snmp credentials.

    (ENG-34918)

  - json-rpc: When the JSON-RPC call 'get_trans_changes' was used in a
    trans-in-trans context, the wrong backend transaction was used.

    (ENG-34031)

  - netconf: Return the correct <error-info> element when a NETCONF message
    is missing the message-id attribute.

    (ENG-15259, RT:28200, PS-9005)

  - toolchain: Revert ENG-33590 correction.

    (ENG-34845, RT:51299, RT:51291, RT:51299, PS-46415, PS-46407, PS-46415,
    CSCwj80704)

  - toolchain: Fixed an issue with the ncs-project tool when fetching
    packages from servers using non-standard HTTP reason phrases.

    (ENG-34781, CSCwj74485, BEMS01740930)

  - yanger: The deviate replace type in a deviation module no longer causes
    a circular dependency when loading the FXS into NSO.

    (ENG-32766, CSCwi65676, BEMS01649077)

NSO-6.2.4 [April 09, 2024]
==========================
Security:

Known Issues:

Non-backwards compatible enhancements:

  - container: The NSO container images (both prod and dev) now install
    python3.11 (currently Python 3.11.5) using the dnf package manager,
    allowing users to effectively upgrade Python themselves by running dnf
    upgrade in their own images.

    (ENG-34315)

Non-backwards compatible corrections:

  - cli: Deleting a non-existing leaf under a YANG choice statement now
    returns "ok".

    (ENG-34317, RT:51138, PS-46257, CSCwj23753)

Enhancements:

  - ncs: Add revision to the log when loading YANG modules with duplicate
    namespaces but different revisions.

    (ENG-20632)

  - aaa: Single sign-on can now be configured to initiate automatically if
    there is a single sign-on package. When not enabled, or when there is
    more than one package, any configured packages will be displayed on the
    webUI login page.
    The cisco-nso-saml2-auth package supports a next query parameter to
    direct the user to a URL when authentication finishes.
    If a package authentication script fails, all returned lines are now
    logged.

    (ENG-32786)

  - container: The NSO container now uses ENTRYPOINT for the /run-nso.sh
    script rather than CMD. This means users can now provide NSO start-up
    arguments (e.g. --with-package-reload) as CMD input rather than using
    the EXTRA_ARGS environment variable. EXTRA_ARGS environment variable
    will still be used, but there is now a more correct way to do it if you
    prefer.

    (ENG-34314)

  - python-api: Using multiprocessing in NSO will now use the spawn method
    instead of fork. Python 3.14 is scheduled to use spawn as the default
    method to avoid issues that can occur using the fork method. This change
    avoids issues with the Python API closing sockets towards NSO upon
    errors in multiprocessing children.

    (ENG-33931, CSCwi67305, BEMS01692997)

  - smart-licensing: Updated webapp-runner to 9.0.86.0

    (ENG-33374)

  - webui-one: Enhanced the Configuration Editor by hiding edit buttons for
    lists when the user lacks permission for the corresponding operation.
    This streamlines the user experience by preventing attempts to edit data
    that would ultimately result in access being denied.

    (ENG-34320)

Corrections:

  - ncs: Allow setting an encrypted string on a leaf of a different
    encryption type, even if NSO cannot first decrypt the string due to the
    absence of the encryption key.

    (ENG-34461, CSCwj42194, BEMS01730616)

  - ncs: The underlying SSH implementation is corrected to prevent the
    connection from dropping after the SSH rekeying.

    (ENG-34428, CSCwj38678, BEMS01730920, BEMS01731673)

  - ncs: The cli-drop-node-name and cli-suppress-mode extensions are no
    longer removed from nodes in the device and compliance template subtrees
    to prevent discrepancies in the CLI behavior with
    /devices/device/config.

    (ENG-34343, CSCwj28404, BEMS01720999)

  - ncs: When modifying a nested choice structure, NSO incorrectly generated
    a delete operation for nodes in the inactive case, resulting in an
    invalid NETCONF payload in some cases.

    (ENG-34301, RT:51146, PS-46265, CSCwj21605)

  - ncs: Actions returning significant amounts of data from CLI and generic
    NEDs no longer consume excessive amounts of memory in NSO. If the reply
    is too large, it is omitted from the trace log.

    (ENG-34194)

  - ncs: A service's backtracking would previously be erroneously considered
    completed if the goal state of the backtrack could not be entered
    because of, e.g., an unfulfilled delete pre-condition. In these cases,
    eventual delete callbacks defined on the goal state would not be
    executed.

    (ENG-34186, RT:51118, PS-46238, CSCwj07550)

  - ncs: Fixed an issue with the commit queue with rollback-on-error enabled
    that, in some cases, could cause the commit queue to deadlock and be
    unable to make progress.

    (ENG-34179)

  - ncs: Raise an error when multiple callbacks are registered for the same
    service point when:
    - starting NSO with option --with-package-reload
    - perform action request packages reload
    - perform action request packages package ... redeploy

    (ENG-33590, CSCwi25475, BEMS01671348)

  - ncs: Clean up the client session when an in-service upgrade fails.

    (ENG-32878, CSCwh59426, BEMS01617844, BEMS01642541)

  - ncs: System messages are processed while NSO executes external commands.

    (ENG-32618, CSCwh36370, BEMS01631421)

  - ncs: Added support to assert the absence of configuration on a device to
    compliance templates. The tag 'absent' can be added to a node to assert
    the absence of the configuration on the device instead of asserting its
    presence, which is the default behavior if no tag is specified. The tag
    'delete' can be used in device templates to assert the absence of
    configuration on a device. It is also supported by compliance templates,
    which are synonyms for the 'absent' tag.

    (ENG-32613)

  - ncs: Correctly decrease the FASTMAP refcount by validating the
    tailf:cli-sequence-command YANG extension.

    (ENG-32464, CSCwh13112, BEMS01618889, BEMS01649449)

  - aaa: The Authentication Packages cisco-nso-ldap-auth,
    cisco-nso-saml2-auth, and cisco-nso-tacacs-auth now write their logs to
    the correct location when used by a system-installed NSO.

    (ENG-34448)

  - aaa: Groups were not assigned when using package authentication without
    single sign-on with JSON-RPC. As expected, groups are now assigned upon
    successful login over JSON-RPC when using package authentication without
    single sign-on.

    (ENG-34054)

  - c-api: Fixed a memory leak in the ncs_cmd traverse_list command.

    (ENG-34063, RT:51107, PS-46227, CSCwi89405)

  - cs_trans: Executing a write action on a read-only transaction (for
    example, operational mode in the CLI) will return a corresponding error.

    (ENG-33183, CSCwh91567, BEMS01652942)

  - documentation: Added more details to the
    com.tailf.ned.NedConnectionBase.createSubscription() Java API method
    documentation regarding NSO re-establishing a notification stream
    connection.
    See the NSO Java API documentation under "Package com.tailf.ned".

    (ENG-32244, BEMS01594083, BEMS01692387)

  - ha: Always return the local node-id when fetching the node-id of a HA
    Raft node with /tfnm:ncs-state/tfnm2:ha/node-id. Previously, the node-id
    of the local node was only returned if the node was in either leader or
    follower state; otherwise, 'not found' would be returned.

    (ENG-34296)

  - ha: Terminate a process that previously caused a process leak when a
    secondary node retries to join the HA cluster.

    (ENG-34002, RT:51066, PS-46187, CSCwi78977, BEMS01722544)

  - ha: NSO now ensures transactions in an HA Raft cluster are permitted
    only on an active leader by changing to read-only mode when a node has
    the role disabled, stalled, or candidate.

    (ENG-31211)

  - java-api: Fixed an issue with the MaapiOutputStream.hasWriteAll
    function, which sometimes led to the MAAPI request being performed
    inside the function and receiving the wrong MAAPI reply.

    (ENG-33977)

  - json-rpc: Logging in using Package Authentication, with username and
    password, now works correctly with JSON-RPC.

    (ENG-34341, RT:51123, PS-46243, CSCwj50404, BEMS01732410)

  - ned: Fixed an issue with moves referencing a list element deleted in the
    same transaction when using the juniper-junos NED, leading to the
    resulting edit-config command being rejected by the device.

    (ENG-18384, RT:35207, RT:44798, RT:32618, PS-30278, PS-39909, PS-28361,
    SR:684218959)

  - netconf: A particular XPath filter, when issuing a NETCONF get-config
    request,
    resulted in the returned XML to be invalid; several of the
    expected top elements were missing in the output.

    (ENG-33288, RT:51067, RT:50861, PS-46188, PS-46000, CSCwh97776)

  - ssh: Connecting to NSO using SSH with an incorrectly encoded password
    previously generated an error log entry. Now, incorrectly encoded
    passwords are handled gracefully without creating entries in the error
    logs.

    (ENG-33948, CSCwi68895, BEMS01692988)

  - upgrade: Corrected an issue where a CDB upgrade altered the order of an
    ordered-by user (OBU) list with modified keys, e.g., upgrading the key
    type from int16 to int32 in the YANG model.

    (ENG-34282)

  - upgrade: Reading the operational datastore at the commit phase of an
    in-service upgrade could lead to a race condition while deleting old
    namespace tables.
    Deletion of old namespace tables is now handled in order.

    (ENG-32900, CSCwh61770, BEMS01578466)

  - webui-one: Previously, when the compliance report was run with an output
    format other than 'sqlite', the detailed results in the WebUI were
    unavailable.
    The compliance report WebUI has been enhanced to allow viewing report
    details regardless of the selected output format.
    Users can now consistently view compliance report details within the
    WebUI, as the details will always display the SQLite database results.

    (ENG-33653)

  - xpath: Corrected an XPath starts-with() issue with certain ordered-by
    user lists, specifically when used with an external data provider that
    does not support list filtering.

    (ENG-34311, RT:51177, PS-46297, CSCwj23513)

  - yanger: Correct a compilation issue when deviating a leafref defined in
    a submodule.

    (ENG-34001)

  - yanger: 'ncsc' now can handle deviation and target modules that use the
    same prefix but are associated with different imported modules.

    (ENG-33355)

  - yanger: The length and range statements for type string can now have the
    same upper- and lower-inclusive bound value.

    (ENG-29377, RT:49463, PS-44583, CSCwc24664)

NSO-6.2.3 [March 11, 2024]
==========================
Security:

Known Issues:

Non-backwards compatible enhancements:

  - cli: A new config element is introduced under
    /ncs-config/cli/default-table-behavior with "suppress", "dynamic", and
    "enforce" as accepted values. The default value is "suppress". To
    continue getting a tabulated output from commands, change the setting in
    ncs.conf or pipe the output to "tab".

    (ENG-31668, CSCwf12667, BEMS01581127)

Non-backwards compatible corrections:

  - ncs: List elements not matching any of the list assertions were
    previously reported as violations when running a compliance template in
    non-strict mode. I.e., a strict mode was implicitly enforced on a list
    node if the compliance template asserted the existence of a list node
    element. The existence of list elements not matching any list assertion
    is now only reported as a violation if the compliance report is run in
    strict mode.

    (ENG-33667)

  - restconf: Previously, when trying to set config with RESTCONF yang-patch
    that caused a when-expression to fail, an ok response was returned
    instead of the expected error. The invalid config was still not set. NSO
    now returns the expected error informing the user of the when-expression
    failure.

    (ENG-33172, RT:50773, PS-45916, CSCwh91116)

Enhancements:

  - ncs: Updated SSHJ to version 0.38.0.

    (ENG-33960, BEMS01713254)

  - ncs: NEDs are now seen as part of the system, and NACM rules will not be
    evaluated when the NED code is executed. Previously this could lead to
    issues with NEDs that needed to write back operational data while
    executing, and the NACM rules were too restrictive.

    (ENG-33163, CSCwh89872, BEMS01647101, BEMS01677442)

  - c-api: Improve robustness of shared schema loading in the C derived APIs

    (ENG-33815)

  - documentation: Added a new "Designing for Maximal Transaction
    Throughput" section to the Development Guide "Scaling and Performance"
    chapter which references the updated
    examples.ncs/development-guide/concurrency-model/perf-trans, perf-stack,
    and perf-lsa examples.
    Merged the Best Practices "Scaling and Performance" section into the
    Development Guide "Scaling and Performance" chapter.

    (ENG-34039)

  - ha: Added additional documentation on generating TLS certificates for HA
    Raft.

    (ENG-34068)

  - ha: Simplified the internal package upgrade protocol used when upgrading
    packages in an HA Raft cluster.

    (ENG-33992)

Corrections:

  - ncs: Fixed an issue where a service's plan was set to fail if errors
    were encountered when dry-running the service.

    (ENG-34224, RT:51110, PS-46230, CSCwj10924)

  - ncs: Fixed an issue fetching the /devices/device/notifications/stream
    with the new live-status NED API.

    (ENG-34130)

  - ncs: Fixed an issue that would cause an internal error when certain nano
    plan extensions, e.g., ncs:variable, were the last element defined in a
    ncs:selector.

    (ENG-34110)

  - ncs: CDB cache invalidation could cause the system to crash due to a
    missing lock. The use of the cache lock has been updated to protect
    against this scenario. The crash was most likely to occur during heavy
    load.

    (ENG-34086)

  - ncs: Fixed an issue with a package upgrade in HA Raft that enabled
    transactions, in some cases, to be processed during the upgrade, leading
    to errors.

    (ENG-34005)

  - ncs: Fixed an issue with handling lists with keys when forwarding device
    notifications in NSO.

    (ENG-31341)

  - ncs: Fixed an issue when fetching leaves of type instance-identifier
    with absolute paths from a device using live-status.

    (ENG-30786)

  - aaa: saml2-auth has updated dependencies due to deprecations in Python
    3.12.

    (ENG-34136)

  - cdb: Resolved the CDB upgrade issue when upgrading from NSO version 5.1.

    (ENG-34004)

  - cdb-capi: Fixed an issue with an XPath error when the mount point could
    not be found during an upgrade after a package reload. This caused the
    package reload to abort and the connection to unexpectedly close when
    removing a leaf with a default value set and a when statement.

    (ENG-33836, CSCwi55430, BEMS01682184)

  - cli: When displaying data in table format, the CLI did not invoke the
    get_case() callback to retrieve data values for the selected case of a
    choice node.

    (ENG-32460, RT:50598, PS-45735, CSCwh12459)

  - cs_trans: ENG-32972 introduced a regression causing
    _ncs.maapi.start_trans_in_trans() to fail whenever the base transaction
    was read-only.

    (ENG-34019, RT:51007, PS-46135)

  - cs_trans: ENG-33809 fixed duplicate kicker invocations when overlapping
    transactions caused the same kicker to be invoked. When used in
    combination with services, the change in ENG-33809 caused a regression,
    making transactions fail with an internal error. The affected code has
    been updated to be more robust.

    (ENG-33971, RT:51082, PS-46202, CSCwi73793)

  - cs_trans: Reduced time spent on device deletion in a system with many
    services.

    (ENG-33885, CSCwi61357, BEMS01667848)

  - cs_trans: Corrected an inconsistency when validating, causing an
    inconsistent commit dry-run result when changing an NSO service.

    (ENG-33453, RT:50878, PS-46017, CSCwi12668)

  - examples: The single-sign-on NSO example has been reworked to function
    correctly with Python 3.12. The TLS data is now generated instead of
    using flask-saml2 test data. The example idp.py server now handles
    different users as well.

    (ENG-34138)

  - examples: The packageauth example used the "Authorize" HTTP header,
    which doesn't exist. It now uses the correct "Authorization" HTTP
    header.

    (ENG-34081)

  - ha: Fixed an issue in an HA Raft cluster that was causing the list
    returned from '/tfcm2:ha/secondaries' to be incorrect in some cases.

    (ENG-33980)

  - ha: A node in an HA Raft cluster should become disabled if it fails to
    open a snapshot sent from the primary node. Previously, nodes would
    enter the follower state briefly before transitioning to the disabled
    state. Now, nodes will enter the disabled state immediately upon failure
    to open a snapshot.

    (ENG-33951)

  - ha: Fixed an issue in HA Raft that sometimes caused state transitions to
    occur before the node had processed all log entries received in its
    previous state. This sometimes led to errors when a node tried to
    process old log entries after transitioning to its new state.

    (ENG-33883)

  - ha: Fixed an issue in HA Raft that could cause the primary node to hang
    indefinitely, waiting for a quorum when shut down.

    (ENG-33620)

  - ha: Status information under /high-availability/status can now be
    accessed even though the node is busy in a long-running HA task, such as
    when a secondary node joins the cluster.

    (ENG-29840)

  - java-api: Fixed an issue where ConfTypeDescriptor::getConfTypeDescriptor
    would incorrectly return a ConfTypeDescriptor object of type ConfInt64
    instead of ConfDecimal64.

    (ENG-34056, RT:51097, PS-46217, CSCwi87527)

  - json-rpc: JSON-RPC processing of login calls has been corrected so that
    it does not cause NSO to terminate in very rare cases.

    (ENG-34193, CSCwj07998, BEMS01718635)

  - json-rpc: Using the JSON-RPC "load" method to set an invalid attribute
    that causes a "bad attribute" error would return an error message in a
    partially unreadable format. Now, the error message is correctly
    formatted.

    (ENG-34089)

  - netconf: RFC 6470 NETCONF Base Notifications are now also created when
    the edit target contains multiple consecutive spaces.

    (ENG-32423, RT:50601, PS-45738, CSCwh03012)

  - upgrade: Prior to NSO-6.3, plan/component/state/.../create-cb and
    delete-cb were internally represented as 'booleans' while externally
    modeled as 'string' in the $NCS_DIR/src/ncs/yang/tailf-ncs-plan.yang
    submodule.
    In NSO-6.3 ENG-21948 corrected the external representation of the
    create-cb and delete-cb from type 'string' to type 'boolean' to match
    the stored content, but the upgrade code could not handle that
    conversion.
    The issue has been solved by updating the upgrade code to handle the
    special case where 'booleans' are stored as 'strings'.

    (ENG-33900, BEMS01698551)

  - xpath: Corrected an issue where the XPath expression evaluation result
    output from CLI and MAAPI was empty instead of 'false'.

    (ENG-33808, CSCwi53130, BEMS01684679)

  - yanger: The performance of the ncsc --get-uri command has been improved.
    Mounted namespaces are now displayed correctly in the ncsc --get-uri and
    ncsc --get-info output.

    (ENG-27287)

NSO-6.2.2 [January 31, 2024]
============================
Security:

Known Issues:

Enhancements:

  - container: Added recommendations to the Administration Guide System Dump
    and Disable Memory Overcommit chapter.

    (ENG-32362)

  - cs_trans: Improved validation performance for certain scenarios when
    deleting a leaf referenced by nested lists.

    (ENG-33713, CSCwi39032, BEMS01661393)

  - documentation: Added additional information on client interfaces,
    accessible with the default configuration, and how to secure them
    further.

    (ENG-33904)

  - documentation: Updated the NSO Administration Guide to add a new section
    'Pre- and Post-Start Scripts' in the Containerized NSO chapter.

    (ENG-33733)

  - json-rpc: JSON-RPC get_schema now optionally includes the cdm-namespace
    to match JSON-RPC get_system_setting model CDM style namespaces.

    (ENG-31393)

  - ned: Reject attributes from the NETCONF/YANG standard when used in
    service templates.

    (ENG-31386, CSCwe84820, BEMS01574254)

  - restconf: The "exclude" query parameter has been added to RESTCONF. It
    can be used with the GET method to exclude a subtree from the returned
    output. "exclude" uses the same syntax and has the same restrictions as
    the "fields" query parameter, as defined in RFC 8040 section 4.8.3.
    NOTE: "exclude" cannot be used together with the "fields" query
    parameter. This will return an error.
    For more information, see the "The Northbound API" guide section "The
    exclude query parameter".

    (ENG-33451)

  - security: The underlying SSH implementation was updated so SSH can
    negotiate the "strict KEX" OpenSSH extension with peers supporting it.

    (ENG-33912)

Corrections:

  - ncs: Added optional nodes are no longer reported as backward
    incompatible when reloading packages with the 'report
    all-schema-changes' option.

    (ENG-33795, CSCwi51359, BEMS01682775)

  - ncs: Fixed an issue where an rpc-reply with both rpc-error and
    rpc-response in the same reply resulted in an internal error.

    (ENG-33271, CSCwh97639, BEMS01651144)

  - cli: Fixed a case where the C-style southbound configuration diff would
    display duplicate lines triggered by a diff-dependency (e.g.,
    tailf:cli-diff-before).

    (ENG-30124, RT:49830, PS-44956, CSCwd41301)

  - cs_trans: Correct an issue where, when recreating a leaf that has a
    default value defined in a choice case, the choice case was wrongly
    deleted.

    (ENG-33730, RT:50963, PS-46097, CSCwi41468)

  - restconf: Syntax error for RESTCONF fields query parameter would
    previously state that there was an error in the "select" specification.
    This has now been changed so that the error message instead mentions
    "fields".

    (ENG-33862)

  - restconf: Previously, only GET was allowed for fields, content, and
    depth query parameters. However, HEAD should also be allowed. In
    addition, with-default was previously allowed with all methods, but it
    should only be permitted with GET and HEAD. This is according to RFC
    8040 section 4.8. An exception is when with-defaults is used with the
    RESTCONF Query API. In this case, it can be used with
    "fetch-query-result", and in this situation other methods are allowed as
    well.

    (ENG-33840)

  - restconf: Package Authentication can now authenticate large RESTCONF
    requests.

    (ENG-33731, RT:50976, PS-46103, CSCwi41543)

  - webui-one: In the Configuration Editor, actions related to templates
    that should alter the configuration now produce changes in the current
    write transaction.

    (ENG-31520, CSCwe99928, BEMS01567142)

  - yanger: Resolved a compilation error when using 'ncsc
    --ncs-compile-bundle' on a YANG model where the model contains an
    augment statement defined in a submodule, augmenting a node defined in
    the main module.

    (ENG-33132)

NSO-6.2.1 [December 18, 2023]
=============================
Deprecated:

  - ncs: The ncs.conf(5) leaf
    /ncs-config/notifications/event-streams/stream/include-component-type
    changed status to  'obsolete'. Configuration of the leaf has no effect.
    The leaf is scheduled for removal in NSO 6.5.

    (ENG-33593)

Security:

Known Issues:

Enhancements:

  - ncs: NSO will now try to merge service actions of the same type executed
    concurrently on the same service instance into a single to improve
    performance. The merging capabilities of NSO have been improved, which
    enables merging concurrent service actions in more situations than
    previously.

    (ENG-30653, RT:50786, PS-45927)

  - examples: Added new perf-stack and perf-lsa examples under
    examples.ncs/development-guide/concurrency-model directory. These
    examples support the Services, Scaling and Performance Optimization, and
    Concurrency Model documentation in the Development Guide.

    (ENG-33662)

  - json-rpc: An 'action' writing and storing configuration data and
    committing using the JSON-RPC API resulted in an error. To support
    handling such an 'action', the get_schema was updated to respond with
    the YANG extension flag tailf:cli_configure_mode set on the 'action'
    node. Now, after invoking JSON-RPC operation run_action, that 'action's
    outcome can be committed successfully.

    (ENG-31404)

  - packages: The cisco-nso-saml2-auth package now logs a stack trace with
    debug level to the package log if an exception occurred.

    (ENG-33494)

  - rollback: Added dry-run option to the
    /rollback-files/apply-rollback-file action.

    (ENG-33365)

  - upgrade: For performance reasons, the values of instance-identifier and
    identityref leafs in the operational datastore are no longer being
    validated.

    (ENG-33639)

  - webui-one: Links to the Configuration editor will now enable 'Edit
    config' mode by default to show the data available more clearly.

    (ENG-32572, CSCwh27397, BEMS01626319)

Corrections:

  - ncs: Fixed an issue that led to the commit queue failing when deleting a
    commit queue item with an associated service instance whose external
    plan location does not exist.

    (ENG-33626, RT:50916, PS-46055, CSCwi27263)

  - ncs: Fixed an issue with ordered-by-user list and commit no-overwrite
    that was, in some cases, leading to false positive out-of-sync errors.

    (ENG-33574, CSCwi22205, BEMS01669288)

  - ncs: Changed the Device Manager service column counter to be on demand
    using a button instead of an on-page load to reduce load times.

    (ENG-33344, CSCwi02720, BEMS01652236)

  - ncs: Fixed an issue with post-actions that could lead to failure to
    write back the post-action result if many post-actions belonging to the
    same service instance run concurrently.

    (ENG-33343)

  - ncs: Improved the error reporting when loading configuration and failing
    to decode a base64-encoded value.

    (ENG-33178, RT:50833, PS-45972, CSCwh91267)

  - ncs: Fixed an issue with the SNMP Notification Receiver. It will now
    retry to start properly when there is a temporary address conflict.

    (ENG-19941, RT:50933, RT:42938, RT:35354, PS-46067, PS-38054, PS-30428)

  - aaa: The logging for Package Authentication challenges has been
    corrected.

    (ENG-33522)

  - aaa: NETCONF/RESTCONF erroneously gave an 'Access Denied' error when a
    set-hook modified nodes that the user was not allowed to modify.
    According to the NACM RFC 8341, implicit changes such as modifications
    done by set-hook or when-expressions should not be considered in access
    checks.

    (ENG-31666, RT:50312, PS-45446, CSCwf12460)

  - cdb: When the maximum number of files is decreased, and #handle.maxF of
    disk_log is stored as a tuple {NewMaxFile, OldMaxFile} instead of an
    integer, the disk_log failed when trying to find numerical order by
    using the rem operator with this tuple. The disk_log now handles the
    case where #handle.maxF is a tuple.

    (ENG-33287, RT:50792, PS-45933, CSCwh97775)

  - cli: When displaying the C-style configuration diff - the annotation
    'tailf:cli-remove-before-change' did not affect modified choice nodes.
    This has been fixed so that a 'no' line will be displayed when there is
    a case switch.

    (ENG-32812, RT:50699, PS-45837, CSCwh53877)

  - documentation: When updating RESTCONF documentation for ENG-30095, some
    parts needed to be included. The list of supported RFCs and capabilities
    is now updated.

    (ENG-33587)

  - erlang-api: The function econfd:new_worker_socket/2 did not work when
    called from an external Erlang process.

    (ENG-32637, CSCwh73576, BEMS01630309)

  - ha: When an HA transition occurs, any ongoing transaction is aborted. If
    the primary received a reply message for a distributed message after the
    transaction was aborted, the transaction returned an internal error.
    Reply messages are now handled accordingly, and the transaction returns
    an informative error message.

    (ENG-33364)

  - ha: When logging in to a secondary node in a High Availability (HA)
    cluster, a misleading error message was written to the developer log,
    stating that a read_write transaction is rejected since the node is in
    read-only mode. This faulty error message is no longer written to the
    developer log.

    (ENG-32728, CSCwh47313, BEMS01633480)

  - java-api: Fixed an issue with Maapi.loadConfigCmds() and very large
    command strings that can result in a NegativeArraySizeException being
    thrown when converting the command string to a byte array due to a
    limitation in Java.

    (ENG-31869)

  - json-rpc: A get-schema in JSON-RPC request with the
    "evaluate_when_entries" parameter set to false when the YANG model
    included a "when" statement could, in some cases, result in an internal
    error. Now, the schema will be returned as expected.

    (ENG-32486, RT:50638, PS-45775, CSCwh16594)

  - kickers: Addressed an issue occurring when concurrently invoking a
    kicker that created an operational data list entry that, in turn, was
    monitored by a second kicker. The operational data list entry created by
    the first kicker now causes the second kicker to be invoked only once
    instead of multiple times.

    (ENG-32517)

  - logging: Fixed an internal error that occurred when the server
    terminated the connection while running the remote command server.

    (ENG-33690)

  - logging: NSO will now not attempt to log failing transactions to the
    transaction error log if the underlying data structure storing the
    transaction is unavailable. Starting with NSO 6.2, if there's a failure
    to create or commit a transaction due to an internal error, the contents
    of the transaction will be dumped to the transaction error log if
    enabled in the configuration. If the transaction failure were caused by
    the transaction data becoming, this would cause the attempt to dump the
    transaction to itself fail, potentially making the system partially
    unresponsive.

    (ENG-33554)

  - packages: The cisco-nso-saml2-auth package now handles SAMLResponse with
    encoding="UTF-8" in the XML declaration correctly.

    (ENG-33500)

  - packages: The "groups" and "gids" attributes for extra groups are
    documented as optional in the cisco-nso-saml2-auth README, however they
    were treated as required. The "groups" and "gids" attributes are now
    handled correctly as optional.

    (ENG-33499)

  - restconf: In some cases, providing a non-existent node in the path for
    the "fields" query parameter in RESTCONF would result in an internal
    error. Now, this will result in no match for the node since the path is
    incorrect.

    (ENG-33722)

  - restconf: Basic authentication now correctly accepts passwords that
    contain colons.

    (ENG-32421, RT:50587, PS-45724, CSCwh02668)

  - toolchain: Moved an error message caused by the client side closing the
    TCP connection when doing daemon queries (for example "ncs --status") to
    devel.log and changed it to informational.

    (ENG-33126)

  - web-server: Navigating to a case containing namespaces in the
    Configuration Editor will no longer cause the current webui session to
    fail.

    (ENG-32959, RT:50764, PS-45907, CSCwh68591)

  - webui-one: The edit config mode in the configuration editor is now
    disabled for secondary nodes in the high availability setup.

    (ENG-33137, RT:50824, PS-45963)

  - webui-one: Hidden and private service data nodes are now excluded from
    the Configuration Editor.

    (ENG-32397, RT:50746, RT:50591, PS-45889, PS-45728, CSCwf99253)

  - xpath: Addressed an XPath evaluation issue when the predicate of a list
    node contains an XPath count() built-in function that counts the
    children of the list node.

    (ENG-33058)

  - yanger: Resolved a compilation error that occurred when using 'ncsc
    --ncs-compile-bundle' on a YANG model containing a leafref defined in a
    submodule, which referred to a leaf augmented into another module by the
    main module.

    (ENG-33643)

  - yanger: Specifying 'tailf:opaque' with a string length greater than 255
    characters caused an internal error in ncsc. Now, it will output a
    descriptive error instead.

    (ENG-32538, RT:50655, PS-45792, CSCwh25449)

NSO-6.2 [November 15, 2023]
===========================
Deprecated:

  - ncs: Deprecated the plan-outline extension 'self-as-service-status'.

    (ENG-30176)

  - ncs: Deprecated /software/repository in the tailf-ncs-software module.

    (ENG-22131)

  - c-api: The following functions have been deprecated and are scheduled
    for removal in NSO 6.4:
    - maapi_report_progress()
    - maapi_report_progress2()
    - maapi_report_progress_start()
    - maapi_report_progress_stop()
    - maapi_report_service_progress()
    - maapi_report_service_progress2()
    - maapi_report_service_progress_start()
    - maapi_report_service_progress_stop()
    Please update the user code to the below functions instead:
    - maapi_start_progress_span()
    - maapi_progress_info()
    - maapi_end_progress_span()
    Consult the confd_lib_maapi(3) man page for more information.

    (ENG-33260)

  - infrastructure: Releases based on Darwin x86_64 platform, intended for
    development, will be discontinued by June 2025.

    (ENG-31547)

  - java-api: Deprecated Java Management Extension (JMX) framework. It is no
    longer enabled by default.

    (ENG-33028)

  - java-api: Deprecated the following methods in com.tailf.maapi.Maapi:
     - reportProgress
     - reportProgressStart
     - reportProgressStop
     - reportNedProgress
     - reportNedProgressStart
     - reportNedProgressStop
     - reportDeviceProgress
     - reportDeviceProgressStart
     - reportServiceProgress
     - reportServiceProgressStart
     - reportServiceProgressStop
    User code should now use the new 'com.tailf.progress' package.

    (ENG-32340)

  - maapi: Deprecated the following MAAPI flags:
    MAAPI_NCS_COMMIT_SAVE_TRANS
    MAAPI_NCS_APPLY_DIFF_SET
    MAAPI_NCS_UPDATE_PLAN_HISTORY
    MAAPI_NCS_COMMIT_SAVE_NO_DIFFSET
    MAAPI_CONFIG_UNSUPPORTED_J_OPER
    MAAPI_COMMIT_NCS_THROUGH_COMMIT_QUEUE

    (ENG-32175)

  - observability: Deprecated the /ncs-config/logs/trace-id configuration
    parameter scheduled to be removed in NSO-6.4. Once removed, trace-id
    will always be enabled, and it will not be possible to disable it.

    (ENG-31889)

  - python-api: Python 3.7 support has been deprecated and will be removed
    in NSO 6.4. Python applications should upgrade their environment and
    verify with Python 3.10 or later.

    (ENG-33399)

  - python-api: The following functions in the modules _ncs.maapi and
    ncs.maapi have been deprecated and are scheduled for removal in NSO 6.4:
    - report_progress()
    - report_progress2()
    - report_progress_start()
    - report_progress_stop()
    - report_service_progress()
    - report_service_progress2()
    - report_service_progress_start()
    - report_service_progress_stop()
    Please update the user code to the below functions instead for the
    low-level API:
    - _ncs.maapi.start_progress_span()
    - _ncs.maapi.progress_info()
    - _ncs.maapi.end_progress_span()
    and the high-level API:
    - ncs.maapi.start_progress_span()
    - ncs.maapi.progress_info()
    - ncs.progress.Span.end()
    Consult the Python API reference manual for more information.

    (ENG-33261)

Removals:

  - ncs: The file tailf-common-monitoring-ann.yang was deprecated in NSO 6.0
    and has now been removed in favor of tailf-common-monitoring2-ann.yang.

    (ENG-32581)

  - ncs: The file tailf-common-monitoring.yang was deprecated in NSO 6.0 and
    has now been removed in favor of tailf-common-monitoring2.yang.

    (ENG-30950)

  - ncs: The deprecated leaf-list backward compatibility mode has been
    removed. To achieve this, the deprecated flags
    'ITER_WANT_LEAF_LIST_AS_LEAF', 'CONFD_DAEMON_FLAG_LEAF_LIST_AS_LEAF',
    'DEPRECATED_MAAGIC_WANT_LEAF_LIST_AS_LEAF', 'leaf_list_as_leaf' and
    'leafListAsLeaf' have been removed.
    Please modify any data providers and transform applications still using
    the deprecated 'leaf-list as leaf' mode to use the new leaf-list mode.
    In data providers/transforms for each leaf-list:
    * Stop handling leaf-lists in the 'set_elem' callback. Instead, handle
    them in the 'create' callback. Instead of receiving 100 elements in
    'set_elem' at once, you will now get 100 callbacks to 'create'.
    * Stop handling leaf-lists in the 'get_elem' callback. Now you need to
    support leaf-lists in 'get_next' callbacks. If you use C code, you will
    probably need to use the transaction context to store your iterator.
    * You will now need to implement the 'exists_optional' callback.
    Previously, this callback was only used for 'type empty' leafs and
    presence containers.

    (ENG-20459)

  - json-rpc: The get_service_points JSON-RPC method has been removed.
    Instead, use the /services/service-type list, which is available through
    all northbound APIs.

    (ENG-30881)

Security:

  - security: Resolved a privilege escalation vulnerability in the NSO
    built-in Secure shell (SSH) server subsystem handling when SSH access to
    the CLI is enabled.
    To prevent unauthorized access, when the SSH client does not specify the
    SSH server subsystem option, the SSH server will fail the subsystem
    request instead of selecting the SFTP subsystem.
    https://sec.cloudapps.cisco.com/security/center/content
    /CiscoSecurityAdvisory/cisco-sa-nso-priv-esc-XXqRtTfT

    (ENG-32611, RT:50683, PS-45820, CSCwh35199)

Known Issues:

Non-backwards compatible enhancements:

  - infrastructure: NSO Java API is now built targeting Java17. Java17 or
    later should be present in order for NSO to run.

    (ENG-31621)

  - java-api: NSO now requires Java version 17 or higher in order to use the
    Java API, since NSO's Java API is compiled with Java version 17 as the
    target version.

    (ENG-31537)

  - logging: Improved logging for high-availability packages reload and
    package add features.

    (ENG-31142)

  - maapi: Addressed an error raised when sending system messages to all
    active sessions when there were no active sessions. This affects all
    MAAPI interface language bindings.

    (ENG-32142, RT:50469, PS-45603, CSCwf66402)

  - ssh: The underlying SSH implementation was upgraded, and support for the
    mac algorithms 'hmac-sha2-256-etm@openssh.com' and
    'hmac-sha2-512-etm@openssh.com' was added for the SSH southbound
    communication.

    (ENG-32441, CSCwh09235, BEMS01622797)

  - upgrade: Separate CDB upgrade log from developer log.

    (ENG-32144)

  - yanger: Dependencies for a deref passing through a leafref leaf-list
    could not be calculated or validated by yanger. This has now been
    corrected.

    (ENG-31536)

Non-backwards compatible corrections:

  - ncs: In certain cases the ncs_load program did not emit correct JSON
    lists with enclosing brackets. Now lists are emitted with enclosing
    brackets.

    (ENG-32776)

  - ha: NSO built-in "rule-based" HA: In cases when a failover took place,
    an HA secondary could fail to connect to the "new" primary with
    be-secondary-result of "error (27) - FXS mismatch" and the devel.log on
    HA primary containing:
    <ERR> 31-Oct-2023::06:51:11.369 wedn ncs[58061][<0.390.0>]: ncs
    Namespaces differ between primary and secondary:
    http://tail-f.com/ns/ncs/high-availability/raft
    This issue was introduced in NSO-6.1.2 to hide
    tailf-high-availability-raft.fxs module from northbound interfaces when
    HA Raft was disabled by altering the exported_agents field in the
    running FXS state in NSO.
    The exported_agents field in the FXS state is no longer altered and
    tailf-high-availability.fxs will always be available northbound unless
    the operator recompiles the YANG module with `ncsc --export Agent ...`,
    see the ncsc(1) man page for more info.

    (ENG-33324, CSCwh99536, BEMS01654624)

  - json-rpc: When the show_config method used result_as json2, lists were
    not enclosed within brackets. Now lists are enclosed in brackets with
    json2.

    (ENG-32777)

  - netconf: Deleting a non-existing leaf under choice now returns the
    expected "data-missing" error.

    (ENG-32055, RT:50468, PS-45602, CSCwf57045)

  - netconf: Now using the error-tag 'malformed-message' for some malformed
    error messages that previously had the 'invalid-value' error-tag.

    (ENG-31383)

  - yanger: ncsc has been improved such that it will give an error if a
    'list key' leaf's type is deviated (replaced) to type 'empty'. This is
    in accordance with RFC6020. Also, the ncsc man page states that 'list
    key' leafs cannot have type 'empty' even though RFC7950 allows it.

    (ENG-32010)

Enhancements:

  - ncs: NSO is now more eager to close transaction resources no longer
    needed to free up memory.

    (ENG-32972)

  - ncs: Added a YANG list for reporting errors to the plan data. See
    grouping "plan-errors" in $NCS_DIR/src/ncs/yang/tailf-ncs-plan.yang for
    details.
    NSO now automatically removes side-effect failed/canceled status on a
    service re-deploy/reactive-re-deploy and reports an error when a
    side-effect is canceled in the commit queue.

    (ENG-32573)

  - ncs: Added a daemon log (default ncs.log) entry showing if Erlang JIT is
    enabled or disabled.

    (ENG-32101)

  - ncs: During service reconciliation, a service can now own a sequence
    command if and only if the service itself provides all commands to
    complete the sequence. In all other cases, the removal of the service
    needs to trigger the restoration of the original sequence to avoid
    invalid configuration changes and device errors.

    (ENG-32046, CSCwf54796, BEMS01604295)

  - ncs: To limit memory usage of NSO, log messages collected from Java VM's
    stdout and stderr capture are throttled under high load. If there are
    more than 10K unprocessed log entries, 5k log entries are going to be
    dropped. The act of throttling is logged.

    (ENG-31884, CSCwf40147, BEMS01594249)

  - ncs: Added new operational leaf-list /devices/device/device-group that
    lists the device groups the device is a member of. See
    $NCS_DIR/src/ncs/yang/tailf-ncs-devices.yang under "leaf-list
    device-group" for details.

    (ENG-31758)

  - ncs: Added support for component-type in plan-state-change notification
    in the tailf-ncs-plan.yang YANG submodule. See
    $NCS_DIR/src/ncs/yang/tailf-ncs-plan.yang under "notification
    plan-state-change" for details.

    (ENG-31678)

  - ncs: For external (imported) nano plans, the node above the plan may now
    be created by the pre-modification() callback, which is invoked before
    the FASTMAP nano create() callback is invoked.

    (ENG-31611)

  - ncs: On debug dump, automatically create the required directory path
    unless it already exists, e.g., 'some/dir' for `ncs --debug-dump
    some/dir/dump.bin`.

    (ENG-31514)

  - ncs: Added leaf-lists under /compliance/template/variables and
    /devices/template/variables state data, which lists the defined
    variables for the respective templates.

    (ENG-31424)

  - ncs: Added new fields for 'from', 'to', 'number of devices' and 'number
    of services' to the compliance report results. See
    $NCS_DIR/src/ncs/yang/tailf-ncs-compliance.yang under "container
    report-results" for details.

    (ENG-31422)

  - ncs: Add timestamp state leafs under /devices/device: created,
    last-modified, last-connected, last-in-sync. See
    $NCS_DIR/src/ncs/yang/tailf-ncs-devices.yang under "list device" for
    details.

    (ENG-31413)

  - ncs: Improved list scanning scheduling by limiting filters' maximum
    complexity and execution time of a single scan step.

    (ENG-31385, RT:50282, PS-45416, CSCwe84559)

  - ncs: Added a "service-timestamps" grouping with timestamp state data
    leafs to the service-data grouping: created, last-modified, last-run.
    A timestamp is added or updated in the post-modification phase.
    Timestamps are updated as follows:
    - created: on create
    - last-modified: on create, update
    - last-run: when last-modified is updated and on redeploy,
    reactive-deploy
    See the $NCS_DIR/src/ncs/yang/tailf-ncs-service.yang under "grouping
    service-timestamps" for details.

    (ENG-30964)

  - ncs: It's now possible to configure
    '/ncs-config/ssh/algorithms/server-host-key' with 'rsa-sha2-256' and
    'rsa-sha2-512'.

    (ENG-30438, RT:50304, RT:49889, RT:50091, PS-45438, PS-45016, PS-45218,
    CSCwd85171)

  - ncs: The initial creation of a nano-service with a converge-on-re-deploy
    extension no longer takes the service-write-lock and, therefore, is
    unaffected by active service conflicts in the system. This gives more
    predictable and faster initial commit times for northbound systems that
    create such nano-services in NSO.
    See $NCS_DIR/src/ncs/yang/tailf-ncs-plan.yang for a description of the
    converge-on-re-deploy extension.
    In the case of commit-queue rollback, pre-transform validation is not
    invoked.

    (ENG-30228)

  - ncs: The self component in a nano service plan is now generated
    automatically if not defined in the service model. The component has
    self-as-service-status enabled and will automatically be updated
    depending on the states of the other components. See the Development
    Guide chapter "Nano Services for Staged Provisioning" for details.

    (ENG-30178)

  - ncs: Add new alarm: commit-through-queue-failed-transiently
    This alarm will be raised after a failed queued commit exhausted its
    retry attempts on transient errors.

    (ENG-24278, RT:42740, PS-37856, CSCvv44473)

  - ncs: Add reschedule action for cancelled and failed items in the
    side-effect queue.

    (ENG-24012)

  - aaa: The cisco-nso-saml2-auth package no longer depends on flask-saml2.
    This solves dependency issues with pyOpenSSL.

    (ENG-32864)

  - aaa: JSON-RPC now supports redirect and content package authentication
    replies.

    (ENG-32130)

  - aaa: Added a new example for enabling SAMLv2 Single Sign-On for NSO
    under $NCS_DIR/examples.ncs/misc/single-sign-on.

    (ENG-32050)

  - aaa: Extend NACM by introducing Device Group Authorization, where
    authorization for a group of devices is set through a device group.
    The Device Group Authorization is set for a user group, as for normal
    rule-lists. See the administration guide for more details.

    (ENG-31585)

  - aaa: NACM rules can now be configured for leafs in the 'input' statement
    of 'tailf:action' and YANG 1.1 'action'. To use this functionality,
    '/ncs-config/aaa/action-input-rules/enabled' must be configured to
    'true'. Note that when this mode is turned on, all action input leafs
    will be checked for NACM rules, so if broad 'deny' NACM rules are used,
    you might need to add 'permit' rules for certain action input leafs to
    allow actions to be used.

    (ENG-31270)

  - aaa: Package Authentication support has been added to the RESTCONF and
    JSON-RPC interfaces. See the NSO Administration Guide chapter The AAA
    Infrastructure, section Authentication, subsection Package
    Authentication for limitations.

    (ENG-31225)

  - aaa: Package Authentication is now available for username and password
    authentication and for handling challenges. See the Administration Guide
    chapter AAA subchapter Authentication section Package Authentication for
    details.

    (ENG-31223)

  - aaa: Authentication is supported via the LDAP protocol and is documented
    in the cisco-nso-ldap-auth package. The NSO Package Authentication also
    needs to be enabled to enable authentication via LDAP.
    See the $NCS_DIR/packages/auth/cisco-nso-ldap-auth/README and the
    Administration Guide chapter AAA subchapter Authentication section
    Package Authentication for details.

    (ENG-31002)

  - aaa: Authentication is supported via the TACACS+ protocol and is
    documented in the cisco-nso-tacacs-auth package. To enable
    authentication via TACACS+, the NSO Package Authentication also needs to
    be enabled.
    See the $NCS_DIR/packages/auth/cisco-nso-tacacs-auth/README and the
    Administration Guide chapter AAA subchapter Authentication section
    Package Authentication for details.

    (ENG-29413)

  - building: Erlang/OTP virtual machine now uses BeamAsm Erlang JIT for
    improved performance. JIT has only been enabled with the Linux x86_64
    architecture. The wall-clock time performance improvement may cause a
    slight increase in memory consumption in some cases.

    (ENG-33027)

  - c-api: Added support for spans when reporting progress trace to the C
    API:
    - maapi_start_progress_span()
    - maapi_start_progress_span_th()
    - maapi_progress_info()
    - maapi_progress_info_th()
    - maapi_end_progress_span()
    See the confd_lib_maapi(3) man page and NSO Development Guide chapter
    Progress Trace for more information.

    (ENG-32384)

  - cdb: Improved the performance of CDB read requests when the CDB session
    is started with a read lock on running datastore.

    (ENG-33119)

  - cdb: On CDB boot error, a partial loading is attempted and traced to
    provide more debug information on where and why the load might have
    failed. A new log file has been introduced, which can be configured
    under /ncs-config/logs/transaction-error-log.
    See the ncs.conf(5) man page and Administration Guide chapter NSO System
    Management section Logging for more details.

    (ENG-32278)

  - cdb: On a runtime error of a transaction, the transaction content and
    the changeset that was about to be applied will be dumped to
    /ncs-config/logs/transaction-error-log to provide more debug
    information. See the ncs.conf(5) man page and Administration Guide
    chapter NSO System Management section Logging for more details.

    (ENG-32277)

  - cdb: Low-level CDB routines have been rewritten for improved robustness.
    This change can impact runtime and memory consumption depending on the
    use case.

    (ENG-29868)

  - cli: Performance when calculating southbound diff with leafrefs that are
    referencing list keys has been improved for CLI devices by using caching
    mechanisms.

    (ENG-32349, CSCwf92230, BEMS01614991)

  - cli: If the user has entered a string starting with 'no ...', the
    C-Style CLI will no longer try abbreviations nodes that begin with the
    string 'no' since it is a reserved command within the C-Style CLI.

    (ENG-30669, RT:50038, PS-45168, CSCwe08066)

  - cs_trans: Transaction validation has been changed to validate data in
    parallel. Validation is done by a global pool of validation workers
    shared between all transactions. This change has shown significant
    performance improvements for transactions validating a large number of
    constraints.

    (ENG-31613)

  - documentation: Updated the NSO User Guide to add information about
    Compliance reporting in the Web UI. See the Compliance reporting chapter
    in NSO User Guide for details.

    (ENG-33171)

  - documentation: A Software Bill Of Materials (SBOM) in the Software
    Package Data Exchange (SPDX) format is now shipped with the release. See
    the SBOM.spdx file.

    (ENG-33104)

  - documentation: Updated the Administration Guide to include information
    about the Transaction Error Log. See chapter NSO System Management >
    Monitoring NSO > Logging for details.

    (ENG-32883)

  - documentation: Updated the Administration Guide to include information
    about the Upgrade Log. See chapter NSO System Management > Monitoring
    NSO > Logging for details.

    (ENG-32808)

  - documentation: Clarified the order package authentication attempts to
    log in with configured packages. See the Administration Guide chapter
    The AAA Infrastructure section Authentication for details.

    (ENG-32799)

  - documentation: Updated Administration Guide chapter "Containerized NSO"
    to add new information about running the NSO Development Image.

    (ENG-32693)

  - documentation: Added documentation for the Python self-assignment
    warning and the alarm, log, or none settings for the warning. See the
    NSO Development Guide chapter The NSO Python VM section YANG Model for
    details.

    (ENG-32093)

  - documentation: Updated Administration guide chapter "Containerized NSO"
    to add new information about running the NSO Development Image.

    (ENG-32069)

  - documentation: Clarified the Disable Memory Overcommit section in the
    NSO Getting Started Guide chapter System Install Steps by adding
    information on the Linux overcommit ratio parameter and the importance
    of the NCS_DUMP variable.

    (ENG-31911, RT:45450, PS-40565, SR:690412814)

  - documentation: Added additional details on installation prerequisites to
    the NSO Getting Started Guide documentation.

    (ENG-31139, CSCwe58204, BEMS01570941)

  - documentation: Improved and split the NED Development Guide into a NED
    Administration chapter in the Administration Guide and a NED Development
    chapter in the Development Guide. Added a new example to
    examples.ncs/development-guide/ned-development/netconf-ned to support
    the documentation.

    (ENG-28267)

  - erlang-api: The following functions have been added to the Erlang MAAPI
    (econfd) to allow user code to log to the progress trace. Functionality,
    including child spans, can be started from parent spans. When starting a
    span, it is possible to set service ikeypath, attributes, and links to
    other trace-ids/spans. More information on spans here:
    https://opentelemetry.io/docs/concepts/signals/traces/#spans
    - econfd_maapi:start_progress_span()
    - econfd_maapi:start_progress_span_th()
    - econfd_maapi:progress_info()
    - econfd_maapi:progress_info_th()
    - econfd_maapi:end_progress_span()
    For more details, see the NSO econfd Erlang API reference documentation
    and NSO Development Guide chapter Progress Trace.

    (ENG-32439)

  - erlang-api: Adding the function 'econfd_maapi:request_action_th/4 to the
    Erlang (econfd) API.

    (ENG-29777, BEMS01432219)

  - examples: Added a new package authentication example for authenticating
    RESTCONF with a JSON web token under
    $NCS_DIR/examples.ncs/misc/packageauth.

    (ENG-31255)

  - ha: Added a ncs_pkg_delta tool that can be used for generating deltas
    between package directories. The deltas, in general, result in a smaller
    amount of data to be copied between primary and secondary nodes.

    (ENG-32508)

  - ha: Packages under the state directory are now distributed instead of
    packages in the load path in an HA Raft cluster when distributing
    packages over the raft log using the /package/reload action and when
    sending packages during snapshot recovery. Instead of sending entire
    packages to followers, the leader sends a package diff that the
    followers can apply to their own local state package directory to obtain
    the new package state, which minimizes the amount of transferred package
    data.
    It is still possible to synchronize load paths using the
    /packages/ha/sync action; however, packages are distributed outside the
    raft algorithm, meaning that the data is not distributed using the raft
    log but instead sent directly to each node.

    (ENG-32136)

  - ha: Improved logging to include the size of replicated data in an HA
    cluster. During HA sync, each HA app logs the size of replicated data
    separately, and the total size of replicated data has been logged at the
    end of HA sync. The size of replicated data for each transaction has
    also been improved to log each chunk on both primary and secondary so
    that the number of replicated chunks can be correlated between primary
    and secondary.

    (ENG-31783)

  - ha: Logging of HA synchronization to the developer log has been improved
    to log details of each step of HA synchronization with their elapsed
    time. It is also possible to correlate the log items on primary
    developer logs with the secondary developer logs using the trace-id.

    (ENG-31781)

  - ha: The detection mechanism used to determine whether HA synchronization
    of rollback files is required for when a new secondary joins the cluster
    has been changed such that it now primarily relies on the number of
    rollback files and calculates a checksum of files only if the number of
    files is equal on both the primary and the secondary nodes. This allows
    NSO to quickly determine whether a sync is required, reducing the time
    spent joining the cluster in such cases.

    (ENG-31630)

  - ha: The detection mechanism used to determine whether HA synchronization
    is required when a new secondary joins the cluster has been changed such
    that it now primarily relies on the number of nodes in the datastore and
    only calculates a checksum of datastores if the number of nodes is equal
    on both the primary and the secondary nodes. This allows NSO to quickly
    determine whether a sync is required, reducing the overall time spent
    joining the cluster in such cases.

    (ENG-31570)

  - ha: in HA Raft the following HA notifications are implemented:
    - CONFD_HA_INFO_SECONDARY_INITIALIZED: node becomes follower
    - CONFD_HA_INFO_IS_PRIMARY: node becomes leader
    - CONFD_HA_INFO_IS_NONE: node becomes candidate | stalled | disabled
    - CONFD_HA_INFO_NOPRIMARY: leader disappears
    - CONFD_HA_INFO_SECONDARY_DIED: follower disappears
    - CONFD_HA_INFO_SECONDARY_ARRIVED: follower arrives
    while the following is no longer applicable:
    - CONFD_HA_INFO_BESECONDARY_RESULT

    (ENG-30973)

  - java-api: If in the CLI/devices/device{dev0}/live-status/a is requested,
    and afterward in the same session /devices/device{dev0}/live-status/a/b,
    then the second request will now return the data cached in the first
    request.

    (ENG-32507)

  - java-api: Improved the schema lookup performance for the Java API.

    (ENG-31688, RT:49679, PS-44807)

  - java-api: The javadoc in the Java API source has been improved to work
    with Java17

    (ENG-31625)

  - java-api: Added following new modes to NavuParser for handling parsing
    action/rpc input or output: MODE_SET_ACTION_PARAM and
    MODE_SET_ACTION_RESULT. The modes can be passed to XMLtoConfXMLParam's
    toXMLParam(int) method to indicate the parser to parse action's/rpc's
    input or output.

    (ENG-31022, RT:49744, PS-44872, CSCwe45590)

  - java-api: A new Java package, 'com.tailf.progress', has been introduced
    to interact with the progress trace framework based on spans.
    This deprecates the current progress trace report API in the Maapi
    class.
    See the Java API reference documentation and the NSO Development Guide
    chapter Progress Trace for details.

    (ENG-30799)

  - json-rpc: Add a "login" method without parameters. The "login" method
    without parameters directly invokes package authentication. The "login"
    method with parameters invokes the standard authentication procedure,
    including package authentication.

    (ENG-32733, RT:50605, PS-45742)

  - json-rpc: It is now possible to use pagination for the JSON-RPC method
    get_leafref_values. To achieve this, a new parameter, "Offset", has been
    added that can be used together with the existing "Limit" parameter to
    delimit the size of the leafref list. "Offset" specifies how many
    elements to skip at the beginning of the list. "Offset" and "Limit" can
    therefore be used together repeatedly to paginate the leafref values.
    For example, Offset=15 and Limit=15 will return a list with 15 elements
    where the first 15 elements are skipped. To get the next 15 elements,
    increase the offset to 30, and so on. See the NSO WebUI User Guide
    Chapter "The JSON-RPC API" section "Method get_leafref_values" for
    details.

    (ENG-31433)

  - python-api: Added a high-level progress trace API to the ncs.maapi
    module:
    - Maapi.start_progress_span()
    - Maapi.progress_info()
    - Transaction.start_progress_span()
    - Transaction.progress_info()
    Added an ncs.progress module with Span and EmptySpan classes.
    Call Span.end() to end spans started from Maapi.start_progress_span() or
    Transaction.start_progress_span().
    EmptySpan objects can be passed as links.
    Added a low-level progress trace API to the _ncs.maapi module:
    - maapi.start_progress_span()
    - maapi.progress_info()
    - maapi.start_progress_span_th()
    - maapi.progress_info_th()
    - maapi.end_progress_span() (also used for spans started from
    maapi.start_progress_span_th())
    See the Python API reference documentation under ncs.maapi,
    ncs.progress, and _ncs.maapi for details.

    (ENG-33289)

  - python-api: Output additional information on the 'Assign to self' alarm
    from the Python API.

    (ENG-32058)

  - python-api: Added support for ncs.maagic ActionParams to be returned
    from as_pyval.

    (ENG-31275)

  - rollback: Added support to specify a list of XPath to exclude from a
    rollback in the apply-rollback-file action. See
    $NCS_DIR/src/ncs/yang/tailf-rollback.yang under "leaf-list exclude" for
    details.

    (ENG-31273)

  - smart-licensing: Upgraded webapp-runner to 9.0.80.0.

    (ENG-32984)

  - smart-licensing: Upgraded smart-agent to version 3.1.22.

    (ENG-32591)

  - ssh: Add error case clause for unexpected_getopts_return.

    (ENG-32235)

  - upgrade: Extended the reload actions with two new options:
    report - Provides a report of the schema changes.
    dry-run - Perform a package reload without actually updating CDB.
    See the reload-params-report grouping in
    $NCS_DIR/src/ncs/yang/tailf-ncs-packages.yang for details.

    (ENG-31768)

  - upgrade: Improved the CDB upgrade performance by skipping the upgrade of
    unchanged namespaces and unchanged nodes under list nodes.

    (ENG-31150)

  - upgrade: - Optimize CDB upgrade by defining upgrade tree.
    - Use a dedicated log file for upgrade logging.
    - Re-evaluate "when" expression if dependent node was changed.

    (ENG-27163)

  - web-server: The Cross-Origin-Embedder-Policy and
    Cross-Origin-Opener-Policy HTTP headers are now present in responses by
    default. See the ncs.conf(5) man page for details.

    (ENG-32917)

  - web-server: The server now allows adding 'wasm-unsafe-eval' to the
    'script-src' rule in the Content-Security-Policy header for specific
    files. The parameter '/confdConfig/webui/wasmScriptPolicyPattern' can be
    set with a pattern matching the requested files' names. The default is
    to add it to JavaScript files with names that contain the word "wasm",
    for example, 'my-wasm.file.js'. See the ncs.conf(5) man page for
    details.

    (ENG-31701)

  - webui-one: The selected datastore within the Insights Manager is now
    retained when manually updating the page during the session.

    (ENG-33022)

  - webui-one: The commit manager's commit notification now displays the
    commit-queue id, status, and additional queue information, provided the
    commit-queue option is set in the commit.

    (ENG-33018, CSCwh75524, BEMS01644873)

  - webui-one: The high-availability cluster and package upgrade
    applications are updated to incorporate the new Raft consensus algorithm
    implementation. Furthermore, the previously utilized "rule-based"
    algorithm continues to be supported. It is important to note that the
    two high-availability solutions are not activated simultaneously.

    (ENG-30828)

  - xpath: Improved performance when getting large XML configuration.

    (ENG-31182, CSCwe62868, BEMS01566586)

  - yanger: Relax YANG compiler's reported severity on nodes referencing
    forbidden YANG status, from 'error' to 'warning'. This is in case a
    child and a parent have the same 'status', but any nodes in between have
    another 'status'.

    (ENG-31938)

  - yanger: The tailf:display-when extension can now be used directly under
    choice and case statements.

    (ENG-31726)

Corrections:

  - ncs: Fixed an issue where the CLI cache was not cleared after performing
    a distributed package add in an HA cluster. Clearing the CLI Cache after
    adding new packages is necessary to remove outdated data that might
    exist in the cache.

    (ENG-33231)

  - ncs: Add missing augmentation file when compiling internal yang module
    tailf-common-monitoring2.yang.

    (ENG-33117, RT:50817, PS-45956, CSCwh84386)

  - ncs: Added a missing case statement, causing issues when checking for
    the existence of /cluster/connection list items.

    (ENG-33107, CSCwh82861, BEMS01630864)

  - ncs: Fixed an issue that caused commit queue progress trace entries to
    be emitted from csv formatted trace files.

    (ENG-32971, RT:50749, PS-45892, CSCwh70745)

  - ncs: Fixed an issue where a service instance would fail to proceed
    backtracking when backtracking a service instance that was never fully
    deployed and where one of the non-reached states contains a delete
    post-action.

    (ENG-32951, RT:50765, PS-45908, CSCwh68278)

  - ncs: ENG-29883 introduced a collection of more transaction conflict
    details in conflict messages. In certain situations, collection would
    fail, making the faulting and subsequent transactions wait forever. The
    conflict management has been updated to be more fault-resilient by
    releasing stuck transactions on error.

    (ENG-32874, RT:50706, PS-45844, CSCwh59054)

  - ncs: Fixed an internal error (badarg) that could occur when a nano
    service was back-tracking.

    (ENG-32833)

  - ncs: Services should save/update the latest commit parameters whenever
    the service is created/modified/deleted/re-deployed. These commit
    parameters are then reused when reactive-re-deploy is issued.
    Nano services were not updating their latest commit parameters when they
    were modified. This is fixed now.

    (ENG-32636)

  - ncs: The file src/ncs/yang/Makefile has been updated to include the
    monitoring annotation file when compiling tailf-ncs-monitoring2.fxs.

    (ENG-32593, RT:50676, PS-45813, CSCwh32090)

  - ncs: The NSO documentation has been updated with references to the file
    tailf-common-monitoring2.yang instead of the now deprecated file
    tailf-common-monitoring.yang.

    (ENG-32483, RT:50625, RT:50633, PS-45762, PS-45770, CSCwh16105)

  - ncs: Correct display inactive container for outformat CLI

    (ENG-32418, CSCwh02277, BEMS01615179)

  - ncs: Addressed an issue where NSO could sometimes hang when multiple
    transient errors occurred for a commit queue transaction. The errors are
    now merged.

    (ENG-32405)

  - ncs: Fixed an issue with compliance reporting causing the same device to
    be checked multiple times, which could sometimes lead to false positives
    in the compliance report due to device-lock-related errors.

    (ENG-32255)

  - ncs: Transactions now abort if a service receives conflicting intents,
    for example, it gets modified and deleted in the same transaction.
    Previously, the transaction would go through and, in some cases, the
    changes done by the service were not undone. For more information, refer
    to the 'Conflicting Intents' subsection under 'Developing NSO Services'
    > 'Service Caveats' in NSO Development Guide.

    (ENG-32236, CSCwf73900, BEMS01597314)

  - ncs: Commit-queue now reports well-formed error message if an error
    occurs during southbound diff generation. Previously, the badly
    formatted error resulted in an internal error.

    (ENG-32083, CSCwf59586, BEMS01602465)

  - ncs: Operations on the top level in a YANG module defined with the "rpc"
    statement resulted in RPC requests through the NETCONF NED triggering an
    internal error. Now, the YANG "rpc" statement NETCONF RPC requests
    returns the expected value through the NETCONF NED.

    (ENG-32080, CSCwf59048, BEMS01603931)

  - ncs: Fixed an issue that would generate an error when copying leaves of
    type instance-identifier across mount points using the copy_tree MAAPI
    function.

    (ENG-32051, RT:50360, PS-45494, CSCwf56400)

  - ncs: Corrected an issue causing an error when loading JSON formatted
    configuration containing data for the YANG instance-identifier and the
    node referenced by the instance-identifier.

    (ENG-31971)

  - ncs: Fix an issue where the same device template could not be used with
    different device groups in compliance reporting.

    (ENG-31951)

  - ncs: Transactions performed via the CLI were missing reads protecting
    write operations. This could cause conflicting transactions to be
    accepted. This has been fixed now. Besides that, read operations of
    non-existing data will no longer cause conflict with those delete
    operations that have deleted any parent of the non-existing data.

    (ENG-31945)

  - ncs: Fixed an issue where the status of a device notification
    subscription would fail to update due to the update transaction being
    aborted due to an HA role transition.

    (ENG-31863)

  - ncs: The reconcile operation was not supported in stacked service
    scenarios when re-deploying a service resulted in deleting another
    service. This has now been fixed.

    (ENG-31815, CSCwf31066, BEMS01581087)

  - ncs: NSO undoes configuration changes whenever a transaction fails or at
    least one device fails to apply configuration in a network-wide
    transaction. The transaction(s) are undone using NED ABORT or NED
    REVERT. These operations could fail in NSO while calculating the reverse
    diff when all the following three conditions occurred at the same time:
    1. no out-of-sync check was performed, 2. devices orchestrated via
    generic NEDs, and 3. the diff consisted of ordered-by user lists; in
    this case, the error seen Northbound was:
        "Cannot push individual entries from an ordered-by user list"
    In case of ABORT or REVERT, NSO will fetch configuration from the device
    using partial-sync-from with the list of paths of subtrees the PREPARE
    or COMMIT modified. The reverse diff is a best-effort-only configuration
    fetched by NSO will be used.
    - commit no-out-of-sync-check: if PREPARE fails, NSO will rollback
    changes on the device to what is in CDB on NSO (much similar to
    partial-sync-to on the paths modified by the transaction in NSO)
    - commit no-overwrite: if the transaction-id is not the same on NSO and
    the device, the transaction will be discarded in NSO, and no changes
    will be sent to the device
    NSO brownfield deployments are encouraged to apply transactions with
    "commit no-overwrite" or
    /devices/global-setting/no-overwrite/enabled-by-default=true.
    "no-overwrite" will perform check-sync on each modified subtree and will
    help to avoid unintended data loss (see the
    $NCS_DIR/src/ncs/yang/tailf-ncs-devices.yang submodule for more info).

    (ENG-31798, CSCwf26892, BEMS01592914)

  - ncs: Fixed an issue with live status causing fetching individual list
    entries to fail.

    (ENG-31747)

  - ncs: Fixed an issue in the Java API where keys of type IdentityRef would
    not get formatted as strings when encoding a ConfPath object.

    (ENG-31692, RT:50350, PS-45484, CSCwf13978)

  - ncs: In an LSA cluster, no-networking commits towards the lower NSO
    nodes could hang consecutive commits toward the same NSO nodes if the
    changed NSO nodes had had snapshot (they had been changed via
    commit-queue or have the pre-populate snapshot datastore setting turned
    on). This issue has been fixed.

    (ENG-31691, CSCwf13908, BEMS01574308)

  - ncs: Fix an internal error that could happen when checking multi-key
    lists in compliance templates.

    (ENG-31579)

  - ncs: Nano service related FASTMAP create callbacks were run with a
    system user session. Now all FASTMAP create callbacks (regular and nano
    service) run with a user session associated with the user last modifying
    the service.

    (ENG-31506, RT:50297, RT:50303, PS-45431, PS-45437, CSCwe98491)

  - ncs: Fix an issue where multiple levels of escaping were needed in
    compliance templates.

    (ENG-31486)

  - ncs: Remove mentions of obsolete functionality in compliance models.

    (ENG-31479)

  - ncs: Fix an issue in the NSO upgrade code which could make upgrades fail
    silently.

    (ENG-31337)

  - ncs: YANG "ordered-by user" list instances created/modified and moved in
    the same transaction are handled differently in NSO for Junos devices.
    This special handling was not applied correctly when committed through
    the commit queue.

    (ENG-31279, CSCwe74934, BEMS01574254)

  - ncs: If NSO was started using the "-c, --conf ConfFile" flag and the
    path to the ncs.conf file contained a whitespace character, NSO failed
    with an internal error.

    (ENG-31185)

  - ncs: Change function to get timestamp for logging from
    erlang:system_item to os:system_time.

    (ENG-30947)

  - ncs: When using the 'ncs-compile-bundle' option in 'ncsc', for each
    module M, now only the deviating files directly deviating M are
    included.

    (ENG-30287, CSCwd62781, BEMS01531845)

  - ncs: Accessing data under ietf-yang-library:yang-library after ncs
    --reload with a transaction opened before ncs --reload would result in
    an internal error if the data were accessed before the reload.

    (ENG-30123, RT:49860, PS-44986, CSCwd41272)

  - aaa: When building the single-sign-on example, the example Makefile now
    uses the correct path for the cisco-nso-saml2-auth package dependencies.

    (ENG-32865)

  - aaa: Fix an issue that would result in an internal error or incorrect
    NACM rule matching for a device group rule.

    (ENG-32587, RT:50671, PS-45808, CSCwh30389)

  - aaa: Corrected an issue that prevented NACM device group rules from
    matching correctly.

    (ENG-32462, RT:50619, PS-45756, CSCwh12921)

  - aaa: The cisco-nso-saml2-auth package now writes its log to the NSO log
    directory.

    (ENG-31854)

  - aaa: A non-existent package with name empty string always attempted
    login first for package authentication. This showed up as rejected
    logins in the audit log. Login attempts are no longer done for this
    non-existent package.

    (ENG-31853)

  - aaa: When using PAM for authentication, NSO could become unresponsive
    due to internal scheduling issues if the PAM method does not respond
    promptly. The scheduling of authentication requests has been reworked,
    and the system is no longer sensitive to slow PAM lookups.

    (ENG-24375, RT:42318, PS-37417, CSCvv28167, SR:689038311)

  - building: The file 'src/ncs/yang/Makefile' has been updated to compile
    'tailf-common-monitoring2.yang' correctly.

    (ENG-32925, RT:50770, PS-45913, CSCwh64793)

  - building: The file 'src/ncs/yang/Makefile' has been updated to compile
    the internal yang files correctly.

    (ENG-32598, RT:50679, PS-45816, CSCwh33170)

  - c-api: Allow NSO to receive leaf-lists of instance-identifier type from
    C API and econfd Erlang API-based data providers.

    (ENG-33110, RT:50812, PS-45951, CSCwh83068)

  - c-api: It is now possible to call dp.action_set_timeout() from an
    asynchronous action (after responding with DELAYED_RESPONSE). Previously
    an error was returned.

    (ENG-31882, RT:50428, PS-45562, CSCwf39401)

  - c-api: Fix bug in econfd to allow leaf-list nodes to be of type
    'instance-identifier' without encountering 'application protocol error'.

    (ENG-31314)

  - c-api: For some notifications, the CAPI function
    confd_read_notification() would allocate memory that was never freed.
    This is now handled correctly in confd_free_notification(). Make sure to
    always call it after handling notifications using the CAPI.

    (ENG-31050)

  - c-api: Fix a regression introduced in ENG-30205 that made NSO miss a
    namespace change from a C_XMLBEGIN entry in a data callback reply of
    type array(tag_value_t), effectively requiring the following children to
    explicitly indicate namespace.

    (ENG-30877, RT:50278, RT:50140, PS-45412, PS-45267, CSCwe34320)

  - candidate: The JSON-RPC API now returns the following error message for
    transactions towards the candidate or startup datastore: "Invalid
    parameters."

    (ENG-29521)

  - cdb: Added an extra check to avoid a redundant modification notification
    for the leaf-list in addition to the leaf-list value modification.

    (ENG-32863, RT:50745, PS-45888, CSCwh58052)

  - cdb: Corrected an issue with reading the default values of operational
    nodes in a CDB session at the commit phase.

    (ENG-32734, RT:50711, PS-45849, CSCwh47916)

  - cdb: A defect in earlier versions of CDB occasionally caused invalid WAL
    operations on lists to be persisted to the write-ahead log. Loading CDB
    with such incorrect nodes, e.g., using sync-from, could lead to an
    internal error when creating a new list element. CDB can now
    automatically resolve an incorrect node type when loaded to memory.
    Still, the user is also recommended to perform CDB compaction to resolve
    the error in the WAL permanently.

    (ENG-32708, CSCwh45107, BEMS01610933)

  - cdb: In rare cases, a node joining the HA cluster may arrive at such a
    time that it receives a distributed commit message for a transaction for
    which it has not received any prior information. Ignoring such a message
    would lead the primary to wait indefinitely for a reply and reject
    subsequent attempts from secondaries to join the cluster. A secondary
    will now reply to an unknown commit message to avoid the described
    situation.

    (ENG-32602)

  - cdb: A mandatory choice has active case before NED migration. During NED
    migration, in case of deleting the node of both active/inactive case,
    and adding a new node into active case, migration transaction fails with
    an internal error due to not correctly handling looking up new child
    node from the new schema.
    Now this use case works correctly and NSO only looks up the node
    existing on both, old and new schema.

    (ENG-32402, CSCwh00057, BEMS01619460)

  - cdb: While the operational datastore is locked, NSO would fail to
    retrieve information from the operational datastore when running ncs
    --status or when generating a debug dump. This issue has been resolved.

    (ENG-32279)

  - cdb: A CDB session established in the prepare phase of an ongoing
    transaction with the CDB_LOCK_REQUEST flag set would lead to a crash of
    the node if the requested lock could not be acquired. This has now been
    resolved to respond with an error message correctly.

    (ENG-32270, RT:50540, PS-45676, CSCwf79568)

  - cdb: In some cases, it has been observed that invalid WAL operations
    have been written by CDB, leading to failure during the boot of NSO.
    Although the issues leading to such corruption have been addressed in
    previous releases, these failures can still occur as they persist in the
    WAL. CDB will re-create the faulty node based on the available YANG
    schema if the failing node is a list or leaf-list. It is recommended to
    trigger the compaction of the CDB files to resolve the issue in the WAL
    permanently.

    (ENG-32137, RT:50507, PS-45641, CSCwf66357)

  - cdb: Creating a presence container with a "choice" statement containing
    a default "case" statement caused a call to an operational callpoint
    under that choice statement. The callpoint was called with a delete even
    though the case was not set.
    Now NSO will not delete the node when the node initializes with a
    default value.

    (ENG-31770, RT:50308, PS-45442, CSCwf23765)

  - cdb: A performance degradation when closing a transaction with few or no
    changes has been addressed.

    (ENG-31033, RT:50168, PS-45298, CSCwe45782)

  - cli: The performance to evaluate list entries in the CLI has been
    improved for range expressions.

    (ENG-32564, CSCwh26308, BEMS01627825)

  - cli: When using multiple NEDs that share the same NED-id, the filtering
    in the CLI sometimes would not apply instance-filtering of key elements
    correctly and instead show more data than intended. The issue was
    corrected by changing the data filtering to resemble how just a single
    NED-id was done.

    (ENG-31949, CSCwf44860, BEMS01600018)

  - cli: A crash that could occur when applying a select-filter in the CLI
    across multiple devices has been fixed.

    (ENG-31890, CSCwf40868, BEMS01600018)

  - cli: When loading data into NSO using the load option and replacing old
    configuration using, for example, 'load replace filename.txt', the CLI
    would remove all the leaf-list entries but only set the last entry in
    the leaf-list with tailf:cli-list-syntax extension.

    (ENG-31756, RT:50382, PS-45516, CSCwf47446)

  - cli: The order of commands in the C-style southbound configuration diff
    corresponding to the deletion/re-ordering of instances in an ordered-by
    user list was, in some cases, incorrect depending on the instances
    deleted/modified. This fix ensures that the order is correct.

    (ENG-31752, CSCwf22489, BEMS01583489)

  - cli: Correct "commit dry-run" on CLI sometimes missing some changes in
    the printout when the subtree under an order-by user list was modified.

    (ENG-31531, CSCwf00593, BEMS01576456)

  - cli: Corrected completion results when completing a case inside a nested
    choice so that other case nodes (can be many levels deep) from some
    common ancestor choice node are excluded from the results.

    (ENG-31512, RT:50072, PS-45199, CSCwe98608)

  - cli: A YANG leaf of type union with a combination of integer and string
    member types with a string pattern restriction could cause XPath
    evaluations to return the wrong evaluation result.

    (ENG-31432, CSCwe89454, BEMS01569679)

  - cli: Print to CLI all user sessions, including the ones in the process
    of closing but not yet completed, when encountering "Too many sessions"
    error.

    (ENG-31402, RT:50258, PS-45392, CSCwe86458)

  - cli: A config false leaf annotated with tail:link pointing to a config
    true leaf with a default value would be included in the output when
    running the J-style command 'show ...' in combination with any display
    command such as 'display xml'. This has been fixed so that it will not
    be included in the output unless the config false leaf is the command's
    argument.

    (ENG-31164, RT:50162, PS-45292, CSCwe61320)

  - cli: After creating a service with kickers implemented, executing the
    command 'commit dry-run outformat cli-c' would fail with an internal
    error when displaying the leaf 'kick-node' with type union of
    yang:xpath1.0 and instance-identifier.

    (ENG-31121, CSCwe56315, BEMS01568529)

  - cli: Error messages from confd_trans_seterr() are now displayed in the
    CLI when used from create and delete hooks.

    (ENG-30638, RT:50019, PS-45148, CSCwe04494)

  - cli: Fixed use of data provider iterators in CLI auto-complete
    expansion.

    (ENG-29466, RT:49427, PS-44547, CSCwc38291)

  - cli: The CLI now detects a semicolon that has been escaped to be part of
    a value correctly during completion and will also escape the semicolon
    when going back in history interactively.

    (ENG-29420)

  - cli: When trying to set a container with the same name as a leaf that is
    a child node to the sibling container with tailf:cli-drop-node-name
    extension would cause a syntax error with an incomplete path.

    (ENG-27765)

  - cli: The CLI can now handle ambiguity due to live-status-protocol from
    one device being added to another by correctly separating the nodes with
    namespace prefix information.

    (ENG-23447)

  - cli: When the J-Style CLI sets multiple leafs with one command, and if
    one leaf fails, the other leafs will remain untouched. This aligns the
    set operation with how C-Style handles set leaf failures.

    (ENG-20247, RT:35694, PS-30770)

  - cs_trans: 'get_next' on a list with deleted instances, using an
    extensive list filter, would erroneously return a list instance. Now,
    this same 'get_next' replies that there are no instances.

    (ENG-32743, RT:50708, PS-45846, CSCwh48647)

  - cs_trans: Corrected an issue where attributes for leafs of type empty
    were not applied when loading XML configuration.

    (ENG-32588, CSCwh30754, BEMS01628980)

  - cs_trans: In certain scenarios, a commit dry-run could alter the active
    changeset. This could, for example, be seen as a difference in the CLI
    output when running "show configuration" before and after a commit
    dry-run.

    (ENG-32580, RT:50588, PS-45725, CSCwh28922, BEMS01625726, BEMS01638907)

  - cs_trans: Corrected an issue where deleting a choice case in a service
    node that includes 'min-elements' or 'max-elements' and 'must'
    statements could cause validation to fail.

    (ENG-32513, CSCwh20901, BEMS01627034)

  - cs_trans: Corrected an issue that would prevent enumerations from being
    formatted correctly in --check-callbacks.

    (ENG-32414, RT:50596, PS-45733, CSCwh01972)

  - cs_trans: Prevent an action from waiting indefinitely when reading live
    data using a transaction in a transaction.

    (ENG-32290, CSCwf83078, BEMS01604787)

  - cs_trans: ENG-30824 introduced a regression where transactions could
    fail with an internal error during retry if one checkpoint were missing
    due to memory constraints. The selection of the checkpoint is now
    updated to handle this correctly.

    (ENG-32007)

  - cs_trans: The CLI could incorrectly report conflicts towards other
    transactions when the prepare phase of a transaction fails.

    (ENG-31874)

  - cs_trans: The CLI could incorrectly report conflicts towards other
    transactions when working with data models with choices.

    (ENG-31864)

  - cs_trans: A "when" statement with a 'tailf:dependency' substatement was
    not re-evaluated if the node referred to in the dependency statement was
    populated using a transaction hook. The problem occurred in the CLI.

    (ENG-31171, RT:50174, PS-45304, CSCwe61517)

  - cs_trans: Fixed an issue where deleting a 'choice' with a
    'when'-expression, invalidating that 'when'-expression caused an
    internal error.

    (ENG-27667, RT:47688, PS-42810, CSCwa16269)

  - cs_trans: Addressed an issue where NSO would send an unexpected
    notification to a subscriber when modifying an unsubscribed node.

    (ENG-27665, RT:50672, RT:47742, PS-45809, PS-42865, CSCwa16196)

  - documentation: Documented the interaction of NACM and services in the
    Administration Guice chapter AAA subchapter Authorization section NACM
    Rules and Services.

    (ENG-33218)

  - documentation: Add Package Authentication to NSO Admin Guide Section AAA
    related items in ncs.conf.

    (ENG-32821)

  - documentation: Clarified how data provider applications need to sort
    list data, including the union type key special case, for the get_next()
    and find_next() sections in the confd_lib_dp(3) man page.

    (ENG-32725, RT:50674, PS-45811, CSCwh82886)

  - documentation: Updated the Administration Guide chapter "Containerized
    NSO" to add information about overriding environment variables.

    (ENG-32296, RT:50555, PS-45691, CSCwf84526)

  - documentation: The cisco-nso-saml2-auth README used "sp" and "idp" node
    names for the package configuration. These are named "service-provider"
    and "identity-provider" in the package YANG file. Furthermore, the
    private-key-signing had the wrong path (missing service-provider
    segment). The package documentation is corrected regarding the
    configuration.

    (ENG-32038)

  - documentation: Fixed hyperlinks for RFC 8072 in the Northbound API
    documentation under the Yang Patch Media Type section.

    (ENG-31737)

  - documentation: Added What's new information for NSO 6.1.

    (ENG-31603)

  - documentation: Updated the installation guide to add link references to
    the Cisco Software Licensing Guide.

    (ENG-31209, CSCwe67341, BEMS01574648)

  - documentation: Added the list of RFCs that the RESTCONF server
    implements and removed Legacy REST API content from the RESTCONF
    documentation.

    (ENG-30095)

  - documentation: Updated User Guide sections "NSO CLI" and "NSO Device
    Manager" to include recommendations about password handling.

    (ENG-21602, RT:37729, PS-32805, SR:686905211)

  - erlang-api: Corrected an issue where an econfd action could not be added
    when registering a new worker socket using the action_init callback
    function.

    (ENG-31866)

  - examples: Updated the
    examples.ncs/development-guide/nano-services/netsim-sshkey example to
    use a semaphore when generating keys from the nano service side effect
    action. The semaphore avoids multiple re-deploys generating keys
    concurrently to cause a mismatch between the generated public and
    private keys.

    (ENG-32104)

  - examples: The notification handling in the netsim-sshkey example no
    longer causes the Python RESTCONF showcase script to, in some cases,
    wait forever for all nano service instances to reach the ready state.

    (ENG-31698)

  - ha: Fixed an issue where a distributed package add would lead to a crash
    on the primary node if the connection to both secondaries is lost during
    the package add.

    (ENG-33356)

  - ha: HA Raft: The oper data leaf /ncs-state/ha/mode did not exist when
    the HA role was disabled/stalled/candidate. Now, it does, which makes it
    possible to check the existence of the leaf in a package to decide if HA
    is enabled/disabled.

    (ENG-32960)

  - ha: Fixed an issue where pending transactions waiting for a quorum would
    not be aborted on an HA Raft node if the node is longer the Raft leader.

    (ENG-32952, BEMS01644721)

  - ha: The package management command 'packages ha sync and-add' has been
    simplified to not wait for HA primary and secondaries to sync before
    completing the package add process. Before, the command could fail in a
    system under a high transaction load where all applications may never be
    in sync simultaneously.

    (ENG-32931)

  - ha: An internal race condition that caused system crashes in HA Raft
    setups was resolved.

    (ENG-32769)

  - ha: Setting the ncs.conf setting '/ncs-config/ha/tick-timeout' to "PT0S"
    has the intended meaning of disabling keepalive ticks. An issue has been
    fixed where setting the value PT0S instead leads to a timeout when a
    secondary attempts to join an HA cluster.

    (ENG-32720, RT:50689, PS-45826, CSCwh46065)

  - ha: If a new secondary tried to join the cluster and sync took longer
    than 3 * tick time, the primary would close the socket with the first
    secondary because it did not correctly process the ticks received from
    the first secondary. NSO now correctly handles tick messages during the
    long sync process.

    (ENG-32596)

  - ha: Changing /ncs-config/ha-raft/cluster-name and running `ncs --reload`
    didn't update the used cluster-name and required a restart. `ncs
    --reload` now updates the cluster-name dynamically.

    (ENG-32356)

  - ha: When using the NSO command 'packages ha sync and-add' or 'packages
    ha sync and-reload', the primary node tries to determine whether
    synchronization is required. During this period, the synchronization
    ticks were not correctly handled, potentially leading to a failure due
    to CONFD_ERR_HA_NOTICK and the command failing with the message "The
    secondary node list does not match after adding packages". A previous
    fix addressed this error when it originated from the HA primary, but NSO
    now also handles tick messages during package add and reload on the
    secondary.

    (ENG-32288, CSCwf83008, BEMS01613352)

  - ha: Fixed two issues with ha_upgrade on followers when using HA Raft.
    The first issue could lead to followers deadlocking during a distributed
    package reload. The second issue allowed followers, in some cases, to
    apply diff-sets meant to be applied by the follower after it had
    finished upgrading its packages before the package upgrade finished.

    (ENG-32261)

  - ha: Added support for adding individual packages using package add with
    HA Raft.

    (ENG-32182)

  - ha: An internal crash could occur if the primary node receives an HA
    status request when a new secondary node joins the HA cluster. The HA
    server has been updated to handle the requests from the new nodes
    joining the HA cluster.

    (ENG-32109)

  - ha: When using the NSO command 'packages ha sync and-add' or 'packages
    ha sync and-reload', the primary node tries to determine whether
    synchronization is required. During this period, the synchronization
    ticks were not correctly handled, potentially leading to a failure due
    to CONFD_ERR_HA_NOTICK and the command failing with the message "The
    secondary node list does not match after adding packages". NSO now
    correctly handles tick messages during package add and reload.

    (ENG-31964, CSCwf47503, BEMS01597827)

  - ha: Invoking the actions /high-availability/read-only or
    /ha-raft/read-only with input mode "false" will now return an error if a
    node has been set to read-only using the C-API/py-api/japi
    maapi_set_readonly_mode(1). This prevents NSO from reaching an invalid
    state where the commit-queue is left in read-only mode. When this
    happens call maapi_set_readonly_mode(0) or 'ncs_cmd -c mrw' to restore
    read-write mode in the current node.

    (ENG-31963, CSCwf47500, BEMS01599891)

  - ha: Change of /ncs-config/ha-raft/listen/node-address and a call to `ncs
    --reload` made the internal state invalid. To prevent this, a restart of
    NSO is now required after updating the node-address.

    (ENG-31785)

  - ha: Fixed issue to avoid a potential deadlock in the internal HA
    subsystem. Without this fix, NSO would be unable to change the HA role,
    or the user would be unable to read oper data under the /ncs-state/ha
    tree while the deadlock occurred.

    (ENG-30878)

  - ha: Fixed an issue with the checksum calculation of rollback files to
    avoid a mismatch between HA nodes causing, for example, package upgrades
    to fail.

    (ENG-30504, CSCwd90667, BEMS01541595)

  - java-api: The com.tailf.maapi.Maapi.ncsRunWithRetry() method was missing
    from the SDK API reference documentation and has been added.

    (ENG-33346)

  - java-api: Fixed a race condition in the Java API, which could lead to
    various errors when deploying multiple Java services concurrently.

    (ENG-33213)

  - java-api: Fixed an issue that made it possible for a NED to return
    internal error responses for requests to which the NED had already
    responded to NSO. Multiple replies for a single request are not
    supported. An error will be logged if a NED tries to send an internal
    error response for an already responded request.

    (ENG-32620)

  - java-api: When 'same-secondary-password' is configured and a valid
    cleartext password is unavailable for the session (for example, a
    non-authenticated session via ncs_cli), connections towards CLI/generic
    devices would fail with a connect timeout. This has been fixed, so it
    fails early with a proper error message.

    (ENG-32300)

  - java-api: Fixed an issue where the wrong showStatsFilter NED function
    was invoked when format was set to 'path'.

    (ENG-31745)

  - java-api: Fixed an issue with validation when parsing XML, including
    leaf-lists with min-elements.

    (ENG-27148, RT:47111, PS-42230, CSCvz47555)

  - json-rpc: Evaluation of when expressions for JSON-RPC read transactions
    are now
    performed in the same way as for JSON-RPC read_write transaction.

    (ENG-31790, RT:50396, PS-45525, CSCwf26439)

  - json-rpc: When the webui session idle timer timed out an error
    method-failed was returned. Now the error message states that the
    session idle timer timed out.

    (ENG-31421, RT:50299, PS-45433, CSCwe88087)

  - kickers: Corrected an issue with executing package reload to upgrade a
    schema node monitored by a kicker.

    (ENG-32274, RT:50532, PS-45668, CSCwf81555)

  - logging: Complement the fix in ENG-30980 to make it possible to
    enable/disable
    the writing of NETCONF trace log output without disrupting active
    NETCONF sessions.

    (ENG-32716, RT:50710, PS-45848, CSCwh45408)

  - logging: Enable/Disable the writing of trace output will now not disrupt
    active NETCONF session.

    (ENG-30980, RT:50164, PS-45294, CSCwe42185)

  - maapi: When the MAAPI server needs to respond with an error to a MAAPI
    client and that client is not reachable, MAAPI will now log an INFO
    message to 'ncs.log' instead of writing an error to 'ncserr.log'.

    (ENG-32594)

  - maapi: When loading XML through MAAPI or the 'ncs_load' tool, allow the
    'remove' operation on leafs without any value specified.

    (ENG-30521, RT:49966, PS-45093, CSCwd93417)

  - maapi: MAAPI could, depending on the YANG model, fail with an internal
    error during error message creation in case of a missing data provider.
    Instead of failing with an internal error, the node is now treated as
    missing in the error message.

    (ENG-27541, RT:47531, PS-42652, CSCwa02078)

  - ned: When syncing from NETCONF devices using the built-in NETCONF NED,
    too much incoming data may cause an unnecessarily large amount of memory
    to be allocated. This fix will delay the adjustment of the SSH Channel
    Window until the data processing begins, which has been shown to improve
    memory allocation behavior significantly.

    (ENG-31326, CSCwe81624, BEMS01574303, BEMS01580705)

  - ned: Updated and renamed the 26-ned-migration example. It can now be
    found under examples.ncs/development-guide/ned-upgrade/ned-migration in
    the example set.

    (ENG-28060)

  - netconf: Corrected an issue when retrieving live-status data through the
    CLI where too much data would be requested from the device if a wildcard
    was used in the CLI command.

    (ENG-31437, CSCwe89779, BEMS01550536)

  - netconf: This fix will undo the effects of the fix in ENG-28333;
    now the sending of a Notification in netconf_base_notification.erl
    will (again) be done synchronously.

    (ENG-30170, RT:49826, PS-44952, CSCwd47102)

  - python-api: Fix incorrect handling of None initial state in cdb
    subscriber diff_iterate.

    (ENG-32265)

  - python-api: Corrected the progress notification documentation in the
    _ncs.events Python module.

    (ENG-31565)

  - python-api: _cdb.sub_abort_trans_info() argument order has been synced
    to be in line with the documentation.

    (ENG-30990)

  - restconf: A RESTCONF PATCH operation, when the user has no access
    rights, will now return proper access denied reply.

    (ENG-32431, RT:50611, PS-45748, CSCwh04975)

  - restconf: When YANG Patch fails while performing several simultaneous
    edit operations with an enabled commit queue, error messages are now
    more verbose.

    (ENG-32248, RT:50498, PS-45632, CSCwf76175)

  - restconf: A module with a parent and a child container explicitly
    specifying the same namespace caused an error response to a legitimate
    request. Such a request no longer responds with an error but a proper
    answer.

    (ENG-32078, CSCwf58773, BEMS01532188)

  - restconf: RESTCONF will now use module name instead of prefix in reply
    when using instance-identifier and leaf-list in JSON format.

    (ENG-32041, RT:50340, PS-45473, CSCwf52710)

  - restconf: The query parameter unhide can be used when invoking an RPC or
    action in RESTCONF. This has been added to the NSO Northbound APIs Guide
    chapter RESTCONF section Query Parameter and under the Hidden Nodes
    section.

    (ENG-31823)

  - restconf: Correctly return 'invalid-value' error tag for some invalid
    value error messages that before had the 'malformed-message' error tag.

    (ENG-31379)

  - restconf: Previously, the query-parameter was ignored when invoking an
    RPC or action in RESTCONF with a query-parameter. This has been changed
    to respond with a 400 (Bad Request) response with the error-app-tag set
    to invalid-value. The trace-id query parameter is an exception, which is
    still allowed when invoking an RPC or action in RESTCONF. This has been
    added to the NSO Northbound APIs Guide chapter RESTCONF section Query
    Parameter and the Administration Guide chapter System Management section
    Trace ID.

    (ENG-30826, BEMS01558776)

  - restconf: Previously, a POST in RESTCONF where the path points to a list
    key and the request contains a payload that includes the list key would
    result in an internal error response. Instead, the response will now be
    a resource-denied "object already exists" error with status code 409".

    (ENG-30624)

  - restconf: When external validation was used with RESTCONF request header
    Authorization and configuration file contained
    /logs/webui-access-log/traffic-access-log and enabled syslog, the
    request crashed with a printout in the error log. With this fix, the
    request is carried out correctly, and the intended trace log entry is
    written to the access log.

    (ENG-30366, RT:49933, PS-45060, CSCwd72457)

  - restconf: In a scenario were external authentication were set in the
    config file and authentication cache (AuthCacheTTL) was used, and a
    burst of RESTCONF requests were sent, there were several requests that
    did not make use of the auth-cache, despite being within the auth-cache
    time frame of existence.
    This fix now implies that the first request of a burst of requests will
    authenticate and fill the auth-cache so that the requests following in
    the burst can make use of the auth-cache within its time-to-live time.

    (ENG-30238, CSCwd55725, BEMS01497187, BEMS01540333)

  - rollback: CLI command 'show commit changes' is no longer deprecated and
    will not be removed.

    (ENG-32584)

  - rollback: Corrected an error when the HA node transitions from none to
    the primary role while applying a configuration change.

    (ENG-32145, RT:50505, PS-45639, CSCwf66833)

  - smart-licensing: When a HA instance leaves primary SLS JVM should stop
    and if it becomes primary SLS JVM will be started if Smart Licensing is
    enabled.

    (ENG-31624, BEMS01624167)

  - toolchain: Removed a deadlock that could occur when calling "ncs
    --status" while transitioning from phase0 to phase1.

    (ENG-32272, RT:50542, PS-45678, CSCwf80724)

  - toolchain: The algorithm that generates unique integer values for YANG
    identifiers has been modified to generate a different value for
    "bgp-lsp" and "current-peers" to avoid conflicts.

    (ENG-31690)

  - toolchain: Fix loading error that would not allow a leafref to point to
    an augmented node if the underlying type was not local or primitive.

    (ENG-29485, RT:49485, PS-44609, CSCwc45399)

  - toolchain: ncsc will now check for enumeration conflicts when performing
    revision-merge.

    (ENG-29276)

  - upgrade: If a mandatory choice had an active case before the CDB
    upgrade, during the CDB upgrade, when deleting the node and adding a new
    node into the active case, the CDB upgrade would fail with an internal
    error.  NSO will now only look up nodes existing in the old and new
    schema.

    (ENG-32487)

  - upgrade: Fixed an issue where CDB upgrades ignored a constraint change
    on a list node.

    (ENG-32416)

  - web-server: When requesting an SQLite compliance report through the HTTP
    server, the response will now include a correct Content-Type header.

    (ENG-31268)

  - web-server: Invalid Content-Length values are now handled gracefully by
    returning a HTTP 400 Bad Request response, instead of the previous
    behavior where the connection was closed immediately.

    (ENG-30160, CSCwd46346)

  - web-server: If the WebUI was disabled in ncs.conf and other web server
    components were enabled when docroot was set to "api". This effectively
    meant that a directory in the working directory named "api" would be
    exposed publicly. No docroot is now set if the WebUI is disabled.

    (ENG-26481)

  - webui-one: Navigating to operational data for an offline device in the
    Configuration Editor will now display an error message instead of
    failing silently.

    (ENG-33335)

  - webui-one: Clicking on a service instance in the "services" pane of the
    Device Manager will now redirect the user to the correct location in the
    Configuration editor.

    (ENG-32747, RT:50709, PS-45847, CSCwh48823)

  - webui-one: In the case of initiating a new instance of a service point
    modeled under a nested list in the root of NSO, the filtering of the
    parent selector gave the illusion that only the ten first items of the
    parent were available. This has been fixed.

    (ENG-31297, CSCwe82539, BEMS01571021)

  - xpath: Resolved incorrect XPath evaluation when using multiple current()
    inside count() function.

    (ENG-33184, RT:50881, PS-46020)

  - xpath: Fixed an issue where the result of an XPath expression was
    evaluated to an empty string instead of 'false'.

    (ENG-32907, CSCwh62100, BEMS01637458)

  - xpath: An incorrect XPath predicate evaluation was resolved when
    current() is used inside a count() function.

    (ENG-32524, RT:50644, PS-45781, CSCwh22546)

  - yanger: Ensure FXS files are consistent when compilation is done in
    parallel or the input order differs.

    (ENG-31953, RT:50447, PS-45581, CSCwf45308)

  - yanger: Corrected the 'tailf:display-when' statement when replacing
    'if-feature' using 'ncsc --ncs-compile-bundle'.

    (ENG-31947, RT:50443, PS-45577, CSCwf44803)

  - yanger: Fix validation of 'must' expression with 'not' keyword pointing
    to a type 'empty' leaf.

    (ENG-31533, RT:50329, PS-45463, CSCwf00671)

NSO-5.8 [April 11, 2022]
========================
Deprecated:

  - nso: Obsoleted /ncs-config/rollback/type.
    Obsoleted /ncs-config/rollback/rollback-numbering.

    (ENG-28224)

  - nso: The NSO build toolchain will be updated for NSO-6.0. This impacts
    the oldest version of glibc supported for use on Linux. As of the
    NSO-6.0 release, the minimum version of glibc supported for Linux will
    be glibc-2.24. The runtime requirements for the upcoming NSO-5.8 will
    remain unchanged.

    (ENG-26972)

  - nso: Only HCC 5.x and higher will be supported from NSO 6.0

    (ENG-28530)

  - ned: The NSO 5.4 "revision compilation/merge" feature deprecation has
    been reverted. There are currently no plans to remove or replace the
    existing revision merge feature.
    The revision merge feature documentation has been improved and an
    example supporting the documentation has been added to the example set.
    See the NED Development Guide chapter "Revision Merge Functionality" and
    examples.ncs/development-guide/ned-upgrade/yang-revision for details.

    (ENG-25569)

Removals:

  - ncs: Removed obsoleted leaf /java-vm/service-transaction-timeout.

    (ENG-26347)

  - examples: Removed the vrouter.yang live-status monitor from the nano
    services netsim-vrouter example as it breaks best-practices and will
    cause a compiler warning.

    (ENG-28164)

Non-backwards compatible corrections:

  - ncs: Previously, the un-deploy action was run outside of the service
    manager for both services and nano-services; before taking the
    transaction lock. Reading and applying the reverse diffset to the
    transaction before taking the transaction lock enables a race condition
    that occurs when another transaction makes changes to the same service
    before the transaction with the reverse diffset is applied.
    Another issue with the previous implementation was that it did not
    un-deploy nano-services in stages. The entire nano-service was
    un-deployed in a single stage, not respecting any delete pre-conditions
    or executing delete post-actions.
    The un-deploy action is now integrated inside of the service manager.
    The reverse diffset is read and applied after taking the transaction
    lock, which makes the race condition mentioned previously impossible.
    Un-deploying a nano-service now results in a staged un-deploy that works
    similarly to how the deletion of a nano-service behaves but without
    removing the service intent.

    (ENG-26396)

  - cli: History handling is refactored in CLI, so that indefinite growth
    should not be possible. The format of history data stored on disk has
    been changed. The old format is still readable.

    (ENG-17471, RT:30774, RT:42018, PS-27052, PS-37116)

  - ha: Primary and secondary nodes are required to have the same NETCONF
    notification stream names when built-in replay store is enabled. If not,
    the primary node will reject any attempt to become secondary node with
    the following error message: Remote HA node has bad configuration

    (ENG-16548, RT:30058, RT:32993, RT:33130, PS-9864, PS-28535, PS-28628)

  - web-server: Previously the local install would install pre-generated CA
    and TLS certificates and keys. The local install now generates these
    files instead, as the system install already does.

    (ENG-28128, RT:48426, PS-43538)

Enhancements:

  - ncs: Transactions automatically started by the fetch-ssh-host-keys
    action no longer generate rollback files when being applied.

    (ENG-28576)

  - ncs: Service templates does no longer register callbacks on
    servicepoints through an application daemon. They are instead registered
    in an internal data structure specific to templates.
    /ncs-state/internal/callpoints/servicepoint/template has been added as a
    new registration type.

    (ENG-28319)

  - ncs: A new outformat - 'cli-c' has been introduced. It can be used to
    get Cisco-style CLI output in "commit dry-run" and also in all the
    internal device/service actions.

    (ENG-28280, RT:48629, PS-43742)

  - ncs: Moved leafs /zombies/service/{diffset, latest-u-info,
    latest-commit-params} to /zombies/service/private/{diff-set,
    latest-u-info, latest-commit-params}.
    The leaves were moved below the private container, and the leaf
    'diffset' was renamed 'diff-set' to make the zombie and service model
    more consistent.

    (ENG-28205)

  - ncs: The 'trigger-expression' of a kicker can now in some cases be used
    to refine the kicker 'monitor' to avoid unnecessary evaluations. See the
    updated Kicker Constraints/Filters section in the Development Guide for
    details.

    (ENG-28112)

  - ncs: Performance improvements in the validation phase.

    (ENG-28030, RT:48206, PS-43323, CSCwa55071, SR:692487980)

  - ncs: Device locks (implemented as commit queue locks) now have a more
    descriptive tag. This tag is visible in status data and notifications.

    (ENG-27962)

  - ncs: Service metadata (ref-counters, backpointers, etc.) were previously
    always saved when performing a shared set or create on a node in
    FASTMAP. However, storing service metadata on nodes with a parent node
    created using a non-shared operation is redundant because the entire
    subtree rooted at the parent will be removed when applying the service's
    reverse diffset.
    Service metadata is no longer saved on nodes that are part of a subtree
    rooted at a node created with a non-shared operation.

    (ENG-27952)

  - ncs: Clients can now subscribe to Audit-network events (config changes
    sent to devices) via the events API. See the Java/Python/econfd API
    reference for more details.

    (ENG-27509)

  - ncs: Added new if-ned-id-match processing instruction and
    supported-ned-id-match package-meta-data.xml configuration.
    The if-ned-id-match processing instruction works similarly to the
    already existing if-ned-id processing instruction but accepts a regular
    expression as its argument instead of a list of ned-ids. The regular
    expression is matched against all of the ned-ids supported by the
    package. If the if-ned-id-match processing instruction is nested inside
    of another if-ned-id-match or if-ned-id processing instruction, then the
    regular expression will only be matched against the subset of ned-ids
    matched by the encompassing processing instruction. For details, see the
    NSO Development Guide, chapter Templates, section Processing
    instructions.
    The new supported-ned-id-match configuration list contains regular
    expressions for ned-ids supported by a package. Ned-ids in the system
    that matches at least one of the regular expressions in this list are
    added to the already existing supported-ned-id configuration list, which
    holds the ned-ids supported by a package. For details, see the NSO
    Development Guide, chapter NSO Packages, section The
    package-meta-data.xml file.

    (ENG-27392, RT:46107, PS-41224)

  - ncs: When /ncs-config/logs/trace-id is set to 'true', actions may now
    relay trace-id's from NB requests, if none exist a new trace-id is
    created at the time the action is invoked. In RESTCONF requests trace-id
    can be provided as query parameter and will be included in the
    X-Cisco-NSO-Trace-ID header in the response. See the ncs.conf(5) man
    page and the NSO 5.8 Administration Guide -> NSO System Management ->
    Monitoring NSO -> Trace ID for more info.

    (ENG-26764)

  - ncs: The commit queue now handles request bursts more effectively.

    (ENG-26761)

  - ncs: When a device template refers to an unknown NED ID during package
    upgrade, an error message will be returned instead of silently removing
    the template.

    (ENG-25849, RT:45300, PS-40413, SR:689782056)

  - ncs: When compiling a Nano service model the Yang compiler will now warn
    when any pre-condition monitor have an invalid value.

    (ENG-24556)

  - ncs: Service actions (deep-check-sync and get-modifications) work
    correctly in 3-layer LSA.

    (ENG-24354)

  - ncs: New configuration option under ncs-config/ssh/rekey-limit allowing
    to specify SSH rekey interval in bytes, or in minutes, for built-in SSH
    servers. The limits are checked every minute. Rekeying initiated by the
    other peer will still occur. See the ncs.conf(5) man page for details.

    (ENG-23457, RT:41267, PS-36333)

  - cdb: Emit progress event when a HA node joins the HA cluster to for
    example indicate whether initial replication is needed or not.

    (ENG-27756)

  - cdb: Operational and snapshot databases are now compacted when calling
    the initiate_journal_compaction command.

    (ENG-27495, RT:47602, PS-42723, CSCvz97167, SR:692301943)

  - cli: Performance of displaying diff in the CLI where large lists are
    combined with data nodes that use the tailf:cli-reset-container,
    tailf:cli-reset-siblings, or tailf:cli-reset-all-siblings extensions has
    improved.

    (ENG-27929, RT:48112, PS-43227, CSCwa41947)

  - cli: When deleting a list entry which has a non-mandatory leaf with
    extension "tailf:cli-prefix-key", no completion shall be provided to
    that leaf.

    (ENG-15216)

  - cs_trans: Skip evaluating "when" expression for a leaf without a default
    value when a parent node is created, since the leaf does not have a
    value yet.

    (ENG-28019)

  - documentation: The Python high-level API documentation was improved and
    is now consistent with providing information on argument and return
    parameters and examples where necessary.

    (ENG-28444)

  - documentation: The upgrade documentation was improved. See the:
    - Administration Guide chapter NSO Deployment --> Upgrading and NSO
    Packages --> NED Migration
    - Development Guide chapter NED Upgrades and Migration
    - Installation Guide chapters NSO Local Install --> Migrate to System
    Install and NSO System Install --> Version Upgrade
    - NED Development Guide chapter NEDs --> NED Version Scheme and Revision
    Merge Functionality

    (ENG-28076)

  - documentation: A description of the --cdb-compact flag is added to the
    ncs command man page.

    (ENG-27734)

  - documentation: The Layered Service Architecture Development Guide "LSA
    Overview", "LSA examples", and "Deploying LSA" chapters were improved.
    Related to LSA, the Development Guide was also updated with a new
    "Scaling and Performance Optimization" chapter. The new documentation is
    supported by the previously released examples.ncs/development-guide/lsa/
    examples.

    (ENG-27638)

  - examples: Updated the Development Guide chapter "Basic Automation with
    Python" and the examples_ncs/development-guide/basic-automation example
    to cover the Python ncs.maapi.apply_params() method. See also the
    apply_params() description in the NSO Python API documentation.

    (ENG-28679, RT:48840, PS-43955)

  - examples: Added new examples for the built-in high availability feature
    under examples.ncs/development-guide/high-availability to support the
    updated admin and development guide upgrade documentation.

    (ENG-28424)

  - examples: Added an example to the NSO example set under
    examples.ncs/development-guide/ned-upgrade/yang-revision to complement
    the new "Revision Merge Functionality" NED Development Guide
    documentation.

    (ENG-28140)

  - ha: Added default 'true' to /high-availability/consensus/enabled, see
    the tailf-ncs-high-availability.yang YANG submodule for more info.

    (ENG-27977)

  - ha: Added the action /packages/ha/sync/and-reload. The action performs
    distributing packages from the primary to secondary nodes, and reload
    the packages in HA cluster.
    More information in the tailf-ncs-packages.yang, and in the NSO HA
    Version Upgrade section under the NSO Deployment chapter of the NSO
    Admin Guide

    (ENG-23284, RT:45615, PS-40733)

  - java-api: NavuList methods containsNode(), insert() and isEmpty() no
    longer do a full refresh of available keys when called.

    (ENG-28081)

  - java-api: log4j has been upgraded to version 2.17.1

    (ENG-28036, CSCwa54664, CSCwa54674)

  - json-rpc: This feature adds the possibility to get the progress trace
    for an action in JSON-RPC using comet requests. When invoking an action
    using the "run_action" method you can set the "comet_id", "handle", and
    "details" params. This allows fetching the progress trace for the action
    using the "comet" method with the same "comet_id" that was used for the
    "run_action" method. "details" specifies the verbosity level and can be
    either "normal", "verbose", "very_verbose", or "debug". See section
    "Method run_action" in the Web UI documentation.

    (ENG-28109)

  - json-rpc: Adding the list_packages JSON-RPC method for listing package
    attributes in NSO. See the JSON-RPC chapter of the Web UI documentation
    for more details.

    (ENG-27623)

  - logging: The audit log (when having /ncs-config/logs/audit-log-commit
    enabled) now only reports added and deleted backpointers instead of the
    entire list for a changed path.

    (ENG-25273, RT:44433, PS-39540, SR:690262073)

  - netconf: Improve performance of fetching operational data from NETCONF
    devices by utilizing the northbound read intent. By utilizing the read
    intent NSO will now fetch all the requested data using one NETCONF
    request to the device, which might considerably increase the performance
    of fetching large sets of operational data from a device.

    (ENG-20304)

  - observability: The "ncs --debug-dump <File>" command now supports
    additional options:
    (1) --collect-timeout <seconds> to provide the desired timeout when
    system collects internal data. The default timeout is 10 seconds.
    (2) --compress to compress the debug dump to File.gz.
    Additionally, if a timeout is reached, NSO will inform the client with
    the following message:
    *** Failed to collect <type>: timeout
    See the NSO Administrator Guide chapter "General Troubleshooting
    Strategies" section "Debug dump" for more details.

    (ENG-27926, RT:47738, PS-42861, SR:692398999)

  - python-api: Added original value, when and refcounter symbols.

    (ENG-28389, RT:48809, PS-43924, CSCwb09501)

  - python-api: Log a warning when a service, nanoservice or action callback
    does an assignment to self.X. The new log entry is "Assigning to self is
    not thread safe". Assigning to self during setup will not produce a log
    entry.

    (ENG-27331)

  - smart-licensing: Upgraded smart-agent to version 3.1.12.

    (ENG-28048, RT:48257, PS-43374)

  - snmp-agent: Support added for the following algorithms:
      * usmHMAC128SHA224AuthProtocol
      * usmHMAC192SHA256AuthProtocol
      * usmHMAC256SHA384AuthProtocol
    See the SNMP-USM-HMAC-SHA2-MIB.mib for details.

    (ENG-27834)

  - web-server: Adding the HTTP endpoint "/package-upload" for uploading
    packages to NSO which can be called from a web client instead of the
    upload action. See the webserver chapter of the Web UI documentation for
    more details.

    (ENG-27376)

  - webui-one: Adding a new Package upgrade application to the WebUI which
    can upload, install, deinstall and reload packages. In a High
    Availability scenario it is also possible to sync packages from the
    primary node to its secondary nodes.

    (ENG-28648)

  - webui-one: Dropdown menu redesigned.

    (ENG-28104)

  - webui-one: Add hyperlinks to the other nodes the High availability
    cluster application. The assumption is that all nodes use the same
    protocol and port.

    (ENG-27870)

  - webui-one: Revalidate button shows loader while the revalidation is
    running

    (ENG-27684)

  - yanger: For YANG "identity" statements, when using the YANG
    "description" substatement as help text in the CLI and using <TAB> or
    question mark in the CLI to retrieve the help text for possible values,
    the CLI would not show the help text. The CLI will now show the help
    text for identity statements when the YANG description information is
    used as help text.

    (ENG-25152, RT:44606, RT:44300, PS-39717, PS-39406)

Corrections:

  - ncs: Diffs of Lower LSA nodes are now included in commit dry-run for all
    outformats when commit-queue is enabled globally.

    (ENG-28550)

  - ncs: NSO now correctly store paths that have been deleted in the service
    reverse diff-set. If these paths point down into the
    /devices/device/config tree a NED migration could previously render them
    invalid. Services that perform delete operations should be re-deployed.

    (ENG-28462, RT:48875, PS-43991, CSCwb19469, SR:48033)

  - ncs: NSO would, in some cases, use an invalid cached IP address when
    connecting to a NETCONF device configured with a hostname address, if
    the IP address assigned to that hostname changed since the previous
    connection attempt.

    (ENG-28435)

  - ncs: Extensions junos-val-as-xml-tag and "junos-val-with-prev-xml-tag"
    are now handled when constructing subtree filters for fetching partial
    configurations from junos devices.

    (ENG-28312, RT:48580, PS-43692, CSCwa97292, SR:692993261)

  - ncs: The show customers command is now displaying customers' customer
    services correctly.

    (ENG-28251, RT:48566, PS-43678, CSCwa88116, SR:692366008)

  - ncs: The force-back-track action is no longer returning an error
    ("Failed: service is not deployed") when invoked on a component
    belonging to a zombie with an external plan.
    The force-back-track action previously only used a component's keypath
    to determine if it belongs to a service or zombie service; however, this
    does not work with components belonging to a service with an external
    plan.
    The action is now concluding if a component of an external plan belongs
    to a zombie service by checking if a zombie belonging to the service
    owning the plan exists in CDB.

    (ENG-28155, RT:48440, PS-43553, CSCwa77259)

  - ncs: Leaf or leaf-list nodes modeled directly below
    /devices/device/config are no longer falsely marked as modified during
    NED migration.

    (ENG-28058)

  - ncs: Faulty revision tags in the capability list no longer cause an
    internal error in NSO.

    (ENG-28032)

  - ncs: The 'get-modifications' action did not work correctly for stacked
    services where the the lower service in the stack is an LSA service.

    (ENG-27654, RT:48705, RT:47528, PS-43818, PS-42649, CSCwa14547)

  - ncs: The position of list elements in lists is now retained when
    replaced using the replace tag in a configuration template.

    (ENG-27552, RT:46144, PS-41262, CSCwa04231, SR:691348810)

  - ncs: Fixed incorrect change-set handling that would sometimes lead to
    schema violations in the write-ahead log. This caused data nodes to
    appear in the tree with the wrong schema or new nodes being created
    during delete operations.

    (ENG-26915, RT:47668, RT:45996, RT:47442, PS-42790, PS-41113, PS-42563)

  - ncs: Filtering progress trace events, based only on context or user, was
    corrected.

    (ENG-26901, RT:46498, PS-41612, CSCvy73354, SR:691550999)

  - ncs: Fixed missing CDB subscriber notification for default leaf
    belonging to a non-presence container with "when" expression.

    (ENG-23203, RT:40699, PS-35794, CSCvs98323)

  - candidate: Fixed wrongly removing inactive attribute when committing
    candidate configuration.

    (ENG-27710)

  - cdb: Attribute data for annotation attributes are now kept after a NED
    migration.

    (ENG-28062)

  - cdb: When replying to RESTCONF GET requests, as a performance
    improvement, NSO no longer iterates through tailf:hidden nodes.

    (ENG-25645, RT:45104, PS-40217, CSCvx25429)

  - cdb: Corrected set_case() callback in operational datastore when
    applying nested 'choice' statements.

    (ENG-24931)

  - cdb-capi: cdb_exists() for a leaf-list node at prepare phase crashed and
    caused NSO to close the application socket. Leaf-list nodes are now
    handled correctly and cdb_exists() returns the correct results.

    (ENG-28245, RT:48570, PS-43682, CSCwa87372)

  - cdb-capi: A close event from a CDB subscriber socket while processing
    cdb_oper write requests is now handled properly instead of restarting
    NSO.

    (ENG-27531, RT:47665, PS-42787, CSCwa00963)

  - cdb-capi: cdb_get_txid() wrongly returned 'Unknown CDB operation' on a
    CDB session which was established at the prepare stage for a read-write
    transaction. The CDB has been updated and will now correctly return the
    transaction ID.

    (ENG-25840, RT:45363, PS-40477, CSCvx61089)

  - cli: The CLI diff engine generated wrong command when deleting a choice
    case which is an empty leaf with extension "tailf:cli-hide-in-submode"
    under a parent list node with extensions "tailf:cli-sequence-commands"
    and "tailf:cli-incomplete-command".

    (ENG-28144, RT:48600, RT:48450, PS-43712, PS-43563, CSCwa74894,
    SR:692880408)

  - cli: Loading a configuration file in J-style CLI would encounter an
    internal error when the YANG model uses the "tailf:cli-no-keyword"
    extension on a list and the value of the list key is an IPv6 prefix or
    address.

    (ENG-28103, RT:48410, PS-43522, CSCwa68686)

  - cli: Executing an action mounted under a list annotated with
    tailf:cli-key-format would not work correctly if the key-filter in the
    path to the action contained any wildcards.

    (ENG-28045, RT:48284, PS-43401, CSCwa57149, SR:692769827)

  - cli: When traversing the command line to execute, the candidate node
    matching algorithm used prefixes even when it was not required. This
    resulted in syntax errors when the command did not include a prefix, and
    has been corrected.

    (ENG-27723, RT:47882, PS-42994, CSCwa21504)

  - cli: Completion on action parameter with type leafref did not work
    because the XPath evaluation failed if the leafref path uses a predicate
    to constrain the list key value to be its peer action parameter with
    type leafref which is not a list key.

    (ENG-27708, RT:47589, PS-42710, CSCwa19710, SR:692136637)

  - cli: Commands produced by CLI as the result of
    cdb_get_modifications_cli() invocation or as the result of "show
    configuration" command in "config shared" mode, did not correctly
    reinstate parts of an ordered-by user list, which were removed as part
    of dependencies processing.

    (ENG-27496, RT:47671, PS-42793, CSCvz97183)

  - cli: If similar YANG schemas where successfully augmented to the same
    data node the CLI would crash when trying to display the information.
    This has been fixed by improving the exposure of the YANG prefixes for
    ambiguous results and in case the CLI can't handle the ambiguity an
    error regarding this will be presented instead of a crash.

    (ENG-27271)

  - cli: When calling an action from the CLI with input params of type enum
    with exactly one possible entry the CLI would identify empty input as
    the only enumeration entry if the ncs.conf option
    '/ncs-config/cli/allow-abbrev-enums' was turned on. This has been
    corrected by not auto expanding empty input as something that has been
    abbreviated.

    (ENG-26774, RT:46370, PS-41489, CSCvy58554)

  - cli: Add an audit log entry of value which is set in the auto wizard in
    J-style CLI.

    (ENG-26648, RT:45703, PS-40818, CSCvy45290)

  - cli: When loading CLI spec files FXS cache has not been used, thus
    making namespace lookup operations very time-consuming. Now the FXS
    cache is available when CLI spec files are loaded.

    (ENG-26585, RT:47789, RT:46195, PS-42912, PS-41313, CSCvy47978)

  - cli: When 'max-elements' restriction is present for a list then range
    expressions for list keys are not expanded if the result of the
    expansion will have more elements than the specified 'max-elements'.

    (ENG-26351, RT:45950, PS-41067, CSCvy13194)

  - cli: Corrected the input validation of action parameters constrained
    with the range attribute so that the range custom error message of leafs
    annotated with `tailf:drop-node-name` is shown.

    (ENG-19794, RT:35168, PS-30239)

  - cli: The 'top' command, of the C-style CLI, is now setting correctly the
    submode path when executing a command that exits configuration mode,
    e.g. 'top end' and 'top exit'.

    (ENG-17581, RT:31357, PS-27414)

  - cli: The CLI can now see that a command is incomplete when using
    'tailf:cli-drop-node-name' extension on nodes inside a container or list
    that has the 'tailf:cli-incomplete-command' extension even if a empty
    string is used.

    (ENG-11182, RT:29212, PS-9454, SR:682698945)

  - cluster: If a new IP address is detected when resolving a hostname
    belonging to a device, then all existing connections towards that device
    need to be recreated against the newly resolved IP address. Previously
    only the connection that detected the new IP would be reconnected;
    however, there might be cluster connections or NETCONF subscribers
    configured towards the affected device that also needs to be
    reconnected. NSO is now trying to reconnect all connections towards a
    device when a newly resolved IP address is different than the IP address
    used by the currently active connection.

    (ENG-28100, RT:47116, PS-42235, CSCwa67519, SR:691883016)

  - cs_trans: Fixed incorrect min-elements constraint validation when
    deleting a list/leaf-list under "choice" that has a default "case".

    (ENG-28465, RT:48933, PS-44049, CSCwb20963)

  - cs_trans: Removed an issue with the CLI hanging, caused by a "when"
    statement.

    (ENG-27976, RT:48123, PS-43238, CSCwa46737, SR:692651570)

  - cs_trans: Fixed "when" expression not evaluating if it depends on a leaf
    with a default value, the leaf is removed, then set to the old value
    again in the same transaction.

    (ENG-27931)

  - cs_trans: Corrected a fatal "bad dependency" error  occurring with a
    "must" expression on a leaf-list that refers to a list node ancestor.

    (ENG-27917, RT:48094, PS-43209, CSCwa40711)

  - cs_trans: When NSO needs to know the length of a list or a leaf-list it
    calls num_instances() in the data provider. If num_instances() is not
    registered NSO falls back to doing multiple calls to get_next(). In case
    get_next() is not registered NSO failed to continue and issued an error.
    The correct behavior in this case would be to calculate the length by
    doing multiple calls to get_next_object() which NSO did not do. With
    this fix NSO now falls back to calling get_next_object() to calculate
    the length in case neither num_instances() nor get_next() is registered.

    (ENG-27902, RT:48103, PS-43218, CSCwa38337)

  - cs_trans: Compare config on CLI in all formats will return the
    difference or reports instead of an error line.

    (ENG-27768, RT:47975, PS-43090, CSCwa26408)

  - cs_trans: Validation failed with 'internal error' when evaluating 'must'
    expressions to lists with composite keys, where the composite keys
    include a key of 'enum' type.

    (ENG-27357, RT:48208, RT:46887, PS-43325, PS-42004, CSCvz79758)

  - cs_trans: Validation in NETCONF calls will now take when-expressions
    into account for transformations.

    (ENG-27173, RT:46790, PS-41908, CSCvz51086, SR:691511452)

  - cs_trans: In a nested choice node, the subscription notification for the
    default leaf under nested default case was missing when deleting the
    non-default leaf in the same choice. Now, the subscription notification
    will be present for the default leaf under nested default case when
    deleting the non-default leaf in the same choice.

    (ENG-27123, RT:47119, PS-42238, CSCvz42203)

  - cs_trans: Remove dependency on cli.ez for systems not using cli

    (ENG-25437, RT:44612, PS-39723, CSCvw84514)

  - documentation: Updated the RESTCONF API documentation to list the
    correct combination of commit parameters and methods.

    (ENG-28397, RT:48840, PS-43955)

  - documentation: Documentation has been added to describe exit code 16 in
    the NSO System Management part of the NSO Administration Guide.

    (ENG-23761, RT:41801, PS-36895)

  - erlang-api: The old Erlang crypto API was deprecated in OTP 23.x in
    favor of the new crypto API. Furthermore, the old Erlang crypto API is
    removed in OTP 24.x.
    NSO migrates to the new crypto API and also replaces erlang:phash/2
    (deprecated) with erlang:phash2/2 for the econfd MAAPI cursor id.

    (ENG-28212, RT:48547, PS-43659, CSCwa82880)

  - ha: Return an error if action /high-availability/enable is invoked on a
    node in read-only mode. The action needs to write to CDB; however, the
    write would previously return successfully even though the CDB write
    failed, leaving the system in an invalid HA state.

    (ENG-28422)

  - ha: Removed a race condition when pending rollback files were aborted
    and deleted just before HA tried to distribute the file to the
    secondaries. The race condition resulted in an ENOENT - file not found
    error.

    (ENG-27882)

  - java-api: The SSH client in the NSO/NED Java API no longer erroneously
    returns an "SSH host key mismatch" error when connecting to a turned-off
    device. It now correctly returns a "Connection refused" error instead.

    (ENG-28246, RT:48438, PS-43551, CSCwa87703)

  - java-api: Disabled external resource access (entities, DTD etc) while
    parsing XML in the Java API

    (ENG-28195, RT:48817, PS-43932)

  - json-rpc: Doing show_config for /ncs:compliance/report-results/report in
    JSON-RPC when result_as is set to json2 would return an empty result
    even though reports existed. This has been fixed to show the correct
    result.

    (ENG-27824, RT:48047, PS-43162, CSCwa33751, SR:692232320)

  - kickers: Triggering actions with optional input parameters from a
    notification kicker previously resulted in an error because of faulty
    handling of action input parameters. The issue has been resolved, and it
    is now possible to invoke actions with optional input parameters from
    notification kickers.

    (ENG-28237, RT:48531, PS-43643, CSCwa86478, SR:692886387)

  - logging: The audit network log now logs additional edit-config calls
    containing move operations on Juniper Junos devices.

    (ENG-28309)

  - logging: Enabling NETCONF tracing will enable tracing for existing
    connections as well as new connections. Previously only new connections
    were affected by the change.

    (ENG-27071, RT:47031, PS-42150, CSCvz32833)

  - logging: NSO now logs the reverse diff-set being sent to the device when
    the transaction is aborted in the audit network log. Any error when the
    diff-set is applied to the device will also be logged.

    (ENG-25436, RT:44699, PS-39810, CSCvw84497, SR:690304560)

  - maapi: When loading data into NSO using the relative load option and
    replacing old configuration, for example `rload replace filename.txt`,
    the CLI could in some situations not retain data for leaf-lists. This
    has been fixed by making sure any preexisting data that shouldn't be
    removed remains in place.

    (ENG-27786, RT:46931, RT:48200, PS-42048, PS-43317, CSCwa29847)

  - netconf: The session of establish-subscription could sometimes be
    dropped due to an incorrect namespace being used in the internal data
    provider handling the monitor model under /sn:subscriptions. Now the
    correct namespace is added and the session continues stable.

    (ENG-28351, RT:48041, PS-43155, CSCwb01938)

  - netconf: The netconf-subsys crashed in case the number of group IDs
    exceeded 255. The limit on group ID count has been removed and now the
    number of group IDs is first queried before reserving space for the
    actual list.

    (ENG-28262, RT:48602, PS-43714, CSCwa89726)

  - netconf: NSO now handles invalid elements in commit-results/rpc-error
    gracefully.

    (ENG-27885, RT:48057, PS-43172, CSCwa35948, SR:692485616)

  - netconf: XPath-filter from NETCONF notification modify-subscription
    operation was not propagated into the monitor structure
    /sn:subscriptions. Now the filter is properly stored for a
    modify-subscription request and can be read from /sn:subscriptions
    afterwards.

    (ENG-27610, RT:47752, PS-42875, CSCwa09847, SR:692301317)

  - netconf: For a Yang-Push subscription type on-change, where there were
    several changes occurring within the dampening-period, the corresponding
    notifications could be held back until another change was made, and then
    being sent. This fix assures that all received changes will be part of
    the notification sent at the end of a dampening period.

    (ENG-27570)

  - netconf: <edit-config>, <copy-config> and <edit-data> operations inside
    a tail-f transaction now reuses trace-id. Earlier any subsequent
    operation would generate a unique trace-id. tail-f transactions are
    started using <start-transaction> from tailf-netconf-transactions.yang.
    trace-id is enabled from /ncs-config/logs/trace-id (see ncs.conf(5) man
    page for more info).

    (ENG-27450)

  - netconf: NSO reclaims the memory which was allocated for the NETCONF
    event notifications right after each notification has been generated.

    (ENG-27205, RT:47265, RT:47091, PS-42386, PS-42210, CSCvz57953)

  - netconf: An ongoing NETCONF notification establish-subscription, that
    was abruptly terminated by killing the user session, sometimes resulted
    in a zombie subscription being left in the monitor model
    /sn:subscriptions in the CDB. A following attempt of an
    establish-subscription would fail due to clash with the leftover zombie
    subscription.
    To avoid zombie subscriptions in /sn:subscriptions, an internal data
    provider (DP) now handles client reads from /sn:subscriptions. The DP
    also protects /sn:subscriptions from being written to by clients, as
    only dynamic subscriptions are supported.

    (ENG-27115, RT:46541, RT:48041, PS-41655, PS-43155, CSCwb01938)

  - netconf: Add status for the running database in netconf-state, as well
    as the corresponding set_running_status and get_running_status commands
    for the ncs_cmd utility.
    Change of the status is logged in the developer log.

    (ENG-26042, RT:45616, PS-40734, CSCvx84625)

  - nmda: The NETCONF origin-filters that are passed down to CDB as a list
    filter expression caused NSO to hang. They are now properly handled.

    (ENG-28331, RT:48693, PS-43806, CSCwa98767)

  - nmda: The NETCONF server now implements the with-operational-defaults
    capability as defined in RFC 8526.

    (ENG-24850, RT:46629, RT:43844, PS-41744, PS-38949, CSCvv95799)

  - packages: Redeploying a tarball package with action
    /packages/package/redeploy no longer results in an internal error.

    (ENG-28177, RT:48486, PS-43599, CSCwa78386, SR:692616782)

  - python-api: The Python API held the lock while applying templates from
    service code effectively blocking other threads in the same Python VM to
    execute. The lock is now released before applying the template.

    (ENG-28546)

  - python-api: In some situations there is a risk that certain internal
    attributes in the maapi.Transaction class will get mixed up and some
    methods will no longer work, often resulting in a raised AttributeError
    with the text "Maapi has no attribute 'fileno'". This correction makes
    sure that the internal attributes in maapi.Transaction is handled
    correctly.

    (ENG-28185, RT:48430, PS-43543, CSCwa79623)

  - restconf: When using Yang-Patch with JSON payloads, the order in which
    list keys are presented is now truly irrelevant.

    (ENG-27423, RT:47554, PS-42675, CSCvz86603, SR:692230863)

  - rollback: The number of XPath evaluations due to when-expressions on
    leafs with default values have been reduced when building a rollback
    file.

    (ENG-25661, RT:44842, PS-39954, CSCvx64222)

  - security: The TLS 1.3 implementation was updated.

    (ENG-26256)

  - snmp-agent: Internal SNMP functionality failed, under some
    circumstances, to return a database read-lock. The functionality has now
    been reworked in a more robust fashion.

    (ENG-27975, RT:48117, PS-43232, CSCwa46320)

  - toolchain: Removed an incorrect ncsc circular dependency error when
    using YANG annotation files.

    (ENG-26573, RT:46200, PS-41318, CSCvy35906)

  - upgrade: Corrected upgrade handling of volatile nodes to persistent
    nodes in operational datastore.

    (ENG-28252, RT:48561, PS-43673, CSCwa88302)

  - upgrade: Corrected the issue that caused the system upgrade to fail with
    CONFD_ERR_UNSET_CHOICE due to an inactive case of a mandatory choice
    containing list entry under NP-container.

    (ENG-28166, RT:48476, PS-43589, CSCwa76454)

  - upgrade: If an identity was moved or deleted during an in-service
    upgrade, outdated identities could linger in the internal state
    potentially leading to a failed upgrade. NSO now ensures that the
    identity information is recreated from a clean state when performing an
    upgrade.

    (ENG-27474, RT:47572, PS-42693, CSCvz93806, SR:692296690)

  - upgrade: The upgrade process incorrectly handled an operational node
    with 'tailf:persistent true' statement being changed to
    'tailf:persistent false' and, therefore, a system restart did not clear
    the node's value in the datastore. The upgrade process has been fixed
    and the node will be removed after system restart.

    (ENG-27180, RT:45088, PS-40201, CSCvz52132)

  - upgrade: Corrected upgrade of leaf-lists with enumeration type.

    (ENG-26209, RT:45813, PS-40928, CSCvy00034)

  - webui-one: Google Chrome should no longer become unresponsive when
    navigating from webui-one to an external link.

    (ENG-28154, RT:48384, PS-43496, CSCwa76400)

  - webui-one: Removing a leaf properly renders a loader.

    (ENG-27688)

  - webui-one: Selecting and then deselecting a leafref input no longer sets
    it to the empty string. Typing and then deleting sets to the empty
    string. Selecting an empty string in the dropdown is unchanged and sets
    to the empty string.

    (ENG-27687)

  - xpath: Fix of a regression. When evaluating keys of nested lists, the
    XPath component would in certain cases, due to interaction of an
    optimization, evaluate queries as false instead of skipping an
    optimization step and evaluating deeper nested lists.

    (ENG-28370, RT:48773, PS-43887, CSCwb05892)

  - xpath: Fix regression introduced in ENG-26540 causing XPath expressions
    to be incorrectly evaluated when data types was unsupported in the
    low-level filtering or data partially available in the transaction
    changes.

    (ENG-28049, RT:48308, PS-43425, CSCwa57623)

  - xpath: Fixed issue where an XPath expression involving a path under a
    mount point would be incorrectly evaluated.

    (ENG-27978, RT:47874, PS-42986, CSCwa46601, SR:692455364)

  - xpath: The validation code could not find a leaf-list when referred to
    from a leafref. The filter code used for validation has been changed to
    fix this.

    (ENG-27907, RT:48106, RT:48454, RT:48107, PS-43221, PS-43567, PS-43222,
    CSCwa39014)

  - xpath: Correct a wrong result of XPath filtering outer list using inner
    list's keys.

    (ENG-27896, RT:48037, PS-43152, CSCwa37228, SR:692562956)

  - xpath: A regression introduced in ENG-24498 could make an XPath
    expression using count() referring to multiple leaf-list nodes return
    incorrect result.

    (ENG-27780, RT:47746, PS-42869, CSCwa29779)

  - yanger: Refinements are no longer, in some cases, erroneously applied to
    schema nodes with the same top-level name as the refinement's target
    node.
    For example, given the following grouping and refinement:
    grouping g {
            leaf a { type string; }
            container c { leaf a { type string; } }
    }
    uses g {
            refine a { default "default-string"; }
    }
    The refinement statement would previously, in some cases,  be applied to
    both "a" leaves in the grouping.

    (ENG-28431, RT:48997, RT:48869, PS-44111, PS-43985, CSCwb15578)

  - yanger: Using extension tailf:cli-custom-range in a submodule no longer
    results in an internal error.

    (ENG-28352, RT:48653, PS-43766, CSCwb02074)

  - yanger: Fixed an issue when actions with tailf:display-when on RFS nodes
    cannot be executed from CFS.

    (ENG-27830)

  - yanger: The YIN XML output produced by the yanger yin plugin had an
    incorrect escaping of the '>' character, did not include the
    'description' field, and did not use the prefix from the YANG module.

    (ENG-27338, RT:47384, PS-42505, CSCvz77446)

  - yanger: When a leafref with a relative path pointed to a config-false
    node in NSO packages, yanger didn't rewrite the path of that leafref.
    This caused NSO reload package to fail. Now yanger correctly rewrites
    the path of that leafref.

    (ENG-23550)

  - yanger: The XPath argument referencing the device's feature list, in
    tailf:display-when statements generated from if-feature statements, now
    contains a valid path.

    (ENG-20372, RT:35958, PS-31036)

  - yanger: The XPath argument, in tailf:display-when statements generated
    from if-feature statements, no longer in some cases contain an invalid
    path referencing the device's module list.

    (ENG-20371, RT:35957, PS-31035)

  - yanger: It is now possible to nest the 'ncs:plan-data' grouping inside
    another grouping and include the enclosing grouping in your service
    model without breaking the service.

    (ENG-16750, RT:30012, PS-9833)

NSO-5.7 [December 13, 2021]
===========================
Deprecated:

  - ncs: Obsoleted the usage of the 'service-commit-queue' grouping in
    tailf-ncs-plan.yang and tailf-ncs-services.yang.

    (ENG-27876)

  - ncs: The /devices/global-settings/commit-queue/check-integrity leaf has
    been obsoleted and will be removed in a future release.

    (ENG-27875)

Removals:

  - python-api: Changed minimum supported Python version from 3.5 to 3.7.

    (ENG-24808)

Security:

  - java-api: Security fix. This vulnerability affects NSO releases 5.3 and
    later.

    (ENG-27982, RT:48182, PS-43299, CSCwa48390)

Non-backwards compatible enhancements:

  - ncs: Added support for adding multiple monitors to nano service
    pre-conditions.
    The two new 'ncs:all' and 'ncs:any' extensions are used in nano service
    state and synthesizer pre-conditions to monitor multiple paths. A
    pre-condition using the 'ncs:all' extension is satisfied if all monitors
    given as arguments evaluate to true. A pre-condition using the 'ncs:any'
    extension is satisfied if at least one of the monitors given as argument
    evaluates to true.
    For more details, see the NSO Development guide, chapter "Nano
    services", section "Nano service pre-condition".

    (ENG-27194)

  - ncs: The /devices/device/scp-from and /devices/device/scp-to actions no
    longer stop iterating if one device fails when invoked on multiple
    devices using a wildcard, e.g., 'request devices device * scp-to'.

    (ENG-26755, RT:46130, RT:46300, PS-41247, PS-41420, CSCvy56409,
    SR:691490112)

  - ncs: The behavior of the commit queue error recovery (with error-option
    stop-on-error/rollback-on-error) has changed. Instead of saving and
    applying the reverse transaction intent (the reverse of what the
    northbound client wrote in the transaction), the entire reverse of the
    transaction (including transformations, operational state, service
    private data etc.). is saved and applied at queue item failure. This way
    CDB will get back to its previous state on the changed paths. Each
    failed node in an LSA setup will roll back its own configuration,
    bottom-up, while the successful items will be rolled back from the top
    node. With 'rollback-on-error', a node will not initiate its rollback
    until the rollback is completed for each failed lower node. With
    'stop-on-error' the user has to manually rollback the failed lower nodes
    in bottom-up order. This change has been done to facilitate error
    recovery for RFM/nano services which are heavy reliant on service
    re-deploys (doesn't have any transaction intent) to drive them forward.
    See the Commit Queue section in the Device Manager chapter of the NSO
    User Guide for a more detailed description.
    This change is not compatible with the previous rollback scheme. Thus,
    in a LSA setup, it is required to upgrade all nodes at once if using the
    commit queue error recovery feature.

    (ENG-26234)

  - ncs: Progress trace now includes trace-id (where available) when
    /ncs-config/trace-id is set to 'true'. See ncs.conf(5) man page on how
    to enable trace-id.

    (ENG-23948)

  - ha: /high-availability/settings/reconnect-slaves is now enabled by
    default. The parameter is required to be enabled by
    /high-availability/settings/consensus/algorithm = ncs:rule-based. See
    the NSO Administration Guide, High Availability chapter, Failover
    section, and the tailf-ncs-high-availability.yang submodule for more
    info.

    (ENG-27563)

  - ha: A node that joins a HA cluster as a secondary node will no longer
    trigger state replication of snapshot DB and configurational datastore
    if the state is the same on primary and secondary. This may cause
    different nodes temporarily to have different last transaction ids on
    snapshot and configuration datastore which is a non-compatible change.
    This optimization avoids having unnecessary replication after nodes
    upgrade on the HA cluster.

    (ENG-27411)

  - ha: When /high-availability/settings/enable-failover is set to 'true',
    an HA consensus algorithm is enabled, which reduces the risk of a
    split-brain scenario. It requires three NSO nodes. Configurable from:
    - /high-availability/settings/consensus/enabled [true]
    - /high-availability/settings/consensus/algorithm [ncs:rule-based]
    - /high-availability/settings/reconnect-slaves must be enabled for
    consensus HA to work. The default value has been changed from 'false' to
    'true'.
    More info in the tailf-ncs-high-availability.yang and in the HA chapter
    of the NSO Administration Guide.

    (ENG-27362, RT:46261, PS-41381)

  - logging: The format of one log in devel.log is as following
    <severity> <timestamp> <hostname> <app_name>[<proc_id>]: <message>
    In which, the <proc-id> is the Erlang emulator PID, which is not very
    useful when debugging. The <proc-id> has been changed to Erlang process
    PIDs.

    (ENG-27237)

Non-backwards compatible corrections:

  - ncs: For nano service behavior trees, pre-conditions defined on
    multiplier nodes or their child nodes are now being evaluated and
    respected. Previously, only pre-conditions defined on child nodes of
    selector nodes were being evaluated. For more details, see the NSO
    Development Guide, chapter Nano Services, section Multiple and Dynamic
    Plan Components.

    (ENG-26682)

  - ncs: Support XPath in Nano service's external plan location.
    The XPath starts with absolute or relative path to a list or container
    where the plan is stored. Use this only if the plan is stored outside
    the service.
    The XPath expression is evaluated using the nano service as the context
    node, and the expression must return a node set.
    If the target lies within lists, all keys must be specified. A key
    either has a value, or a reference to a key of the service using the
    function current() as starting point for an XPath location path.
    See the NSO Development Guide Nano Services chapter Implementation
    Reference section Plan Location subsection for more details.

    (ENG-26640, RT:46405, RT:46217, PS-41524, PS-41335, CSCvy44807)

  - ncs: Reading the path /netconf-state/streams/stream/subscriber now shows
    both subscriber id and session id. This changes the subscriber list key
    from "session-id" to "id".

    (ENG-25453, RT:44776, PS-39887, CSCvw88298)

  - ncs: The CLI and XML formatted output of commit dry-run is now including
    modified nodes tagged with tailf:hidden <hide-group> when <hide-group>
    has been unhidden. Note that this change requires recompiling LSA
    compiled services to avoid service private data nodes from being
    incorrectly included in the dry-run output in certain situations.

    (ENG-21845)

  - cli: It was possible to execute an action even though NACM read access
    was denied for the non-presence container ancestors to the action. This
    has been fixed so that when executing an action, or auto-completing the
    path to an action, read access is now required for all ancestors to the
    action regardless of their types.

    (ENG-27067, RT:44466, PS-39574, CSCvz32166, SR:690147395)

  - ha: When /high-availability/settings/enable-failover is set to 'true': 1
    nominal master and 1 failover master must be configured or validation
    will fail. For details, see the NSO Administration Guide High
    Availability chapter NSO built-in HA section Failover subsection and the
    tailf-ncs-high-availability.yang submodule.

    (ENG-27631)

  - yanger: The compiler will return an error when a tailf:link's target is
    under a tailf:mount-point or yangmnt:mount-point. For example, when a
    tailf:link target /device/device/config, /device/device/live-status,
    there would be an error at run-time. The issue will now be caught by
    yanger at compile time.

    (ENG-27571, RT:47678, PS-42800, CSCwa06951, SR:692198252)

  - yanger: Actions were previously removed from groupings used in the
    template and RPC subtrees when device-compiling a module for NSO with
    YANGER; however, YANGER kept augments referencing the dropped actions.
    Because of this, it was not possible to augment actions defined inside
    groupings; since it would make YANGER produce invalid YANG containing
    augments referencing non-existent actions.
    Augments referencing non-existent actions are now dropped in groupings
    used in the template and RPC subtrees; thus, YANGER is no longer
    producing invalid YANG when an action defined inside of a grouping is
    augmented.

    (ENG-19102)

Enhancements:

  - ncs: The time to create a device snapshot when committing a device to
    the commit queue for the first time has been improved. For a single
    device this could be up to five times as fast as before.
    See the Commit Queue section in the Device Manager chapter of the NSO
    User Guide for a more detailed description on how to tune the commit
    queue in the best way.

    (ENG-27567)

  - ncs: Add a new extension 'ncs:converge-on-re-deploy' to the Nano service
    behavior tree. Using this extension will make instances of a service
    only converge on re-deploys. On creation the service plan will be
    created and a reactive-re-deploy will be scheduled to converge the
    service instance, similarly on modification of a service instance a
    reactive-re-deploy will be scheduled.
    Since this behavior will be the default in a future release the
    extension is added with a deprecated tag. This was done to allow for
    gradually updating services to support the new behavior before it is
    made the new default.
    For details see the converge-on-re-deploy extension in
    tailf-ncs-plan.yang.

    (ENG-27461)

  - ncs: Add /packages/ha/sync action to distribute packages from primary to
    secondary nodes.
    The action is only supported in system installation, and it is executed
    from a primary node. It distributes packages as tar archives from the
    primary's installation directory to the secondary's installation
    directory.

    (ENG-27294)

  - ncs: Prepared the low-level memory management in CDB and changeset
    storage for increased parallelism. Enable potential future core
    improvements.

    (ENG-27258)

  - ncs: Added /devices/device/scp-to and /devices/device-group/scp-to
    actions that allow copying a file to all or a subset of configured
    devices in parallel. For details, see tailf-ncs-devices.yang and the NSO
    User Guide, chapter Life-cycle Operations, section Actions.

    (ENG-27165)

  - ncs: The self-as-service-status extension that can be set on a Nano
    plan-outline will now take post-actions into account. A Nano service
    with self-as-service-status enabled will not have its self components
    ready/init state set to reached/not-reached until all outstanding
    post-action have been run successfully and all other states have status
    reached/not-reached. The self component state will also be set to failed
    if any state or post-action have failed, reflecting that the service as
    a whole has failed.

    (ENG-27113, RT:46899, PS-42016)

  - ncs: Added dry-run support to the /devices/partial-sync-to and
    /devices/partial-sync-from actions. For details, see the NSO Development
    Guide, chapter Developing NSO Services, section Partial Sync.

    (ENG-26974)

  - ncs: Run Nano services in the service manager when they have been turned
    into zombies. This fixes a number of small issues that was due to
    zombies being run outside of the service manager and makes convergence
    and backtracking of services behave in a more uniform way.

    (ENG-26921)

  - ncs: When the SSH key exchange fails NSO will now return an error
    message that does not indicate that the kex algorithm is the problem in
    the key exchange negotiations.

    (ENG-26900)

  - ncs: It is now possible to implement service pre- and post-modification
    callbacks with service templates. Previously, it was only possible to
    implement a service's create callback with a service template. For more
    details, see the NSO Development guide, chapter "Templates", section
    "Pre- and Post-Modification Templates".

    (ENG-26395)

  - ncs: When synthesizing the behaviour tree pre-conditions for components
    will no longer result in a kicker being created if the kicker only
    monitors the service configuration data. As the service will be run when
    the service configuration is changed there is no need to create these
    kickers.

    (ENG-26297)

  - ncs: It is now possible to run NSO in an LSA architecture with three
    layers.
    The functionality is the same as traditional LSA with two layers.
    Currently, get-modifications and deep-check-sync for services do not
    work correctly in three layers.

    (ENG-24240)

  - ncs: Added <?elif {expression}?> processing instruction. For more
    details see the NSO Development guide, chapter Templates, section
    Conditional Statements.

    (ENG-23825)

  - ncs: Added the partial-sync-to action that enables pushing a subset of a
    device's configuration stored in NSO to the device. For more details see
    the NSO Development guide, chapter "Developing NSO Services", section
    "Partial sync".

    (ENG-22219, RT:39013, RT:45333, PS-34085, PS-40452, SR:687480390)

  - ncs: Service reconciliation, i.e. taking full ownership over
    pre-existing data, can now be performed as a part of service creation,
    using the existing 'reconcile' commit parameter. Previously
    reconciliation had to be performed as a part of a service re-deploy.
    For more details see the NSO Development guide, chapter Developing NSO
    Services, section Service Discovery.

    (ENG-20559, RT:45203, PS-40316)

  - cdb: Improved performance of startup, compaction, and cdb upgrade times
    through disk I/O access optimizations. If upgrading to NSO-5.7 from an
    older version, it is recommended to have cdb files compacted before on
    the older version of the product. See NSO CDM Migration Guide for more
    on compaction.

    (ENG-27104)

  - cdb: CDB API and MAAPI are extended to delete metadata attributes on
    operational config data in CDB oper. For example using MAAPI/CDB
    set_attr() with the NOEXISTS no value indicator.

    (ENG-25730)

  - cli: Add a new CLI YANG extension named "tailf:cli-short-no". When
    deleting a list with "tailf:cli-suppress-mode" extension or deleting a
    presence container without "tailf:cli-add-mode" extension, which has
    multiple levels of sub-nodes, the show configuration output normally
    would be deletion of all the sub-nodes under the list or the presence
    container. This extension "tailf:cli-short-no" will alter the show
    configuration output to be deletion of the list or the presence
    container itself.

    (ENG-25191, RT:44079, PS-39183)

  - cs_trans: Increased performance for "when" expression evaluation. There
    will be a notable performance improvement for big lists with "when"
    expressions pointing to other big lists. This applies to the following
    example:
    list a {
        key name;
        leaf name { type string; }
        leaf a_leaf {
            when "/b[name=current()]/sort = ";
            type string;
        }
    }
    list b {
        key name;
        leaf name { type string; }
        leaf sort { type string; }
    }

    (ENG-25232)

  - documentation: Updated the development guide "NSO Packages" and "Package
    Development" chapters with additional details on the
    package-meta-data.xml and project-meta-data.xml configuration files.

    (ENG-27547)

  - documentation: The Development Guide Nano Services chapter was
    rewritten, updated to cover the existing nano services features, and a
    gradual introduction of the nano services concepts were added.

    (ENG-27233)

  - documentation: Updated the NSO Administrator Guide, chapter NSO System
    Management, section Disaster Management, subsection NSO Failure After
    Startup with additional information on how to prevent and handle issues
    where the host system runs out-of-file descriptors.

    (ENG-27228)

  - examples: Added three examples to the NSO example set under
    examples.ncs/development-guide/lsa/22-upper-nso-single-upgrade,
    22-upper-nso-multi-upgrade, and 28-multi-nso-upgrade to complement the
    new Migration and Upgrades section in the NSO Layered Service
    Architecture Guide, Setting up LSA Deployments chapter that addresses
    single and multi-version deployment upgrade scenarios.

    (ENG-27914, RT:47862, PS-42974)

  - examples: Added a examples.ncs/development-guide folder with new
    cdb-and-yang, basic-automation, creating-service, and applications-nso
    intro examples in support of the updated development guide
    documentation.

    (ENG-27510)

  - examples: Added two examples to the NSO example set under
    examples.ncs/development-guide/nano-services/basic-vrouter and
    netsim-vrouter to complement the updated nano services Development Guide
    documentation.

    (ENG-27482)

  - logging: A new progress phase called 'push configuration' has been added
    to encapsulate all the device phase.

    (ENG-26937)

  - maapi: Improved performance when applying templates using parallel MAAPI
    transactions.

    (ENG-27303)

  - nct: Restricted input for --file and --ssh-user, allowed regex is
    ^[/0-9A-Za-z.:@_]([\\/0-9A-Za-z.:@_-]*[/0-9A-Za-z.:@_])?$.
    Created <user> sub-folder under /tmp and scp files under user folded
    from host to remote nodes for scripts install, copy, packages.
    Renamed load-config file to temp filename and scp to /tmp folder for
    load into CDB or copy ncs.conf to /etc/ncs

    (ENG-21386, RT:33192, PS-28684)

  - ned: If a NED chooses to populate the entire subtree below a certain
    path in the showStatsPath() callback and has nothing more to fetch it
    can now indicate so with the new NedTTL class constructor. The TTL value
    for this path will act as a default for the entire subtree, thus
    removing the need to build a TTL list, which could be expensive, for
    every node populated by showStatsPath().
    For more details see the NSO NED Development guide chapter Network
    Element Drivers section Statistics.

    (ENG-27367)

  - netconf: The documentation for yang-push has been extended to include
    the limitation that on-change subscription will not give notifications
    for changes made through the CDB-API or for subscriptions to internal
    callpoints (see section "YANG-push" in the NSO Northbound APIs document
    chapter "The NSO NETCONF Server").

    (ENG-24461)

  - observability: Progress trace CSV output now use microsecond precision
    in the timestamp and duration field.

    (ENG-25261)

  - packages: Added 'callpoint-model' setting to the 'python-vm' container
    in 'package-meta-data.xml'. The 'callpoint-model' is default set to
    'threading' preserving the old behavior. Setting 'callpoint-model' to
    'multiprocessing' can improve performance significantly by handling each
    callpoint in a separate process. For details see the NSO Development
    Guide, chapter The NSO Python VM, section Structure of the User Provided
    Code.

    (ENG-27343)

  - packages: The package installation was optimized for the compressed
    packages when using the "software packages install package" action.

    (ENG-27325, RT:47229, PS-42350, CSCvz75497, SR:692002964)

  - python-api: Maagic node construction now defer construction of the child
    nodes until access. On nodes with many children this can improve access
    time considerably.

    (ENG-27299)

  - restconf: The 'Authorization' HTTP header is now checked for a OAuth2
    Bearer token; which will be passed on to the existing external
    authentication mechanism.

    (ENG-22229, RT:38936, PS-34008, SR:687451234)

  - security: CiscoSSL has been upgraded from CiscoSSL 7.1 to CiscoSSL 7.2
    release ciscossl-1.1.1l.7.2.289 that is based on OpenSSL 1.1.1l

    (ENG-27155)

  - snmp-gateway: NSO's SNMP manager component no longer opens a port of an
    address family that is not used for communicating with managed devices
    of type SNMP.

    (ENG-27661, RT:47838, PS-42952, CSCwa15363)

  - toolchain: Reading CPU topology slows down startup when starting many
    parallel instances of ncsc on systems with large amount of cores.
    The emulator flag +ssrct is added which can be used to skip reading CPU
    topology to improve performance in such a scenario.

    (ENG-26765, RT:46163, PS-41281)

  - upgrade: Speed up packages reload which was degraded after ENG-24494.

    (ENG-26998, RT:45594, PS-40711, CSCvz52082, SR:691043336)

  - webui-one: Add dirty handle to none empty lists. Modifying anything
    within a list renders a dirty handle on the list itself, as well as its
    items.

    (ENG-27117)

  - webui-one: Add a new application High availability cluster, which can be
    used to monitor the states of the High Availability cluster nodes. The
    new application is only available when running NSO with High
    availability enabled.

    (ENG-23584)

  - webui-one: Add support to handle multiple transaction handles in the
    commit manager. There is a new drop down element in the commit manager
    that allows the user to switch between transaction handles to view,
    revert and commit each individual transaction.

    (ENG-21997)

Corrections:

  - ncs: Nano services will now update the plan history for services that
    have been deleted and turned into a zombie.

    (ENG-27792)

  - ncs: The side-effect-queue will not try to re-deploy a zombie nano
    service while there is an outstanding commit queue item.

    (ENG-27774)

  - ncs: If a transaction only contains service meta-data changes for a
    device, the device is not marked as out of sync anymore. This could
    previously occur if the device was southbound-locked or the transaction
    committed with no-networking commit parameter.

    (ENG-27769)

  - ncs: Failed delete post actions will now be rerun when a Nano service is
    re-deployed, similar to how create post actions are handled.

    (ENG-27759)

  - ncs: Fix an issue where nano service synchronous delete post actions
    would be run asynchronously.

    (ENG-27660)

  - ncs: NSO is now returning an error in some cases if initiating a package
    upgrade when nano service zombies exist in the system. The rationale
    behind the decision is that a nano service zombie's continued correct
    execution cannot be guaranteed if it is affected by the upgrade.
    If initiating a package upgrade at startup with the
    '--with-package-upgrade' flag, the package upgrade will fail if a nano
    service zombie exists in the system. However, it is possible to force
    the package upgrade to proceed by using the
    '--with-package-upgrade-force' flag.
    If initiating a package upgrade via the 'reload' action, the package
    upgrade will only fail if a nano service zombie exists in the system
    whose schema is affected by the upgrade. I.e., it is possible to execute
    package upgrades as long as existing nano service zombies are not
    affected by the upgrade.

    (ENG-27642)

  - ncs: NSO could previously erroneously throw unsupported-ned-id errors
    when applying a template to a device with a supported NED if:
    (a) the template belongs to a package declaring a list of supported
    NEDs,
    (b) the template uses namespace matching to conditionally apply parts of
    the template to only devices supporting the namespace.

    (ENG-27619, RT:47774, RT:47775, PS-42897, PS-42898, CSCwa13516,
    SR:692358333)

  - ncs: NSO does no longer get an internal error when running a service
    that has data in its reverse diff-set pointing to a list that is not
    defined in the currently active device model.  The path is now dropped
    silently.

    (ENG-27516, RT:47575, PS-42696, CSCvz99068)

  - ncs: Invoking 'ncs-status' is no longer causing an internal error when
    listing a servicepoint with a wildcard component type, i.e.,
    componenttype=*.

    (ENG-27498, RT:47666, PS-42788, CSCvz97666)

  - ncs: Fix a performance issue in the handling of framing in the NETCONF
    protocol.

    (ENG-27470, RT:47515, PS-42636, CSCwa16249, SR:692169628)

  - ncs: Improved the stability of the SSH connection towards the CLI by
    removing a race condition that could make the connection drop.

    (ENG-27426, RT:47564, PS-42685, CSCvz86903)

  - ncs: NSO now handles mandatory nodes correctly when reconciling a
    service. Mandatory nodes should have the same service reference counter
    as the closest instance node above it so that it isn't removed while its
    parent are not. This is also true for nodes that are implicitly
    mandatory by its CLI annotations (e.g. cli-hide-in-submode).

    (ENG-27315, RT:47017, PS-42136, CSCvz72430, SR:691887882)

  - ncs: Set the back-track flag of zombie components to true immediately on
    deletion of the service. Previously the back-track flag was not set to
    true until a re-deploy of the zombie was executed, resulting in that
    zombies where not shown as backtracking until the re-deploy had been
    run.

    (ENG-27274)

  - ncs: NSO does no longer crash when handling large lists in live-status
    requests.

    (ENG-27230, RT:46769, PS-41887, CSCvz61379, SR:691776960)

  - ncs: The affected services reported by the /devices/device/migrate
    action now always point to the actual service instance. It would
    previously for nano services point to the plan component state.

    (ENG-27206)

  - ncs: Opaque variables created in Nano callbacks or behaviour trees could
    not include both single and double quotes due to problems converting the
    value to an XPath string value. When an opaque variable includes both
    single and double quotes NSO will now convert that value into a call to
    the concat function to handle the quoted value.

    (ENG-27076, RT:46962, PS-42081, CSCvz33914)

  - ncs: Some parts of configuration, which were created by a nano service,
    are not shown in the reverse get-modifications output. This has been
    fixed.

    (ENG-27075, RT:46976, PS-42095, CSCvz33830)

  - ncs: Leafrefs which refer to leafs within their own structure are
    optimized for db access. The optimization doesn't work if the leafref is
    external, i.e., contains non-local prefixes, so the fix is to avoid
    doing the optimization for these leafrefs.
    Such external leafrefs now work because the optimization is not done.

    (ENG-26531)

  - ncs: The handling of nodes augmented into choice has been corrected so
    that live-status can be displayed.

    (ENG-26433, RT:45891, PS-41008, CSCvy21768)

  - ncs: Ensure that Java and Python VMs are shutdown properly when NSO is
    stopped. If a VM cannot be stopped gracefully in a certain amount of
    time it will be killed forcefully so that no lingering process are left
    behind when NSO has been stopped.

    (ENG-25154, RT:47523, PS-42644, CSCvz99317)

  - ncs: 'plan-state-change' notifications can now correctly be filtered by
    component type. Configuring
    /services/plan-notifications/subscription/component-type would
    previously result in missing notifications for some plan state
    transitions.

    (ENG-23041)

  - c-api: Fixed a bug in cleanup procedure for a disconnecting daemon that
    had multiple concurrent subscriptions to push on-change callbacks.

    (ENG-27393)

  - c-api: When all the elements within a container are deleted the CLI has
    been fixed so that any other deleted node which should have been printed
    before these due to the tailf:cli-diff-delete-before extension actually
    happen.

    (ENG-26958, RT:46621, PS-41736, CSCvy84616)

  - c-api: Do not allow to use cdb_set_elem() or cdb_set_elem2() to set the
    value of a list key. The action shall result in the
    'CONFD_ERR_NOT_WRITABLE' error code, and the 'A list key is not
    writable' error string.

    (ENG-26118, RT:45749, RT:46959, RT:47025, PS-40864, PS-42078, PS-42144,
    CSCvx95656)

  - cdb: Fixed two issues that caused a memory leak in the system.
    1. Some internal processes, that are started when reading running db at
    prepare phase through South Bound APIs, were not terminated, causing
    increased memory consumption.
    2. At prepare phase, if a CDB subscriber aborts an ongoing-transaction,
    that has modifications on operational data, by using
    cdb_sub_abort_trans(), some parts of state data were not garbage
    collected.

    (ENG-27653, RT:47713, PS-42836, CSCwa14532)

  - cdb: Rename operation used during NED migrate now support all types of
    internal key representations. Previously NED migrate could crash given
    specific to/from migrations involving a key change.

    (ENG-27546)

  - cdb: The snapshot database (the S.cdb file in the cdb directory) is now
    compacted by the 'ncs --cdb-compact' option. The same option now
    compacts the files in the cdb directory in parallel.

    (ENG-27456, RT:47602, PS-42723, CSCvz91142, SR:692301943)

  - cdb: Correct a regression that lead to reading the operational datastore
    during prepare phase returning the wrong value.

    (ENG-27365, RT:47503, PS-42624, CSCvz81135)

  - cdb: Accessing a leaf that had both a when expression and a default
    value during upgrade crashed, halting the upgrade and start of NSO. This
    has now been fixed.

    (ENG-27341, RT:47387, PS-42508, CSCvz78619)

  - cdb: Corrected leaf-list ordering when using 'tailf:sort-order'
    statement.

    (ENG-27307, RT:47425, PS-42546, CSCvz71243)

  - cdb: Operations like get_object, get_objects, get_values require read
    lock acquisition even for CDB_LOCK_REQUEST and CDB_LOCK_PARTIAL modes
    which may happen when cdb_agent already have a nb-read lock. The nb-read
    lock is now released if it was taken and try to grab read lock
    instantly.

    (ENG-27161)

  - cdb: If there is "ordered-by user" list under "choice"/"case" statement,
    querying that list in the CDB_PRE_COMMIT_RUNNING database at commit
    phase returned incorrect value.
    Now, the database has been corrected and shall return correct value.

    (ENG-27149, RT:47109, PS-42228, CSCvz47561)

  - cdb: There was an inconsistency between CDB and cs_trans engines which
    caused an internal error if external subscriber invokes
    cdb:get_modifications() in prepare phase of the transaction. The
    inconsistency has been removed now.

    (ENG-27134, RT:47094, PS-42213, CSCvz43221)

  - cdb-capi: A lockless session with CDB_LOCK_REQUEST and CDB_LOCK_WAIT
    flags, which was established at prepare phase and doing
    cdb_get_values(), cdb_get_object(), or cdb_get_objects(), had an issue
    when being used. The use-case has been fixed and the lockless session
    now completes its operation successfully.

    (ENG-27840, RT:47834, PS-42948, CSCwa34746)

  - cdb-capi: A CDB-CAPI session that reads data at phase0, and where the
    action requires "when" expression evaluation, caused CONFD_EOF. The
    use-case has been fixed and the reading action will now return
    correctly.

    (ENG-27795, RT:47950, PS-43064, CSCwa31437)

  - cdb-subscription: Corrected cdb_get_modifications() notifications of
    transaction that containing both changes in config data and state data.

    (ENG-27497)

  - cdb-subscription: Correct cdb_get_modifications() when creating or
    deleting presence container.

    (ENG-27386)

  - cdb-subscription: Added missing notifications of cdb_oper_subscribe()
    when creating or deleting config node, which is the ancestor of
    operational nodes.
    Fixed hanging transaction when doing cdb_diff_iterate() in
    cdb_oper_modifications()

    (ENG-25488, RT:31994, RT:44500, PS-27856, PS-39609, CSCvw97177)

  - cli: Corrected the "show" of configuration changes of leaf lists
    annotated with "tailf:cli-list-syntax" to prevent that an error message
    is logged for non string types, e.g. ipv4 addresses and integers.

    (ENG-27202, RT:47256, PS-42377, CSCvz57241)

  - cli: Fix the piped command 'display json' to separate top data nodes
    with comma when displaying JSON-data output.

    (ENG-27201, RT:47209, PS-42329, CSCvz56887)

  - cli: Help string is displayed upon completion for containers with
    tailf:cli-suppress-no extension, having a child leaf of type empty.

    (ENG-20709, RT:36665, RT:36529, PS-31745, PS-31609)

  - cs_trans: Fixed incorrect "when" expression evaluation on default leafs.

    (ENG-27805)

  - cs_trans: When deleting config data containing config list and the
    config list containing state data, the state data was not deleted in the
    operational datastore. The behaviour has been corrected so now the state
    data will be deleted.

    (ENG-27763, RT:47925, PS-43037, CSCwa26071)

  - cs_trans: Corrected the min-elements constraints for leaf-lists with
    "when" expressions.

    (ENG-27652)

  - cs_trans: Calling an action from within a transaction hook resulted in a
    deadlock when the action needed data from the original transaction -
    which was blocked on the hook. NSO now supports getting data from the
    original transaction.

    (ENG-27003, RT:46719, PS-41836, CSCvy97164)

  - cs_trans: Due to a regression, validation of dynamic nodes under
    /devices/device/config was not performed correctly.

    (ENG-26934)

  - cs_trans: Fixed incorrectly set case when writing to nonexistent node
    that belongs to a nested choice statement.

    (ENG-26308)

  - documentation: Addressed issues with broken reference links "???" in the
    documentation

    (ENG-27032, RT:46906, PS-42023, CSCvz20243)

  - documentation: Added a note to the "Mapping using Java combined with
    Templates" section of the NSO Development guide explaining how to assign
    the empty string to a template node using a template variable.

    (ENG-27001, RT:46564, PS-41678, CSCvy95718, SR:691592428)

  - documentation: Using ncs_load with turbo parser for save config returns
    an error message 'ncs_load: format C-style CLI using turbo parser is
    only applicable for load config'

    (ENG-26945, RT:46577, PS-41691, CSCvy81801)

  - documentation: The nano plan example has been fixed.

    (ENG-26699, RT:46165, PS-41283, CSCvy49747, SR:691265452)

  - ha: Fixed HA deadlock that occurred when transitioning from none to
    active, and there was a transaction attempting to distribute rollbacks.

    (ENG-27578)

  - ha: A regression that was introduced in ENG-26374 caused the primary
    node  to crash when distributing change-set to secondary nodes.

    (ENG-27129)

  - ha: When using the 'json2' return format, internal support for returning
    the number of list instances was missing.

    (ENG-26980)

  - ha: A standby node with volatile CDB sometimes failed to revert a commit
    that was not confirmed on the active node in time. The commit is now
    always rolled back on the standby node if no commit confirm command has
    been issued before the timeout expires.

    (ENG-26719)

  - ha: Corrected the distributed change-set from the primary node to
    secondary nodes.
    Corrected the notification of subscriber to operational datastore on
    secondary nodes.

    (ENG-26374, RT:45765, PS-40880, CSCvy17408)

  - java-api: Fixed an issue with IPv6 address handling when receiving
    SnmpaNotification.

    (ENG-27320, RT:47195, PS-42315, CSCvz74017)

  - json-rpc: The "get_leafref_values" method lacked support for reading
    action/rpc leafref values with "must" expressions present.  This can now
    be done via an action/rpc transaction started with the parameter
    action_path set.

    (ENG-27445, RT:47390, PS-42511, CSCvz88997)

  - json-rpc: Optimisation of the memory usage when using the JSON-RPC
    method 'subscribe_poll_leaf'.

    (ENG-27406, RT:47251, RT:47208, PS-42372, PS-42328, CSCvz84694)

  - json-rpc: Some access log entries for dynamically generated content had
    content length incorrectly set to 0. Such access log entries are now set
    to the actually generated content length.

    (ENG-27110, RT:47047, PS-42166, CSCvz38804, SR:691975456)

  - json-rpc: Previously, multiple *identical* Set-Cookie HTTP headers could
    be returned.

    (ENG-27073, RT:47029, PS-42148, CSCvz33670)

  - json-rpc: The JSON-RPC operation show-config for operational data on a
    newly created device did not respond that the device was 'southbound
    locked'. It now responds with 'Device <device name> is southbound
    locked'.

    (ENG-26636)

  - maapi: Removed a ncs_load error when the program was used to save
    configuration with a config false child in a config true tree. The error
    was: 'ncs_load: maapi_save_config_result(sock, id) failed: internal
    error (18): internal'

    (ENG-27390, RT:47527, PS-42648, CSCvz82356)

  - nct: If an invalid command is provided with -c option for some nct
    commands then it fails with 'internal error' along with error stack
    trace. Now, with this fix the nct commands terminate with better error
    message as 'unknown command'.

    (ENG-25044)

  - ned: NSO does no longer leak idle NedWorker threads.

    (ENG-27283, RT:47260, PS-42381, CSCvz66974, SR:691960068)

  - netconf: NSO SSH servers will now correctly respect the WantReply field
    in SSH protocol's "subsystem" requests. This should not affect
    configurations or the end users.

    (ENG-27262, RT:47316, PS-42437, CSCvz62749)

  - netconf: If there is a default leaf with a "when" expression evaluating
    to false, the leaf belonging to an external data provider, creating its
    closest ancestor caused an error. The error did only occur in
    transactions using the "delayed when" mode and has been resolved.

    (ENG-27136, RT:47082, PS-42201, CSCvz44280)

  - netconf: A user session that performed an establish-subscription did not
    introduce an exception to the nso.conf parameter idleTimeout for
    NETCONF, resulting in the session being timed out according to the value
    of idleTimeout. Now the idleTimeout for NETCONF will no longer trigger
    as long as there exists an establish-subscription in the user session.

    (ENG-26802)

  - netconf: NSO could not connect to Junos 21 devices with the
    "hello-message yang-module-capabilities" setting configured (which would
    make the device advertise extra models in its hello message). This has
    been fixed.

    (ENG-26788)

  - netconf: NETCONF get-config now includes list instance keys when a
    subtree filter selects a list instance but not its keys.

    (ENG-22626)

  - observability: Erlang/OTP-22 and newer versions had removed list of
    messages when getting process information, which caused 'ncs
    --debug-dump' to stop and not include all necessary system information.
    The debug-dump command is now corrected and shall include the list of
    process messages, if that process has pending messages.

    (ENG-27166, RT:46796, PS-41914)

  - python-api: Fixed Python log using wrong product name "ConfD closed
    connection". Python log will now be displayed with correct product name
    like so "NSO closed connection".

    (ENG-26043)

  - restconf: A faulty check was triggered when trying to validate that the
    URL of a PUT request was corresponding to the actual payload.

    (ENG-27627, RT:47818, PS-42939, CSCwa12490)

  - restconf: The fix for ENG-25894 introduced a regression for RESTCONF
    action JSON output where identityrefs and instance-identifiers were not
    quoted properly. This regression is now fixed and quotation is correct.

    (ENG-27366, RT:47516, RT:47958, PS-42637, PS-43072)

  - security: When loading back NSO-exported SSH keys from an XML file an
    incorrect internal representation was used making the keys
    unrecognizable. Now the correct internal representation is used, so SSH
    keys can be loaded back into NSO.

    (ENG-27569, RT:47646, PS-42768, CSCwa06905)

  - security: The SSH CLI server offered public key authentication even
    while the config file specified "none" as SSH public key method. Now the
    CLI server will not offer public key auth method when the setting is
    "none".

    (ENG-25748, RT:45309, PS-40422, CSCvx48406)

  - smart-licensing: Upgraded the smart licensing agent to latest maintained
    version (3.1.8). Unused licensing messages are logged as DEBUG with
    this.

    (ENG-21745, RT:37878, PS-32952, CSCvq51204)

  - snmp-agent: When flooding the system with SNMP 'set-request' messages,
    memory growth of the system internal 'note-store' is now avoided.

    (ENG-27324, RT:47046, PS-42165, CSCvz75273)

  - toolchain: Initiating a package reload stops active ned-builder
    projects. However, until now, the ned-builder projects were not
    restarted once the package upgrade was finished.

    (ENG-27586)

  - toolchain: The file ietf-datastores.fxs is not shipped in the loadpath
    anymore since it is a built-in fxs file. When compiling SNMP MIBs it is
    correctly handled as a built-in fxs by ncsc.

    (ENG-27052, RT:46979, PS-42098, CSCvz29935)

  - toolchain: Fixed a bug in yanger ncs plugin that made refine statements
    ineffective when target nodes were nested in uses statements.

    (ENG-27033)

  - webui-one: The Device Manager application in the webui will no longer
    become unresponsive for a very long time when handling large number of
    devices and device-groups.

    (ENG-27707, RT:47444, PS-42565, CSCwa18944, SR:692180136)

  - webui-one: Removing a leaf properly renders a loader

    (ENG-27688)

  - webui-one: The create button in the webui service manager is now
    properly activated after deleting a presence container service.

    (ENG-27678)

  - webui-one: Under conditions with slow networking/heavy load, a presence
    container in a choice loses exists after reloading browser, this has
    been fixed.

    (ENG-27368)

  - xpath: Improve performance of XPath queries when current() is used to
    match values in large leaf lists.

    (ENG-26540)

  - xpath: If the XPath filter in NETCONF subscription contains a
    choice/case node, the XPath expression was always evaluated to false,
    and the notification was always filtered out. The XPath engine has been
    corrected to evaluate such XPath expressions.

    (ENG-22016, RT:38698, PS-33771, CSCvr08857)

NSO-5.6 [August 31, 2021]
=========================

Deprecated:

  - ncs: The NSO build toolchain will be updated for NSO-6.0, scheduled for
    release in spring 2022. This impacts the oldest version of glibc supported
    for use on Linux. As of the NSO-6.0 release, the minimum version of glibc
    supported for Linux will be glibc-2.24. The runtime requirements for
    the upcoming NSO-5.7 will remain unchanged.

    (ENG-26972)

  - ncs: Deprecate pre-lock create FASTMAP services.
    New usages  are discouraged, the support for pre-lock create FASTMAP
    services will be removed in an upcoming release. It is recommended to
    write create FASTMAP services in all cases.

    (ENG-26675)

  - ncs: Obsoleted /java-vm/service-transaction-timeout leaf. The setting is
    replaced with the /services/global-settings/service-callback-timeout
    leaf and any value configured in the old leaf is automatically migrated
    to the new.

    (ENG-26302)

  - ncs: The /devices/device/netconf-notifications container have been
    deprecated and will be removed in a future release. The
    /devices/device/notifications container should be used instead.

    (ENG-26257)

  - ncs: Deprecate the MAAPI_SHARED_NO_BACKPOINTER MAAPI flag in the C API
    and the SHARED_NO_BACKPOINTER MAAPI flag in the Python API.
    New usages of the flags are discouraged, the flag will be removed in an
    upcoming release.

    (ENG-26127)

  - python-api: Python-3.5 has been deprecated and will be removed in
    NSO-5.7. You should upgrade your Python environment and make sure
    everything works with Python-3.7 or higher.

    (ENG-24807)

Removals:

  - ncs: Removed leaf-list 'device-list' from 'service-data' grouping.
    Removed the action /services/commit-dry-run.
    Removed enum 'not-master' in
    /devices/device/netconf-notifications/subscription/failure-reason.
    Removed the alarm type identity 'dev-manager-internal-error'.
    Removed /ncs-config/db-mode.
    Removed /ncs-config/candidate.
    Removed /ncs-config/large-scale.
    Removed /ncs-config/logs/syslog-config/version,
    /ncs-config/logs/syslog-config/udp, and
    /ncs-config/logs/syslog-config/syslog-servers.
    Removed /ncs-config/cli/show-ned-error-as-info.
    Removed error code 'lsa_not_enabled".

    (ENG-24101)

  - cluster: Removed /devices/device/remote-node and
    /devices/commit-queue/waiting-for/cluster-node leaf.
    Removed 'no-remote' leaf from /devices/disconnect and
    /devices/clear-trace actions.
    Removed /cluster/caching and /cluster/remote-node/device.

    (ENG-25221)

  - documentation: Device cluster documentation and examples have been
    removed.

    (ENG-25476)

  - examples: Unused Python modules, using deprecated Python APIs, were
    removed from the documentation.

    (ENG-21495, RT:37604, PS-32681, CSCvp93712)

Security:

Non-backwards compatible enhancements:

  - ncs: The NSO scheduler now handle timezones and daylight savings time
    according to the specification of the 'date-and-time' type in RFC 6021.
    The /scheduler/task/get-next-run-times action will show the next run
    times for the task in the local time of the server.
    Note that if there are non-recurring tasks configured that have not yet
    run when this change takes effect, the previously ignored timezone field
    will now be adhered to.

    (ENG-25406, RT:44204, PS-39310)

  - ncs: If a user performing rollback lacks access rights to some or all
    data, the action was previously aborted with an "access denied" error.
    To improve usability, the rollback action now discards changes for which
    the user has insufficient access rights. A message with the following
    format is written to the developer log:
      devel-aaa User: <user>[<group>] rejected data access path <path> op
    <op>, change is discarded
    If the rollback is performed from the CLI the following message will
    appear in the console:
      Warning: Some changes could not be applied due to NACM rules
    prohibiting access.
    For the JSON-RPC methods "install_rollback" and "load_rollback" the
    following message will be returned in the warnings array:
      Some changes could not be applied due to NACM rules prohibiting
    access.

    (ENG-25237, RT:41672, PS-36758, CSCvw57771)

  - ncs: Add support for configurable SSH algorithms in NSO making it
    possible to decide which algorithms should be used when connecting to a
    device. The new model is available as a global setting underneath
    /devices/global-settings, but can also be configured per device, device
    profile, cluster node or live status protocol.
    In addition to making the algorithms configurable, more algorithms have
    been added to the list of supported algorithms and the fetch-host keys
    action has been updated to only fetch host keys for the public key
    algorithms configured for a device.
    It is important to note that the ssh-rsa and ssh-dss algorithms have
    been removed from the default list of configured public key algorithms
    and therefore to be able to communicate with devices only supporting
    these algorithms one has to manually configure them in NSO for these
    devices.

    (ENG-25123)

  - ncs: Added container 'dry-run' and the new 'ncs-hidden-commit-params'
    grouping to the apply-template and load-native-config action input
    parameters. This makes it possible to invoke the actions with commit
    parameters when no read-write transaction is supplied through the
    northbound interface (for example when invoked via RESTCONF). If invoked
    without a transaction, the actions will automatically create one and
    commit the resulting changes. When invoked with a transaction (such as
    via the CLI) the actions will apply the configuration to it and leave it
    to the user to commit or revert the resulting changes, just as before.
    When invoking apply-template without a transaction, an error will be
    returned and the transaction aborted if the template failed to apply on
    any of the devices (previously the resulting changes would be applied
    anyway).

    (ENG-23967, RT:42224, PS-37320, CSCvu39055, SR:689130499)

  - ncs: NSO no longer exposes FASTMAP attributes such as reference counters
    and backpointers by default in NETCONF. An 'with-service-meta-data'
    optional parameter has been added to the NETCONF and RESTCONF APIs to
    include these attributes in the reply. See API documentation for more
    details.

    (ENG-23120, RT:43603, PS-38720)

  - ncs: NSO has different behavior during schema upgrade, which contains
    instance-identifier nodes with stale data.
    For in-service upgrade, the schema upgrade aborted and the old system
    was restored.
    For out-of-service upgrade, NSO logged bad dependencies in ncs.log and
    the schema upgrade succeeded.
    Now, the schema upgrade will always succeed and implicitly delete
    instance-identifier nodes with stale data.

    (ENG-22943)

  - ncs: Service templates can now define and use macros. See the NSO
    Development Guide for details and examples.
    As part of this feature, the following backwards incompatible changes
    were made:
    * /packages/package/oper-status/error-info has been changed from a leaf
    to a leaf-list.
    * 'Empty' XML templates (ie., templates containing neither a
    servicepoint nor any dynamic nodes - templates with only the
    <config-template> tag, for example) cannot be applied programmatically,
    from Java/Python etc. They are also not displayed in
    /packages/package/templates.

    (ENG-20561, RT:43621, PS-38738)

  - cdb: The NED migration code has been redesigned to reduce the amount of
    committed changes and allow for smarter migrations. Performance of
    migration has been improved but is model and data dependent. As a
    consequence of the redesign, some of the input and output parameters of
    the 'migrate' action have changed. See the revision statement of
    tailf-ncs-devices.yang for more details.

    (ENG-23014, RT:40264, RT:42277, RT:44061, RT:44908, PS-35343, PS-37376,
    PS-39165, PS-40020)

  - cli: If a user lacking access right tries to delete a subtree, a warning
    message was printed in the console as following:
      Warning: Some elements could not be removed.
    In order to be consistent with rollback scenario, the warning message
    has been changed to:
      Warning: Some elements could not be removed due to NACM rules
    prohibiting access.
    The warning message is also updated accordingly for JSON-RPC northbound
    interface.

    (ENG-25533)

Non-backwards compatible corrections:

  - ncs: Validate string input as UTF-8 encoded YANG string
    Exceptions, i.e. not validated:
    * ncs.conf
    * data providers
    * cli prompt leafs, i.e. /ncs-config/cli/prompt1 and friends.
    * encrypted string types
    Add /ncs-config/validate-utf8/enabled for compatibility and upgrades.
    Add "ncs --cdb-debug-dump cdb-dir validate_utf8" option for checking CDB
    contents for invalid UTF-8 encoded YANG string data. Correcting CDB
    contents has to be done manually.

    (ENG-24758, RT:43631, PS-38748, CSCvv82025)

  - ncs: The value of union type nodes are re-evaluated during upgrade. This
    enables the possibility to change these nodes' value types after
    upgrade, even though the schema was not changed.

    (ENG-24494, RT:43078, RT:44081, PS-38192, PS-39185, CSCvv27768,
    SR:688845201)

  - aaa: Removed an internal error that occurred when deleting an
    np-container with a container and leaf as children.
    This also corrects problems with deleting a default leaf under a
    p-container and problems with deleting a list.

    (ENG-25454)

  - aaa: Allow deletion of descendant nodes when they are implicitly deleted
    as a side effect of an allowed operation.
    Rules on non-presence container should apply for its descendants.

    (ENG-24793, RT:43711, PS-38828, CSCvv89172)

  - java-api: There was a race-condition leading to data being interleaved
    in the same socket by Maapi and MaapiInputStream objects and it led to
    clients failing to decode the response or indefinitely waiting for data.

    (ENG-26562, RT:45448, PS-40563, CSCvy34675, SR:690961451)

  - java-api: Added the following ncs.conf parameters
    /ncs-config/java-vm/restart-on-error/enabled
    /ncs-config/java-vm/restart-on-error/count
    /ncs-config/java-vm/restart-on-error/duration
    They control the behaviour of the java-vm on receiving errors from
    packages. If enabled, the java-vm will be restarted if
    the specified number of errors occur within the configured duration.

    (ENG-25421, RT:44264, PS-39370, CSCvw81273, SR:690217710)

  - json-rpc: JSON-RPC would delay the evaluation of "when" expressions
    until the validation phase, which means that when config is set the
    "when" expressions are not evaluated and the request succeeds even when
    the config goes against a "when" expression. The "when" expression does
    not fail until a validation is done later. This is in contrast to how
    the CLI works. Since JSON-RPC is supposed to work as the CLI, the
    behavior in JSON-RPC has been changed so that "when" expressions are
    evaluated in the same way as in the CLI, so the validation of "when"
    expressions is no longer delayed by default. Note that this change of
    behavior for JSON-RPC will mean that in situations where before a "when"
    expression failed in the validation phase, either causing an error when
    performing a validation or just leading to a silent delete depending on
    the 'when_error_mode' option, it will now instead fail with an error
    when trying to set the config.
    In addition, this fix removes the 'when_error_mode' functionality. This
    is a parameter for validate_commit and validate_trans in JSON-RPC that
    decides if a failing "when" expression should fail silently or throw an
    error when validate_commit and validate_trans are performed. Since the
    validation of "when" expressions now happens when setting the value this
    parameter is no longer valid.

    (ENG-25862, RT:45467, PS-40583, CSCvx64666)

  - restconf: In rare cases RESTCONF subscriptions, where the subscriber
    terminates without tearing down the connection correctly, could lead to
    ports and internal processes not closing/terminating as they should. The
    two config settings '/ncs-config/webui/transport/keepalive' and
    '/ncs-config/webui/transport/keepalive-timeout' have been added to
    handle this. Setting keepalive to true will ask the host OS to detect
    future lingering ports and instruct the server to periodically send
    comment messages (":keepalive test") over the subscription channels. The
    'keepaliveTimeout' can be used to specify the frequency of the messages.
    Note that subscribers must be able to handled these new messages!

    (ENG-25623, RT:43256, PS-38372, CSCvx21813)

  - web-server: Previously an OPTIONS * request would respond with 200 OK
    and an Allow header with a static list of HTTP methods. Such a request
    now responds with a 400 Bad Request without an Allow header.

    (ENG-22346)

Enhancements:

  - ncs: Decrease the memory needed when a lot of services are touched in
    the same transaction, which in certain special cases could lead to NSO
    crashing due to being out of memory.

    (ENG-27013, RT:46543, PS-41657, CSCvz03536, SR:691633167)

  - ncs: The performance of outputting XPath evaluation to a trace log has
    been considerably improved.

    (ENG-26661)

  - ncs: The number of close system calls has been optimized for some
    operating systems.

    (ENG-26130, RT:45752, PS-40867, CSCvx96615)

  - ncs: Added service-commit-queue-event notification to the
    service-state-changes stream. The notifications can be subscribed to by
    configuring the /services/commit-queue-notifications container.
    Obsoleted the commit-queue-failed enum for
    commit-queue/queue-item/status leaf in the service-commit-queue
    grouping. Use the failed enum instead.
    Removed commit-queue/queue-item/no-of-impacted-services leaf in the
    service-commit-queue grouping.
    Removed mandatory statement from status leaf in plan-state-change
    notification.
    Added commit-queue container and trace-id leaf to plan-state-change
    notification.
    Removed unique statement from /services/plan-notifications/subscription.
    Added trace-id leaf to ncs-commit-queue-progress-event notification.
    The original service path is displayed in the commit queue for nano
    service zombies that are part of the queue item.

    (ENG-25810, RT:42738, PS-37854)

  - ncs: The user-provided commit queue tag is now propagated down to the
    lower nodes in an LSA cluster. This makes the tag visible in the created
    queue items of the lower node and its northbound notifications.

    (ENG-25809, RT:45475, PS-40591)

  - ncs: Progress trace events are now emitted when a session limit has been
    exceeded for a device and the user have to wait for it to be available.

    (ENG-25734)

  - ncs: The system will log an error if it can not delete a rollback file.
    The format of the error log is shown as below,
    Failed to delete rollback file <filename>: <reason>

    (ENG-25636)

  - ncs: Added /devices/commit-queue/queue-item/retry action which lets the
    commit queue retry devices with transient errors instead of waiting for
    the automatic retry attempt.

    (ENG-25606)

  - ncs: Make ordered diffs for generic NEDs less scattered. When creating
    the ordered diff, the dependency tracking for a diff will now take into
    account parents of the dependent diff and order the diff after any diffs
    related to the parent and its children.

    (ENG-25435)

  - ncs: Add support for installing decompressed packages and multiple
    versions of NEDs in the /software/packages/install action.

    (ENG-25414, RT:44639, PS-39750, CSCvw84306)

  - ncs: Added /netconf-state/sessions/session/transaction/lock to report
    when a read-write transaction has requested and acquired the transaction
    lock.
    Added enum 'read-write' and obsoleted the enum 'read_write' in
    /netconf-state/sessions/session/transaction/mode. The 'read-write' enum
    will now be reported instead of the 'read_write' enum.

    (ENG-24088, RT:42348, PS-37450, CSCvx37739, SR:689092085)

  - ncs: Backtracking of nano plan during service deletion did not support
    sending plan-state-change notification when a state changes from reached
    to not-reached or when deleted. Plan status change notifications during
    zombie backtracking(nano service deletion) are now added.

    (ENG-23909)

  - ncs: When using an external SSH daemon for NETCONF SSH Call Home, there
    the support for passing an opaque string has been added. This is done by
    using the new MAAPI function maapi_netconf_ssh_call_home_opaque.

    (ENG-23350, RT:40792, PS-35888)

  - ncs: CDB oper has been extended to support operational config nodes in
    order to comply with the operation-state datastore defined in RFC 8342
    Network Management Datastore Architecture (NMDA).
    The tailf:operational extension can be used as a substatement to
    tailf:cdb-oper to indicate that operational data should be read from CDB
    oper.
    CDB API and MAAPI are updated to manage operational config data in CDB
    oper. Two new functions have been added to support attributes for
    operational config data in CDB oper - cdb_get_attrs() and
    cdb_set_attr().

    (ENG-23109)

  - ncs: NSO now supports subscribing on non-NETCONF device notifications
    generated by the southbound device. These notifications are consumed in
    the same way as NSO today consumes NETCONF Event Notifications (RFC
    5277) and will have the same capabilities to drive notification kickers.
    The Network Element Drivers are able to implement notification
    mechanisms, for example, RESTCONF Event Streams, W3C SSE, WebSockets,
    and gNMI, and return these in a normalized form to NSO by using the new
    methods introduced in the NED API.
    The enum 'session-limit-exceeded' have also been added to
    /devices/device/netconf-notifications/subscription/failure-reason.

    (ENG-22941)

  - ncs: Commit queue items distributed to other LSA NSO nodes can now be
    viewed in /devices/commit-queue/queue-item/remote-queue-item.
    Removed tailf:hidden annotation in
    /devices/commit-queue/completed/queue-item/remote-queue-item.
    Added and changed the tailf:display-groups annotation for nodes below
    /devices/commit-queue.

    (ENG-21532)

  - ncs: Leafref handling, that would rewrite XPath expression, when the
    leafref path contains subpath, in which the list's key is a leafref,
    points to the target node inside the same instance, was optimized.

    (ENG-21146, RT:35156, PS-30227)

  - ncs: Deleting a service instance did not clear related service
    activation alarms that might exist.

    (ENG-16365, RT:29067, PS-9382)

  - aaa: Non-ascii characters are now allowed in account names and passwords
    at login when connecting to NSO using SSH.

    (ENG-25174)

  - c-api: Improve networking and data management when bulk replies are used
    by applications and NSO performs traversals on lists with items that
    have leaf references to the same list.

    (ENG-26666, RT:46202, RT:45764, PS-41320, PS-40879, CSCvy46865)

  - cli: Improved the memory usage of the CLI for situations where rate of
    'maapi_sys_messages' is high.

    (ENG-25738, RT:45277, PS-40390, CSCvx45627)

  - cli: A new pipe target called "display maagic" has been added to show
    commands to display the configuration and configuration diffs as Python
    Maagic paths.
    This command will only be available if devtools has been set to true in
    the CLI session settings

    (ENG-25639)

  - cli: A new pipe target called "display netconf" has been added to show
    commands. It will display the northbound NETCONF RPC equivalent to the
    show command. For example, if used with the C-style command "show
    running-config" it will display the equivalent <get-config> RPC and if
    used with the C-style command "show configuration" it will display the
    equivalent <edit-config> RPC.
    Note that other than the base capability, no other capabilities are
    assumed. Also, due to the differences between CLI show filtering and
    NETCONF subtree filtering, show-filters are not taken into account when
    displaying the <get> or <get-config> RPCs.
    This command will only be available if devtools has been set to true in
    the CLI session settings

    (ENG-25638)

  - cli: When displaying /devices/device{<device name>}, performance is now
    unaffected by the number of NEDs installed in the system.

    (ENG-25465, RT:44739, PS-39850, CSCvw91542)

  - cli: The performance when displaying C-style configuration diffs (e.g.
    commit dry-run outformat native) involving the deletion of leafrefs has
    been improved.

    (ENG-25180, RT:44256, PS-39362)

  - cli: The "commit dry-run outformat" and "show rollback changes" commands
    have been improved to output in consistent format in Cisco or Juniper
    style CLI.
    (1) Add new options "cli-c" and "cli-c reverse" to "commit dry-run
    outformat" command to output in Cisco style and in the reverse order in
    respectively.
    (2) Improve "show rollback changes" command to output in Juniper style
    when it is in Juniper style CLI.

    (ENG-282, RT:41611, RT:41868, PS-36696, PS-36962)

  - cs_trans: When a leaf-list has a "when" expression or "when"
    dependencies, the system evaluated the "when" expression for each
    modified leaf-list entry. Now the "when" expression is evaluated once.

    (ENG-26543)

  - cs_trans: ENG-24474 degraded performance during the validation phase for
    transactions running in "delayed when" mode, for example, set by
    'maapi_set_delayed_when()'.

    (ENG-25783)

  - documentation: Introductory chapters have been added and improved in the
    Development Guide documentation. The improvements target the learning
    experience of novice users using a gradual approach.

    (ENG-27084)

  - documentation: The debug hide-group is now included in the default
    ncs.conf file used when setting up NSO for the first time.

    (ENG-25439)

  - documentation: Documentation on High Availability was revised.

    (ENG-24597)

  - examples: Added a new example on how to use a custom login-page for NSO.
    It is located at:
    examples.ncs/web-ui/custom-login-page
    The example can handle login both with and without two factor
    authentication.

    (ENG-25999)

  - java-api: New Java SSH client based on SSHJ is a modern alternative
    supporting newer crypto algorithms such as the ECDSA key format.

    (ENG-23230, RT:43626, RT:40537, RT:40856, PS-38743, PS-35616, PS-35953,
    SR:688321646)

  - json-rpc: The JSON-RPC "load" call can now also be used with action
    transactions.

    (ENG-25688)

  - logging: Enhance logging for operational data schema upgrades.

    (ENG-25943, RT:45558, PS-40675)

  - netconf: XML RPC replies from Juniper devices are now allowed to contain
    both data AND ok. Note that this change introduces a deviation from RFC
    6241 (4.4).

    (ENG-24714, RT:41430, RT:44484, PS-36503, PS-39592)

  - netconf: The configuration option "keepalive" has been added to the TCP
    transport for NETCONF.

    (ENG-24045, RT:42375, PS-37485, CSCvu52320)

  - nmda: When the cdb-oper statement augmented into a callpoint that is
    extended with the tailf:operational substatement, loading of FXS files
    did not detect that cdb-oper is not legal under a callpoint. It is now
    not permitted to augment an operational callpoint with cdb-oper.

    (ENG-27054)

  - restconf: It is now possible to set rollback label and rollback comment
    in RESTCONF and NETCONF when invoking action "apply-rollback-file".
    The leafs "label" and "comment" have been added to tailf-rollback.yang
    to the "apply-rollback-file" action input, so when invoking this action
    in RESTCONF or NETCONF one can give a label and comment as input
    together with the ID of the rollback file to apply the rollback. This
    will lead to the label and comment being added to the rollback file.

    (ENG-22886, RT:40131, PS-35210, CSCvs72102, SR:688066696)

  - toolchain: Updated regular expression library excerpt from libxml2-2.9.8
    to libxml2-2.9.12.

    (ENG-26808)

  - toolchain: The ncsc option --allow-interop-issues can now be used
    together with --emit-h and emit-hrl options. When generating headers
    from YANG files, if a config true node contains an XPath expression that
    refers to config false data, ncsc prints an error. When the compiler
    flag --allow-interop-issues is used, ncsc reports this issue as a
    warning instead.

    (ENG-25729, RT:45008, PS-40121)

  - toolchain: ncs-make-package will now generate Makefiles which compiles
    YANG with the option --fail-on-warnings for packages other than NETCONF
    NEDs. For legacy usage the --no-fail-on-warnings option can be used to
    generate Makefiles without the --fail-on-warnings flag.

    (ENG-25577, RT:45012, PS-40125, CSCvx13668)

  - toolchain: The compiler ncsc has a new option --allow-interop-issues. By
    default, if a config true node contains an XPath expression that refers
    to config false data, ncsc prints an error. When the compiler flag
    --allow-interop-issues is used, ncsc reports this as a warning instead.
    The flag can only be used as an option to the following ncsc commands:
    ncsc --compile
    ncsc --ncs-compile-module
    ncsc --ncs-compile-bundle
    Note that this is not recommended as it violates RFC7950 section 6.4.1;
    a constraint on a config true node contains an XPath expression may not
    refer to a config false node.

    (ENG-25538, RT:45008, PS-40121)

  - toolchain: The compiler ncsc has been changed to not allow emitting of
    custom versions of system builtin YANG namespaces. The reason is that it
    is not possible to change system builtin YANG modules, therefore it
    should not be possible to emit code from such custom versions of system
    builtin YANG modules either, since it will pose a risk to cause
    inconsistencies.
    As a convenience, it is still possible to emit source code (C, Erlang,
    Python, Java, MIB), from actual builtin YANG modules. In order to allow
    this, a new flag called '--builtin' has been added. To see which system
    builtin YANG modules can be used to emit, please use the new flag
    '--list-builtins'.

    (ENG-24844, RT:43894, PS-39000, CSCvv95148)

  - web-server: The '/resources' URL for the webui has now been disabled by
    default. Set the parameter '/ncs-config/webui/resources/enabled' to
    'true' to enabled it.

    (ENG-24612)

  - webui-one: Updated the Manage hide groups modal by changing the behavior
    from a select element with show/hide options and a confirm button to
    hide and show buttons that shows and hides the group respectively.

    (ENG-25602)

  - webui-one: The webui now prevents automatic logout if a commit is in
    progress.

    (ENG-25337)

  - webui-one: The commit manager link in the main navigation is linked to
    the last active tab in the commit manager.

    (ENG-25266)

  - webui-one: Service manager list will include parent key columns on
    presence containers.

    (ENG-24792)

  - webui-one: It is now possible to show/hide applications and modify
    application shortcuts through the settings dialog.

    (ENG-24262)

  - webui-one: Added a confirmation dialog when running batch actions to
    prevent executing heavy actions by mistake.

    (ENG-23601)

  - webui-one: Option to set unhide/hide schema group was added to the
    WebUI.

    (ENG-21250)

  - webui-one: The active tab in the commit manager is now handled by the
    url, which implies it is linkable.

    (ENG-18518)

Corrections:

  - ncs: Re-enable `aes256-cbc` encryption algorithm for SSH.

    (ENG-27060, RT:46969, PS-42088, CSCvz30796)

  - ncs: Fix an issue where the execution of a Nano service would stall when
    the self component was updated with new states in a new version of the
    service.

    (ENG-27011, RT:46909, RT:46767, PS-42026, PS-41885, CSCvz02371)

  - ncs: Re-enable cipher suites: TLS_RSA_WITH_AES128_CBC_SHA,
    TLS_RSA_WITH_AES256_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA256 and
    TLS_RSA_WITH_AES256_SHA256.

    (ENG-27002, RT:46676, PS-41793, CSCvy96859)

  - ncs: A nano-service zombie no longer gets stuck if the nano-service is
    deleted through a "when" statement.

    (ENG-26995, RT:46681, PS-41798, CSCvy93853, SR:691376495)

  - ncs: Added mandatory nodes, and existing nodes that didn't have instance
    data, but became mandatory would now cause a validation error if present
    in the active case.

    (ENG-26965)

  - ncs: Delete the oldest progress trace entry instead of the most recent
    when exceeding the progress trace's maximum size.

    (ENG-26954, RT:46504, PS-41618, CSCvy83549, SR:691377841)

  - ncs: Fix an issue in Nano services where certain behaviour tree
    variables that contain single quotes would not be usable in state
    pre-conditions and post actions.

    (ENG-26890)

  - ncs: The order of user-ordered leaf-lists is now preserved when
    calculating reverse diff-set during a sync-to.

    (ENG-26825, RT:46352, PS-41471, CSCvy66434)

  - ncs: An unexpected behavior occurred when a choice did not change from
    default even though it was explicitly set. This resulted in a validation
    failure at commit but has now been corrected so the choice does change
    value to the explicitly set one, and the validation can proceed.

    (ENG-26783, RT:46378, PS-41497, CSCvy60045, SR:691511452)

  - ncs: The 'no-out-of-sync-check' commit flag is no longer incorrectly
    ignored when used in combination with the 'no-lsa' commit flag when
    committing towards an LSA-device.

    (ENG-26660, RT:46274, PS-41394, CSCvy46258, SR:691432717)

  - ncs: Services deleted in the transaction are now displayed in the
    resulting commit queue item.
    'plan-state-change' notifications are now sent after devices has
    persisted their configuration in the commit phase.

    (ENG-26620)

  - ncs: NSO no longer returns an internal error when the device manager
    tries to obtain a device lock, and there already exists a lock in the
    commit queue that is locking all devices.

    (ENG-26619)

  - ncs: A post action would fail with an internal error when the post
    action included a result expression and the called action is in another
    namespace than the Nano service.

    (ENG-26487, RT:46019, PS-41136, CSCvy25965, SR:691225325)

  - ncs: Items set in in the /progress/trace/debug leaf-list now takes
    effect for the configured progress trace.

    (ENG-26446)

  - ncs: Pre-conditions for Nano services would still be present even after
    a service upgrade that removed the pre-condition.

    (ENG-26423, RT:45608, PS-40726, CSCvy21451)

  - ncs: A synchronous post action with a result expression would be
    re-deployed indefinitely.

    (ENG-26402, RT:45994, PS-41111, CSCvy20489, SR:691271362)

  - ncs: The 're-deploy' and 'un-deploy' actions now return the expected
    commit queue result when the commit queue is enabled by default and no
    other parameters are passed to the action.

    (ENG-26373)

  - ncs: Using force-commit in multiple nano service components where more
    than one is fulfilled in a transaction caused multiple redeploys of the
    service. This has now been improved to redeploy once only per
    transaction.

    (ENG-26368)

  - ncs: Using a leaf-list in a nano service-behavior-tree foreach
    multiplier would  result in only one leaf-list element being processed
    and thus one component being created. Now a nano foreach multiplier can
    handle leaf-lists and all the leaf-list elements are processed.

    (ENG-26366)

  - ncs: A significant performance degradation when calculating the
    southbound diff for CLI devices has been fixed.

    (ENG-26264, RT:45769, PS-40884, CSCvy04497, SR:691107363)

  - ncs: Generating a compliance report would return an internal error due
    to a service having failed. The action will now return a more
    descriptive error that includes the service that is failing.

    (ENG-26229, RT:45379, PS-40493, CSCvy01364, SR:690719608)

  - ncs: The service would get stuck when upgrading Nano services where
    deprecated components never were deleted.

    (ENG-26213)

  - ncs: Correct a service that the 'deep-check-sync' action sometimes
    failed for an LSA service in the CFS node if the service created
    multiple copies of the service instances in the RFS node.

    (ENG-26138, RT:45808, PS-40923, CSCvx99052, SR:691170445)

  - ncs: Leafs explicitly set to their default values in NSO were sometimes
    not handled correctly during NED migration.

    (ENG-26052, RT:45727, PS-40842, CSCvx85861, SR:691085256)

  - ncs: Correct a service that 'device check-sync' action for CLI NEDs
    failed when NSO was in read-only mode.

    (ENG-25992, RT:45444, PS-40559, CSCvx79695)

  - ncs: The NED trace files now includes the correct user session id when a
    device session is reused.

    (ENG-25942, RT:45539, PS-40656, CSCvx74526, SR:690884402)

  - ncs: The performance of 'commit dry-run outformat cli' has been improved
    in the case where the change-set mostly consists of attribute changes
    such as backpointers and ref-counters.

    (ENG-25940, RT:45609, PS-40727, CSCvx95764, SR:691043785)

  - ncs: The version of field of a Nano service component would be set to an
    invalid value.

    (ENG-25937, RT:45554, PS-40671, CSCvx74369)

  - ncs: Deinstalling packages using the '/software/packages/deinstall'
    action resulted in an internal error.

    (ENG-25927)

  - ncs: A large amount of Immediate-Query request via the RESTCONF Query
    API could cause the memory to grow unnecessarily large.

    (ENG-25906, RT:45514, RT:45424, PS-40630, PS-40538, CSCvx70377,
    SR:690948532)

  - ncs: Make 'reactive-re-deploy' behave the same for zombies and for
    services that are converging by making the zombie 'reactive-re-deploy'
    asynchronous by default. If one wants the action to be synchronous, the
    sync parameter can be used when calling the action.

    (ENG-25871, RT:45501, PS-40617)

  - ncs: The filter tree generated for large leafref is now limited only by
    the memory of the server.

    (ENG-25778, RT:45649, RT:44891, PS-40767, PS-40003, CSCvx54246)

  - ncs: An internal error was thrown when commit was done with a
    no-revision-drop flag to multiple devices in the same commit.

    (ENG-25758, RT:45272, PS-40385, CSCvx49831)

  - ncs: For a nano component state with a delete post action but no create
    post action, if the state went from backtracked to reached, the
    'post-action-status' was not cleared(not-reached). The
    'post-action-status' is now cleared(-).

    (ENG-25656, RT:45119, PS-40232, CSCvx27994)

  - ncs: Updated the initial configuration of how alarms are sent northbound
    with X.733 mapping.

    (ENG-25635)

  - ncs: NSO did not rename rollback files based on
    /ncs-config/rollback/rollback-numbering if rollback-numbering was
    changed and the system restarted. Now NSO will check and rename all
    rollback files accordingly upon restart.

    (ENG-25605)

  - ncs: Namespace changes could cause NSO to crash on sync-from towards an
    LSA RFS node.

    (ENG-25603, RT:46043, PS-41160)

  - ncs: Notifications including an element named 'notification' could crash
    the notification handler.

    (ENG-25589)

  - ncs: The correct blocking queue item is now reported when a commit fails
    due to a commit queue lock with 'block-others' is blocking all managed
    devices.

    (ENG-25584)

  - ncs: The MAAPI save_config call produced XML elements with the wrong
    namespace when the MAAPI_CONFIG_NO_PARENTS flag was used.

    (ENG-25580, RT:44890, RT:44935, PS-40002, PS-40047, CSCvx13767,
    SR:690649704)

  - ncs: The 'deep-check-sync' action now works correctly with stacked
    services.

    (ENG-25562, RT:45237, RT:44964, PS-40350, PS-40076, CSCvx09940)

  - ncs: NSO would crash when the /java-vm/synchronization-timeout-action
    was set to log and the JVM would crash/timeout during startup.

    (ENG-25552, RT:44887, PS-39999, CSCvx08496)

  - ncs: Service opaque properties added in delete pre-modification are now
    accessible from nano delete callbacks.

    (ENG-25514, RT:44897, PS-40009, CSCvx02962)

  - ncs: NSO did not delete old rollback files based on
    /ncs-config/rollback/history-size if history-size was reduced and the
    system restarted. Now NSO will check and reduce the number of rollback
    files upon restart.

    (ENG-25477, RT:45071, RT:44807, PS-40184, PS-39919, CSCvw92968,
    SR:690533459)

  - ncs: NSO and ncsc no longer hangs at startup if 1024 file descriptors
    are open when the commands are invoked.

    (ENG-25475, RT:44747, PS-39857, CSCvw96027)

  - ncs: If there is a leaf with a default value containing a "must"
    expression, and an instance of its ancestor is created, the command
    'commit dry-run' generated a delete operation on that leaf, which is
    incorrect. NSO has been updated to not generate delete operations on
    such nodes.

    (ENG-25469, RT:44182, PS-39288, CSCvw91944)

  - ncs: For a stacked nano service, the get-modifications action with
    forward option no longer returns an error stating that the reverse diff
    is not found even though it actually exists.

    (ENG-25460, RT:44788, PS-39899, CSCvw90251)

  - ncs: Fixed outputs of a service's get-modifications and
    get-modifications reverse. For get-modifications, the output shows as if
    the service was the only service instance being deployed. For the
    get-modifications reverse, the output shows as if the service was the
    last service instance.

    (ENG-25447, RT:44760, RT:44719, PS-39871, PS-39830, CSCvw87682)

  - ncs: The "when" timestamp in a plan state could be set to a time in the
    past.

    (ENG-25423)

  - ncs: Migration from pre-CDM to CDM, when a namespace has been removed in
    the new schema, crashed.

    (ENG-25403, RT:44571, PS-39681, CSCvw77966, SR:690404217)

  - ncs: Duplicate keys could be returned underneath the path
    '/ncs:devices/device/live-status/yanglib:yang-library'.

    (ENG-25401)

  - ncs: A dry-run commit with cli output format resulted in an internal
    error.

    (ENG-25396, RT:44512, PS-39621, CSCvw76596, SR:690058342)

  - ncs: Commit parameters are now kept throughout a staged deletion of a
    nano service (using the /zombies/service/reactive-re-deploy action).
    Added commit parameters to the /zombies/service/re-deploy action.

    (ENG-25349, RT:44528, PS-39639, CSCvw73176, SR:690381223)

  - ncs: When an abort was triggered towards a device and the data model
    included a list with the cli-remove-before-change annotation, NSO would
    in some cases fail to revert the changes done on the device. This has
    now been fixed so that any data changes due to the annotation is
    properly reverted during an abort.

    (ENG-25348, RT:44574, PS-39684, SR:690397301)

  - ncs: Fix an internal error related to the plan location for services
    when the service only uses the ncs:service-data grouping and does not
    have the ncs:servicepoint extension set. Also fixes an issue where a
    plan location was returned for services without a plan.

    (ENG-25330, RT:44558, PS-39668, CSCvw70106, SR:690396481)

  - ncs: Diff dependency rules in generic NEDs would not be applied when the
    rule was set on a list node.

    (ENG-25280)

  - ncs: maapi.setValues can now be used to set keyless (config false)
    lists.

    (ENG-25276)

  - ncs: Addressed a regression that could lead to decreased throughput for
    Nano- and RFM-services.

    (ENG-25271)

  - ncs: When the Rollback File mechanism was enabled, the number of
    Rollback Files affected the response time for RESTCONF request (due to
    the construction of the ETag HTTP response header). The implementation
    has now been changed to make the response times unaffected by the number
    of Rollback Files.

    (ENG-25269, RT:44807, RT:44137, RT:45268, PS-39919, PS-39241, PS-40381,
    CSCvw62366, SR:690110245)

  - ncs: Locks in the commit queue are unlocked even when the NSO node is in
    HA mode none.

    (ENG-25251, RT:43129, PS-38243, CSCvw59945, SR:689429134)

  - ncs: When setting leaf-list containing 'tailf:cli-list-syntax'
    extension, the system generated incorrect rollback data which lead to
    the 'rollback configuration' only deleting one leaf-list entry. Now
    the system has been updated to generate rollback data correctly.

    (ENG-25247)

  - ncs: Correcting the Time Zone calculation that did not handle cases
    properly when Local- and Universal time ended up on different days.

    (ENG-25171, RT:44335, PS-39442, CSCvw61112)

  - ncs: The 'compare-config' action have been fixed so that it works when
    XML output is requested.

    (ENG-25155)

  - ncs: When changing a node (N1) that another node (N2) is when-dependent
    upon, effectively making N2 non-existent, the resulting rollback file
    did not include the changes to N2 if the change to N1 was done through
    one of the northbound interfaces (except RESTCONF) or a MAAPI
    transaction started in delayed-when mode.

    (ENG-24474, RT:43074, PS-38188, CSCvv21888, SR:689537608)

  - ncs: Checks and deletes if nano-plan/error-info exist during nano
    service un-deploy workflow.

    (ENG-24272, RT:42734, PS-37850, CSCvv44459)

  - ncs: Configured progress trace files are now reopened on reception of
    reopen_logs command.

    (ENG-23205)

  - ncs: Action/RPC input parameters of type empty which are also mandatory
    did not get passed along to the action callback.

    (ENG-22987, RT:40278, PS-35357, CSCvs66485)

  - ncs: If /kickers/data-kicker/kick-node changed its value during upgrade,
    NSO ignored the changed config. The system has been updated so that such
    changes will be applied when upgrade is completed.

    (ENG-21577, RT:37548, PS-32625)

  - aaa: Corrected NACM check when using RESTCONF/NETCONF or load operation
    in CLI/JSON-RPC to deleting configuration.

    (ENG-25627, RT:45059, PS-40172, CSCvx23657)

  - aaa: A regression caused an unrelated NACM rule to prevent a list
    element from being deleted because of an error occurring while
    processing this rule. The change that made this failure happen has now
    been reverted.

    (ENG-25364, RT:44541, PS-39651, CSCvw75133)

  - c-api: Fix an issue that caused failures when subscribing on NETCONF
    Event Notifications while Authorization Callbacks are enabled.

    (ENG-26680, RT:46296, PS-41416, CSCvy49397)

  - c-api: Do not allow to use cdb_set_elem() or cdb_set_elem2() to set
    value of list key. The action shall result 'CONFD_ERR_NOT_WRITABLE'
    error code, and 'A list key is not writable' error string.

    (ENG-26118, RT:45749, RT:46959, RT:47025, PS-40864, PS-42078, PS-42144,
    CSCvx95656)

  - cdb: The value of
    /ncs-state/internal/cdb/datastore/pending-subscription-sync/time-remaining
    was always set to infinity for operational datastore. The value of this
    leaf has been corrected to show the remaining time in seconds before
    clients which does not respond will have its socket closed.

    (ENG-26916, RT:46429, PS-41544, CSCvy75316)

  - cdb: It was possible for invalid operational data to be persisted in CDB
    after a schema change. Such invalid data, if any, will now be deleted
    during CDB upgrade.

    (ENG-25888, RT:45457, PS-40573, CSCvx68272, SR:690855993)

  - cdb: Fix error handling of lock acquisition in HA and CDB

    (ENG-25874)

  - cdb: Fixed an issue where old augments into built-in user modules
    remained after an upgrade, which was resulting in incorrect data models
    and causing faulty behaviour.

    (ENG-25596, RT:44658, PS-39769, CSCvx16595)

  - cdb: NSO performed unnecessary "when" expression evaluations and set
    hook invocations. This happened when resetting the value to its current
    value.
    Now the value change is verified before evaluating the "when" expression
    and running the set hook.

    (ENG-25515, RT:44786, RT:44400, PS-39897, PS-39507, CSCvx02960,
    SR:690219367)

  - cdb: When using functions from the CDB API to format a keypath using
    "%h" (hkeypath) and the keypath was pointing to an augmented node, the
    call failed with a "bad tag value" error. This was a regression
    introduced in ENG-22839.

    (ENG-25479, RT:44811, PS-39923, CSCvw94125)

  - cdb: Introduced new flag - 'CDB_GET_MODS_WANT_ANCESTOR_DELETE' for
    'cdb_get_modifications()'. If set, subscriber to child now get
    notification of parent structure deletion.

    (ENG-25478, RT:44288, PS-39394, CSCvw93729)

  - cdb: Incorrectly handled parameters internally in CDB could in some
    cases result in NSO to terminating.

    (ENG-24469, RT:42742, PS-37858, CSCvv20389)

  - cdb: When a service subscribed on a standby node, and the standby first
    connected to active node, the system did not generate notifications for
    nodes with "when" expressions evaluating to true. The system has been
    updated to correctly generate notifications for such nodes.

    (ENG-19091, RT:33879, PS-29130)

  - cli: The handling of pipe targets of the show command was corrected to
    prevent an internal error on C-Style CLIs.

    (ENG-27029)

  - cli: Removed access denied error of the show command when the pipe
    target tab is used.

    (ENG-26990, RT:46540, PS-41654, CSCvy92541)

  - cli: The JSON-data output now displays leaf-lists as arrays instead of a
    strings.

    (ENG-26514, RT:45998, PS-41115, CSCvy28080, SR:691315031)

  - cli: The terminal window size limits are now enforced. It also increases
    the maximum allowed terminal window width to 1024.

    (ENG-26434, RT:46035, PS-41152, CSCvy22148)

  - cli: The "| display restconf" CLI command now includes /data/ in the
    URL.

    (ENG-26388, RT:46007, PS-41124, CSCvy19911)

  - cli: Do not display nodes with 'tailf:no-keyword' extension when using
    the 'display set' pipe command in J-Style CLI and also do display nodes
    without the extension.

    (ENG-26380, RT:45877, PS-40994, CSCvy18115, SR:691166344)

  - cli: The configuration diff (as displayed by 'commit dry-run outformat
    native') after re-ordering the instances of an 'ordered-by user' list
    along with other config modifications would in some cases render invalid
    diff output.

    (ENG-26303, RT:45931, PS-41048, CSCvy09562)

  - cli: Looking at operational-data (such as live-status information)
    crashed due to missing initial CLI session information.

    (ENG-26000)

  - cli: CLI incorrectly processed symlinks, in particular when a symlink
    was part of the value for '--cwd' / '-c' option passed to ncs_cli, thus
    making it possible to set the working directory to an invalid value. Now
    all symlinks are internally resolved to real paths by CLI.

    (ENG-25959)

  - cli: The C-style configuration diff, for example, 'commit dry-run
    outformat native' towards a CLI device, after adding leaf annotated with
    'tailf:cli-prefix-leaf' while modifying a sibling leaf annotated with
    'tailf:cli-remove-before-change' is now rectified.

    (ENG-25955, RT:45581, PS-40698, CSCvx76165)

  - cli: The CLI does no longer ship the pre-compiled clispec file confd.ccl
    but instead include the J-style commands as true builtin commands to
    allow user-defined clispec override to take precedence.

    (ENG-25946, RT:45621, PS-40739, CSCvx75435)

  - cli: Tags can now be set or cleared or deleted as on leaf-list data
    types using the CLI and the extension 'tailf:cli-range-list-syntax' is
    inherited to 'device-templates'.

    (ENG-25881, RT:45255, PS-40368, CSCvx66888, SR:690795765)

  - cli: The C-style delta-diff after adding and removing elements from
    multiple leaf-lists annotated with tailf:cli-compact-syntax has been
    corrected.

    (ENG-25683)

  - cli: When creating siblings of an empty leaf with extension
    'tailf:cli-hide-in-submode' under a parent list node with extensions
    'tailf:cli-sequence-commands' and 'tailf:cli-incomplete-command', the
    empty leaf would be wrongly appended to the list key although it was not
    set.

    (ENG-25647, RT:45129, PS-40242, CSCvx25828, SR:690649860)

  - cli: Presence containers have corrected and more valid JSON data output
    from the CLI when using the "display json" pipe command.

    (ENG-25616, RT:45043, PS-40156, CSCvx20838, SR:690403083)

  - cli: Entering the auto-wizard in the C-style CLI when configuring a
    leaf-list of the type union, containing both string and integer types,
    could fail and result in an internal error.

    (ENG-25591, RT:44990, PS-40103, CSCvx15152)

  - cli: The C-style configuration diff (e.g. commit dry-run outformat
    native) when deleting a leafref pointing to the parent list has been
    corrected in the case that the parent instance has been deleted.

    (ENG-25554, RT:44920, PS-40032, CSCvx08648)

  - cli: Even if 'use-expose-ns-prefix' in the ncs.conf was set to false,
    CLI completion for /devices/device/config got very sluggish if it had a
    good amount of devices configured.

    (ENG-25546, RT:43667, PS-38784, CSCvx07233, SR:689659066)

  - cli: Showing an empty leaf in JSON format with the pipe command "display
    json" has been corrected.

    (ENG-25509, RT:44904, PS-40016, CSCvx01947, SR:690615369)

  - cli: The handling of operational data keyless lists was corrected to
    prevent an internal error when the display JSON target or the de-select
    target is used.

    (ENG-25501, RT:39494, PS-34572, CSCvw98947)

  - cli: Now NACM cmd rules are not checked for auto-rendered CLI commands
    when cStrictAAA is set to true.

    (ENG-25485, RT:44618, PS-39729, CSCvw96173)

  - cli: When piping data to xpath in the CLI, any information regarding
    presence containers would be ignored unless it contained more data
    beneath itself. This change makes sure the xpath information is
    displayed even if the presence container can be considered empty but
    existing.

    (ENG-25470, RT:44800, PS-39911, CSCvw92172, SR:690528176)

  - cli: When a choice with implicitly selected default option has an
    operational leaf as a descendant, and the leaf is handled by a data
    provider, "show" command on the leaf involved existence check without
    invoking the data provider resulting in incorrectly omitted leaf. Now
    the existence check is performed at a later stage of the "show" command
    execution, thus returning the correct result.

    (ENG-25456, RT:44746, PS-39856, CSCvw89236)

  - cli: When deleting a non-empty leaf with extension
    'tailf:cli-hide-in-submode' under a parent list node with extension
    'tailf:cli-incomplete-command', the leaf value did not appear with the
    list key.

    (ENG-25452, RT:44781, RT:44713, PS-39892, PS-39824, CSCvw88278)

  - cli: The resulting C-style configuration diff ('commit dry-run outformat
    native') after modifying a node where all of the parents were containers
    annotated with tailf:cli-compact-syntax and tailf:cli-flatten-container
    would in some cases cause an internal error.

    (ENG-25397, RT:44638, PS-39749, CSCvw76684)

  - cli: Make the access "file" parameter check work for absolute paths when
    restrictedFileAccess is set to true.

    (ENG-25342, RT:44580, PS-39690, CSCvw72507)

  - cli: This fix adapts the path of 'tailf:dependency' statements, when
    they appear as children to top level 'when' statements in augmentations.
    Previously, these 'tailf:dependency' statement paths would point to each
    augmented node (since the 'when' expression is augmented to each node),
    now they will point to the augmentation's target node (or the closest
    data node ancestor). This is now adhering to part 7.21.5. of RFC 7950.

    (ENG-25329)

  - cli: The CLI 'copy' command now copies device template content.

    (ENG-25310, RT:43883, PS-38989, CSCvw69683, SR:690022710)

  - cli: When combining the 'tailf:cli-full-command' and
    'tailf:cli-drop-node-name' on a non-presence container which does not
    have 'tailf:cli-add-mode' the CLI will now fail with a syntax error in
    accordance with how the CLI completion code works. A warning is also
    raised during compilation of such a YANG module.

    (ENG-25253)

  - cli: When NACM rule forbids read access to certain ordered-by user list
    entries, it would generate incorrect rollback file content when moving
    an ordered-by user list entry due to it requires full access to all the
    ordered-by user list entries.

    (ENG-25240, RT:44437, PS-39544, CSCvw58352)

  - cli: An internal error occurred when invoking action with duplicate list
    keys.

    (ENG-25016, RT:43821, PS-38926, CSCvw19891, SR:689900906)

  - cli: Make sure the CLI triggers the 'tailf:cli-diff-delete-before' or
    'tailf:cli-diff-delete' extensions in combination with leaf-list and
    leafrefs during delete.

    (ENG-24989, RT:44086, PS-39190, CSCvw17520)

  - cli: The CLI now supports using more filters that can be passed down via
    the XPath engine to a data provider. One requirement is that a range
    expression is explicitly or implicitly used.

    (ENG-24968, RT:43427, PS-38543, CSCvw13445)

  - cli: Correction of the auto rendering of enabled/disabled of leafs that
    have a "when" expression.

    (ENG-24587, RT:43003, PS-38117, CSCvv50455)

  - cli: Child leafs of presence containers with a mode and annotated with
    tailf:cli-show-no will now correctly display the diff in the I- and
    C-style CLIs.

    (ENG-24560, RT:43429, PS-38545, CSCvv45685)

  - cli: Expand command parameters correctly in CLI spec to allow for
    correct matches in NACM rules.

    (ENG-24464, RT:43095, PS-38209, CSCvv18191)

  - cli: The CLI will now override the default-db with the operational-db
    when issuing the "show operational-state" command.

    (ENG-23398)

  - cli: The CLI does not support using 'tailf:hidden' extension on key
    leafs. Instead the extension is ignored on those locations. This has
    been made clearer in the documentation.

    (ENG-21500, RT:43411, RT:43472, RT:35923, PS-38527, PS-38589, PS-31001,
    CSCvp95854)

  - cli: A leaf annotated with 'tailf:cli-trim-default' and set to its
    default value, either explicitly or implicitly, will now be trimmed when
    displaying configuration in the table format.

    (ENG-19878, RT:35186, PS-30257)

  - cs_trans: Load configuration failed at validation phase for nested
    "choice" statements, where the inner is mandatory choice containing
    dependency node of "when" expression,  even though the inner choice
    belonged to inactive case of outer choice. The transaction engine has
    been updated to ignore the inner choice in such scenario.

    (ENG-26318, RT:45952, PS-41069, CSCvy11622, SR:691249158)

  - cs_trans: A bug caused CDB API's 'cdb_get_modifications_cli()' function
    to return incomplete results when in the CDB_SUB_PREPARE phase.

    (ENG-26004, RT:45585, PS-40702, CSCvx80857)

  - cs_trans: If there is a default leaf with "must" expression under
    non-presence container with "when" expression, the default leaf was
    always deleted if the dependency node of the "when" expression was
    changed, causing the "when" expression on the non-presence container
    evaluating to true.

    (ENG-26001, RT:45646, PS-40764, CSCvx80850, SR:691068375)

  - cs_trans: When deleting a node referenced by multiple "leafrefs" and/or
    "must" expressions only one of the constrains would be considered in the
    validation, causing validation to pass when it should actually fail. Now
    all relevant "leafrefs" and "must" expressions will be considered in the
    validation.

    (ENG-25889, RT:45717, RT:45509, PS-40832, PS-40625, CSCvx68284)

  - cs_trans: Fixed min/max-elements validation violation for list/leaf-list
    with min/max-elements under a deleted case, and the case is created in
    the same transaction.

    (ENG-25526, RT:44927, PS-40039, CSCvx05176)

  - cs_trans: Using a trans-in-trans, e.g. started by
    maapi_start_trans_in_trans(), to change configuration that makes an
    NP-container existent (through a when dependency) and that NP-container
    in turn contains a choice with a default case, would make the
    transaction crash with an internal error.

    (ENG-25511, RT:44905, PS-40017, CSCvx02853, SR:690616861)

  - cs_trans: When committing through the commit queue, NSO now populates
    the snapshot database (when '/ncs-config/cdb/snapshot/pre-populate' is
    set to "false") correctly for augmented choice statements.

    (ENG-24766)

  - documentation: Added description of the '--run-as-user' option to the
    'nct-install' man page and the 'nct-install' section of the NSO
    documentation.

    (ENG-27135, RT:47130, PS-42248, CSCvz43560, SR:692021146)

  - documentation: The '2-real-device-cisco-ios' example README has been
    updated.

    (ENG-25945)

  - documentation: Updated the documentation about NED
    'major/minor/maintenance' releases to make it clearer when a NED
    migration or NED upgrade needs to be done when updating NED packages.

    (ENG-25687, RT:45177, PS-40290, CSCvx34692)

  - documentation: The documentation regarding commit parameters in the
    various northbound interfaces has been updated.

    (ENG-25678)

  - documentation: Updated the clear conditions for the 'final-commit-error'
    alarm type.

    (ENG-25641)

  - documentation: The feature option in the ncsc man page has been updated
    to clarify that if the feature option is used when compiling a YANG
    module, all features defined in all modules must be listed explicitly if
    they are supported.

    (ENG-25142, RT:44281, PS-39387, CSCvw44929)

  - documentation: A leaf that is a 'tailf:secondary-index' may not also
    have a 'tailf:callpoint'.

    (ENG-25101, RT:29023, PS-9358)

  - documentation: Fix actions capability note in NSO user guide.

    (ENG-23665, RT:41598, PS-36684, CSCvt81569)

  - documentation: Removed outdated method of setting a custom start command
    for python-vm through the CLI and added correct steps of modifying
    "ncs.conf" config file to set a python-vm custom start command in
    "Configure NSO to use a custom start command" section in nso_development
    document.

    (ENG-20146, RT:36433, RT:35592, PS-31513, PS-30666)

  - documentation: The installation guide has been updated to include steps
    for logging and local-authentication in local to system install upgrade
    procedure.

    (ENG-17778, RT:31710, PS-27674)

  - examples: Fixed a typo in the scripting example.

    (ENG-25893, RT:45047, PS-40160, CSCvx68772, SR:690681677)

  - ha: Corrected the distributed change-set from primary node to secondary
    nodes.
    Corrected the notification of subscriber to operational datastore on
    secondary nodes.

    (ENG-26374, RT:45765, PS-40880, CSCvy17408)

  - ha: Local variables were called over an HA application even though they
    were not distributed in the HA cluster. This caused a deadlock when they
    were used during HA operations. Now local variables are separated from
    HA applications.

    (ENG-26310, RT:45679, RT:46305, RT:46156, PS-40794, PS-41425, PS-41274,
    CSCvy10996)

  - ha: NSO does no longer permit HA transitions while starting phase 2.
    Previously NSO could deadlock if switching HA state during start-up.

    (ENG-25995, RT:45676, PS-40791, CSCvx80427)

  - ha: Transactions on the primary node would hang when a secondary node
    tried to join during the transaction commit.

    (ENG-25990, RT:45530, PS-40646, CSCvx79357)

  - ha: Using NSO HA could lead to internal errors when communication with
    the internal HA server failed.

    (ENG-25655, RT:45551, RT:45091, PS-40668, PS-40204, CSCvx27792)

  - ha: Previous locking order of HA applications caused a deadlock when
    sending notifications during HA operations. The lock ordering is
    corrected to prevent this deadlock.

    (ENG-25560, RT:43926, PS-39032, CSCvx09563)

  - java-api: When multiple AlarmSource instances were created, one new CDB
    subscription on the path /alarms/alarm-list/alarm was created for each
    AlarmSource instance. Now multiple AlarmSource instances share the same
    CDB subscription to the alarms list.

    (ENG-25901, RT:44968, PS-40080, CSCvx69972)

  - java-api: All the sample NEDs and examples in the NSO release are now
    compiled for Java 8

    (ENG-24434, RT:43060, PS-38174)

  - java-api: The toString() method in ConfBinary produced wrong string
    representations for the YANG types like tailf:hex-list and
    tailf:octet-list.

    (ENG-24223, RT:42481, PS-37594, CSCvy91098, SR:689200181)

  - json-rpc: Due to an earlier change, YANG modules explicitly exported to
    'webui' (using the --export compiler flag or the tailf:export extension
    in the module) were not accessible over jsonrpc.

    (ENG-26716, RT:46182, PS-41300, CSCvy51674)

  - json-rpc: If some existing config includes empty leafs and that config
    is replaced by new config where the empty leafs have been removed, the
    empty leafs should be deleted since the new config does not include
    those empty leafs. However, when using JSON-RPC method 'load' with mode
    'replace' to replace the config the empty leafs would still be there.

    (ENG-26085, RT:45688, PS-40803, CSCvx88495, SR:690897173)

  - json-rpc: If ncs.conf(5) is loaded with any SSL parts in it, NSO will
    not close existing SSL connections.

    (ENG-25484, RT:44396, PS-39503, CSCvw95920)

  - json-rpc: Trans-in-trans via JSON-RPC is now working.

    (ENG-25212, RT:30899, PS-27133)

  - json-rpc: JSON-RPC allowed a user to start a config exclusive
    transaction even though one already exists, which is not allowed. Now
    you instead get a "Database is locked" error when trying to do this.
    In some situations when an error occurred while starting a config
    exclusive transaction the lock was not released, so starting another
    config exclusive transaction afterwards it would fail with "Database is
    locked" error. Now the lock is released in all situations where an error
    occurs when starting a config exclusive transaction.

    (ENG-24620, RT:43531, PS-38648, CSCvv56916)

  - json-rpc: When using the JSON-RPC method 'subscribe_poll_leaf' to
    subscribe to a live-status path, the subscriber returned the old value
    when a change was made to the device. To fix this, when a subscription
    is made to a live-status path, a new transaction is created each polling
    loop and used to get the value of the device, after which the
    transaction is deleted again.

    (ENG-22858, RT:39873, PS-34950)

  - json-rpc: XPaths which deref into an absolute path will now be
    normalized to remove any remaining parent steps that follows the deref
    statement. For example, the leafref path
    'deref(../some-leaf)/../../bar/baz', with the expanded deref
    '/foo:foo/fizz/buzz', will now be correctly compiled to
    '/foo:foo/bar/baz' instead of '/foo:foo/fizz/../bar/baz'.

    (ENG-22029, RT:41387, RT:44003, PS-36457, PS-39107)

  - kickers: If /kickers/data-kicker/action-name is non-existent, then the
    error will be logged in the devel.log

    (ENG-21037, RT:36862, PS-31944, CSCvp12427)

  - logging: SERVICE_PHASE column in progress trace now shows correct value
    for synthesizing start/stop phase of nano service.

    (ENG-26449)

  - logging: Re-opening of error logs no longer leaves unlinked open files.

    (ENG-25740, RT:45286, PS-40399, CSCvx46430)

  - nct: The nct get-logs command would fail if the tar command warned about
    log files changed as tar read from it during the creation of a tarball.
    nct now ignores the warning and fetches the tarball.

    (ENG-25792)

  - nct: Internal server error in nct get-logs has been fixed.

    (ENG-25781)

  - nct: An internal error occurred when executing "nct get-logs" with
    "--log-dir" option set as a directory path without a "/".

    (ENG-25022)

  - netconf: The 'periodic' parameter in operation modify-subscription did
    not take proper effect resulting in that notifications were still sent
    in the same periods as was set in the initial establish-subscription.
    Now modify-subscription handle the 'periodic' parameters properly and
    thus the periods of sent notification are updated accordingly.

    (ENG-26782, RT:46348, PS-41467, CSCvy60021, SR:691362140)

  - netconf: An issue in YANG-Push that led to failures to generate XML
    results for operational data of augmented nodes.

    (ENG-26737, RT:46303, PS-41423, CSCvy53567)

  - netconf: In some circumstances where several levels of 'choice' and
    'case' are used in the YANG module, an incorrect namespace was used.
    This fix makes it so that the correct namespace is used, leading to the
    expected response from an edit-config operation.

    (ENG-25614, RT:45082, PS-40195, CSCvx20041)

  - netconf: When NSO connects to NMDA enabled devices, it may receive
    information about custom datastores, as defined in RFC 8525. Before this
    change, NSO would drop the connection at this point, since it did not
    recognize custom datastores. With this work around, NSO will allow
    custom datastores, but it will not yet handle them in any meaningful
    way.

    (ENG-25590, RT:45344, PS-40459)

  - netconf: A rare case where the TCP handler would not react to a closing
    socket has been identified and is now reacted to, allowing the handler
    to terminate.

    (ENG-25572, RT:42375, RT:44236, RT:44988, PS-37485, PS-39342, PS-40101,
    CSCvx13338)

  - netconf: NETCONF sessions crashed when generating content for YANG-Push
    notifications.

    (ENG-25426)

  - netconf: During introduction of new SSH server code a socket option was
    left out, which caused a decrease in the connection acceptance rate.
    This has been fixed by reintroducing the option.

    (ENG-24796)

  - netconf: NETCONF validate config returned OK even when it broke the
    max-element constraint. Now you instead get the expected "too many
    elements" error.

    (ENG-24358, RT:42858, PS-37974, CSCvu95279)

  - netconf: An action was allowed to be executed despite an existing deny
    read access NACM rule. A check for the action having read authorization
    was missing. A check has now been added and a matching deny read access
    NACM rule will reject the invocation of the action as expected.

    (ENG-23851, RT:43031, RT:42066, PS-38145, PS-37168, CSCvu18469)

  - netconf: NSO refuses to create requests with wd:default="true" for non
    default value leaf-list data, in accordance with RFC 6243: "If the
    'default' attribute is present and set to 'true' or '1', the data node
    within the NETCONF message MUST contain a value in this case, which MUST
    be equal to the schema default value. If not, the server MUST return an
    <rpc-error> response with an 'invalid-value' error-tag."

    (ENG-23815)

  - netconf: Previously the XML payload with default attribute was rejected
    when it contained "0" or "false". Now if the server supports
    'report-all-tagged' mode, the XML payload with default attribute allows
    all data types 'boolean' according to RFC 6243.

    (ENG-23758)

  - netconf: A performance difference was seen between inline and URL
    copy-config operation requests. The url case did some superfluous
    deletes which now have been removed. Also, the url referred to a file
    and the file read buffer has been doubled in size.

    (ENG-21860, RT:38116, PS-33191, CSCvq79753)

  - netconf: Creating NETCONF notification subscriptions with an invalid
    stream or no notification capability now gives proper error message.
    NETCONF subscriptions can only be created for NETCONF devices.

    (ENG-20811, RT:36601, RT:36602, PS-31681, PS-31682, CSCvo75213)

  - python-api: Starting NSO with an empty CDB, while loading a package
    containing a Python upgrade component resulted in a crash and NSO
    failing to start. This has been addressed and starting NSO will succeed.

    (ENG-25628, RT:45038, PS-40151, CSCvx23697)

  - python-api: The Python maagic API now allows creation of entries in
    persistent keyless oper (config false) lists. It was previously only
    possible on in-memory lists, such as those used for action_input /
    action_output.

    (ENG-24983, RT:44022, PS-39126, CSCvw19722)

  - python-api: Add missing documentation for python APIs.

    (ENG-24225)

  - restconf: Fixed an internal error when invoke action with parameters on
    read-only NSO, or on HA standby node.

    (ENG-26952, RT:46601, PS-41715, CSCvy83352, SR:691582803)

  - restconf: Add "error-app-tag" information for error RESTCONF response.
    Correct value for "error-tag" in the error RESTCONF response according
    to appendix-A in RFC-6241 and RFC-8040.

    (ENG-26924, RT:46211, PS-41329, CSCvy76436, SR:691088314)

  - restconf: If the input parameter for an action was a list and the list
    keys were not in schema order the action resulted in an error stating
    that one of the keys is a 'missing element'. This correction makes the
    order of the keys insignificant and the action can be invoked as
    expected.

    (ENG-26773, RT:46360, PS-41479, CSCvy58524, SR:691535543)

  - restconf: An existing error formatting callback is now invoked when
    'commit-queue'  and 'error-option continue-on-error' are in effect and a
    RESTCONF call results in an error of type CONFD_ERRTYPE_NCS.

    (ENG-26623, RT:46096, PS-41213, CSCvy43381, SR:691162352)

  - restconf: Huge queries towards the RESTCONF Query API could cause a race
    condition that led to a process being killed before it had completely
    finished processing the query, which led to an internal error.

    (ENG-26527, RT:46811, RT:45942, PS-41929, PS-41059, CSCvy29808,
    SR:691180091)

  - restconf: A request towards an instance which does not exist did not
    emit an error payload, only an HTTP 404 status code. Now a corresponding
    error payload is emitted when instances are not found.
    Error payloads were also not emitted for missing API resource, DELETE of
    non-existent data, or non-existent list instance in action input. Now
    error payloads are emitted for these cases as well.

    (ENG-26369, RT:45997, PS-41114, CSCvy49809, SR:691047424)

  - restconf: When using commit queues with 'out-of-sync-commit-behavior =
    reject' and trying to set some config to a device that is out-of-sync
    the operation failed, but RESTCONF would return code 200 or 201 which
    indicates success. This has now been changed so that 502 is returned
    instead.

    (ENG-26295, RT:45933, PS-41050, CSCvy08638, SR:690964198)

  - restconf: Before, the module prefix was used in the namespace of the
    RESTCONF notification.
    Now, the module name is used in the namespace of the RESTCONF
    notification.

    (ENG-25894, RT:45518, PS-40634, CSCvx69198)

  - restconf: Only HEAD, GET and OPTIONS methods are allowed for operational
    data.

    (ENG-25861, RT:45199, PS-40312, CSCvx64652)

  - restconf: For a list in JSON format, an error occurred when list keys
    were placed in another order than found in the YANG module. This
    correction makes it possible to place the keys in any order of choice.

    (ENG-25816, RT:45422, PS-40536, CSCvx59543, SR:690910969)

  - restconf: When sending a request for non-existing devices NSO would
    return "500 Internal Server Error", which is wrong. Now NSO will return
    "404 Not Found" as expected.

    (ENG-25695)

  - restconf: A 'yang-patch' request for a non-exist resources will throw
    '404 NOT FOUND' error.

    (ENG-25675, RT:45102, PS-40215, CSCvx32190, SR:690636927)

  - restconf: Before, a RESTCONF request with a JSON payload containing a
    node with a name starting with an underscore would cause an internal
    error. This is from the legacy REST implementation where names starting
    with underscore were treated like attributes. This old behavior has now
    been changed to allow node names starting with an underscore.

    (ENG-25610, RT:44255, RT:44999, PS-39361, PS-40112, CSCvx19034)

  - restconf: The depth parameter now follows RFC-8040, meaning that the
    requested data node has a depth level of "1". If the "fields" parameter
    (Section 4.8.3) is used to select descendant data nodes, then these
    nodes and all of their ancestor nodes have a "depth" value
    of "1".

    (ENG-25222)

  - restconf: RESTCONF POST requests now correctly handles empty JSON
    payloads.

    (ENG-22324)

  - rollback: Rolling back multiple files that contains discarded-changes
    due to NACM rules prohibiting access, no longer result in an internal
    error.

    (ENG-26833)

  - security: SSH "diffie-hellman-group18-sha512" key exchange algorithm has
    been removed from server offers. SSH "curve25519-sha256",
    "ecdh-sha2-nistp256", "ecdh-sha2-nistp384", "ecdh-sha2-nistp521" key
    exchange algorithms are added. SSH "aes128-gcm@openssh.com",
    "chacha20-poly1305@openssh.com" encryption algorithms are added.

    (ENG-25774)

  - smart-licensing: The NSO-network-element entitlements are preserved
    after a smart-agent restart, and not reset to zero.

    (ENG-26951, RT:46445, PS-41560, CSCvy83272, SR:691572154)

  - snmp-agent: Log messages like "<ERR> 10-Feb-2021::01:04:03.241 rhubarb
    ncs[1212]: devel-snmpa snmp not enabled. send notification not possible:
    tfAlarmClear" are now logged with log level trace. Set
    '/ncs-config/logs/developer-log-level=trace' for '<DEBUG>' messages to
    appear in the 'devel.log', see 'ncs.conf(5)' man page for more info.

    (ENG-23229, RT:40741, PS-35837, CSCvt00187)

  - snmp-agent: DateAndTime SNMP objects that are assigned without a
    timezone given will have the local timezone.

    (ENG-22770, RT:39922, PS-34999, CSCvs29275)

  - toolchain: The utility ncs_cmd no longer outputs tmp files if TEST_DIR
    is set.

    (ENG-26987, RT:46702, PS-41819, CSCvy91586)

  - toolchain: When YANG files included HTML encoded quote characters, 'ncsc
    --compile-bundle' could abort with 'internal error'. Now it prints a
    proper error message instead.

    (ENG-26376)

  - toolchain: ncs-netsim no longer allows existing device names in the
    'add-device' option.

    (ENG-26174, RT:45864, PS-40981, CSCvx99468, SR:691083136)

  - toolchain: A list with a validation callback that had a deviation,
    caused the callback to be called twice.

    (ENG-25726, RT:45243, PS-40356, CSCvx43823)

  - toolchain: According to RFC 7950, statements in a deviation should be
    evaluated where they occur in the deviating module. Previously yanger
    and ncsc have been less strict in enforcing this. This means that any
    prefixes or typedef names used in deviating statements must be found in
    that same module.
    If unknown names or prefixes are encountered, a warning will be issued.

    (ENG-25448, RT:44679, PS-39790, CSCvw87723)

  - toolchain: Previously the 'confd_cmd' sub-command 'dump_schema NODE'
    erroneously printed out succeeding siblings to NODE.
    Now only the specified node and its children are printed.

    (ENG-25445, RT:44716, PS-39827, CSCvw86665)

  - toolchain: The 'ncsc --ncs-compile-bundle' command will now expand uses
    statements that have refine sub-statements but not augment
    sub-statements during transform phase. This way, the refine statements
    that are targeting dropped nodes will be handled before the compile
    phase thus preventing compile errors if there is no augment
    sub-statement co-existing with the refine sub-statements.

    (ENG-25166, RT:44646, PS-39757, CSCvw76425)

  - toolchain: Some customer modules are excluded from the optimization for
    leafref handling that was introduced with ENG-21146.

    (ENG-25129, RT:44289, PS-39395, CSCvw39503)

  - toolchain: 'ncsc' will pre-evaluate an xpath expression to determine if
    it is a static 'true' or 'false'.

    (ENG-23908, RT:45764, PS-40879)

  - upgrade: An 'out-of-service' upgrade no longer removes
    '/kickers/data-kicker/kick-node'.

    (ENG-26533, RT:46124, PS-41241, CSCvy30896, SR:691391465)

  - upgrade: Improved performance when using package reload.

    (ENG-25964, RT:45594, PS-40711, CSCvx79647, SR:691043336)

  - upgrade: If the client triggered to upgrade in 'read-only' mode (by
    using 'maapi_set_readonly_mode()'), the system would abort due to an
    internal error. Now the system gently returns an error message in that
    case.

    (ENG-25956, RT:45615, PS-40733, CSCvx76580, SR:690962977)

  - web-server: If an HTTP/1.1 RESTCONF client does not send a
    'Connection:close' header, it would result in NSO keeping a socket open
    which eventually lead to an internal error entry being logged in the
    error log.

    (ENG-25741, RT:45288, PS-40401, CSCvx46503, SR:690819658)

  - webui-one: A list entry with the empty string as key value is now
    clickable, it was not before because the link element collapsed.

    (ENG-27019)

  - webui-one: It is now possible to select empty string in leafref dropdown
    for multiple key list.

    (ENG-27000, RT:46427, PS-41542, CSCvy95455, SR:691569622)

  - webui-one: Empty-string can now be used in leafref dropdowns in the
    webui.

    (ENG-26880, RT:46427, PS-41542, CSCvy69752, SR:691569622)

  - webui-one: Custom shortcuts linked to a native application with last
    location functionality, is now consistently linked to the wanted
    shortcut.

    (ENG-26708)

  - webui-one: If the web browser does not support ResizeObserver, the
    dynamic resize of grids are disabled on window resize. As a work around
    it is still possible to reload the page to get the proper number of
    columns and rows.

    (ENG-26133, RT:45863, PS-40980, SR:691188218)

  - webui-one: The load dialog will now show the correct error message when
    NSO is in, or has been in, 'read-only' mode.

    (ENG-26066, RT:45445, PS-40560)

  - webui-one: While browsing the ned-config of a device in the
    configuration editor, it is now possible to navigate in and out of list
    entries without the page going blank, and lists that are direct children
    of a choice's case are now rendered as expected.

    (ENG-26025)

  - webui-one: Elements deleted from a 'leaf-list' with 'min-elements'
    inside a list will now actually get deleted.

    (ENG-26020, RT:45638, PS-40756, CSCvx82527)

  - webui-one: Actions will now show the correct error message when NSO is
    in, or has been in, read-only mode.

    (ENG-25994, RT:45444, PS-40559)

  - webui-one: Corrected the commit queue error option in webui.

    (ENG-25707, RT:45216, PS-40329, CSCvx38818)

  - webui-one: Improve parsing of keypaths in the add list item modal to
    handle quoted keys. It is now possible to add a new list item with the
    right curly bracket character.

    (ENG-25691)

  - webui-one: When running the apply-template action for a device from the
    webui, the action parameters will now again include values added to the
    "variable" list.

    (ENG-25633, RT:45092, PS-40205, CSCvx24231)

  - webui-one: Loading faulty XML files in the webui resulted in a generic
    "An error has occurred" message.
    Now a contextual error message describing the issue with the XML file is
    shown instead.

    (ENG-25243, RT:44467, PS-39575)

  - webui-one: A loader was missing for the bread crumb options list.

    (ENG-20750)

  - webui-one: Leafs with a "when" target pointing to a leaf-list on the
    same page would not update when the leaf-list was changed. Now they are
    updated correctly when the "when" target is changed.

    (ENG-18042)

  - webui-one: The ping action is missing from batch actions in the Device
    manager.
    This has been resolved by adding the ping action to the list of batch
    actions.

    (ENG-18001)

  - xpath: If XPath has predicate containing relative child with prefix, and
    the relative child is a modifying list node, then the system crashed
    with an internal error when evaluating such XPath expression. Now, the
    system has been updated to handle that XPath correctly.

    (ENG-26912, RT:46518, PS-41632, CSCvy74884)

  - xpath: XPath engine is now able to optimize queries on lists when the
    predicate is using varbinds.

    (ENG-26429)

  - xpath: The system failed to convert XPaths pointing to leaf-list entries
    with values containing whitespaces. For example, the XPath
    /leaf-list[.='foo bar'] has been updated to convert that XPath
    correctly, i.e /leaf-list{"foo bar"}, and not to an invalid leaf-list
    entry, i.e /leaf-list{foo, bar}.

    (ENG-26039, RT:45700, PS-40815, CSCvx84375)

  - xpath: Fixed an internal error when evaluating a XPath filter across a
    mounted-point.

    (ENG-26037, RT:45631, PS-40749, CSCvx84255, SR:691060045)

  - xpath: The XPath engine didn't respect "when" expressions when it was
    traversing the schema tree. This could lead to unnecessary read
    operations, with greater impact for users of external data providers.
    The XPath engine has been updated to evaluate "when" expressions before
    traversing subtrees to eliminate unnecessary calls to the data provider.

    (ENG-24568, RT:43311, PS-38427, CSCvv46804)

  - xpath: The performance of XPath queries was inadvertently reduced with
    the introduction of progress tracing in ENG-17693. The performance is
    now restored to the level before progress tracing was introduced.

    (ENG-24406, RT:42793, PS-37909, CSCvv44474)

  - xpath: Evaluating an XPath expression containing current() function on a
    leaf-list gave incorrect result, for example "current()[1] = 'value';".
    The system has been updated to give correct result when evaluating such
    XPath expressions.

    (ENG-22365, RT:39303, PS-34378, CSCvr72407)

NSO-5.5 [December 17, 2020]
===========================
Deprecated:

  - python-api: Python 3.5 has been deprecated and will be removed in NSO
    5.7. You should upgrade your Python environment and make sure everything
    works with Python 3.7 or higher.

    (ENG-24807)

Removals:

  - cluster: Removed the device cluster feature of NSO. Customers using
    conventional device cluster are encouraged to use LSA cluster instead.

    (ENG-22405)

  - python-api: Changed minimum supported Python version from 3.4 to 3.5.
    With this release Python 3.5 support is deprecated as no more Python 3.5
    releases will be made.

    (ENG-21624)

  - toolchain: The deprecated tailf:symlink statement has been removed.

    (ENG-24522)

Non-backwards compatible enhancements:

  - ncs: Encrypted strings that is of type
    tailf:aes-256-cfb-128-encrypted-string starting with "$", are now
    accepted as input.
    This reverts the earlier change that rejected such input, as this caused
    issues with how some devices handles strings.

    (ENG-24718)

  - ncs: The YANG types inet:ipv6-address, inet:ipv6-prefix and
    tailf:ipv6-address-and-prefix-length will render IPv4-mapped IPv6
    addresses in mixed notation - ie., ::ffff:102:304 will be rendered as
    ::ffff:1.2.3.4

    (ENG-24390, RT:42786, PS-37902, CSCvw28183, SR:689310215)

  - ncs: Make it possible to monitor all data underneath a service plan. For
    uses cases where some data should not be kicked on one has to now either
    create more explicit kickers or use the new functionality added in
    ENG-17135.

    (ENG-24247)

  - ncs: Add when statement to variables in the nano service behaviour tree
    to make it possible to have conditional variables that are only present
    if the boolean xpath expression in the when statement is satisfied.

    (ENG-23780)

  - ncs: NSO can now limit the number of concurrent sessions to a device
    and/or the number of concurrent connects and make operations wait if the
    maximum number of sessions/connects has been reached.
    The configuration for session limits can be found under
    /ncs:devices/global-settings/session-limits,
    /ncs:devices/profiles/profile/session-limits,
    /ncs:devices/device/session-limits for all devices, a group of devices
    and a specific device respectively.

    (ENG-3837, RT:40488, RT:37260, PS-35570, PS-32341)

  - cdb: When individual entries upgrade successfully, but results in an
    invalid list, all list entries will be deleted. This can happen, e.g.,
    when an upgrade removes a leaf from the key, resulting in several
    entries having the same key.

    (ENG-24495)

  - cdb: Loading of FXS files now detect duplicate modules sharing the same
    namespace and aborts loading. Loading consistency has been further
    improved by loading files within a single load directory in lexical
    order.

    (ENG-23989, RT:42289, RT:28070, PS-37388, PS-8946, CSCvu43088)

Non-backwards compatible corrections:

  - ncs: NSO will now be stricter in interpreting namespaces in its
    southbound NETCONF communication and treat elements that have no
    namespace as such. For example, in the following rpc-reply:
    <nc:rpc-reply xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
    message-id="X">
      <some-element/>
    </nc:rpc-reply>
    `some-element` will be interpreted as having no namespace. Previously it
    was assumed to be in the base NETCONF namespace, which is incorrect.

    (ENG-24182, RT:41430, PS-36503, CSCvu69000, SR:688537201)

  - ncs: Encrypted strings that are of types
    tailf:aes-256-cfb-128-encrypted-string,
    tailf:aes-cfb-128-encrypted-string and tailf:des3-cbc-encrypted-string
    starting with "$", are now accepted as input.
    This reverts the earlier change that rejected such input, as this caused
    issues with how some devices handles strings.

    (ENG-24075, RT:42704, PS-37820)

  - ha: Removed audit log entry for terminated sessions with system context.
    The log entry was added for sessions which exited without calling
    end_session.

    (ENG-24878, RT:43212, PS-38327, CSCvv99917)

  - json-rpc: Multiple calls, sent in an array to the JSON-RPC, are now made
    in the order they are written in the array (not in backward order). The
    change in behavior can be observed when creating new items last in an
    ordered-by user list, and in logs.

    (ENG-23763, RT:41885, PS-36979, CSCvu03471, SR:688938362)

  - nct: Some NCT commands returned exit code 0 even though an error
    occurred. The handling of return values for SSH commands was also
    inconsistent for different NCT commands. Now all NCT commands return a
    non-zero exit status if an error occurred, and for some NCT commands the
    return values have been changed to make the behavior more consistent
    throughout NCT.

    (ENG-24580)

  - rest-api: In certain circumstances the removal of indentation spaces
    were neglected. Now each increment of indentation spaces have a
    corresponding decrement.

    (ENG-25113)

  - restconf: In certain circumstances the removal of indentation spaces
    were neglected. Now each increment of indentation spaces have a
    corresponding decrement.

    (ENG-25115)

  - restconf: In certain circumstances it was possible that elements were
    dropped for the XML output format. Now elements are not dropped and are
    emitted as expected.

    (ENG-25112)

  - restconf: The RESTCONF server required identityref value and objectref
    value to be prefixed by namespace prefix in the request URI. That is not
    in compliant to section 3.5.3.1 of RFC8040. Now, the RESTCONF server has
    been updated to only accept identityref value and objectref value that
    prefixed by module name.

    (ENG-24274, RT:42632, PS-37748, CSCvu81052)

  - restconf: For streaming replies an error was added as part of the
    stream, resulting in a syntactically incorrect XML/JSON. Now if an error
    occurs the stream will be abruptly closed without sending any
    terminating empty chunk.

    (ENG-22683, RT:42457, RT:39778, PS-37569, PS-34854, CSCvs42623,
    SR:687934134)

  - restconf: A RESTCONF request missing the 'Host' header now responds with
    a 400 Bad Request, not an 500 Internal Server Error.

    (ENG-22349)

  - restconf: In certain circumstances it was possible that elements were
    dropped for the XML output format. Now elements are not dropped and are
    emitted as expected.

    (ENG-21816, RT:38276, PS-33345, SR:687136729)

  - toolchain: In order to comply with both RFC 6020 and RFC 7950, ncsc now
    returns an error instead of a warning if a constraint on a config true
    node contains an XPath expression that refers to a config false node.

    (ENG-24521)

  - toolchain: When confdc was called with --emit-mib without a --top
    argument it crashed, now the name of the module is used as the default
    value for top.

    (ENG-16794, RT:29700, RT:30171, PS-9688, PS-9920)

  - toolchain: A leaf with tailf:snmp-delete-value will have the range
    extended with that value conforming with the documentation.

    (ENG-16385, RT:28150, PS-8983)

  - toolchain: When converting an SNMP MIB with DEFVAL, the YANG model did
    not contain a corresponding default value. Some conversions are still
    not supported since YANG is more strict in types allowed.

    (ENG-16348, RT:21967, PS-7004)

  - web-server: Changed the type of /ncs-config/webui/transport/ssl/verify
    to uint32, that helped to avoid an internal error when starting NSO with
    that leaf configured.

    (ENG-22659, RT:39755, PS-34831, CSCvs14649, SR:687912543)

Enhancements:

  - ncs: Add all the commit parameters available in the service re-deploy
    action to the nano service force-back-track action, thus making it
    possible to use the action in a LSA setup.

    (ENG-24672, RT:43396, PS-38512)

  - ncs: New call get_trans_params() added in Maapi API for Java, Python and
    Erlang. This call is specific to NSO and makes it possible to get the
    commit parameters for a transaction.

    (ENG-24601, RT:41138, RT:43473, PS-36205, PS-38590, CSCvv53212)

  - ncs: When the commit queue is finished with a queue item it will now
    only re-deploy nano services and zombies that have been re-deployed
    while the queue item was in the queue. Previously the service/zombie
    would always be re-deployed which in certain cases could lead to
    infinite re-deploys of services if multiple instances of the same
    service changed the same data.

    (ENG-24527, RT:43006, PS-38120)

  - ncs: Trigger alarms when either the primary node or a secondary node
    goes down in a HA cluster.

    (ENG-24519)

  - ncs: Make it easier to work with LSA devices. The NED package of an LSA
    device can be of type lsa-netconf, when all the lower nodes has the same
    version as the upper node, or cisco-nso-nc-m.n when the versions differ.
    See the examples 22-lsa-single-version-deployment and
    28-lsa-multi-version-deployment which illustrates this.

    (ENG-24425)

  - ncs: Add new parameter in ncs.conf /ncs-config/python-vm/start-timeout
    that allows the startup timeout for Python VMs to be configurable.

    (ENG-24397, RT:42864, PS-37980, CSCvv19116)

  - ncs: The evaluation of 'when' expressions during the calculation of
    C-style configuration diffs (e.g. 'show configuration', 'commit
    out-format native' for CLI NEDs) has been optimized, which should result
    in a faster diff-calculation for some use-cases where the expression is
    independent of the context node.

    (ENG-24365, RT:42899, PS-38015, CSCvu96970, SR:689441701)

  - ncs: Non-atomic commit queue items can now execute for devices that has
    been processed or is unlocked ahead in the queue. Previously if the item
    had intersecting devices with atomic or locked items ahead in the queue
    it would not start executing.

    (ENG-24270, RT:42736, PS-37852, CSCvv44472)

  - ncs: CLI/generic NED live-status cache transaction is now created in the
    context of the user session reading the live-status data instead of a
    special system session. This means that it is closed as soon as the user
    session is closed, instead of by timeout.

    (ENG-24216, RT:42506, PS-37620)

  - ncs: Removed min-elements for device parameter in
    /devices/commit-queue/add-lock action. If no device is specified, all
    devices in NSO are locked.

    (ENG-24180)

  - ncs: NSO now by default uses as many threads as the system has logical
    processors to run hostname lookups on. The number of threads can be
    changed by the '--dns-resolvers' option to the ncs command.
    The timeout for resolving hostnames has been increased from 3 seconds to
    5.

    (ENG-24104, RT:42276, PS-37375, CSCvu59782, SR:687848937)

  - ncs: Added /devices/global-settings/lsa/no-overwrite parameter and the
    corresponding per-profile and per-device settings that allow to make a
    no-overwrite sync check towards LSA nodes.

    (ENG-24019, RT:41496, PS-36572)

  - ncs: Add documentation about updating Nano services and how different
    changes to a service are handled internally after a Nano service has
    been updated. Also add a new extension, deprecates-component, which
    handles the use-case where a component needs to be replaced with one or
    more other components in a new version of a Nano service.

    (ENG-24008)

  - ncs: Support for errors of type CONFD_ERRTYPE_NCS has been added to C
    API and to the Python API. This is a broad class of errors, ranging from
    authentication failures towards devices to case errors.

    (ENG-23846, RT:42024, PS-37122, SR:689005394)

  - ncs: FASTMAP services setting leaves of encrypted types
    (des3-cbc-encrypted-string, aes-cfb-128-encrypted-string,
    aes-256-cfb-128-encrypted-string) will now be in-sync and will not
    overwrite the encrypted value when the decrypted value hasn't changed.
    Note that the behavior with leafs of hashed types is unchanged.

    (ENG-23641, RT:41538, PS-36620)

  - ncs: NSO error log is now reopened on reception of reopen_logs command.

    (ENG-23441)

  - ncs: Make it possible to update the when timestamp for plan states in
    service callbacks.

    (ENG-23413, RT:41139, PS-36206, CSCvv44470)

  - ncs: Add a new statement, ncs:self-as-service-status, to nano service
    plan outlines that will automatically update the status of the self
    component when a service is converging or being deleted. When this
    feature is enabled and a service is converging the status of the self
    components ready state will never be set to reached until all other
    components in the plan are done (have had their ready states status set
    to reached). Likewise when deleting a service the self components init
    state will never have its status set to not-reached until all other
    components in the plan have been deleted.

    (ENG-23387)

  - ncs: NSO can now run with LSA NEDs compiled with ned-id lsa-netconf, all
    nodes has the same version, or with LSA NEDs dependent on
    cisco-nso-nc-X.Y when nodes has different versions.
    If the package cisco-nso-nc-X.Y is installed on the upper CFS node the
    ncs name space of the lower RFS node is visible.
    The example 22-layered-service-architecture has been renamed to
    22-lsa-single-version-deployment.
    A new example  28-lsa-multi-version-deployment has been added.

    (ENG-23239, RT:37127, PS-32209)

  - ncs: It is now possible to configure explicit source IP addresses for
    NETCONF call home and for NETCONF copy-config RPC leading to uploads of
    XML using ftp or sftp URL.
    These are all separately configurable:
    /ncs-config/netconf/capabilities/url/ftp/source-address
    /ncs-config/netconf/capabilities/url/sftp/source-address.
    /ncs-config/netconf/transport/ssh-call-home-source-address

    (ENG-21467, RT:37552, PS-32629)

  - ncs: The concept of trace id is introduced in NSO. Using trace id, one
    can correlate the intent with changes applied to the network even in an
    LSA cluster. A trace id can be passed as a commit parameter per
    northbound request. If none is given, NSO generates one. Trace id
    appears in the audit-network, northbound and device trace logs. It
    supports Fastmap, Reactive Fastmap, nano service, commit queue and LSA
    operations.
    For further details on how to configure and use trace id please refer to
    the "Trace ID" section in the NSO Admin Guide, under chapter "Monitoring
    NSO".

    (ENG-20889)

  - ncs: Add a filter to data kickers for excluding either configuration
    (config true) or operational data (config false) from triggering the
    kicker. When the filter is applied to a data kicker the changes
    underneath the monitored node will be filtered so that the excluded data
    will not trigger the kicker.

    (ENG-17135)

  - ncs: When the configuration file is reloaded, the changes that have
    taken place are logged to the daemon log.

    (ENG-16589)

  - cdb: Reduce the time it takes for NSO to reclaim memory after performing
    cdb-backup.

    (ENG-23633, RT:41573, PS-36658, CSCvt73379)

  - cli: Replace internal error with more specific and clear error message
    in the case of loading XML formatted config file containing invalid
    operation.

    (ENG-24841, RT:43875, PS-38980, CSCvv94739)

  - cli: The setting /ncs-config/cli/preserveSemicolon has been introduced
    to enable the ability to preserve semicolon as an ordinary char instead
    of using the semicolon as a keyword to separate CLI statements in the I-
    and C-style CLI.

    (ENG-23572)

  - cli: Performance has been improved when displaying J-style configuration
    diffs for those cases where the change set was small compared to the
    schema.

    (ENG-23135, RT:40536, PS-35615, CSCvs86383, SR:688304979)

  - cli: The CLI can perform filtering of data when displaying JSON-data
    output

    (ENG-22436, RT:41166, RT:39419, RT:41166, PS-36241, PS-34496, PS-36231,
    CSCvr84175)

  - cs_trans: A better garbage-collect change-set before validation phase.
    This helps NSO to not invoke validation on unchanged nodes.

    (ENG-23285, RT:40807, PS-35903, CSCvt08018)

  - documentation: python-api: Updated Python API documentation pages to a
    new format and corrected inconsistencies with actual Python code.

    (ENG-24865)

  - documentation: "The YANG Data Modeling Language" chapter has been added
    to the NSO Development guide. This chapter includes general information
    on the YANG modeling language and information on caveats using union
    together with NSO.

    (ENG-23923, RT:42145, PS-37246, CSCvu30511, SR:689022946)

  - java-api: The following methods have been added to
    com.tailf.maapi.Maapi:
    CLIAccounting
    CLICmdToPath
    CLIDiffCmd
    CLIPathCmd
    copyPath
    deleteAll
    disconnectSockets
    getAuthorizationInfo
    getUserSessionIdentification
    getUserSessionOpaque
    reopenLogs
    setNextUserSessionId
    validateToken
    The method Maapi.copy_tree has been deprecated. Use copyTree instead.

    (ENG-23653, RT:41655, PS-36741, CSCvt76465, SR:688483043)


  - json-rpc: get_leafref_values now takes in a 'starts_with' and a 'limit'
    parameter. 'starts_with' can be set to filter out values that do not
    start with a specific prefix. 'limit' can be set to limit the number of
    returned values.

    (ENG-24346)

  - json-rpc: The JSON-RPC method validate_trans and validate_commit now has
    an extra parameter when_error_mode:
      * Valid values: silent_delete, error
      * Default value: silent_delete
    When the parameter when_error_mode is set to error, the validation can
    fail if there is any configured node that has a when-expression
    evaluating to false, or if there is any configured node having a parent
    containing a when-expression evaluating to false.

    (ENG-23980, RT:42284, PS-37383, CSCvu40956, SR:688950166)

  - ned: NSO now considers junos-version field in the response of the
    get-software-version RPC when collecting platform-data for JunOS
    devices.

    (ENG-24411, RT:42727, PS-37843, CSCvv20181)

  - netconf: There is transaction id support for the native NETCONF/YANG
    interface to IOS-XR now and 'check-sync' action is supported for IOS-XR
    devices with Calvados.
    Note: this only works for the XR devices with
    http://cisco.com/ns/yang/Cisco-IOS-XR-config-cfgmgr-exec-oper revision
    2019-xx-xx or later.

    (ENG-24160)

  - netconf: Added experimental support for subscription to
    push-change-update notifications on operational datastore in YANG-Push
    (RFC 8641). Experimental means that some of the newly added API, code
    and behaviour may change in the future. For detailed information see
    relevant sections in NSO Northbound APIs.

    (ENG-23018)

  - python-api: New functions in the Python API, _ncs.cdb.cs_node_cd() and
    _ncs.maapi.cs_node_cd() that provide mount point safe versions of the
    _ncs.cs_node_cd() function.

    (ENG-24266, RT:42714, PS-37830, CSCvu80609)

  - restconf: The configuration option "keepalive" has been added to webui
    transports. This, in conjunction with configuration of the TCP keep
    alive feature of the OS, allows CLOSE_WAIT connections to be detected
    and removed by the OS.

    (ENG-24011, RT:43256, RT:42283, PS-38372, PS-37382, CSCvu46989,
    SR:689141769)

  - restconf: Added /ncs-config/restconf/show-hidden (default: false).
    Setting this to 'true' unhides hidden nodes accessed via RESTCONF.

    (ENG-18844, RT:33373, RT:38583, PS-28824, PS-33655)

  - toolchain: The VERSION file of the installer now contains the BUILD ID
    which the build was built with.

    (ENG-24747)

  - toolchain: The NSO release's VERSION file now shows what SSL, Python,
    and glibc versions were used for the build.

    (ENG-24251)

  - webui-one: Add loader for webui-packages on application hub to indicate
    that the page is not done yet.

    (ENG-25157)

  - webui-one: The service-point selector in the ServiceManager will now
    show the entire path of the service-point, instead of only the
    identifier. This should make it easier to select the correct
    service-point when the identifier is not unique.

    (ENG-24500)

  - webui-one: Instead of combining the key values of a service under the
    name column, it is now a separate column for each key.

    (ENG-24415)

  - webui-one: The commit manager now shows commit status information after
    a commit has been performed.

    (ENG-24220, RT:40394, RT:43725, PS-35475, PS-38842)

  - webui-one: The alarm manager now supports filtering with device. The
    alarm symbol in device manager is now linked to alarm manager with the
    specific device filter activated.

    (ENG-24124)

  - webui-one: List all alarms in Dashboard by default.

    (ENG-24062)

  - webui-one: The commit manager now displays rollback id after a commit
    has been successfully performed. The id can be used to do selective
    rollback later.

    (ENG-23924)

  - webui-one: In the webui service manager, it is now possible to
    instantiate a service that belongs to a service-point that is modelled
    in a nested list.

    (ENG-23828)

  - webui-one: Add styling to plans in zombie-lists to be more distinct that
    the plan is back-tracking.

    (ENG-23428)

Corrections:

  - ncs: Progress trace event types in NETCONF and RESTCONF APIs has been
    corrected.

    (ENG-25328)

  - ncs: NSO no longer gives an error saying that the node is in read-only
    mode for actions below
    /devices/device/netconf-notifications/subscription when node has been
    set back to read-write mode.

    (ENG-25298, RT:44523, PS-39634, CSCvw68082, SR:690385685)

  - ncs: Fix an issue where taking device locks might result in an internal
    error and zombies getting stuck.

    (ENG-25290)

  - ncs: NSO now handle revisions correctly when copying the running config
    from the device.

    (ENG-25277)

  - ncs: The /scheduler/task/local-user leaf is now only removed when the
    task itself is removed from the scheduler. Previously it could end up
    being removed if the task was created by a service instance and this
    service instance was later modified.

    (ENG-25265, RT:44502, PS-39611, CSCvw62220)

  - ncs: /devices/device/load-native-config action now doesn't give an
    internal error when loading configuration for Juniper Junos devices.

    (ENG-25252, RT:44455, PS-39562, CSCvw60028, SR:690265812)

  - ncs: Stop progress events are now outputted when validation fails for a
    transaction.

    (ENG-25233)

  - ncs: Progress trace spans without matching stop events have been fixed.

    (ENG-25172)

  - ncs: NSO now outputs the correct device phase in the progress trace when
    the configuration for the device is reverted.

    (ENG-25150)

  - ncs: When updating read/write timeouts for a device make ensure that
    they are used immediately and that a reconnect of the device is not
    required to activate them.

    (ENG-25148)

  - ncs: Atomic commit queue items with transient devices are now marked as
    failed when the retry attempts are exhausted. Previously this didn't
    happen if the transient error was that the connection was refused.

    (ENG-25144, RT:44299, PS-39405, CSCvw44238)

  - ncs: NSO now always writes the received NETCONF notification to the
    /devices/device/netconf-notifications/received-notifications/notifications
    list (unless max-size is set to 0 or
    /devices/device/netconf-notifications/store-in-cdb is set to false). If
    multiple subscriptions was configured for a device and these streams had
    different timezones in their event time, notifications could end up not
    being written when the max number of received notifications had been
    reached.

    (ENG-25130, RT:44269, PS-39375, CSCvw40410)

  - ncs: Fix an issue where the component properties where not part of the
    delete post action input if the component was deleted in the same
    transaction as the post action was added to the side effect queue.

    (ENG-25088, RT:44216, PS-39322, CSCvw33379)

  - ncs: NSO does no longer allocate large amounts of memory for NETCONF
    subscriptions whenever there are changes to the notification kickers.
    Previously NSO built-up long internal message queues that was not
    handled before notifications was received from the device.

    (ENG-25074, RT:44205, PS-39311, CSCvw30035)

  - ncs: Calling the maapi function Maapi.rollbackConfig() will now get
    configuration data using tailf:alt-name extension if it is present.

    (ENG-25066, RT:44184, PS-39290, CSCvw28398, SR:690146886)

  - ncs: NSO does no longer send a diff to generic NEDs when there is only
    service meta-data changed. This was previously not true for service
    meta-data changes below a list instance.

    (ENG-25065, RT:42963, PS-38078, CSCvw28233, SR:689469331)

  - ncs: Fix an issue where multiple Nano service instances can not be
    deleted in the same commit if they have overlapping changes and the
    commit queue is used.

    (ENG-24916, RT:43006, PS-38120)

  - ncs: Corrected handling of closing connections towards NSO when service
    code was being run.

    (ENG-24913, RT:43807, RT:44619, PS-38915, PS-39730, CSCvw05649,
    SR:689956116)

  - ncs: The template engine now verifies every namespace against the
    advertised capabilities of a device. Before only namespaces on top-tags
    were verified.

    (ENG-24904, RT:43147, PS-38261)

  - ncs: in rare cases NSO could get stuck on startup when the notification
    replay store only consisted of two files and one was empty (without
    header).

    (ENG-24879, RT:44270, RT:43926, RT:42636, PS-39376, PS-39032, PS-37752,
    CSCvw00534)

  - ncs: NSO no longer gives an error if a device is deleted in HA none
    state (unless the device is in the commit queue).

    (ENG-24864)

  - ncs: NSO does no longer hang intermittently at the end of the
    /devices/device/migrate action.

    (ENG-24857)

  - ncs: Fixed a crash that occurred when deleting a list entry where the
    key was of type identityref.

    (ENG-24851, RT:43898, PS-39004, CSCvv95859, SR:689887682)

  - ncs: Make external authentication work in the commit queue by picking up
    the external groups for the user that triggered the commit and reusing
    them when handling the queue item in the commit queue.

    (ENG-24812, RT:43780, PS-38888, CSCvv93044, SR:689943670)

  - ncs: NSO no longer tries to reconnect transient devices in the commit
    queue during shutdown, package reload or when the node is set to
    read-only mode.

    (ENG-24774)

  - ncs: Fix an issue with the commit queue rollback-on-error error option
    and empty reverse diffsets where a failed queue item would create a lock
    on the commit queue that had to be manually removed. If there is no
    reverse diffset that needs to be rolled back when a queue item fails, no
    lock will be created since no rollback will have to be done.

    (ENG-24769, RT:43199, PS-38314, CSCvv84033, SR:689550568)

  - ncs: NSO now deletes a stacked service when it is first modified but
    later deleted in FASTMAP. Previously NSO has either tried to run the
    create code of the deleted service or raised an error saying the service
    is not deployed.

    (ENG-24750, RT:43587, PS-38704, CSCvw54957, SR:689748557)

  - ncs: Unable to load xml file with LSA config which affects the ncs
    namespace on the lower, RFS node.

    (ENG-24746, RT:43690, PS-38807)

  - ncs: Actions on services on the upper node in an LSA cluster propagated
    to the lower nodes. This correction makes services on different nodes in
    an LSA cluster behave as stacked services. Thus service actions like
    'reactive-re-deploy', 're-deploy shallow' and 'touch' will only affect
    the service which is the target for the action and will not propagate to
    the lower node.

    (ENG-24743, RT:43698, PS-38815, CSCvv80002)

  - ncs: Initial validation of a must expression depending on a leaf with
    its default value in effect residing under a newly created instance
    would fail. This issue was caused by the new list filter feature
    introduced in NSO 5.1.

    (ENG-24705, RT:43670, PS-38787, CSCvv74316)

  - ncs: Creating several subscriptions after each other with 'replay'
    enabled could cause a deadlock. The critical section is now removed by
    refactoring and the deadlock cannot occur.

    (ENG-24693, RT:43410, PS-38526, CSCvv71073, SR:689726811)

  - ncs: NSO stops when loading template using if-ned-id/else and there is
    an error in the else part and there is no ned-id for that else part.

    (ENG-24688, RT:43418, PS-38534, CSCvv70598, SR:689646687)

  - ncs: Updated maximum depth for structure used in navigating instance
    data from 16 to 60. This is the length of a path used to access data in
    the configuration tree. The symptom of this was that service-meta-data
    like reference counters and backpointer lists were not updated
    correctly.

    (ENG-24604, RT:43454, RT:43582, PS-38571, PS-38699, CSCvv53359,
    SR:689743851)

  - ncs: Schema changes involving leaves with default values will now be
    migrated correctly when doing a NED migration with 'no-networking'.
    Previously, it was possible for a leaf to be set in CDB without a value
    which could result in errors when displaying the data.
    NSO no longer leaves stale data for lists/leaf-lists directly below
    /devices/device/config when migrating NED versions.

    (ENG-24586, RT:43377, PS-38493, CSCvv50395, SR:689704709)

  - ncs: Transaction abort now revert changes toward NED devices correctly.
    NSO previously closed an internal transaction prematurely causing the
    abort to fail when calculating the reverse diff to send to the device.

    (ENG-24581, RT:43364, PS-38480, CSCvv49845)

  - ncs: Clients were unable to start new transactions when the transaction
    id limit INT32_MAX (2147483647) had been reached. Now ConfD will restart
    with the lowest free number.

    (ENG-24557, RT:42991, PS-38105, CSCvv44589)

  - ncs: NSO no longer crashes when '/' is used in a dependency path or
    keypath for a policy script.

    (ENG-24543, RT:42986, PS-38100, CSCvv41837, SR:689411186)

  - ncs: NSO no longer disconnects the device if a service instance
    augmented below /devices/device change.

    (ENG-24526, RT:43340, PS-38456, CSCvv38256)

  - ncs: NED migrations involving a union of a union no longer results in an
    internal error.

    (ENG-24491, RT:43223, PS-38338, CSCvv26524, SR:689602154)

  - ncs: NSO now pushes device configuration through the commit queue
    correctly after device migration. An error had been introduced where the
    new ned-id was not set in the snapshot database.

    (ENG-24489, RT:43235, RT:43330, PS-38351, PS-38446, CSCvv25785,
    SR:689623865)

  - ncs: Support setting the instance-identifier node pointing to a
    leaf-list entry as defined in Section 9.13.4, RFC 7950.

    (ENG-24485, RT:43356, RT:43552, RT:43185, PS-38472, PS-38669, PS-38300,
    CSCvv24960)

  - ncs: Using nano-services with commit queues sometimes led to user
    sessions not being cleaned up - ie., user sessions created during the
    commit were never closed.

    (ENG-24476, RT:43202, PS-38317, CSCvv22866, CSCvv22867)

  - ncs: Correction for the 'compress' action on a single alarm.

    (ENG-24475, RT:43206, PS-38321, CSCvv22573)

  - ncs: Make it possible to migrate an LSA device from lsa-netconf to
    cisco-nso-nc-m.n and any other combination of LSA ned-ids.

    (ENG-24448)

  - ncs: Ordered-by user lists with some CLI extensions (like
    'cli-compact-syntax') were not handled correctly in commit no-overwrite.

    (ENG-24445, RT:43001, PS-38115)

  - ncs: When a nano service is performing staged deletes and fails in the
    commit queue as part of the commit queue error recovery the device
    configs failed to push to the devices need to be pushed again using the
    load-device-config action under
    /zombies/service/commit-queue/queue-item/failed-device. This action
    failed to load the device config into an open transaction if the device
    config contained multiple top tags. This has been fixed, the action can
    load device configs with multiple top tags.
    The device config saved by the commit queue under
    commit-queue/queue-item/failed-device/config-data is now a proper XML
    document.

    (ENG-24436, RT:43079, PS-38193, CSCvv12847)

  - ncs: Fix an issue were a delete post action re-deploying the zombie of a
    service would hang NSO and make it impossible to backtrack the zombie
    completely.

    (ENG-24404, RT:42647, PS-37763, CSCvv05167)

  - ncs: A sync problem has been fixed where the commit queue would receive
    queue item notifications from lower LSA nodes sooner than expected,
    resulting in that the upper queue item would get stuck.

    (ENG-24389)

  - ncs: Nano service actions where not invoked on lower RFS node when they
    were invoked on the upper CFS node.

    (ENG-24388, RT:42729, PS-37845, CSCvv02801)

  - ncs: Certain directories under a package, like src, test, doc etc., are
    skipped when expanding the tarball into NSO's state directory. If some
    file in the package was a symlink pointing into one of those
    directories, it would lead to a 'dangling' symlink in the state
    directory, and the package loading would fail. This has been fixed.

    (ENG-24377, RT:42922, RT:43367, PS-38038, PS-38483, CSCvv00121,
    SR:689448487)

  - ncs: The 'sync-to action' has been changed to update the transaction ID
    for CLI- or generic-device even when no last-transaction-id value is
    stored. For example an initial sync of  a new device.

    (ENG-24359, RT:42833, PS-37949, CSCvu95443)

  - ncs: When migrating from pre-CDM versions (4.7.x) to CDM (5.x.x),
    instance-identifiers outside the /devices/device tree, whose values
    crossed a mount-point (/devices/device/config, for example) were not
    migrated properly, resulting in those nodes being deleted after the CDB
    upgrade.

    (ENG-24330, RT:42783, PS-37899, CSCvu90505, SR:689386516)

  - ncs: Fix an issue with generating SNMP notifications from alarms when
    the managed object is more than 255 characters long.

    (ENG-24304, RT:42719, PS-37835, CSCvu84132, SR:689290603)

  - ncs: When commit queue is enabled and the retry-attempts were set to
    greater than 0 and a commit failed due to transient errors no commit
    queue alarms were raised. Now in case of commit failure, regardless of
    the value of the retry-attempts, a commit-through-queue-failed alarm is
    raised.

    (ENG-24273, RT:42735, PS-37851, CSCvv09008)

  - ncs: The failed leaf and data written below the 'error-info' container
    in the plan data can now be monitored by a kicker.

    (ENG-24269, RT:42732, PS-37848, CSCvv02822)

  - ncs: Increased possible output size for all external AAA programs;
    externalauth, externalvalidation and externalchallenge.
    The old limit was 4000 bytes, the new limit is 16000 bytes.

    (ENG-24257, RT:42650, PS-37766, CSCvu79807, SR:689299770)

  - ncs: Fix an issue where nano service zombies would stall in certain
    situations due to the precondition being satisfied in between the
    evaluation of the precondition and the creation of the kicker.

    (ENG-24246, RT:43946, RT:42906, RT:43445, PS-39052, PS-38022, PS-38562)

  - ncs: NSO now responds with an error instead of an 'in-sync' result
    whenever the service 'deep-check-sync' action fails to acquire the
    device lock.
    The 'wait-for-lock' grouping has been added to the 'deep-check-sync'
    action input.

    (ENG-24213, RT:42577, PS-37689, CSCvu82752)

  - ncs: Fixed a bug regarding ordered-by user lists and commit
    no-overwrite, where the result of applying a transaction would vary
    depending on the order of operations in the transaction.

    (ENG-24207, RT:42446, PS-37558, CSCvu73971, SR:689119062)

  - ncs: Enabling NED trace for a CLI or generic device does no longer
    affect the performance of other CLI/generic devices.
    When copying the running config from the device (for CLI/generic), the
    resulting transaction aren't printed in the trace if
    /devices/device/config is empty or if it is part of a NED migration. If
    the transaction is printed, leafs of crypto type are masked in the
    trace.

    (ENG-24197, RT:42463, PS-37576, CSCvu70777, SR:689117277)

  - ncs: The length of the allowed XML processing instructions can now be
    configured via /confdConfig/parserLimits/maxProcessingInstructionLength.
    The default length is 32kB.

    (ENG-24192, RT:43023, RT:43089, RT:42731, RT:42871, PS-38137, PS-38203,
    PS-37847, PS-37987)

  - ncs: NSO no longer gives an internal error when doing a live status call
    for a leaf-list on a southbound-locked device.

    (ENG-24174)

  - ncs: Syslog messages are now truncated to 16384 bytes (max size of
    syslog messages over TCP)

    (ENG-24109, RT:42130, PS-37232, CSCvu60254)

  - ncs: NSO no longer print progress trace events in the CLI when an action
    is interrupted.

    (ENG-24042)

  - ncs: The upper node in LSA cluster will no longer try to delete the
    re-deploy-counter of a service on the lower node. This used to be the
    case in some scenarios when the service was re-deployed or modified on
    the upper node, which was incorrect and could lead to nodes being
    out-of-sync unless the out-of-sync-commit-behaviour setting was set to
    accept on the upper node.

    (ENG-23997, RT:41496, PS-36572)

  - ncs: NEDs get the connect, read and write timeout values towards devices
    as a 32-bit integer from NSO. These values were capped at 2147483
    milliseconds. It has now been changed to 2147470000 milliseconds, much
    closer to Integer.MAX_VALUE in Java.

    (ENG-23994, RT:42253, PS-37350, CSCvu44019)

  - ncs: Previously, the "software packages fetch" action would verify that
    the tarball file name meets certain naming conventions and matches the
    metadata in package-meta-data.xml. In order to give more flexibility in
    file naming, this check has been removed. At the same time, NED package
    file names are still recommended to follow the naming conventions, so
    the corresponding description is added to the document.

    (ENG-23984, RT:37289, PS-32370, CSCvu41909)

  - ncs: Using Maapi.applyTransParams in any API keeps the transaction open
    when keepOpen=true parameter is passed in a scenario when this API call
    is executed on a transaction with empty changeset (for example a dry-run
    output returned empty). This was not the case due to a bug, namely the
    transaction would be closed.

    (ENG-23972, RT:42178, PS-37274, CSCvu39823, SR:689101789)

  - ncs: Make it possible to do services commit-dry-run on an empty
    transaction

    (ENG-23920, RT:43523, PS-38640, CSCvu30323, SR:689101789)

  - ncs: Committing a transaction that created a new leaf-list element along
    with other changes using the no-overwrite flag resulted in out-of-sync
    error, even if the device was actually in sync. This has been fixed.

    (ENG-23680, None, PS-36797, CSCvt85838, SR:688786937)

  - ncs: During the commit phase, the changeset of the transaction is sent
    to all other transactions with the same datastore to check for write
    conflicts. NSO previously did this in a synchronous manner. If any of
    the other transactions was stuck in a long running process, like the
    pre-lock-create service callback or loading config from a device, the
    transaction holding the lock would have to wait the entire duration of
    that process before releasing the lock, thus decreasing the overall
    throughput of the system.

    (ENG-23469)

  - ncs: NSO now disables NETCONF notifications for a device during NED
    migration and reconnects them automatically afterwards. Previously the
    subscription had to be reconnected after the migration to work
    correctly.
    NSO now deletes all received NETCONF notifications for a device when the
    device is migrated to a new NED id.

    (ENG-23127)

  - ncs: If a set hook was invoked from an action that was attached to an
    existing transaction, the hook would fail. Now the set hook works as
    expected.

    (ENG-22995, RT:43261, RT:40219, RT:40305, PS-38377, PS-35298, PS-35385,
    SR:688122264)

  - ncs: The algorithm that generates unique integer values for YANG
    identifiers has been modified to generate a different value for
    "lldp-remote-chassis-id-subtype" and "graceful-restart-restart-time" to
    avoid conflicts.

    (ENG-22304, RT:39292, PS-34367)

  - ncs: The requirement for NSO to disconnect a device when a setting below
    /devices/device has changed is now more fine grained. The device session
    is only disconnected when it is absolutely required to do so and never
    in a dry-run transaction.

    (ENG-20289, RT:35817, PS-30894, CSCvq42059)

  - aaa: Corrected MAAPI save-config to only need read access right.
    The MAAPI_CONFIG_READ_WRITE_ACCESS_ONLY bit flag has been introduced for
    backwards compatible.

    (ENG-24105, RT:42466, PS-37579, CSCvu59830)

  - aaa: If there existed two NACM delete rules with the same path, where
    the first rule had a 'permit' action and the second rule had a 'deny'
    action; the result was wrongly: deny.

    (ENG-23883, RT:43213, RT:42033, PS-38328, PS-37133, CSCvu23903)

  - aaa: Corrected MAAPI save-config to only need read access right.
    The MAAPI_CONFIG_READ_WRITE_ACCESS_ONLY bit flag has been introduced for
    backwards compatible.

    (ENG-20498, RT:36177, PS-31255)

  - cdb: Corrected the order of list entries in pre_commit_running datastore
    when there are modifying- and deleting list entries and the list is
    ordered-by-user.

    (ENG-25035, RT:44153, PS-39257, CSCvw25262)

  - cdb: ncs --cdb-debug-dump in XML format no longer generate invalid
    output for nodes after a leaf-list where the nodes after was output in
    the parent container.

    (ENG-24680, RT:43524, PS-38641, CSCvv68589)

  - cdb: cdb_vget_values() updated to not return default values for leaves
    under previously inactive cases.

    (ENG-24576, RT:43353, PS-38469, CSCvv48363)

  - cdb: During a schema upgrade transaction, if there is also a NSO upgrade
    from a version lower than 5.1 to a version equal to or higher than 5.1,
    using the CDB API to read from the database with the old schema could
    cause a EOF error to be returned and the relevant socket to be closed.
    The problem was due to a non-backward compatible change introduced on
    when-statement internal encoding. Now the old encoding is handled
    correctly.

    (ENG-24478, RT:43186, RT:43125, PS-38301, PS-38239, CSCvv23169)

  - cdb: Erroneously calling next_index() on a node which is not of type
    list or leaf-list caused NSO to close the connection to the client.
    Now NSO will return the error "next_index() not allowed on given node
    type" and keep the connection intact.

    (ENG-24460, RT:43125, PS-38239, CSCvv17280, CSCvv23168)

  - cdb: The protocol operation <kill-session> now waits for transactions
    and candidate commit to finish before returning success. If clean up
    takes more than 4 seconds an error will be returned and clean up
    continue in the background. Before this change <kill-session> could
    return ok before resources had been cleaned up which in turn could lead
    to errors on following requests.

    (ENG-24429, RT:43076, PS-38190, CSCvv12194)

  - cdb: Extra protection is introduced to protect database from corruption
    when tailf:cdb-oper erroneously is used under a non-persistent node.

    (ENG-24421)

  - cdb: Corrected an upgrade scenario when NSO allowed mandatory choice
    without any child node to be committed.
    The upgrade transaction now fails and reports missing mandatory choice.

    (ENG-24301, RT:42756, PS-37872, CSCvu83990)

  - cdb: Operational database is no longer deleted at start-up in case the
    file is considered to be corrupted.

    (ENG-24201, RT:42526, PS-37640, CSCvu71984)

  - cdb: cdb_get_modifications() could crash when run on secondary nodes due
    to missing changeset details from the primary node. Secondary nodes now
    operate on a separate transaction based on the changes.

    (ENG-24157, RT:42557, PS-37671, CSCvu66121)

  - cdb: The upgrade transaction has been updated with delayed_when mode.
    This means all when-expressions are treated as evaluating to true and
    NSO evaluates all when-expressions once entering phase1.

    (ENG-24119, RT:42458, PS-37570, CSCvu61240, SR:689183100)

  - cdb: NSO migration from 4.4 or older to 4.7 or newer now handles enum
    value changes in leaf-lists.

    (ENG-23853, RT:41919, PS-37014, CSCvu19427)

  - cdb: A list containing several keys could lose instances at an upgrade
    if the key order was changed. Fix now asserts no instances are lost
    during upgrade.

    (ENG-18879, RT:33448, PS-28898)

  - cli: Actions with input parameters that are lists with sibling leaves
    will now prioritize TAB-completion to the key-leaf prior to any other
    leaves.

    (ENG-25207, RT:43855, PS-38960, CSCvw53629, SR:689920040)

  - cli: A system message is designed to be delayed until the user
    terminates any ongoing command. If NSO receives too many system messages
    during an ongoing command, the corresponding CLI process may choke and
    slow down throughput which, in turn, causes memory to grow over time. A
    system message is now sent to the corresponding CLI process only if
    there are less than 1000 unacknowledged system messages in the queue.
    The message is discarded otherwise. If the system relies on messages
    still being delivered,  then priority messages might be a more suitable
    solution.

    (ENG-25064, RT:43385, PS-38501, CSCvw28108)

  - cli: Executing command "show | compare" on a leaf-list in Juniper style
    caused an internal error.

    (ENG-24736, RT:39702, RT:43618, PS-34777, PS-38735, CSCvv78649)

  - cli: Having multiple target-trigger sub-statements (such as
    tailf:cli-when-target-set) in a single diff-dependency from the
    tailf:cli-diff-after/tailf:cli-diff-before group of diff-dependencies
    would cause all but one of the target-triggers to be disregarded during
    the calculation of C-style configuration diffs.

    (ENG-24627, RT:43518, PS-38635, CSCvv58132)

  - cli: Executing "show" command caused an internal error when it was piped
    to "context-match" command.

    (ENG-24624, RT:43749, RT:43448, PS-38866, PS-38565, CSCvv57705)

  - cli: The /confdConf/cli/completionShowMax setting limits how many values
    that are displayed at completion of leaf-refs. Unfortunately it did also
    limit which values that were allowed to be set when prompted for a
    value, but it is now corrected.

    (ENG-24517, RT:43017, PS-38131, CSCvv33661, SR:689316157)

  - cli: When deleting siblings of an empty leaf with extension
    'tailf:cli-hide-in-submode' under a parent list node with extensions
    'tailf:cli-sequence-commands' and 'tailf:cli-incomplete-command', the
    empty leaf did not appear with the list key.

    (ENG-24515, RT:43160, PS-38274, CSCvv33620, SR:689544716)

  - cli: When the CLI is using its auto-wizard and starts prompting for
    input the input value was not always logged in the audit-log. If it was
    logged it was not always suppressing the value in case it should have.
    Now we assert values are suppressed and identifying where the CLI was
    missing out on producing audit-log entries.

    (ENG-24509, RT:43273, PS-38389, CSCvv31098)

  - cli: Looking at the 'commit dry-run' output after changing case from a
    container with 'tailf:cli-add-mode' annotation, would incorrectly list
    the container as deleted. This is incorrect and now only the new case is
    shown.

    (ENG-24455, RT:43067, PS-38181, CSCvv16433, SR:689467291)

  - cli: When CLI calculated diff configuration, it wrongly emitted deletion
    commands towards unmodified sibling data nodes before it created the new
    data node in the case that the parent was a non-flat mode-less presence
    container.

    (ENG-24444, RT:42005, PS-37105)

  - cli: Running a filtering show command would not display any matches if
    the filter contained a wildcard as part of the key value and the key was
    of the type identityref.

    (ENG-24387, RT:42669, PS-37785, CSCvv02126)

  - cli: tab-completing a path for the C-style 'no' command, where path
    contained a wildcard and one of the children to the current node was a
    leaf named 'enable', would in some cases cause an internal error.

    (ENG-24326, RT:42823, PS-37939, CSCvu89180)

  - cli: The C-style operational command 'show running-config' where the
    show filter consisted of multi-level nested lists (where each list had
    multiple keys) would not produce the correct result if the filter
    contained partial keys at the beginning of the the filter.

    (ENG-24306, RT:40748, PS-35844, CSCvu84795)

  - cli: When an incomplete CLI command invoked an action, the action input
    parameter would invoke an external data provider with an invalid path
    which resulted in an internal error.

    (ENG-24283)

  - cli: When using the J-Style CLI and tab-completing a delete command on a
    leaf node the CLI would also present the leaf value which wasn't
    necessary for performing the delete. This has been fixed by not
    including the leaf value for the delete command tab-completion.

    (ENG-24200, RT:42435, PS-37545, CSCvu71247)

  - cli: Fixed an internal error when using 'load override' XML file on a
    subtree containing operational nodes.

    (ENG-24198)

  - cli: The order of show configuration output was wrong when list key has
    'tailf:cli-diff-delete-before' extension. The first list entry has
    correct order but it is out of order from the second list entry.

    (ENG-24175, RT:42573, PS-37685, CSCvu68072)

  - cli: Show configuration of a leaf named 'enabled' used a semicolon
    instead of a colon as separator which would result in syntax error when
    restoring the saved configuration.

    (ENG-24142, RT:41998, PS-37096, CSCvu64260)

  - cli: Combining NACM restriction rules on a callpoint could result in an
    internal error and crash inside the CLI when using the describe command.
    This has been fixed by displaying the "Access denied" information for
    appropriate data node.

    (ENG-24108, RT:42469, PS-37582, CSCvu60209)

  - cli: Running a filtering 'show' command where the path was to a list and
    the filter was a presence container, the command would display the
    entire contents in the instances matching the filter instead of only
    displaying the contents in the presence container for each matching
    instance.

    (ENG-24099, RT:42455, RT:40489, PS-37567, PS-35571, CSCvu58287)

  - cli: Show configuration data caused internal error when it was piped to
    "context-match" command.

    (ENG-24032, RT:42404, PS-37514, CSCvu49840)

  - cli: Show configuration data on a leaf named 'enabled' caused internal
    error when it pipes to "display set" command.

    (ENG-24010, RT:42382, PS-37492, CSCvu46853)

  - cli: When filtering data for XML output in the CLI the displayed data
    would not show in case 'tailf:display-when' extension was active. This
    extension should not be applicable when doing this and the fix concerns
    ignoring the extension in case XML output is used.

    (ENG-23995, RT:42315, PS-37414, CSCvu44437)

  - cli: Show configuration data with 'tailf:cli-diff-dependency' on a
    denied node by NACM rule caused internal error.

    (ENG-23767, RT:41911, PS-37005, CSCvu04053)

  - cli: Completion could miss certain values when combining leaf-list and
    leafrefs.

    (ENG-23582, RT:41978, RT:42931, RT:38951, PS-37075, PS-38047, PS-34023,
    CSCvt63567, SR:687494628)

  - cli: When traversing command line to execute, the candidate remapped
    with prefix was matched even when it was not required. This resulted in
    that CLI enters wrong command tree and configures wrong data node.

    (ENG-23495, RT:41329, PS-36397, CSCvt43289)

  - cli: When using range expressions and empty leafs the CLI could
    automatically try and create these leafs if they had the
    'tailf:cli-drop-node-name' extension set. This has been fixed by
    verifying that possible data nodes candidates are filtered by checking
    if the extensions were actually present.

    (ENG-23365)

  - cli: Mixing empty leafs and containers with the same name as other nodes
    tailf:alt-name extension could make the CLI confused about which data
    node to prioritize. Fixed by filtering out nodes with proper naming
    ahead of tailf:alt-names.

    (ENG-23218)

  - cli: The list instance with child nodes was not copied to the target
    when executing command 'copy cfg' to copy a configuration subtree.

    (ENG-22843, RT:40056, PS-35135, CSCvs43609, SR:688001297)

  - cli: When combining 'tailf:non-strict-leafref' extension with typedef
    unions the CLI would sometimes fail to evaluate the correct data type
    which could result in the wrong data being presented during
    TAB-completion and other scenarios. This has been fixed by checking if
    this is 'tailf:non-strict-leafref' and then getting the real type def.

    (ENG-22455, RT:39463, RT:41368, PS-34541, PS-36437, CSCvr87410,
    SR:687640782)

  - cli: A glitch could occur in the CLI when filtering display of JSON data
    in combination with empty containers. The fix ensures that empty
    containers are not emitted when displaying JSON data

    (ENG-16559, RT:29736, PS-9706)

  - cs_trans: Fixed an internal error when invoke an action containing at
    least one mandatory typeless action param.

    (ENG-25099, RT:44267, PS-39373, CSCvw35967)

  - cs_trans: Default leafs under a default case is re-validated when
    implicitly setting the default case by deleting the current case.

    (ENG-24855)

  - cs_trans: When committing through the commit queue, NSO now populates
    the snapshot database (when /ncs-config/cdb/snapshot/pre-populate is set
    to false) correctly for nested choice statements.

    (ENG-24737)

  - cs_trans: A service modification failing during validation could cause
    information loss in the change-set. This would lead to inconsistent
    result when executing the commit a second time. The change-set is now
    kept intact after a validation failure.

    (ENG-24430, RT:43070, PS-38184, CSCvv12271, SR:689537473)

  - cs_trans: When validation points were used when 'candidate' and
    'writable-through-candidate' were enabled, edit-config of leafrefs could
    fail with rpc-error bad-keyref. This now works as expected.

    (ENG-24428, RT:42744, PS-37860)

  - cs_trans: The transaction engine crashed if there is transaction
    conflict where the first transaction was modifying children of an
    instance, while the second transaction set attribute on that instance
    and committed.
    The transaction engine has been updated to handle those cases.

    (ENG-24255, RT:42427, RT:42942, RT:42439, RT:42362, RT:42480, PS-37537,
    PS-38058, PS-37549, PS-37471, PS-37593, CSCvu79152)

  - cs_trans: Corrected the delete behaviour for CLI and JSON-RPC.
      * Taken read access into consideration.
      * Fixed wrong delete result when delete empty list node.
      * Fixed wrong delete result when deny-delete node has been removed
    implicitly by when-expression effect.

    (ENG-24238, RT:42535, PS-37649, CSCvu77202)

  - cs_trans: maapi_exists() could return incorrect result on leafs with a
    default value in an explicitly set case. The optimization responsible
    causing this behavior is no longer used for default leafs not yet set.

    (ENG-24164, RT:43885, RT:42313, PS-38991, PS-37412)

  - cs_trans: Fixed bad query result when using maapi_exists() on a
    mandatory node with when-false. The transaction engine has been updated
    to evaluate the when-expression on mandatory nodes for the correct
    result.

    (ENG-23896, RT:42313, RT:42135, RT:43885, PS-37412, PS-37237, PS-38991,
    CSCvu25221)

  - cs_trans: Deleting augmented configuration under a case could cause an
    internal error to occur.

    (ENG-23826, RT:42017, PS-37115, CSCvu14159)

  - cs_trans: A node with multiple when-expressions inside a list with fewer
    when-expressions could lead to internal error when touching a dependent
    node.

    (ENG-23810, RT:41850, PS-36944, CSCvu10824)

  - cs_trans: Fix an issue where the system wrongly invoked non-writable
    nodes during a case switch.

    (ENG-23808, RT:41422, PS-36494, CSCvu10462)

  - cs_trans: move/copy/rename APIs did only affect config-true data and
    config-false data was not considered. Now both config-true and
    config-false data are considered and handled properly when performing
    operations move/copy/rename.

    (ENG-23165, RT:40606, PS-35686, CSCvt37902)

  - cs_trans: Fixed an issue, when a previously active case becomes
    inactive, delete notifications would be present for default leafs under
    all cases. This would only happen for a persisted nested choice. Now
    delete notifications will only be present for default leafs under the
    previously active case.

    (ENG-22559, RT:39616, RT:41483, PS-34692, PS-36558, CSCvs02190)

  - cs_trans: If there is a non-empty list having a min-element under an
    active case of choice, and a switch to another case takes place, then
    min-element violation can be reported on that list node. Now no
    violation is reported for such deselected case of a choice.

    (ENG-21759, RT:38126, PS-33201, CSCvq56433, SR:687080950)

  - cs_trans: Transactions that started on Primary no longer are allowed to
    commit during transition from role Primary to None. Extra measures are
    introduced to ensure that it will not happen on transition from
    None/Primary to Secondary, even if the transition has failed and node
    was left in state None.

    (ENG-21160, RT:37046, PS-32127)

  - cs_trans: Recreating configuration that includes nodes with default
    values inside default cases caused NSO to send faulty delete operations
    for the default nodes to the devices. Such nodes are now excluded from
    the configuration sent to the devices.

    (ENG-16442, RT:29558, PS-9618)

  - documentation: Corrected documentation regarding context node for
    'selector-expr' in notification kickers.

    (ENG-25097, RT:44235, PS-39341, CSCvw35542)

  - documentation: Added missing revision update regarding
    tailf-cli-extensions.yang

    (ENG-24400, RT:42943, PS-38059, CSCvv04892)

  - documentation: Corrected documentation for Python API functions
    _ncs.maapi.save_config() and _ncs.maapi.load_config().

    (ENG-24037, RT:42085, PS-37187, CSCvu50479)

  - documentation: Correct syslog support in NSO Administration Guide.

    (ENG-22480, RT:39367, PS-34444, CSCvr90909, SR:687567096)

  - documentation: Update documentation of maapi_cli_prompt_oneof() with
    mention of pressing enter key without entering any value will return the
    empty string.

    (ENG-22187, RT:38955, PS-34027, CSCvr38469)

  - erlang-api: Erlang embedded application's .app file change was ignored
    after 'confd --reload'. Now those files are considered properly.

    (ENG-24102)

  - java-api: The method maapi.applyTransParams wrapped all Exceptions, such
    that the top level exception was a MaapiException with message "bad
    server response". Now, the Exception is not wrapped if it is already a
    MaapiException.

    (ENG-24717, RT:43281, PS-38397, CSCvv75033, SR:689412305)

  - java-api: Fixed toString() method for ConfIPv6, ConfIPv6Prefix and
    ConfIPv6AndPrefixLen as well as the constructor for
    ConfIPv6Prefix(InetAddress, int) and ConfIPv6AndPrefixLen(InetAddress,
    int) when representing IPv4-mapped IPv6 address.

    (ENG-24621, RT:43501, PS-38618, CSCvv57060, SR:689765500)

  - java-api: Values larger than Long.MAX_VALUE (2^63-1) for type uint64
    were not handled correctly in ConfXMLParam.

    (ENG-24030, RT:42278, PS-37377, CSCvu49628, SR:689091924)

  - json-rpc: Leafrefs pointing to other leafrefs in augmented namespaces
    now works.

    (ENG-24090, RT:42408, PS-37518, CSCvu57645, SR:689024696)

  - json-rpc: The JSON-RPC will no longer time out (idle) while processing a
    request, instead the idle timer will be restarted when the reply is
    returned.

    (ENG-23681, RT:41475, PS-36550, CSCvt86043, SR:688638500)

  - json-rpc: Calling the JSON-RPC methods get_trans_changes or
    get_trans_conflicts with an action transaction handle will no longer
    cause an internal error.

    (ENG-22537)

  - nct: Some failures for the NCT "load_config" command returned exit code
    0, indicating no failure. Now all failures will lead to a non-zero exit
    code being returned.

    (ENG-21712, RT:37969, PS-33044, CSCvq41514, SR:686980762)

  - ned: When a NED restarted due to errors the file descriptors of the NED
    trace files were not closed. This issue has been fixed now.

    (ENG-24374, RT:42893, PS-38009, CSCvu99913, SR:689184198)

  - netconf: When using a NETCONF subtree filter based on a model unknown to
    the NETCONF server, unnecessary resources (memory/processing) was
    allocated. With this fix, such subtree filters are simply ignored.

    (ENG-25267)

  - netconf: Corrected NETCONF reply message to NETCONF client, and
    corrected NETCONF write message in NETCONF trace log, when fetching
    query data that containing ampersand (&) or left angle bracket (<)
    characters.

    (ENG-24322, RT:42788, PS-37904, CSCvu87919, SR:689378595)

  - netconf: The capability with-rollback-id did not apply to the RPC
    copy-config when using inline configuration or URLs. Specifying
    with-rollback-id in a copy-config RPC now include the generated rollback
    id in the response.

    (ENG-24206)

  - netconf: When an rpc had an access failure it did lead to the reuse of
    an internal transaction, and the subsequent rpc:s resulted in the same
    access failure. The correction assert a new transaction to be used, so
    the subsequent rpc now reply with its proper result.

    (ENG-23890, RT:44035, RT:42089, PS-39139, PS-37191, CSCvu24233)

  - netconf: When opening an SSH listening socket for NETCONF or CLI over
    SSH the VRF parameter was not taken into account properly. Now this is
    fixed. Note that starting from NSO 5.4/ConfD 7.4 the underlying SSH
    implementation was changed, so this ticket is only partially applicable.

    (ENG-23658)

  - netconf: Corrected delete so that it does not delete nodes with
    augmented child nodes that cannot be deleted because of access rights.

    (ENG-23481, RT:41277, PS-36343, CSCvt39680)

  - netconf: If multiple NETCONF notification subscriptions are configured
    for a device, received notifications that arrive simultaneously are now
    guaranteed to be written even if they have the same event time.

    (ENG-23083, RT:40375, PS-35455, CSCvs77611, SR:688048793)

  - netconf: When using an XPath filter in a NETCONF 'get' or 'get-config'
    request, the response has been improved to not contain lists with no
    instances. Previously, in some cases, list names would be included in
    the NETCONF response even though the list had no instances.

    (ENG-22625)

  - netconf: Notification netconf-config-change was incorrectly sent to
    subscribers of stream NETCONF when 'config false' data were updated. Now
    only 'config true' data triggers sending of such notification.

    (ENG-22450, RT:39421, PS-34498, CSCvr86681)

  - netconf: When using netconf-subsystem, parsing large "TCP header"
    packets could fail and return <!-- Error: Bad TCP header -->. Large "TCP
    header" packets are now handled robustly and work correctly.

    (ENG-22050, RT:38749, PS-33822, CSCvr13208)

  - netconf: If a leaf-list was deleted, the operation reported to the
    client was erroneously set to 'replace'. The operation is now correctly
    reported as 'delete' to the client.

    (ENG-21993, RT:38670, PS-33742, CSCvr04240)

  - netconf: Removed extra key leaf in <get> request when NSO getting
    operational list entry data from remote NETCONF device.

    (ENG-21611, RT:37724, PS-32800, CSCvq15513, SR:686617075)

  - python-api: Python 3.9 no longer exports PyObject PyIOBase_Type, because
    of this _ncs could not be imported. Now _ncs.init no longer check that
    the "file" argument is of type io.IOBase.

    (ENG-25176)

  - python-api: Fixed memory corruption issues in the DP API.

    (ENG-24907)

  - python-api: If a Python application throws an exception in the setup
    method the teardown will now be called to do any cleanup that is
    necessary for the application.

    (ENG-24883, RT:43707, PS-38824, CSCvw00989)

  - python-api: Actions implemented using ncs.dp.Action failed to execute
    when they were called by notification kickers. These actions now use a
    new transaction to read information about the action being invoked, if
    reading using the provided transaction fails.

    (ENG-24325, RT:42561, PS-37675, CSCvu89029)

  - python-api: _ncs.maapi.cli_prompt() now return the value input by the
    end user instead of always returning None.

    (ENG-24004, RT:42303, PS-37402, CSCvu45765)

  - python-api: ncs.template.Variables now detect duplicate keys when using
    non-string objects as keys.

    (ENG-23917, RT:41942, PS-37037, CSCvu30018, SR:688943173)

  - python-api: Correct a bug where calling _ncs.cdb.diff_iterate() after
    moving an element in ordered-by user list with a key consisting of
    multiple leafs, the new position in the list only included the first
    leaf of the key. Now the new position is returned as a list including
    all leaf values of the key.

    (ENG-22754, RT:39821, PS-34898, CSCvs27802)

  - restconf: NSO did not close the user session properly when it received a
    request containing bad 'Accept' header. Now it closes the user session
    in such a scenario.

    (ENG-24871, RT:43895, PS-39001, CSCvv99636, SR:689725163)

  - restconf: Reinstating the offset and limit query parameters. The
    'offset' query parameter can be used by the client to specify the number
    of list elements to skip before returning the requested set of list
    entries. The 'limit' query parameter can be used by the client to
    specify a limited set of list entries to
    be retrieved.

    (ENG-24511)

  - restconf: For a top-empty leaf, the wrong namespace was generated in the
    XML output.

    (ENG-24386, RT:42972, PS-38087, CSCvv02124, SR:689483955)

  - restconf: There were situations where RESTCONF queries containing fields
    and depth would result in bad JSON.

    (ENG-24364, RT:42903, PS-38019, CSCvu96965)

  - restconf: 'Internal error' was returned for an invalid JSON action POST
    request. Now 'Syntax error' is returned.

    (ENG-21659, RT:37820, PS-32893)

  - restconf: Conforming the handling of the query parameter 'fields' with
    RESTCONF RFC 8040. In order to build a proper path, the full node set
    needs to be supplied using the path and the "fields" query parameter.

    (ENG-20806, RT:43482, RT:36604, PS-38599, PS-31684, CSCvo74470)

  - snmp-agent: If developer-log-level was set to "trace" and an attempt was
    made to send an SNMP notification without a name and snmpTrapOID
    properly set among the varbinds, the attempt would fail silently. Now,
    sending a notification in this manner will succeed.

    (ENG-20191, RT:35564, RT:35790, PS-30639, PS-30867)

  - snmp-agent: The --fail-on-warnings flag added to the --mib2yang calls.

    (ENG-16790, RT:25631, PS-25568)

  - toolchain: ncsc silently ignored tailf:annotate-module targeting an
    unknown module; it displays a warning now.

    (ENG-24873)

  - toolchain: Fixed a bug in yanger fxs plugin that emitted wrong hash tags
    for augmented notification nodes and caused failures during cdb
    upgrades.

    (ENG-24418)

  - toolchain: Fix yanger to run post expand hooks for leafref nodes even if
    the node is defined in a submodule when compiling a YANG version 1.1
    module.

    (ENG-24068, RT:42423, PS-37533, CSCvu54591)

  - toolchain: Fixed a yanger fxs plugin bug that affected handling of when
    statements with a nested deref() function in the XPath argument.

    (ENG-23921, RT:42191, PS-37287, CSCvu30360)

  - toolchain: ncsc did not handle max-status correctly when pruning
    augmented data models. This has been fixed.

    (ENG-23809, RT:41989, PS-37087, CSCvu10712)

  - toolchain: Fixed ncsc so that it reports the proper error message when a
    leafref points to another leafref that has an invalid path.

    (ENG-23621, RT:41596, PS-36682, CSCvt70535)

  - toolchain: For really large YANG models, the Yanger-Swagger plugin
    failed to produce any JSON output due to memory exhaustion. Now handling
    large YANG modules is vastly improved.
    Additionally, a fix was made to handle included YANG submodules so that
    the correct module prefix is now used in the generated HTTP request
    paths.

    (ENG-22380, RT:44114, RT:39278, RT:43366, PS-39219, PS-34353, PS-38482,
    CSCvr74402)

  - toolchain: When loading a YANG file, NSO failed to validate an annotated
    node that was implemented by a subagent due to a missing flag. The
    required flag is now set during the compilation.

    (ENG-18900, RT:32982, PS-28633)

  - web-server: ENG-24577 introduced an issue, where URLs containing a
    query-string would return "405 Not Allowed" because of a strict match
    against static files. The query-string will now be ignored and only the
    location part of the URL will be used to find matching files.

    (ENG-24626)

  - web-server: When uploading via an HTTP POST to a CGI script, where the
    client either terminated prematurely or was stuck, the CGI script was
    not terminated. Now, the pipe toward the CGI script will be closed
    making it possible for the CGI script to terminate properly.

    (ENG-23765, RT:41482, PS-36557, CSCvu03764)

  - webui-one: When navigating to the commit manager with an error in the
    transaction, it would be impossible to view the commit queue because the
    error tab would always be reselected when clicking on the commit queue
    tab.
    To prevent this problem the error tab will only be automatically
    selected once.

    (ENG-25109)

  - webui-one: Show errors inline in the configuration editor, this prevent
    the render of partially loaded schemas.

    (ENG-25030)

  - webui-one: A transaction containing errors can now be committed from the
    webui by checking the "Ignore errors" checkbox in the commit dialog.

    (ENG-24965, RT:43509, PS-38626, CSCvw15526, SR:689755800)

  - webui-one: The webui will now prevent an action from running if the
    parameters do not pass validation.

    (ENG-24799, RT:43843, PS-38948, CSCvv90264)

  - webui-one: The python-uninitialized state was missing in the
    package-view. After a package reload python packages will now have the
    correct message Python uninitialized until they are initialized again.

    (ENG-24558)

  - webui-one: The webui-one service manager is now able to handle service
    instances that belongs to a service point that are nested in a list.

    (ENG-24328, RT:42630, PS-37746, CSCvu89777, SR:689280302)

  - webui-one: Choosing a case on a choice inside an action using JSON-RPC
    that already has a selected case, will now correctly activate the new
    case.

    (ENG-24181, RT:42534, PS-37648, CSCvu68992, SR:689043253)

  - webui-one: Leaf-lists showed all entries on the initial render instead
    of using the proper pagination length of five.

    (ENG-24134)

  - webui-one: Use correct list keys when mapping data for new list entries.

    (ENG-24121)

  - webui-one: Fix action input keep params option, it should not be
    rendered when all children are hidden by unsatisfied when statements.

    (ENG-24057)

  - webui-one: Added a loader when packages are being reloaded from the root
    of the Configuration editor.

    (ENG-24055)

  - webui-one: Added a loader when creating a device in the Device manager.

    (ENG-24049)

  - webui-one: The create button on presence containers in an action will
    now only be visible when the container has not been created.

    (ENG-22592)

  - webui-one: Action input widgets in the webui will now render dirty
    indicators when changed.

    (ENG-22523)

  - webui-one: Creating a list item in an action, using the same keys as an
    already existing list item, will now show an error message.

    (ENG-22522)

  - xpath: Prevent circular dependency when clearing delayed_when flag if
    using 'tailf:override-auto-dependencies' to force a when-expression to
    depends on itself. Introduced XPath cache for get_delem() and exists()
    callbacks at validation phase.

    (ENG-24755, RT:43496, PS-38613, CSCvv81733)

  - xpath: When an imported prefix is used in a top-level 'tailf:annotate'
    together with 'tailf:annotate-module' in the same annotation module, a
    circular dependency error is reported. In this case, the annotation
    module needs to be split up into two modules, one module for
    'tailf:annotate' and another for 'tailf:annotate-module'. Prior to this
    change, annotation imports were wrongly updated with target modules from
    'tailf:annotate'. Annotation imports are now populated with modules only
    from 'tailf:annotate-module'.

    (ENG-24588, RT:43441, PS-38557, CSCvv50480)

  - xpath: Corrected XPath count() on leaf-list to prefer using
    num_instances() callback.

    (ENG-24498, RT:43133, PS-38247, CSCvv28437)

  - xpath: Corrected an issue when using XPath last() on list/leaf-list
    under mounted point returned incorrect value.

    (ENG-23794)

NSO-5.4 [June 26, 2020]
=======================
Deprecated:

  - ncs: Revision compilation is deprecated as of NSO 5.4 and will be
    removed in NSO 5.6. Handling of different versions of NEDs (YANG-models)
    have been improved in 5.1 with the introduction of CDM (Common Data
    Models).

    (ENG-23288)

  - cli: /ncs-config/cli/commit-retry-timeout has been deprecated and will
    be removed in NSO-5.6. Use /ncs-config/commit-retry-timeout instead to
    control this behavior consistently for all northbound interfaces.

    (ENG-21263, RT:37093, PS-32175, None)

  - cluster: Deprecate the device cluster feature of NSO. The feature will
    be removed in NSO 5.5 release. Customers using conventional device
    cluster are encouraged to use LSA cluster instead.

    (ENG-21955)

  - ncs: Certain operations can be made to run in a backwards compatibility
    mode, making them behave as before, i.e., handling leaf-lists as single
    elements. The flags for controlling this behaviour are deprecated,
    and will be removed in NSO-5.5.
    For the iteration functions in the CDB and MAAPI APIs, the flag
    ITER_WANT_LEAF_LIST_AS_LEAF can be used to get the old behaviour, see
    the confd_lib_cdb(3) and confd_lib_maapi(3) manual pages.
    For data providers, the flag CONFD_DAEMON_FLAG_LEAF_LIST_AS_LEAF can be
    used to get the old behaviour, see the confd_lib_dp(3) manual page.

    (ENG-15312)

  - python-api: Python 3.4 has been deprecated and will be removed in NSO
    5.5. You should upgrade your Python environment and make sure everything
    works with Python 3.5 or higher.

    (ENG-22280)

Removals:

  - python-api: It is no longer possible to use Python 2.7 with NSO. As a
    bare minimum Python 3.4 must be used, but we strongly advice to use at
    least Python 3.5.

    (ENG-22284)

  - rest-api: The REST API has been removed.
    NOTE: When upgrading, any 'rest' specific configuration in the
    ncs.conf file has to be removed.

    (ENG-20522)

Non-backwards compatible enhancements:

  - ncs: The NSO build toolchain is being modernized. This impacts the
    oldest version of glibc which is supported for use on Linux.
    NSO now requires glibc-2.16 or higher on Linux.

    (ENG-22666)

  - ncs: The /ncs-config/aaa/rest container in ncs.conf is renamed to
    /ncs-config/aaa/restconf.

    (ENG-24069)

  - ncs: The diffie-hellman-group1-sha1 algorithm is no longer possible to
    configure in /ncs-config/ssh/algorithms/kex. The algorithm uses a
    1024-bit MODP group and was removed since this algorithm is not
    considered secure. See draft-ietf-curdle-ssh-kex-sha2-10 for more info.

    (ENG-23764, RT:41249, PS-36315, CSCvu03693, SR:688495265)

  - ncs: NSO now fails to connect to a device that announced yang-library
    version 1.0 or 1.1, but NSO could not get the corresponding information
    from the device. The error message in such case is more specific.
    Previously NSO would ignore the fact that we could not fetch the
    yang-library data from the device announcing this capability which could
    result in that we ignore parts of data model the device intended to
    announce.

    (ENG-23525, RT:41298, PS-36365, CSCvt66285)

  - ncs: Add a new tag ncs:force-commit to trigger a commit in between two
    states in a nano service component.

    (ENG-23460)

  - ncs: Deleting the external plan of a nano service is delayed until all
    staged deletes have been performed, it is synchronized with the commit
    queue.
    The commit queue recognizes nano service related changes and include the
    service reference in the queue-item service related fields.
    If a commit queue item fails the related nano service is shown in the
    commit queue alarm under
    /alarms/alarm-list/alarm/commit-through-queue-failed/impacted-objects.
    Learn more about how to use Nano services with Commit queue enabled
    under the Nano Services/Nano Services and Commit Queue section in the
    Development Guide.

    (ENG-23409, RT:41135, PS-36202, CSCvt31155)

  - ncs: Deleting a nano service is never immediate, when a nano service is
    deleted the service will always become a zombie.
    Nano services and commit queue are aware of each other and work together
    nicely. Nano services monitor the commit queue to avoid doing
    unnecessary progression and increase level of automation. Learn more
    about how to use Nano services with commit queue enabled under the Nano
    Services/Nano Services and Commit Queue section in the Development
    Guide.

    (ENG-23098)

  - ncs: Introduce a new 'sync' statement for nano service post actions
    which specifies that a post action should be run synchronously. The new
    statement ensures that any states following the state with the
    synchronous post action will not be run until the post action has been
    run successfully.

    (ENG-22835)

  - ncs: Moved /scheduler/task/history to
    /scheduler/task/history/history-entry and made it persistent.
    Added /scheduler/task/history/history-entry/action-node leaf.
    Added /scheduler/task/history/history-entry/ha-node-id leaf.
    Added /scheduler/task/history/max-size leaf.
    Added /scheduler/task/history/purge action.
    Made /scheduler/suspended leaf into an internal callpoint.
    Renamed /scheduler/task/is-running leaf to running and made it into an
    internal callpoint.
    Removed must expression from /scheduler/task/time leaf making it
    possible to run one-off tasks on a slave node.
    The type of 'next-run-time' leaf in /scheduler/task/get-next-run-times
    action has changed from string to yang:date-and-time.

    (ENG-22385, RT:39368, PS-34445)

  - ncs: When YANG modules for a NED are compiled with ncsc, the compiler
    now requires all dependant YANG modules for the device to be present in
    the given directory.
    The way YANG modules for a lower NSO in an LSA setup are compiled has
    been changed.  The old flags '--lsa', '--lsa-upper' and '--lsa-lower'
    have been removed from ncs-make-package.  A new flag
    '--lsa-lower-ncs-version' has been added to complement
    '--lsa-netconf-ned'.  It is used when the lower NSO runs a different
    version of NSO than the upper NSO.
    See the "NSO Layered Services Architecture" guide for details.

    (ENG-22227)

  - ncs: Now NSO is always using the SMP (Symmetric Multiprocessing) VM. The
    non-SMP emulator does not exist anymore. The default is still to use as
    many threads as the system has logical processors. This can be limited
    by the ncs -smp option.
    Support for TLS 1.3 has been added.

    (ENG-21704)

  - cli: The combination of tailf:cli-prefix-key and
    tailf:cli-hide-in-submode extensions on a leaf now causes a warning from
    the YANG compiler (or an error, if --fail-on-warnings or -E options are
    given to the compiler).

    (ENG-21876)

Non-backwards compatible corrections:

  - ncs: An identityref that has the same namespace with context namespace
    will be encoded without prefix.

    (ENG-24116)

  - ncs: The previous lsa-common/tailf-nso-nc-m.n package has been replaced
    by a package with a new name: cisco-nso-nc-m.n
    The former packages lsa-common/tailf-nso-nc-m.n will not work in ncs-5.4
    and later.

    (ENG-23732)

  - ncs: It was discovered that the yang data type inet:ip-address from
    ietf-inet-types yang module could translate ipv6-data that wasn't using
    a 'zone index' into data that would do so. This has been changed so the
    input results in the same output. Also a restriction against usage of
    'zone index' for ipv6 for the yang data type  inet:ip-address; has been
    added. This already existed for the data type inet:ipv6-address.
    See here for more info about the <zone id> part:
    https://tools.ietf.org/html/rfc4007#section-11.2

    (ENG-23497, RT:40757, PS-35853, CSCvt43666)

  - ncs: NSO no longer triggers FASTMAP service if there was *only* changes
    in operational (config false) data under the service subtree. The
    service will still trigger if there was configurational (config true)
    nodes changed in its subtree. Previously the services would be triggered
    on operational (config false) changes in the service subtree, which is
    incorrect.

    (ENG-23195)

  - ncs: It is no longer possible to disable attributes support for NSO in
    ncs.conf as they are essential for the normal operation. This means that
    <enable-attributes> configuration option in ncs.conf is no longer
    accepted and must be removed.

    (ENG-22826)

  - ncs: Removed option 'always' in /ncs-config/aaa/audit-user-name.

    (ENG-22598)

  - ncs: Upon reading a service plan on lower NSO LSA node from an upper LSA
    node could result in error messages such as "ncs:self is not a valid
    value". Any YANG data node should now be accessible from an upper LSA
    node. However the LSA NED may need to be recompiled.

    (ENG-21195, RT:42108, RT:37127, PS-37210, PS-32209, CSCvp62361)

  - ncs: The tailf:cli-hide-in-submode extension can no longer be used on
    mandatory leaf nodes that are of type empty.

    (ENG-19664, RT:34831, PS-29899, SR:684983271)

  - ncs: A 'load override' with an input that in effect deleted
    configuration the user was not allowed to delete, was incorrectly
    allowed. Now the complete changes are checked against the NACM rules
    before it is applied and refused if the rules deny it.

    (ENG-18119, RT:32287, RT:38940, RT:27938, PS-28069, PS-34012, PS-8900)

  - aaa: * SSH servers now use OTP 22 SSH and new Crypto library from OTP 22
    * SSH rekeying interval option is not supported, we agreed to keep the
    default values as they are looking good
    * We now have support for multi factor authentication for the CLI over
    SSH. This is implemented via the 'keyboard-interactive' SSH mode
    * SSH identification string has changed to the default in OTP SSH server
    identification "SSH-2.0-Erlang/4.9"

    (ENG-23548)

  - c-api: Maapi.loadConfigCmds API call now respects chroot parameter (fmt
    + arguments) when loading configuration in XML or JSON format.

    (ENG-22804, RT:39935, PS-35013, CSCvs36210)

  - cli: Internal data structures used by differ engine have been modified
    to allow for better handling of cases when a config line should be
    modified after it is inserted into diff (e.g. during
    tailf:cli-no-value-on-delete extension processing).

    (ENG-22773, RT:38941, PS-34013)

  - cli: Performing a delete you can get now a warning if some element
    required to be removed is not available anymore. Or an error if the only
    element to be removed is not available.

    (ENG-17835, RT:31821, PS-27752)

  - cs_trans: The transaction engine has been updated to handle conflict
    scenarios better. For example, if a transaction was modifying children
    of an instance and another transaction deleted the same instance and
    committed, the first transaction did not handle the conflict correctly
    which would lead to invalid data in CDB if the transaction
    was committed.

    (ENG-22841, RT:39559, PS-34635, CSCvs43530)

  - json-rpc: Multiple calls, sent in an array to the JSONRPC, are now made
    in the order they are written in the array (not in backward order). The
    change in behaviour can be observed when creating new items last in an
    ordered-by user list, and in logs.

    (ENG-23763, RT:41885, PS-36979, CSCvu03471, SR:688938362)

  - json-rpc: The server can now limit the size of unauthenticated messages
    accepted over JSON-RPC. The parameter
    '/ncs-config/webui/transport/unauthenticated-message-limit' can be the
    number of bytes to allow or to 'nolimit'. The default is 65535. This
    changes the previous behaviour which can be restored using 'nolimit'.

    (ENG-22499, RT:39551, PS-34627, CSCvr95022)

  - netconf: NETCONF now limits the accepted XML processing instruction
    target length.

    (ENG-22472, RT:39480, PS-34558, CSCvr89757)

  - netconf: If a deny-create rule exists on a leaf in a list, a create on
    the list instance is now denied if it would cause a create on that leaf.
    This also applies if the deny-create was set on a leaf-list.

    (ENG-20419, RT:41594, RT:38940, RT:30335, RT:34670, RT:35946, PS-36679,
    PS-34012, PS-10000, PS-29736, PS-31024)

  - restconf: RESTCONF error data was not according to RFC. XML
    instance-identifiers was formatted with module prefix instead of xmlns +
    prefix. JSON output did not include module prefix on top level elements.

    (ENG-23652)

  - restconf: Check the complete changeset against the NACM rules before
    applying an operation. This fix also takes care of a problem with the
    USER variable in NACM rules, for example in denying delete of the user
    used in a request.

    (ENG-18530, RT:32902, RT:34280, PS-28483, PS-29374)

  - toolchain: The 'default' keyword on leaf-list was incorrectly allowed in
    YANG 1.0 files, and YANG 1.1 files only allowed a single default value
    to be refined. Using refine to set a default value in a YANG 1.0 file
    now generates an error message.

    (ENG-22570, RT:39598, PS-34674, CSCvs03576, SR:687854008)

  - toolchain: ncsc now correctly handles the grammar for the 'deviate'
    statement.  Specifically, it now rejects attempts to deviate delete
    'mandatory', 'min-elements' and 'max-elements'.

    (ENG-21093, RT:36922, PS-32004)

Enhancements:

  - ncs: Improved a transaction's commit phase, by caching the last
    transaction in memory

    (ENG-23857)

  - ncs: When compiling a yang model with a nano service where the base
    identity for a component type or a state name is incorrect the compiler
    will emit a warning.

    (ENG-23721)

  - ncs: ncs-make-package now generates Makefiles which compiles YANG with
    the option --fail-on-warnings. The generated packages should serve as a
    good example how Makefiles ought to be written.
    For legacy usage of ncs-make-package has a new option
    --no-fail-on-warnings.
    A new option --lsa-lower-ncs <dir> has been added. An upper node needs
    to have its own packages compiled for the lower node's ncs namespace if
    the lower node runs a different version than the upper node.
    Period is now accepted as a valid character in package names. In Java
    packages the period character is replaced with underscore.

    (ENG-23702)

  - ncs: Added option --fail-on-warnings to ncs-compile-bundle

    (ENG-23700)

  - ncs: The internal runtime representation of some data structures widely
    used throughout the system, including transactions, has been modified to
    consume less memory. The actual improvement depends on the number of
    data models loaded. Apart from a memory reduction, especially noticeable
    with many concurrent transactions, it also leads to a general
    performance improvement in certain parts of the system.

    (ENG-23639)

  - ncs: NSO now takes less time to stop (noticeable when idle).

    (ENG-23597)

  - ncs: NSO now prune devices automatically from the commit queue when they
    are deleted. Devices can be pruned automatically if they belong to a
    non-atomic queue item or if all devices in the item are pruned.
    Otherwise an error will be returned and no items changed.
    NSO now returns an error if an queue item cannot be pruned, deleted or
    the atomic behaviour changed.
    An atomic queue item can now be pruned if all devices in it are pruned.

    (ENG-23487)

  - ncs: The leaves under /ncs-config/ssh/algorithms used to have an empty
    default value, meaning enable all supported algorithms. The default
    values are now specified to the recommended values which the user can
    override by either explicitly configure all supported algorithms or
    (continue to) set the leaves to an empty value. See the ncs.conf(5) man
    page for more info.

    (ENG-23480, RT:41249, PS-36315, CSCvt39691, SR:688495265)

  - ncs: Improve error messages returned by NETCONF NED builder actions.

    (ENG-23424)

  - ncs: General performance improvement for the commit queue, especially
    noticeable when adding new queue items in rapid succession.

    (ENG-23374, None, PS-35820)

  - ncs: Add a new leaf plan-location to the service-data grouping which
    will return the location of the plan for a service instance.

    (ENG-23327)

  - ncs: NSO does no longer require all affected services to be re-deployed
    after a NED migration before removing the old NED package.

    (ENG-23172, RT:40465, PS-35547, SR:688252357)

  - ncs: NSO now supports the concept of supported-ned-ids to allow packages
    with templates to be loaded in environments with different set of NEDs
    than the reference environment. For more information see NSO Development
    Guide > Templates > Service and API Templates in multi-NED environment

    (ENG-23086)

  - ncs: Add WEBUI_LOG notifications as NOTIF_WEBUI to the C API, Java API,
    Python API, and Erlang API.

    (ENG-23072)

  - ncs: Add the apply-template to the /devices container to make it
    possible to apply a template to multiple devices.

    (ENG-22980)

  - ncs: Added support to override Java log file name and location by
    configuring /ncs-config/java-vm/stdout-capture in ncs.conf.

    (ENG-22923, RT:40239, PS-35318, CSCvs72087, SR:688094624)

  - ncs: Keep failed side effects in the side effect queue for a
    configurable amount of time instead of just leaving the last failed side
    effect in the queue and add an action to purge all failed side effects
    from the queue.

    (ENG-22837)

  - ncs: Add a new sort of trigger, trigger-on-delete, to nano service
    preconditions which makes it possible to have preconditions checking if
    one or more nodes have been deleted. Previously this could only be done
    by monitoring a parent node, which in many cases is rather expensive if
    the parent node is a list with many elements in it. With the new trigger
    the precondition only has to monitor the actual node, or nodes, that
    should be deleted.

    (ENG-22834)

  - ncs: If an empty transaction is applied, NSO no longer executes the
    validation phase for this transaction.

    (ENG-22792)

  - ncs: The format of configurable progress traces (CSV and log), progress
    trace through the CLI and devel.log as well as the notification API has
    changed. Also the notifications API (NOTIF_COMMIT_PROGRESS
    and NOTIF_PROGRESS stream) now exports all the fields present in the
    progress trace CSV file and the /progress/trace/event list.
    A field, 'annotation', giving metadata about the event (indicating
    error, explaining latency, shows result etc.) and a field 'datastore'
    have been added.

    While XPath tracing has been removed from progress verbosity level debug
    as a default it is now optional to include (as well as kicker and
    subscriber debug tracing) when configuring progress traces under
    /progress/trace.
    The devel.log now logs progress trace event for verbosity level normal
    when set at level info. At level trace, progress trace events for
    verbosity level debug are emitted.
    API methods are added for C, Java and Python to log progress spans
    (events with a duration) from user code.

    (ENG-22758, RT:36798, PS-31879)

  - ncs: Add a new event for nano service zombie deletion to the progress
    trace.

    (ENG-22744)

  - ncs: Optimized transaction performance when configuring a large set of
    kickers.

    (ENG-22668)

  - ncs: NSO implements the origin metadata annotation feature defined in
    RFC 8342 Network Management Datastore Architecture (NMDA). The feature
    marks all configuration nodes in operational with the new attribute
    "origin". Both NETCONF and RESTCONF protocol implementations are
    extended to support the origin feature as defined in RFC 8526 and RFC
    8527 respectively.
    The NETCONF origin-filter and negated-origin-filter parameters can be
    passed down to data provider as a list filter expression.

    For better performance, following new replies that contain value with
    attributes are implemented for the callbacks below.
    - get_elem: confd_data_reply_value_with_attrs()
    - get_next: confd_data_reply_next_key_with_attrs()
    - get_object: confd_data_reply_tag_value_attrs_array()
    - get_next_object: confd_data_reply_next_object_tag_value_attrs_array(
    - get_next_object (multiple objects):
    confd_data_reply_next_object_tag_value_attrs_arrays()
    The attributes have been stored in the object cache so that CAPI does
    not invoke get_attr() and use the attributes in the object cache
    instead, see the confd_lib_dp(3) manual page for details.

    (ENG-22602)

  - ncs: Make the side effect queue aware of NSO state changes so that it
    does not run side effects when the node is set to read-only mode, is not
    HA master and during an upgrade.

    (ENG-22544)

  - ncs: Start NSO SNMP manager component only when there are managed
    devices of type SNMP configured. This also means that NSO does not open
    the UDP ports used by the SNMP manager to communicate with managed
    devices, unless there are such devices configured.

    (ENG-22497, RT:39505, PS-34583, CSCvr94504)

  - ncs: Improve performance on tree traversal for deeply nested lists with
    large amount of elements.

    (ENG-22329, RT:38750, PS-33823)

  - ncs: Replay support check is now performed in the same NETCONF session
    in which the subscription is later established. This is cheaper and more
    robust than checking it in a separate session as before.

    (ENG-22265, RT:39081, PS-34154)

  - ncs: Add documentation about the ncs:plan-location statement detailing
    how to use a plan not situated at the nano service instance path.

    (ENG-22245)

  - ncs: If NSO gets stuck while terminating, it can now create a debug dump
    after being stuck for 60 seconds. To enable this mechanism, set the
    environment variable $NCS_DEBUG_DUMP_NAME to a filename of your choice.

    (ENG-22141, RT:38589, PS-33661)

  - ncs: Generic NED now takes into account tailf:cli-diff-after,
    tailf:cli-diff-modify-after, tailf:cli-diff-set-after,
    tailf:cli-diff-delete-after, tailf:cli-diff-create-after YANG extensions
    between leaf nodes when ordering the diff. Read more about the YANG
    extensions in the Tailf cli Yang extensions man page.

    (ENG-22090)

  - ncs: NSO is now built with support for Address Space Layout
    Randomization (ASLR).

    (ENG-22079, RT:38850, RT:38007, PS-33921, PS-33082)

  - ncs: Attempts to connect to SSH with excessive authentication data (>
    4kb) will now be dropped at the protocol level.
    Note that this early drop leads to that the attempts will not be logged
    in the server!

    (ENG-22035, RT:38712, PS-33785, CSCvr11505)

  - ncs: Reduced memory footprint of capi object cache in some specific use
    cases where leaf-lists are stored.

    (ENG-21874, RT:38337, PS-33406, CSCvq81640)

  - ncs: General performance improvements to the service manager, especially
    in cases where the transaction invokes large number of service
    instances.

    (ENG-20981, RT:36632, PS-31712, SR:686287714)

  - ncs: Optimize existence check for leafs with when-expression. Previously
    when-expressions were evaluated for all leafs. Now when-expressions are
    only evaluated for leafs when the default value is effective. This
    change does not apply to external data providers.

    (ENG-20771, RT:27383, PS-8692)

  - ncs: Add support for retrieving id of the rollback file created during a
    transaction commit. The id returned can later be used to do selective
    rollback. See API documentation for details. C, Python, Java, and Erlang
    MAAPI interfaces supported. CLI, RESTCONF, NETCONF, and JSON-RPC
    supported.

    (ENG-20491)

  - ncs: A new flag CdbGetModificationFlag.CDB_GET_MODS_INCLUDE_MOVES is
    available for use with CdbSubscription.getModifications(). Combining
    CdbGetModificationFlag.CDB_GET_MODS_INCLUDE_LISTS with this flag will
    make it possible to receive information about where a list instance in
    an ordered-by user list is moved. See documentation of
    CdbSubscription.getModifications() for more information.

    (ENG-16185, RT:29618, PS-9651)

  - aaa: When authenticating for CLI access over SSH, ConfD now supports
    iteratively issuing challenges for which the user needs to give the
    right responses to gain access.

    (ENG-22882)

  - aaa: Storing last-login information. Information about the last time at
    which a username was successfully used for authentication, the name of
    the authenticating host, the name or address of the location from which
    the user last received service, and the type of service used, will be
    written to the 'last-logins' operational container. Information is also
    stored to keep track of the number of failed login attempts since the
    last successful login, together with the information normally given for
    a successful attempt. This functionality requires the Operational
    Datastore to be enabled.

    (ENG-16721)

  - cli: By changing how the tear-down process was handled in the CLI it is
    now possible to get it completed much faster if the connection is a pure
    console connection. Prior to this fix a long wait state was allowed to
    make sure no connection was torn down prior to it being complete. These
    wait states where deemed unnecessary nowadays.

    (ENG-23581, RT:41492, PS-36567, CSCvt63338)

  - cli: A new pipe target "restconf" has been introduced in the CLI to
    display paths as restconf.

    (ENG-23388)

  - cli: The CLI has added support for the tailf:description extension to be
    fully supported. If the field exists and has been properly compiled into
    the yang model it will now be presented where applicable.

    (ENG-22951)

  - cli: The CLI Turbo Parser has been improved such that it can now accept
    a configurable root in which to start parsing at. This applies within
    the 'ncs_cli', where users can now call the 'turboparse' command under
    for instance '/devices/device{dev0}/config'.

    (ENG-22864)

  - cli: Using the new flag
    CdbGetModificationFlag.CDB_GET_MODS_INCLUDE_MOVES with
    CdbSubscription.getModificationsCLI(), the resulting C-style CLI command
    string may include comments about where a list instance in an ordered-by
    user list is moved.

    (ENG-22808)

  - cli: The CLI now supports last-login information about successful and
    failed attempts from both the ordinary CLI- as well as SSH-CLI-sessions.
    This interoperates with any other interface that supports this new
    feature. This is connected to the feature described in ENG-16721.

    (ENG-22740)

  - cli: Improved performance when generating CLI output by reducing the
    number of get_case calls to the data provider. The improvement is mostly
    noticeable when the model has many children under choices.

    (ENG-21819, RT:38260, PS-33329, CSCvq83585)

  - cli: Optimizations has been done to speed up the calculation of
    tailf:cli-diff-before dependencies when displaying a C-style southbound
    diff.

    (ENG-21117)

  - cli: Command info texts were added to all the intermediate built-in
    commands which were missing.

    (ENG-19633)

  - cs_trans: Optimised the number of dependency check on key of list
    instance containing hook.

    (ENG-23981, RT:42206, PS-37302, CSCvu41092)

  - cs_trans: Reduced the amount of memory usage when deleting large numbers
    of leafref targets.

    (ENG-23555, RT:41772, RT:41299, RT:41300, PS-36863, PS-36366, PS-36367,
    CSCvt55297)

  - cs_trans: Improved performance when an instance is created that is the
    parent of an NP-container with a when-statement, and the when-expression
    evaluates to true.

    (ENG-23542, RT:41869, RT:41398, RT:41440, PS-36963, PS-36468, PS-36513)

  - cs_trans: Improved scalability of load replace using C-style CLI config.

    (ENG-22781, RT:37470, PS-32549)

  - cs_trans: Improved performance in the transaction engine by reducing the
    number of required when evaluations for leafs with default values under
    lists and presence containers. The reduction in evaluations does not
    take effect if the leaf has a hook, must expression or have validation
    dependencies.

    (ENG-22780, RT:39805, RT:40459, RT:39898, PS-34882, PS-35541, PS-34975)

  - cs_trans: The transaction engine has been update to speed up loading
    configuration as the following
    1. Optimising to not evaluate duplicated when-expressions.
    2. All when-expressions are evaluated at validation phase.
    3. Using when-cache at building commit log.

    (ENG-19932, RT:40608, RT:35147, PS-35688, PS-30218)

  - documentation: Expanded documentation on Subscribed Notifications for
    NETCONF (RFC 8639 and RFC 8640) to include compatibility with NETCONF
    Notifications (RFC 5277) and monitoring of established subscriptions.

    (ENG-23978)

  - documentation: Added <?if-ned-id?> with description to the summary list
    of processing instructions in templates in the NSO Development Guide,
    under Templates -> Basic Principles -> Processing Instructions.

    (ENG-23686)

  - documentation: Improved documentation to include NSO package naming
    conventions.

    (ENG-22994, RT:37982, PS-33057, CSCvs72067)

  - documentation: Clarified inheritance rules for 'tags' attribute in XML
    templates.

    (ENG-21411, RT:37325, PS-32405, CSCvp78798)

  - documentation: Add description about the appropriate usage of the "tab"
    pipe command to NSO User Guide.

    (ENG-17661, RT:31531, PS-27544)

  - documentation: Clarify that a no-overwrite commit will lead to the
    last-transaction-id being cleared in NSO's CDB

    (ENG-16743, RT:30304, RT:40932, PS-26804, PS-36030)

  - examples: Add monitoring of established subscriptions via the
    subscriptions container to the NETCONF Subscribed Notifications (RFC
    8639) example.

    (ENG-24145)

  - ha: Fail-over and startup logic for NSO instances in a high availability
    setup

    (ENG-23266)

  - ha: Actions for managing NSO in a high-availability setup

    (ENG-23265)

  - ha: Built-in capabilities for defining NSO instances in a
    high-availability setup and respective settings, defined in
    tailf-ncs-high-availability.yang

    (ENG-23264)

  - java-api: Java clients will now connect to an IPC port with
    SHA-256-based authentication method when IPC access check is enabled.
    Older MD5-based clients are still supported for backwards compatibility.

    (ENG-23255, RT:40783, RT:41142, PS-35879, PS-36209, CSCvt37929)

  - java-api: When writing to MaapiOutputStream would fail, the resulting
    error message was logged, but there was no way to retrieve the error
    message in the code. Two methods, getErrorString() and getErrorCode(),
    have been added to retrieve the error message and the error code
    respectively.

    (ENG-23137, RT:40425, PS-35507)

  - java-api: Add a new API method encrypt to MaapiCrypto to be able to
    encrypt values before setting them in CDB.

    (ENG-20512, RT:36464, PS-31544)

  - json-rpc: JSON-RPC now supports 2-factor authentication. This is
    implemented via the new external challenge mechanism.

    (ENG-22880)

  - json-rpc: A new method "get_description" is now available, it can be
    used to get YANG description if the YANG file is compiled with the
    --include-doc option.
    See JSON-RPC documentation for a complete description.

    (ENG-22534)

  - ned: There is now a possibility for a NED to return a transaction ID at
    the same time as it is asked to fetch the full device's configuration.
    This is an optimization primarily for those NEDs that use full
    configuration hash as a transaction ID. NSO may still ask for a
    transaction ID separately in other scenarios, when fetching the full
    configuration is not desired.

    (ENG-23558, RT:39989, PS-35067, CSCvt66299)

  - ned: NSO now supports diffie-hellman-group-exchange-sha256 key exchange
    algorithm when connecting to CLI or generic devices via SSH.

    (ENG-23538, RT:40537, PS-35616)

  - netconf: NSO now uses <get-data> towards a NETCONF device that
    advertises support for NMDA.

    (ENG-23162)

  - netconf: Add support for the "subscriptions" container defined in RFC
    8639 Subscribed Notifications.
    There is basic support for monitoring subscriptions via
    /sn:subscriptions; it is possible to retrieve subscription-id, encoding,
    receiver, stop-time, and filters.

    (ENG-23012)

  - netconf: There is transaction id support for the native NETCONF/YANG
    interface to IOS-XR now and 'check-sync' action is supported for IOS-XR
    devices.
    Note: this only works for the XR devices with
    http://cisco.com/ns/yang/Cisco-IOS-XR-config-cfgmgr-exec-oper revision
    2019-xx-xx or later and no
    http://www.cisco.com/ns/yang/Cisco-IOS-XR-sysadmin capability supported.

    (ENG-21164)

  - netconf: Added support for RFC8641 "Subscription to YANG Notifications
    for Datastore Updates", also known as YANG-Push.
    The "ietf-yang-push" YANG module is exported only to NETCONF and
    compiled with ietf-subscribed-notification features: encode-xml, replay,
    xpath, and subtree; and also with the ietf-yang-push feature on-change.
    Major items from RFC 8641 not supported are the following:
     - configured subscriptions
     - mechanism to suspend and resume subscriptions due to lack of
    computational resources, like cpu, memory etc.
     - RFC compliant errors for features not supported.
    - subscription on operational datastore is not  supported for on-change
    subscriptions.

    Yang-Push implementation supports the following:
    Receiver Authorization:
    API calls establish-subscription and modify-subscription will grant a
    selection filter even if the filter contains references to nodes which
    are non-existent or nodes to which the receiver has got no authorized
    access right to. See chapter Receiver Authorization in RFC 8641.

    Dynamic periodic subscription to a datastore:
    API call establish-subscription and modify-subscription (where
    applicable) supports the follow parameters,
     - datastore: running, operational
     - datastore-subtree-filter
     - datastore-xpath-filter
     - stop-time
     - encoding: xml
     - period
     - anchor-time
    Not supported parameters are,
     - selection-filter-ref
     - dscp
     - weighting
     - dependency
    API calls modify-subscription, delete-subscription and kill-subscription
    are supported.
    Dynamic periodic-subscription can be used to subscribe on running or
    operational datastores. By subscribing on operational datastore, data
    may be read from a data provider.
    A filter may select the model top, but is not recommended as this will
    cause a huge amount of notifications and data to be sent, reflecting
    every update in a datastore.

    Dynamic on-change subscription to a datastore:
    API call establish-subscription and modify-subscription (where
    applicable) supports the follow parameters,
     - datastore: running
     - datastore-subtree-filter
     - datastore-xpath-filter
     - stop-time
     - encoding: xml
     - dampening-period
     - sync-on-start
     - excluded-change
    Not supported parameters are,
     - datastore: operational
     - selection-filter-ref
     - dscp
     - weighting
     - dependency
    API calls modify-subscription*, resync-subscription, delete-subscription
    and kill-subscription are supported.
    *modify-subscription rpc handling does not support to change the
    update-trigger type from periodic to on-change or vice versa.
    A filter cannot select the model top and usage of such a filter results
    in an error being replied.

    Monitoring of subscriptions:
    There is basic support for monitoring subscriptions via the
    /subscriptions container. Currently it is possible to view dynamic
    subscriptions' attributes,
     - subscription-id
     - stream
     - encoding
     - receiver
     - stop-time,
     - datastore-xpath-filter
    Not supported attributes are,
     - datastore-subtree-filter
     - receiver/sent-event-records
     - receiver/excluded-event-records
     - receiver/state
     - periodic/period
     - periodic/anchor-time
     - on-change/dampening-period
     - on-change/sync-on-start
     - on-change/excluded-change
    A known issue is that it is possible to alter dynamic subscriptions in
    the /subscriptions container in the running datastore. However, this
    does not affect the actual subscription only the monitoring of it.
    Because of this, it is recommended to only allow admin write access to
    /subscriptions via NACM rules.

    (ENG-18441, RT:39669, RT:33788, RT:35398, RT:36758, RT:39872, PS-34745,
    PS-29067, PS-30472, PS-31838, PS-34949)

  - python-api: Just like all other NSO logs, Python VM logs are now
    reopened on ncs --reload. Also, when python-vm log-file-prefix is
    changed in the configuration the Python VMs will start writing to the
    log with the new prefix immediately.

    (ENG-22649)

  - restconf: The RESTCONF documentation has been much improved.

    (ENG-20558)

  - restconf: It  is possible to specify separate transport section for
    RESTCONF in a fully backwards-compatible manner, see the ncs.conf(5)
    manual page, RESTCONF section.

    (ENG-19015, RT:33759, PS-29058)

  - toolchain: ncsc and yanger now includes the models 'ietf-restconf' and
    'ietf-yang-patch' in the default load path.

    (ENG-23753)

  - toolchain: The flag "--verbose" can now be passed to ncsc for YANG
    compilation to print some info during the compilation process.

    (ENG-23181)

  - toolchain: The ncsc  compiler now detects and optimizes some "when"
    expressions that always will evaluate to "true" or "false".  An example
    of such a "when" expression is:  'local-name(../../..) = "foo"'.

    (ENG-22652)

  - toolchain: ncsc and yanger have new options --include-doc and
    --fxs-include-doc, respectively, which includes the descriptions from
    YANG source files in the fxs files. This description will be available
    in the WebUI.

    (ENG-22536)

  - toolchain: The development tool netconf-console has better support for
    subtree filtering.

    (ENG-22500, RT:39259, PS-34334)

  - toolchain: If the system crashes, it will now generate a crash dump file
    in $NCS_RUN_DIR/ncs_crash.dump for debugging. See the system dump
    section in the system management chapter in the admin guide for more
    info.

    (ENG-22137)

  - toolchain: The confd.conf generated for netsim devices now contain some
    default encryption keys.

    (ENG-19931, RT:35366, PS-30440)

  - web-server: In order to use TLSv1.3 the built-in testing TLS CA
    certificates and self-signed TLS certificates have been updated to use
    SHA-256 instead of SHA-1 signature algorithm. Note that these should
    only be used for development.

    (ENG-23744)

  - web-server: Add support for logging webui access log to syslog. This
    means all HTTP server based logs, i.e. webui, json-rpc, rest, restconf,
    can log to syslog. Note that some components have their own log in
    addition to the webui access log.

    (ENG-21059, RT:36935, PS-32017, SR:686449716)

  - webui-one: The PACKAGES text at the top level of the Configuration
    editor is now a link to the packages model.

    (ENG-23805)

  - webui-one: Do not render the "keep input parameters" checkbox in the
    action container if there are no input parameters for the action.

    (ENG-23804)

  - webui-one: Show zombie services in another list in service manager

    (ENG-23573)

  - webui-one: Show related services or devices within expandable sections
    in service manager and device manager.

    (ENG-23281)

  - webui-one: Redesigned the information modal in the configuration editor.
    Added additional meta data e.g. name, types, path, enumerations, default
    value, access, list keys and more.

    (ENG-23178)

  - webui-one: Added basic support for multi-factor authentication, see
    ENG-22074. When multi-factor is enabled in NSO, a second prompt will be
    shown where the challenge response need to be put.

    (ENG-23067)

  - webui-one: Added a link to the configuration editor, inside actions,
    that points to the top of the action container.

    (ENG-23049)

  - webui-one: Add webui notification bar in the application hub with last
    logged in information

    (ENG-23001)

  - webui-one: Include all top level leafs which is mandatory in create
    dialog.

    (ENG-22961)

  - webui-one: Add link in configuration editor that is visible when inside
    a service item.
    This link points to the service manager.

    (ENG-22960)

  - webui-one: Add link in configuration editor that is visible when inside
    device item.
    This link points to the device manager.

    (ENG-22959)

  - webui-one: Add an option to keep action input parameters between action
    runs.

    (ENG-22796)

  - webui-one: Page load optimizations when loading ConfigurationEditor with
    a lot of modules

    (ENG-22752)

  - webui-one: There is a new, experimental tool created for viewing
    configuration and operational data. It enables multiple types of
    presentation modes such as JSON and XML. It development name is
    Multi-output-configuration-editor and will be released as a separate
    package. The package will be made available for download once NSO 5.4 is
    released. If this tool is well received it might be added to NSO in the
    future

    (ENG-22510)

  - webui-one: It is now possible to access the YANG description field from
    within the NSO-web-ui. The description will shown in the information
    modal that can be opened in the Configuration editor. Use the 'more
    options' mode to display the information icons on the YANG elements and
    click any of them to bring up the modal. For this information to be
    preserved in the compiled YANG files, they need to be compiled using the
    --include-doc options. The ui will use the new get_description method to
    retrieve the data.

    (ENG-18182)

  - webui-one: When adding elements to a fully populated list, the newly
    created element would not be rendered due to the list being full. The
    new behavior of the list always renders newly created elements.

    (ENG-18022)

  - webui-one: Add Alarm manager as a new tool for monitoring and managing
    NSO alarms. The basic functionality of Alarm manager include:
        - The full list of NSO alarms
        - A summary of alarm counts
        - Filter alarms by severity levels
        - Show/hide cleared alarms
        - Alarm actions for acknowledge alarms and purge cleared alarms
        - Access details of an alarm
        - Sort alarms in ascending or descending order
        - Customize the visibility of alarm list columns

    (ENG-17127)

Corrections:

  - ncs: The default build rule for ietf-netconf-nmda.fxs in
    ${NCS_DIR}/src/ncs/yang has been overriden to include NETCONF NMDA
    features origin and with-defaults. So that if one decides to build yang
    modules in the release directory, ietf-netconf-nmda.yang compiles to the
    same file as the delivered ietf-netconf-nmda.fxs.

    (ENG-23933)

  - ncs: In NSO-4.7.7.2, attempting to fetch SSH host keys from a device
    whose SSH server sent an identification string with only a newline as
    line termination, would lead to an error. This has been fixed, by
    interpreting a newline as if it was the proper line termination sequence
    - "carriage return, newline".

    (ENG-23907)

  - ncs: If a service touches a list instance, and the schema for that
    list's keys were changed, the old diffset stored in the service's
    private data was not handled properly. This led to a crash when the
    service instance was updated/re-deployed, after the schema upgrade.

    (ENG-23893, RT:39537, PS-34613, CSCvu24805)

  - ncs: The upgrade triggered by the /package/reload action does no longer
    risk crashing if setting the 'timeout-action' leaf to 'kill' and there
    are open transactions after the 'max-wait-time' is reached.

    (ENG-23863)

  - ncs: NSO now runs any scheduler task added through an XML init file with
    the system user, which implies that AAA rules will not be applied at
    all. The task will not be able to initiate device communication.

    (ENG-23835, RT:41784, PS-36877, CSCvu15756)

  - ncs: When commit queue is enabled and the error-option is set to
    rollback-on-error or stop-on-error, commit queue creates a reverse
    diffset and offers that as the 'rollback' action's input parameter under
    /devices/commit-queue/completed/queue-item{ID} to restore the original
    configuration data.
    If the changeset contained operational data related changes, or zombie
    related changes performing the rollback action would corrupt the zombie
    plan and would delete any operational nodes. This has now been fixed,
    operational  data related changes are handled correctly and any changes
    under the following paths are always excluded from the rollback:
    /zombies/service, /side-effect-queue.

    (ENG-23803)

  - ncs: If a delete post action was added to the side effect queue and the
    zombie deleted in the  same transaction the post action would never be
    run due to the missing zombie. This has been fixed so that the delete
    post actions will be run even though the zombie might not be present
    anymore.

    (ENG-23790)

  - ncs: Fix an internal error in nano services when nano-plan-data was
    missing from the plan container or list.

    (ENG-23772)

  - ncs: Commit no-networking now honors the device locks. This ensures
    proper sequence between a no-networking commit and sync-from, sync-to,
    compare-config actions.

    (ENG-23757)

  - ncs: NSO's built-in SSH implementation was silently stripping illegal
    trailing characters from received identification strings. This has been
    changed - For compatibility and security reasons identification strings
    will be used as-is even if not RFC-compliant.

    (ENG-23743, RT:38983, PS-34055, CSCvt98942, SR:687514067)

  - ncs: 'reactive-re-deploy' does no longer get an internal error when last
    commit on the service instance was committed through the commit queue
    without specifying the 'sync/timeout' or 'sync/infinity' parameter (only
    seen when committing on some NB interfaces).
    'commit-queue/sync' commit parameters are now handled more consistently
    across all northbound interfaces, correctly defaulting to
    '/devices/global-settings/commit-queue/sync' configuration if not set.
    NSO does no longer return bad XML in the NETCONF rpc reply when
    committing synchronously through the commit queue and a device fails.

    (ENG-23722, RT:41734, PS-36824, CSCvu06544)

  - ncs: If the path /side-effect-queue was restricted to a user by NACM
    rules, that user could not create/edit a nano-service, even if the
    service node itself was allowed to the user. This has been fixed, so
    that operations towards /side-effect-queue and the nano-service's
    post-actions are done without access checks.

    (ENG-23713, RT:41165, PS-36230)

  - ncs: Leafs with default values incorrectly evaluated their must
    expressions even though ancestor when expressions evaluated to false.
    This error occurred when using candidate or delayed when including
    operations over NETCONF and RESTCONF.

    (ENG-23689, RT:40997, PS-36095, CSCvt89488)

  - ncs: Yanger now reports an error if there is circular dependency between
    tailf:non-strict-leafref leafs. The error message has format as below
    <module.yang>:<line>: error: circular dependency for leafref path of
    leaf <node>

    (ENG-23656, RT:41661, PS-36747, CSCvt77385, SR:688482828)

  - ncs: Due to a bug, in some cases rollback numbering could be reset on
    NSO restart when rollback-numbering is configured to be 'fixed' in
    ncs.conf. This means that NSO would in some cases start overwriting old
    rollback files after restart. This has been fixed.

    (ENG-23624)

  - ncs: If a Nano service has no delete pre-conditions or delete callbacks,
    deletion can take place in a single transaction.

    (ENG-23623)

  - ncs: Fixed the 'delete failed for'-error that occurred when trying to
    delete a device. The problem applied for all API:s that use the
    'safe-delete' behavior. It only occurred for devices with a set-hook
    that delete configuration under the device being deleted.

    (ENG-23619, RT:41549, RT:42167, PS-36631, PS-37261, CSCvt70368)

  - ncs: When migrating from versions before 5.x the migration of
    live-status-protocol of type snmp was not correctly done. Now the
    correct ned-id is set to the live-status-protocol if the capabilities
    are known otherwise the generic snmp ned-id is used.

    (ENG-23563, RT:41388, PS-36458, CSCvt57039)

  - ncs: A race condition has been fixed which could cause, for example, the
    compare-config action to show a diff for changes committed through the
    commit queue even though the changes have been pushed to the network.

    (ENG-23556)

  - ncs: NSO used to re-establish NETCONF notification subscription on any
    subscription configuration change, even if it was only a change in
    attributes. Now NSO only re-establishes NETCONF notification
    subscription on significant configuration changes.

    (ENG-23535, RT:41286, PS-36352, CSCvt53017)

  - ncs: Closing a user session with an in progress candidate commit could
    under cause the system to crash. Synchronization has been added to avoid
    the user session to go away while the commit is in progress.

    (ENG-23529, RT:40539, PS-35618, CSCvt50204)

  - ncs: In NETCONF NED builder, restrict the type of major-version field to
    match the restrictions of package version format imposed by the
    package-version type defined in tailf-ncs-packages.yang data model. All
    existing projects with non-matching major-version values will get an
    automatically assigned version after upgrade to this NSO version,
    starting at 0.1, and a comment will be made on each upgraded instance
    indicating the upgraded value. All existing projects will matching
    major-version values are unaffected.
    Also, during upgrade, when the type of a list key has changed in a part
    of YANG model that is config false, or has config false children, CDB
    will now attempt to upgrade the key by converting it to string and back
    to value. If the resulting value of the key leaf is valid, then CDB will
    move the stored config false data into the new structure.

    (ENG-23483, RT:41197, PS-36263)

  - ncs: In LSA cluster, commit dry-run will now correctly work with
    reconcile, no-deploy and ignore-refcount options. Previously these
    options were ignored by lower nodes in the cluster when used together
    with dry-run.

    (ENG-23475, RT:41287, PS-36353, CSCvt38039, SR:688579103)

  - ncs: NSO now correctly handles symlinks to directories inside package
    tarballs. Previously they were treated as empty directories.

    (ENG-23416)

  - ncs: When using the NETCONF lock RPC with "wait-time" parameter, and the
    lock was already held by some other sessions. If the other session
    released the lock, NSO invoked lock/unlock call-points of external data
    provider in bad order. The order of lock/unlock call-points has been
    corrected now.

    (ENG-23360, RT:40965, PS-36062, CSCvt17815)

  - ncs: Leafs with their value set to the default value of the leaf will
    now be migrated correctly when doing a NED migration of a device that is
    trimming default values.

    (ENG-23352, RT:39988, PS-35066, CSCvt16608, SR:688000498)

  - ncs: Failing to fetch platform data from NETCONF devices could in some
    cases cause the operation to fail with a cryptic error message. The
    error message now correctly reflects the issue.

    (ENG-23345, RT:40717, PS-35812, CSCvt15200, SR:688382407)

  - ncs: ncs_load option -C was removed in version 5.3, however the usage
    text was not updated to reflect this change.

    (ENG-23334)

  - ncs: Fix an issue where a nano service would end up in an infinite loop
    due to only backtracking a component to a certain state instead of
    completely backtracking the component, when the component is deleted in
    the middle of executing the nano service.

    (ENG-23320, RT:40453, PS-35535)

  - ncs: Fixed an issue where all validation call-points of a node were
    invoked multiple times. NSO now invokes validation call-points based on
    dependency, and only once.

    (ENG-23269, RT:40786, PS-35882, CSCvt06001)

  - ncs: phase0 upgrade would fail with an internal error in the error log,
    if the CDB API was used to read an augmented leaf with a
    when-expression. The upgrade code has been changed to properly keep
    track of node name mappings for augmented leafs.

    (ENG-23261, RT:38033, PS-33108, CSCvt05669)

  - ncs: Removed deps and tools from ncs-src and conf-api-src jars.

    (ENG-23217)

  - ncs: NSO no longer produces an internal error when migrating leafs of
    union type with the /devices/device/migrate action.

    (ENG-23207, RT:41238, RT:40711, RT:40578, PS-36304, PS-35806, PS-35658,
    CSCvs98406, SR:688345324)

  - ncs: NSO would in a rare condition send invalid commands to a CLI
    device, effectively making the communication flow between the NED and
    the device out of sync.

    (ENG-23173, RT:40588, PS-35668, CSCvs91566, SR:688074211)

  - ncs: Previously there was no diff entry shown when a presence container
    was created/deleted in the Generic NED:s diff. Now, a diff entry is
    shown in these cases.

    (ENG-23125)

  - ncs: Fix an issue were we could get an internal error when quickly
    adding/deleting nano service instances.

    (ENG-23081)

  - ncs: When undeploying a nano service instance NSO will now remove all
    kickers created by the instance.

    (ENG-23070)

  - ncs: Notification kickers configured after the NETCONF subscription are
    now triggered without the need to restart the subscription.

    (ENG-23069, RT:40491, PS-35573)

  - ncs: Fixed an internal error in maapi_save_config() that occurred for
    MAAPI_CONFIG_NO_PARENTS when the subtree of the provided path had an
    augmented node.

    (ENG-23031, RT:40391, PS-35472, CSCvs71005)

  - ncs: Fixed an issue where NSO neglected the changed validation on keys
    when upgrading, which lead to invalid data in CDB after upgrading.

    (ENG-23024, RT:40344, PS-35424, CSCvs71982)

  - ncs: Correct handling of operational leafs, undefined values are not
    stored in reverse diffsets.

    (ENG-23023)

  - ncs: NSO now gives an error if a commit queue item exists when doing a
    data model upgrade from boot. The check can be circumvented with the
    '--with-package-reload-force' flag. This will instead invalidate
    existing queue items.
    The commit queue now checks if an in-service upgrade of the data model
    intersects with changes in the queue items and gives an error if so. If
    nothing intersects the upgrade is allowed to continue.
    NSO does no longer wipe the device snapshot in the snapshot database
    when the device is migrated to a new NED version.

    (ENG-23020, RT:40291, PS-35371, CSCvs69315)

  - ncs: Correct an issue were nano services would invoke the
    pre-modification callback multiple times when backtracking.

    (ENG-23006)

  - ncs: Nano service post actions will now be run using the same context as
    the session which created them.

    (ENG-23000)

  - ncs: Configured settings under /devices/global-settings/connect-retries
    or /devices/profiles/profile/connect-retries are now used if not set on
    the device.
    Removed default values for connect-retries settings under
    'device-profile-parameters' grouping.
    Added default value for
    /devices/global-settings/connect-retries/attempts and
    /devices/global-settings/connect-retries/timeout.

    (ENG-22997, RT:40014, PS-35093)

  - ncs: If the /scheduler/task/action-node is given as an XPath 1.0
    expression, the NSO scheduler will execute the action on the node set
    concurrently. The NSO scheduler does no longer overwrite history items
    if the start time of the action invocation for a given node is the same
    as another.

    (ENG-22996)

  - ncs: When CDM migration was done from pre CDM NSO device-type was
    incorrectly changed from snmp to netconf when no capabilities where
    known for the device. This has now been corrected and the ned-id for
    those snmp devices will be set to the generic snmp ned-id.

    (ENG-22968, RT:40265, PS-35344, CSCvs71654)

  - ncs: If the monitor of an existing data kicker was modified, the kicker
    would monitor both the old and the new paths. This has been fixed.

    (ENG-22955, RT:40073, PS-35152, CSCvs62631)

  - ncs: Maapi.reportServiceProgress does no longer hang when called from
    pre_modification or post_modification callbacks in a service.

    (ENG-22946, RT:40143, PS-35222, CSCvs62259, SR:688101801)

  - ncs: The CLI does no longer print progress trace events with missing
    newline character during concurrent processing of devices in NSO.

    (ENG-22945)

  - ncs: When configuring a callback function for an authgroup the callback
    will be now be called each time a connection attempt is made against a
    NETCONF device.

    (ENG-22922, RT:40007, PS-35086, CSCvs59629, SR:688037543)

  - ncs: ENG-20771 introduced a regression isolated to existence check of
    operational data where it could return true even if the when expression
    evaluated to false. The when evaluation is no longer skipped for
    operational data since it can be written without validation.

    (ENG-22918, RT:40640, RT:40235, PS-35722, PS-35314, CSCvs57789)

  - ncs: The builtin SFTP (SSH File Transfer Protocol) client connected with
    unsupported SSH host key algorithm. The host key algorithm ssh-ed25119
    is unsupported in NSO for OpenSSL < 1.1. I.e. the NETCONF <copy-config>
    operation with a target/source SFTP URL resulted in a crash in NSO and
    the session was prematurely terminated. The builtin SFTP client will
    from now on only connect with the ssh-ed25519 host key algorithm if it
    is supported.

    (ENG-22909, RT:40217, PS-35296, CSCvs56253)

  - ncs: The temporary copy of ncs.conf file created by the NSO installer,
    prevented 'ncs-backup' from completing when invoked by user other than
    root.

    (ENG-22908, RT:40057, PS-35136, CSCvs56231)

  - ncs: The /devices/device/migrate action does no longer call set-hooks
    when copying the running config from the device.
    A number of cases are now corrected where the migrate action crashed or
    set service meta-data incorrectly on backwards compatible data model
    changes.

    (ENG-22894, RT:40385, RT:40429, RT:40443, PS-35465, PS-35511, PS-35525)

  - ncs: Notification replay store logs where log files were missing could
    in very rare cases cause the log mechanism to stop working. This has
    been fixed.

    (ENG-22865, RT:40114, PS-35193, CSCvs48880)

  - ncs: The id-values associated with each element in a data model are now
    localized to each namespace to avoid conflicts between the loaded data
    models.

    (ENG-22839)

  - ncs: /progress/trace/event/duration and /progress/trace/event/timer
    leafs now contains the correct value.

    (ENG-22807)

  - ncs: A list instance with a leafref pointing to it could be deleted if
    it was not the first instance deleted in that transaction.

    (ENG-22802, RT:41712, RT:39977, PS-36800, PS-35055, CSCvs35339)

  - ncs: Data written below the 'error-info' container in the plan data can
    now be monitored by a kicker.

    (ENG-22784)

  - ncs: Display correct callback names in the output of ncs --status and
    tailf-ncs-monitoring data model. Previously only the callback names for
    data callbacks were correctly displayed.

    (ENG-22774)

  - ncs: NSO no longer gives an internal error when calculating the
    southbound diff for a device, where a leaf is reset to its default
    value, to which the user does not have read access.
    NSO no longer tries to push configuration to a device when it is
    southbound locked when using the 'commit-queue/bypass' commit parameter.

    (ENG-22760, RT:39920, PS-34997, CSCvs28141)

  - ncs: NSO does no longer give an internal error when changes are made to
    an ordered-by user list, where an instance is created and then moved
    last in the same transaction, and then committed through the commit
    queue where an item already exists with the same operations on another
    list instance.

    (ENG-22747, RT:38992, RT:39323, PS-34064, PS-34398, CSCvs26933,
    SR:687768246)

  - ncs: If the host that NSO run on crashed abruptly from e.g. kernel
    panic, the replay store could in very rare cases be corrupted which lead
    to NSO failing to come up. NSO can now handle this case.

    (ENG-22734, RT:39814, PS-34891, CSCvs25387)

  - ncs: When ssh-ed25519 was set as the only supported key algorithm
    without runtime support for it, NSO would fail to generate a proper
    error message and terminate with Internal error.

    (ENG-22725)

  - ncs: A change to the /scheduler/task list does no longer make scheduled
    tasks just about to run (in less than 1 second) to be silently dropped.

    (ENG-22657, RT:39513, PS-34591, CSCvs13942)

  - ncs: When modifying a service, commit parameters were stored to be used
    by the reactive-re-deploy action; which must have the same parameters as
    the original service commit. This could cause unexpected behavior, for
    example: when using reactive FASTMAP loops in combination with LSA and
    the commit queue - queue items on the lower node can end up being locked
    in subsequent reactive commits. NSO now only stores a subset of the
    commit parameters: no-revision-drop, no-out-of-sync-check, no-overwrite,
    use-lsa, no-lsa, commit-queue/async, commit-queue/sync,
    commit-queue/sync/timeout, commit-queue/atomic,
    commit-queue/error-option and wait-device.

    (ENG-22647)

  - ncs: Previously if a service manipulated an ordered-by user list on a
    CLI device, then after executing commit dry-run outformat native the
    transaction could in some cases have unintended configuration changes in
    addition to the original service intent. Updated so that it no longer
    leaves unintended extra configuration changes in the transaction after
    commit dry-run.

    (ENG-22643, RT:39738, RT:39620, PS-34814, PS-34696, CSCvs19526,
    SR:687856173)

  - ncs: Fix an internal error that could be triggered when a device
    connection finished during a packages reload.

    (ENG-22624, RT:39502, PS-34580, CSCvs09814)

  - ncs: As design, FASTMAP code runs without access check. This allows
    administrators to grant indirect but controlled access to users to
    execute device configuration changes on devices that users are not
    allowed to configure directly.
    When Nano Services are created, modified or progressed forward as a
    Reactive FASTMAP service this design decision is honored. However, in
    case of zombie revive-redeploy it was not. This made the create / delete
    inconsistent and might have resulted in corrupted CDB. Now zombie
    revive-redeploy runs without access check as well.

    (ENG-22623)

  - ncs: Correct an issue where session creation and termination for
    sessions with context=system was logged to the audit log.  Sessions with
    context=system are to be excluded.

    (ENG-22619, RT:39701, RT:39830, PS-34776, PS-34907, CSCvs08519)

  - ncs: Reading a leaf using the CDB API during upgrade could fail if the
    old schema for the leaf had a default value and when expression. The
    when-evaluation now considers the old schema during upgrades.

    (ENG-22617, RT:38033, PS-33108, CSCvs08375)

  - ncs: Improve performance of handling NSO services with large amount of
    input parameters. On minor releases, while the new implementation is
    backwards compatible with service models compiled with the previous NSO
    versions within the same major, recompiling service models with the new
    NSO version will improve the performance gain.

    (ENG-22535, RT:39538, PS-34614, CSCvs00060, SR:687643395)

  - ncs: When an upgrade causes an instance-identifier with require-instance
    true to have stale data, NSO now rejects the upgrade with the error
    message as below
    * Out-of-service upgrade
      Upgrade failed: Upgrade transaction failed to validate:
    <instance-identifier>: instance has stale data after upgrading:
    <stale-data>
    * In-service upgrade
      Required instance does not exist - <instance-identifier>: instance has
    stale data after upgrading: <stale-data>

    (ENG-22505, RT:39545, PS-34621, CSCvr95973, SR:687634930)

  - ncs: Fix an issue where nano service post actions would be rerun even
    though the status of the state did not change.

    (ENG-22498, RT:39536, PS-34612, CSCvr94983)

  - ncs: NSO now sends correct alarm state change parameters in a NETCONF
    notification related to an alarm status change. In rare cases NSO could
    previously send state change parameters from a different status change
    of the same alarm.

    (ENG-22417, RT:39299, PS-34374, CSCvr81098)

  - ncs: When the ordered-diff flag is set for generic NED:s NSO is expected
    to generate a southbound diff that takes dependencies (e.g. leaf refs)
    into account. The previous implementation didn't take the following
    cases into account: (1) when the key of a list was depending on another
    config, (2) a deleted configuration subtree had a child that was in
    dependency relation with another child from a deleted configuration
    subtree.
    The implementation has been rewritten to handle more complex scenarios,
    such as an ordered by user list entry is created and moved in the same
    transaction. Now NSO generates two NedEditOps, create and move.

    (ENG-22158)

  - ncs: If NP-container has when statement and mandatory leafs, and if the
    target node is modified causing when evaluation returns true, then NSO
    did not consider old value of mandatory leaf in DB and asked for new
    value. Now NSO reuses old value of mandatory leaf in DB.

    (ENG-22056, RT:39512, RT:40077, RT:38783, PS-34590, PS-35156, PS-33856,
    CSCvr15945, SR:687307392)

  - ncs: Added support for dates beyond year 2038 in the Java API.

    (ENG-21933, RT:31475, RT:32015, RT:38255, RT:41018, PS-27493, PS-27869,
    PS-33324, PS-36116, CSCvq92574)

  - ncs: Handling when-statements on choice/case properly.

    (ENG-21448, RT:37513, PS-32590, CSCvq12732)

  - ncs: If the status of an alarm changes and the last status is exactly
    the same (text and severity) as the new status NSO will not add a new
    entry to the list of status changes in the alarm.

    (ENG-21427, RT:37414, PS-32493, CSCvq27665)

  - ncs: Packages fetch and installation was broken for some packages.

    (ENG-21330, RT:37289, PS-32370, CSCvq12473)

  - ncs: NSO now makes sure that the operational data explicitly created by
    a service is correctly handled by FASTMAP, namely the data not
    explicitly re-created by the service during service
    modification/re-deploy is deleted by FASTMAP. This behaviour does not
    extend on other (not explicitly created by service) operational data in
    a service-owned subtree which survives service modification or re-deploy
    during which its config parent is deleted and re-created.

    (ENG-20370, RT:35890, PS-30968, SR:685940554)

  - ncs: When invoking the get-modifications action on a service NSO will
    now show deletes.

    (ENG-20293, RT:35722, PS-30798)

  - ncs: When changing a leaf node to leaf-list in YANG data model an error
    occurred when executing get-modifications action on a service which had
    affected that leaf. This has now been corrected.

    (ENG-20285, RT:35722, PS-30798)

  - ncs: Templates can now register on servicepoints with tailf:opaque
    substatement in the YANG model. The argument of the tailf:opaque
    statement is accessible through SCHEMA_OPAQUE variable if the template
    is registered on a servicepoint with this statement.

    (ENG-19640)

  - ncs: Service re-deploy no longer generates rollback files.

    (ENG-19165, RT:40383, RT:34168, PS-35463, PS-29316)

  - c-api: maapi_get_next() no longer leaks memory when used with XPath
    filters.

    (ENG-23507, RT:41275, PS-36341, CSCvt46469)

  - c-api: When the Data Provider returned a default value indication
    (C_DEFAULT), it was not handled correct by the system.

    (ENG-23490, RT:41318, PS-36386, CSCvt41447)

  - c-api: If a daemon implementing an action died at a crucial moment in
    time the NSO server could crash. Now the NSO server handles this type of
    unexpected disconnections correctly.

    (ENG-22707, RT:39659, PS-34735, CSCvs22213)

  - cdb: cdb_get_elem failed to evaluate when expressions before returning
    default values if the when expression spanned both config true and
    config false data. cdb_get_elem now returns the default value instead of
    not found.

    (ENG-23818, RT:41857, PS-36951, CSCvu12483)

  - cdb: cdb_exists for config false did not evaluate when expressions
    before returning default values.

    (ENG-23745, RT:41857, PS-36951, CSCvt99196)

  - cdb: When a CLI user tried to abort a confirmed commit in configure
    exclusive mode, a message was displayed in the CLI stating that the
    abort failed. This caused the confirmed timer to timeout and the
    confirmed commit to be committed without creating a rollback file. This
    has been changed so that the lock taken through exclusive mode will be
    used with the abort so that the abort can succeed.

    (ENG-23262, RT:40796, PS-35892, CSCvt05767)

  - cdb: cdb_diff_iterate() using ITER_WANT_LEAF_LIST_AS_LEAF no longer
    crash during rollback of confirmed commit.

    (ENG-23100, RT:40457, PS-35539, CSCvs78275)

  - cdb: In a HA setup a subscriber to a slave node does not receive
    notifications for non-persistent operational data written to the master
    node (this is expected). If the slave node transitions to none or master
    the subscriber should receive notifications for such data written to
    that same node, but did not. Non-persistent operational data written to
    a node that has transitioned from slave to none or master is now
    notified to connected subscribers.

    (ENG-22658, RT:39672, PS-34748, CSCvs15299)

  - cdb: Calling maapi_get_next() using list filters against
    PRE_COMMIT_RUNNING data store caused the CDB application to terminate,
    hence NSO terminated. Now maapi_get_next() using list filters works as
    expected against PRE_COMMIT_RUNNING

    (ENG-22633, RT:39470, PS-34548, CSCvs10894)

  - cdb: Upgrade of operational list data stored in CDB did not handle
    order-by changes. The upgrade process did not fail, however move
    operations on an upgraded system could cause the system to crash. The
    upgrade code has been extended to handle changes between order-by system
    and order-by user.

    (ENG-22519, RT:39537, PS-34613, CSCvr98199, SR:687811066)

  - cdb: Corrected a fault when upgrading a P-container to a NP-container.
    If the P-container did not exist in CDB, and it had a mandatory node,
    then upgrading that P-container to a NP-container was successful. This
    is wrong because the mandatory node was missing in CDB.

    (ENG-22466, RT:39389, PS-34466, CSCvr88850)

  - cdb: Removed superfluous MOP_DELETED when create and deactivate node in
    the same transaction.

    (ENG-18937, RT:33565, PS-28968)

  - cli: In some cases when processing leaf-lists with
    tailf:cli-drop-node-name extension CLI removed the node name but kept
    delimiting spaces intact, so in the resulting config line there were
    double spaces. Now the delimiters are also removed if not needed.

    (ENG-24159)

  - cli: When combining certain characters (example: #) in the CLI the
    output would sometimes get rendered with quotes even if it was
    unnecessary for the current context. This has been fixed by evaluating
    the current context and make sure that the characters are rendered in a
    more uniform way.

    (ENG-23910, RT:42179, PS-37275, CSCvu28868)

  - cli: The C-style operational command 'show running-config' where the
    show filter consisted of multi-level nested lists (where each list had
    multiple keys) would not produce the correct result if the filter
    contained partial keys.

    (ENG-23807, RT:40748, PS-35844, CSCvu10339)

  - cli: Outputting data in Cisco CLI format resulted in internal error if
    access to a case was denied.

    (ENG-23783, RT:42083, RT:41926, PS-37185, PS-37021, CSCvu05475)

  - cli: When using range expressions in the CLI on data nodes with
    tailf:cli-range-list-syntax extension and setting use-double-dot-ranges
    in ncs.conf the CLI could get confused on what range-expression
    separator to use. Fixed by letting the tailf:cli-range-list-syntax
    extension override double-dot-ranges setting.

    (ENG-23576, RT:41507, PS-36583, CSCvt62511, SR:688581613)

  - cli: The 'show running-config | display xml' command caused CLI to reach
    for node attributes even when "enableAttributes" is set to false, thus
    causing performance degradation e.g. when a list with a lot of elements
    is displayed. This has been fixed.

    (ENG-23549, RT:41300, PS-36367, CSCvt54162)

  - cli: In some cases and after reordering an 'ordered-by user' list
    annotated with tailf:cli-show-obu-comments, tailf:cli-sequence-commands
    and its sub-statement tailf:cli-reset-siblings, some reordering comments
    was missing from the C-style southbound diff (e.g. 'commit-dry-run
    outformat native').

    (ENG-23509, RT:41366, PS-36435, CSCvt46651, SR:688515880)

  - cli: There was a mistake in the documentation regarding the typedef
    tailf:cli-template-string. Nested invocations was missing one
    $-character (dollar sign). This was corrected and a better error is now
    reported in case a faulty tailf:cli-template-string has been detected.

    (ENG-23499, RT:41334, PS-36402, CSCvt43689)

  - cli: Running the C-style command 'show configuration this' would result
    in an internal error.

    (ENG-23467, RT:41276, PS-36342, CSCvt36155)

  - cli: The C-style operational command 'show running-config' where the
    filter consisted of at least 3 levels deep nested lists (where the keys
    were omitted) would not produce the correct result.

    (ENG-23329, RT:40959, PS-36056)

  - cli: Creation of empty leafs under an action input section did not work.
    This could lead to numerous problems, e.g. not being able to set other
    input values having a when-dependency on that empty leaf.

    (ENG-23214, RT:40731, PS-35827, CSCvs99036)

  - cli: Handling of lists in actions had implicit assumptions regarding
    user input, that can be incorrect. Now the implicit assumptions are
    replaced by explicit checks, thus preventing incorrect input: it is not
    possible to enter non-key leaves before keys in lists as action input,
    also cli-prefix-key extension cannot be used for lists as action inputs.

    (ENG-23150, RT:40576, PS-35656, CSCvs88270)

  - cli: Fixed an internal error that happens when using the CLI to set the
    value of a leafref pointing to a tailf:non-strict-leafref.

    (ENG-23066, RT:38122, PS-33197, CSCvs74722)

  - cli: The southbound C-style configuration diff as produced after
    deleting a list-instance annotated with tailf:cli-diff-before would in
    some cases be incorrect when the list-instance itself had been removed.
    This has been fixed by making sure that local dependencies in a
    list-instance/presence container are disregarded if the
    list-instance/presence container itself is removed.

    (ENG-23033, RT:40295, PS-35375, CSCvs71290)

  - cli: The CLI could leak internal processes when executing specific
    range-expressions. This has been fixed by making sure the spawned
    processes are closed.

    (ENG-22963, RT:40203, PS-35282, CSCvs63186)

  - cli: The 'when' dependency on a leaf-list was wrongly triggered on
    unchanged elements when using range or wildcard on the key of its parent
    list.

    (ENG-22928, RT:40154, PS-35233, CSCvs59979)

  - cli: A potential man-in-the-middle attack vector between the ncs_cli and
    NSO when using NCS_IPC_ACCESS_FILE has been blocked.

    (ENG-22892, CSCvs52334)

  - cli: A potential buffer overwrite vulnerability in the ncs_cli
    executable has been removed.

    (ENG-22890, CSCvs52326)

  - cli: If a CLI user aborted the commit procedure several times more than
    was defined for the CLI configuration session limit, the configuration
    mode could not be entered due to session limit exceeded.

    (ENG-22689, RT:39769, PS-34845, CSCvs19453)

  - cli: During command line completion in the CLI alternatives would
    sometimes be displayed with prefixes even when not required. This has
    been changed. Prefixes are now only displayed when necessary due to
    ambiguity or when explicitly entered.

    (ENG-22678, RT:39715, RT:39765, PS-34798, PS-34841, CSCvs17574)

  - cli: Combining leaf-list and leafrefs could result in missing values
    during TAB-completion in the CLI. This has been corrected to not miss
    out any values in the list and filter out as many suggestions as
    possible.

    (ENG-22488, RT:38951, PS-34023, CSCvr92470, SR:687494628)

  - cli: When accessing data in the CLI that should result in ambiguous
    commands for the new common data model structure a crash could occur.
    The fix involved recognizing the ambiguousness and returning  error
    instead.

    (ENG-22487)

  - cli: The indentation was wrong in the output of commit dry-run outformat
    native with "no" command to delete leaf from a leaf-list with multiple
    entries. This has now been fixed.

    (ENG-22479, RT:39448, RT:39993, PS-34525, PS-35071, CSCvr90919,
    SR:687762006)

  - cli: Double-subscription for interrupts from one of CLI-internal
    processes caused race condition between that process and the actual
    running command (ping in this case) when handling the interrupt. The
    double-subscription is removed.

    (ENG-22232, RT:38956, PS-34028, CSCvr46217)

  - cli: The tab-completion and execution for RPC/action nodes did not
    present similar results in the CLI. This has been corrected so the
    execution would behave more according to the tab-completion.

    (ENG-21762, RT:38193, PS-33264, CSCvq57911)

  - cli: The tailf:info tag would not present anything useful in the CLI for
    RPC/action-nodes. This has been corrected and can now be added to these
    nodes. Please note that any tailf:info on the mount-point-nodes will not
    be used for the RPC/action-node.

    (ENG-21758, RT:38176, PS-33247, CSCvq56249)

  - cli: When displaying the devices list in tabular format (e.g. 'show
    devices list') any IPv6 addresses in the address column would in some
    cases be truncated if number of devices exceeded the value of
    '/ncs-config/cli/table-look-ahead'. This has been fixed so that if the
    number of devices exceeds the value of /ncs-config/cli/table-look-ahead,
    the column-width of the address field in the device list will be set to
    50 in order to fit any IPv6 addresses including the first 5 characters
    of any eventual zone suffix.

    (ENG-21740, RT:38079, PS-33154, CSCvq48702)

  - cli: A 'must' statement on an action/rpc input parameter of the type
    leafref would not be evaluated in the right transaction during
    auto-completion or execution of the action/rpc.

    (ENG-21394, RT:34325, RT:41164, PS-29393, PS-36229, CSCvq12124)

  - cli: The tailf:cli-incomplete-command annotation did not work properly
    on leaf-list. This has now been fixed.

    (ENG-20531)

  - cli: 'tailf:cli-full-no' annotated on key leafs is now honored when
    displaying C-style southbound configuration diffs.

    (ENG-20033)

  - cli: When combining tailf:cli-list-syntax, leaf-list, sibling leafs and
    omitting the tailf:cli-multi-word option the CLI would still consider
    the tailf:cli-multi-word to be active. This could create faulty
    list-entries in the leaf-list. The CLI has been fixed to check the for
    the tailf:cli-multi-word option and otherwise properly create multiple
    list-entries.

    (ENG-19697, RT:35018, PS-30088)

  - cli: Fix way optimisation for ordered by user lists was made. It's
    showing now commits changes when a modification was made in a deeper
    level of a ordered by user list.

    (ENG-16074, RT:26524, PS-8376)

  - cli: Setting the element '/clispec/$MODE/cmd/callback/table/root' to a
    path to a list (as opposed to a list instance), would lead to an
    internal error when the table was to be displayed in the CLI.

    (ENG-15395, RT:22485, RT:39737, PS-7197, PS-34813)

  - cli: Displaying status and configuration in XML format in the CLI has
    been changed such that it harmonizes with the curly bracket format and
    the Cisco style format when filters and pipe commands are used. The XML
    output is now also correctly indented.

    (ENG-14164, RT:24955, RT:28162, RT:32545, RT:32921, RT:35873, RT:17273,
    RT:31822, PS-7898, PS-8988, PS-28240, PS-28544, PS-30951, PS-22048,
    PS-27754, SR:684342694)

  - cs_trans: Loading configuration data in replace mode did not validate
    mandatory leafs under NP-containers in created instances. This lead to
    inconsistent data being stored in the database and affected all NB
    interfaces.

    (ENG-23987, RT:42285, PS-37384, CSCvu42779, SR:688950166)

  - cs_trans: Fixed bad query result when using maapi_exists() on mandatory
    node has when-false. The transaction engine has been updated to evaluate
    the when-expression on mandatory node for the correct result.

    (ENG-23896, RT:42313, RT:42135, PS-37412, PS-37237, CSCvu25221)

  - cs_trans: Creating a leaf-list element under an unset case lost the item
    but activated the case. Subsequent create operations worked as expected.
    This regression was introduced in ENG-17921.

    (ENG-23850, RT:42056, PS-37157, CSCvu18417)

  - cs_trans: confd_load (without -a) should doing AAA validation on the end
    result even if the format is specified in Juniper format.

    (ENG-23781)

  - cs_trans: abort() is now always invoked when prepare() has been
    interrupted.

    (ENG-23666)

  - cs_trans: CLI show command resulted in an internal error when all the
    elements under a list was hidden by a tailf:hidden YANG extension
    statement.

    (ENG-23412, RT:41109, PS-36175, CSCvt28086)

  - cs_trans: Querying over NETCONF with a filter consisting of a list with
    key of type identityref and there was no xmlns declaration for the
    prefix, NSO would crash with internal error.

    (ENG-23308)

  - cs_trans: Nodes with when-expression in a mandatory choice was falsely
    validated if a dependent node was changed, even if the choice itself did
    not exist.

    (ENG-23301, RT:40862, PS-35959, CSCvt09456)

  - cs_trans: A subscriber calling cdb_diff_iterate() with
    ITER_WANT_SCHEMA_ORDER did not get a notification for a leaf's default
    value, if the leaf was in a default case and the choice was becoming
    active due to an ancestor being created.

    (ENG-23194, RT:41152, RT:40613, PS-36215, PS-35693, CSCvs95050)

  - cs_trans: Fixed an issue when deactivating/activating a list containing
    a node that has a when-statement and a mandatory node, and
    writable-through-candidate was used.

    (ENG-23184, RT:40558, PS-35637, CSCvs93741)

  - cs_trans: Loading data using "load replace" no longer report mandatory
    leafs in list instances under a nested choice as missing.

    (ENG-23119, RT:40521, PS-35600, CSCvs84053)

  - cs_trans: NSO did not remove data dependent on NP-container existence in
    all scenarios. If an NP-container when-expression turned false the
    dependent data was left in CDB.

    (ENG-23080, RT:40437, PS-35519, CSCvs76689)

  - cs_trans: Resolved an issue where a HA setup could become indefinitely
    blocked for writes, triggered by a slave node connecting to a master
    node.

    (ENG-23064, RT:40478, PS-35560)

  - cs_trans: Corrected a fault where deleting a leaf caused a crash in NSO.
    The crash occurred when there was a default case containing two default
    leaves, the first default leaf had a when-statement on the second
    default leaf. The crash was caused by deleting the second leaf.

    (ENG-22787, RT:39684, PS-34760, CSCvs33016)

  - cs_trans: Deleting a mandatory leaf in a case whose choice resides
    inside a container case of parent choice and then setting a leaf in a
    sibling case (all in the same transaction) would lead to validation
    failure where NSO would falsely complain that the mandatory leaf is
    missing even though that case is no longer active.

    (ENG-22727, RT:39837, PS-34914, CSCvs24703)

  - cs_trans: A delete on a nested 'choice', with the top-choice being
    mandatory, incorrectly deleted the whole path of choice:s leading up to
    that nested 'choice'. NSO now check mandatory choice by choice when
    performing choices deletion.

    (ENG-22641)

  - cs_trans: NSO wrongly asked for mandatory leaf has when-true, under
    non-existence p-container. Now, If ancestor does not exist, NSO shall
    not require mandatory nodes of that subtree.

    (ENG-22628, RT:39724, PS-34796, CSCvs10082, SR:687864960)

  - cs_trans: maapi_delete_all(..., MAAPI_DEL_SAFE) used from i.e. "load
    replace" in the CLI could sometimes crash i.e. when attempting to delete
    YANG data nodes that are not writable or callpoints that are not
    registered. The function will no longer attempt to delete unwritable
    YANG data nodes.

    (ENG-22541, RT:39573, PS-34649, CSCvs00251)

  - cs_trans: MAAPI delete on a non-presence container path failed if its
    ancestor was created in the same transaction.

    (ENG-22332, RT:39289, PS-34364)

  - cs_trans: Module and submodule do not share prefix maps now.

    (ENG-21326, RT:37254, PS-32335, CSCvp61728)

  - cs_trans: If a service input parameter had a must statement referring to
    the service keys, NSO did not validate that before invoking the service
    callback.

    (ENG-20778, RT:36488, PS-31568)

  - documentation: Correct econfd:tagval() type.

    (ENG-23678, RT:41719, PS-36808, CSCvt85202)

  - documentation: diffie-hellman-group14-sha256 and
    diffie-hellman-group18-sha512 were missing from the
    '/ncs-config/ssh/algorithms/kex' description and have now been added.

    (ENG-23148, RT:40552, PS-35631)

  - documentation: NSO-4.7 is tested with Java 7 and 8.
    NSO-5.x is tested with Java 8 and 11.

    (ENG-23147, RT:40584, PS-35664)

  - documentation: Add missing 'ncs:pre-condition' statements to the
    pre-condition examples in the development book.

    (ENG-23061)

  - documentation: Removed documentation stating that
    tailf:cli-drop-node-name could not be used inside tailf:action.

    (ENG-7025, RT:30265, PS-9961)

  - java-api: Fix an error introduced in MaapiCrypto.decrypt that made the
    function throw an exception when trying to decrypt a value that was
    encrypted using a static IV.

    (ENG-23834)

  - java-api: In some cases, devices' mount point information was not used
    then ConfPath may find a tag in another namespace and add wrong prefix.
    This has been fixed.

    (ENG-23580, RT:41493, PS-36568, CSCvt63133, SR:688731143)

  - java-api: /java-vm/connect-time timeout now triggers only if the NSO
    Java VM did not initiate a connection towards the core process within
    the configured time, as originally intended. Previously it could trigger
    after the connection has been established, during NSO Java VM
    initialization, due to a bug.

    (ENG-23381, RT:40969, RT:41102, PS-36066, PS-36168, CSCvt22008,
    SR:688524057)

  - java-api: ConfIPv4 equals method now returns false rather than throwing
    a NullPointerException if called with null as argument.

    (ENG-23123)

  - java-api: Synchronized maapi operation in MaapiCrypto class to avoid a
    situation where two requests are dispatched on the same socket before
    one of them receives a reply.

    (ENG-23111, RT:40463, PS-35545, CSCvs82815)

  - java-api: Constructing a ConfObjectRef from an XPath resulted in an
    exception when list instances were positioned at root level.
    The reason was that root level nodes weren't checked if they contained
    keys.
    The root level node is now checked if it contains keys as well.

    (ENG-22783, RT:39865, RT:39957, PS-34942, PS-35035, CSCvs31227)

  - java-api: An exception thrown by an snmp4j class caused unnecessary
    restarts of the Java VM. This has been fixed.

    (ENG-22687, RT:41516, RT:40171, RT:39721, PS-36592, PS-35251, PS-34795,
    CSCvs19293)

  - java-api: When implementing a generic NED, previously NSO could not
    decode the value for a MOVED operation from NedEditOp class. New method
    NedEditOp.getMoveDestination() now returns the move destination and in
    case the move is relative to another list key NedEditOp.getValue()
    returns this key. See Javadoc for more information.

    (ENG-22414)

  - json-rpc: Calling the show_config method, with_oper set to true, could
    hang if the subsystem returned not well formed XML. This has been fixed.

    (ENG-23662)

  - json-rpc: The validate_commit JSONRPC call will now take an optional
    'flags' parameter to handle commit flags that might have an effect
    during the validate phase of a commit, e.g 'no-deploy'.

    (ENG-23530, RT:41800, RT:41389, PS-36894, PS-36459, CSCvt50485,
    SR:688650577)

  - json-rpc: Keypaths will now include a prefix when the namespace changes,
    where previously only the root node would have a prefix.
    E.g the path '/foo:foo/foo:bar/fizz:fizz/fizz:buzz' would be returned as
    '/foo:foo/bar/fizz:fizz/buzz' instead of '/foo/bar/fizz/buzz'.

    (ENG-23473)

  - nct: NCT now considers install_dir and run_dir options in hostsfile when
    executing nct backup commands.

    (ENG-22521, RT:39526, PS-34604, CSCvr98249)

  - netconf: NETCONF messages with a non UTF-8 encoding used to cause an
    error to be logged in the error log and the connection closed. For hello
    messages the connection is still closed, for other messages a proper
    error response is returned. No errors due to invalid encoding are logged
    to the error log.

    (ENG-23631)

  - netconf: Namespaces are now correctly returned for keys of type
    instance-identifier.

    (ENG-23521, RT:41373, PS-36442, CSCvt48281)

  - netconf: Fixed regression of XML parsing performance of augmented
    choices. This affected the performance of <get-data> parsing.

    (ENG-23324)

  - netconf: The fix for ENG-22909 changed the interpretation of the url
    parameter in source / target of <copy-config>. The path segment was
    interpreted as a relative path for the sftp/ftp protocols to align with
    the OpenSSH sftp(1) client. The change has been reverted and paths are
    now absolute. Users are recommended to run sftp/ftp daemons with support
    for chroot(2) to reduce the risk of exposing their filesystems for
    unintended read/write access.

    (ENG-23145, RT:40529, PS-35608, CSCvs88091)

  - netconf: If an xmlns prefix was used in <get-data>'s <xpath-filter>, NSO
    would reply with an error.  This bug has been fixed so that valid
    prefixes are accepted.

    (ENG-23117)

  - netconf: The data reply for the NETCONF get-data operation now includes
    the following xmlns string for the ietf-netconf-nmda namespace:
    <data xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-nmda"/>

    (ENG-22872)

  - netconf: Errors corresponding to new api operations in RFC 8639
    (Subscribed Notification) now aligns with the RFC specification.

    (ENG-22823)

  - netconf: When a dynamic subscription is killed, deleted, or if a stream
    is removed the notification 'subscription-terminated' is sent. See RFC
    8639 Section 2.7.3. "subscription-terminated".
    The rpc-error responses for 'delete-subscription' and
    'kill-subscription' are aligned with the RFC 8639 and RFC 8640.

    (ENG-22699)

  - netconf: Subscription state change event subscription-completed will be
    sent when provided stop-time has been reached.

    (ENG-22698)

  - netconf: When all replay events have been sent up to either provided
    stop-time or current time, the subscription state change event
    replay-completed will be sent.

    (ENG-22697)

  - netconf: Fixed an issue where NETCONF copy-config with-transaction-id
    returned old transaction-id in reply message.

    (ENG-22694, RT:39819, PS-34896, CSCvs19559)

  - netconf: Providing incorrect subscription id with operations modify-,
    delete- and kill-subscription now results in a proper error response.

    (ENG-22691)

  - netconf: Notifications now work when a notification includes a choice
    from a different namespace than the notification namespace.

    (ENG-22356, RT:39254, PS-34329, CSCvr72130)

  - python-api: When dealing with a large number of open files and sockets
    the Python API could fail with "ValueError: filedescriptor out of range
    in select()". The API is now using poll() instead of select() which
    supports file descriptors > 1023.

    (ENG-23354, RT:41062, PS-36162, SR:688535507)

  - restconf: The error tag for an unexpected query parameter has been
    changed from "malformed-message" to "invalid-value", see RFC 8040
    chapter 4.8 Query Parameters for details.

    (ENG-23852)

  - restconf: A proper HTTP error code (403 Forbidden) is now returned if an
    action is invoked in conflict with existing AAA rules denying access.
    This is valid both for the REST API and the RESTCONF API.

    (ENG-22621, RT:39700, PS-34775, CSCvs08708)

  - restconf: Deleting a service path via RESTCONF fails when invoking
    service callbacks or templates.

    (ENG-22340, RT:39301, PS-34376, CSCvr69422, SR:687353031)

  - restconf: If /ncs-config/restconf/root-resource in ncs.conf was
    configured as a nested path, GET requests for the RESTCONF Root Resource
    failed and yielded internal server error.

    (ENG-22143, RT:38638, PS-33710, CSCvr29300)

  - smart-licensing: Upgraded the smart licensing agent to latest maintained
    version. This also makes the new licensing event log to be written to
    the smartlic directory.

    (ENG-22828, RT:40015, PS-35094)

  - snmp-agent: In some special cases, the snmp-config-transform process may
    get stuck and does not terminate properly. This has been fixed.

    (ENG-23314, RT:40780, PS-35876, CSCvt10227, SR:688091660)

  - snmp-agent: The NSO CLI command "commit dry-run" was broken, it did not
    show SNMP changes correctly. This has been fixed.

    (ENG-23131, RT:40534, PS-35613, CSCvs85658, SR:688322825)

  - toolchain: If a leaf with default value had its type changed via
    deviation the default value was not validated with the new type. This is
    now fixed.

    (ENG-23596, RT:41515, PS-36591, CSCvt66309)

  - toolchain: NETCONF NED builder now correctly recognizes qualified
    identity name (e.g. `ncm:yang`) as a value for `location` leaf in
    ietf-netconf-monitoring list of schemas. Previously only identity name
    without prefix (e.g. `yang`) would be recognized although both forms are
    valid according to the YANG RFC.

    (ENG-23378)

  - toolchain: If a NED module had a "if-feature" statement with "not", the
    module would fail to compile. This bug has been fixed so that the module
    compiles properly.

    (ENG-23152, RT:40587, PS-35667, CSCvs88338)

  - toolchain: If a YANG module with an obsolete "augment" statement where
    the nodes in the "augment" were not obsoleted, were compiled with
    "--max-status deprecated", the nodes in the augment would still be
    added. This bug has been fixed so that the nodes are not added.

    (ENG-23108, RT:40376, PS-35456, CSCvs81838)

  - toolchain: If a YANG module with obsolete nodes in an "augment" were
    compiled with "--max-status deprecated", the obsolete nodes would still
    be added. This bug has been fixed so that the obsolete nodes are not
    added.

    (ENG-23029, RT:40376, PS-35456, CSCvs70634)

  - toolchain: Added option --kill-subscription=<subscription id> to tool
    netconf-console.

    (ENG-22769)

  - toolchain: Tool netconf-console can now handle all command line options
    for the operation establish-subscription.

    (ENG-22669)

  - toolchain: When config-true leafref points to config-false node in NSO
    packages, yanger wrongly rewrites the path of that leafref. This causes
    NSO reload package to fail. Now, yanger correctly rewrites the path of
    that leafref.

    (ENG-22442, RT:35651, PS-30727)

  - toolchain: If a deviation module contained multiple deviations of a
    given module, some XPath expression would fail to compile with an
    "Invalid namespace prefix" error.  This fix let these XPath expressions
    be compiled without errors.

    (ENG-22231, RT:38620, RT:39101, PS-33692, PS-34174, CSCvr45880)

  - toolchain: ncsc and yanger now validate must expressions in augment
    statements with a "when" statement in YANG 1.1 modules.

    (ENG-22173, RT:38962, PS-34034, CSCvr33900)

  - toolchain: If a deviation tried to delete one of many must statements,
    the selected must statement would not be deleted by the compiler.  This
    bug has been fixed so that the deletion works.

    (ENG-21747, RT:38075, PS-33150, CSCvq51461)

  - toolchain: ncsc now correctly handles type leafref referring to a config
    false element when this leafref is encapsulated in typedef and such
    typedef is used in a notification or an RPC when compiling a device
    model (i.e. with --ncs-compile-module or --ncs-compile-bundle flags).

    (ENG-20880, RT:34507, RT:37700, PS-29570, PS-32776, CSCvo86647)

  - toolchain: ncs-backup now checks $NCS_RUN_DIR to avoid generating
    invalid backup files.

    (ENG-20108, RT:35569, PS-30643, SR:685726860)

  - webui-one: The webui will now handle all selected commit flags while
    performing a commit. Previously some flags could be ignored during parts
    of the commit sequence, e.g 'no-deploy'.

    (ENG-24033)

  - webui-one: The webui will no longer throw an error when trying to render
    a choice with no cases.

    (ENG-23990, RT:42327, PS-37428, CSCvu43110, SR:689167030)

  - webui-one: When a webui-user tried to run apply-template on a
    device-group, no changes was seen in the Commit Manager. This has been
    fixed.

    (ENG-23611)

  - webui-one: The "config" and "native config" tabs in the Commit Manager
    will now show horizontal scrollbars if the content is too wide, instead
    of just cutting it at the window edge.

    (ENG-23553, RT:41454, PS-36529, CSCvt65833)

  - webui-one: Square brackets in list-keys will no longer cause the
    Configuration Editor to render a blank page.

    (ENG-23449, RT:41189, PS-36255, CSCvt34128)

  - webui-one: When a user tried to navigate to a choice with an augmented
    case. A loader was displayed instead of the case, the case is now
    displayed as expected.

    (ENG-23389)

  - webui-one: Failing to load a configuration file in the commit manager
    load dialog now displays an error message.

    (ENG-23186)

  - webui-one: When a leafref was configured with a faulty value, the error
    was rendered without the context link in the Commit manager's error tab.
    This is now rendered with the correct context link.

    (ENG-22884)

  - webui-one: A full page reload was run when a user clicked an empty list.
    Now the link loads as expected.

    (ENG-22838)

  - webui-one: Lists in actions will now show data from the correct
    transaction.

    (ENG-22742, RT:40038, PS-35117)

  - webui-one: A leafref with a default value is no longer rendered as an
    empty string in the configuration editor. It is now rendered with the
    default value enclosed in parenthesis.

    (ENG-22226)

  - webui-one: Increased readability of read only leafs, like operational
    data.

    (ENG-20938)

  - webui-one: Service instances that are not committed will no longer be
    shown in the Dashboard in the service instance widget.

    (ENG-19410)

  - xpath: Some expressions with descendant-or-self (or "//" in the short
    form) did not return all matching nodes.  This bug was introduced in NSO
    5.1, and is now fixed so that all matching nodes are returned.

    (ENG-22763, RT:39911, PS-34988, CSCvs29035)

  - xpath: An xpath-expression using name(), local-name(), or
    namespace-uri() crashed if they were used on a key. Before the fault was
    removed, it could be observed in the CLI as an internal error.

    (ENG-22630, RT:39688, PS-34764, CSCvs10192)

  - xpath: Validation tailf:dependency statement no longer fails on module
    when the statement is annotated from annotating modules to the
    submodules. The statement contains prefixes that imported by annotating
    modules only.

    (ENG-19766, RT:35076, PS-30146)

Known_Issues:

  - ncs: When a nano service performing staged deletes and finds that a
    delete precondition is not satisfied it sets up a precondition kicker to
    resume the progression once the delete precondition has been satisfied.
    If the kicker is set up at the same time as the precondition is satisfied,
    the kicker will not kick and the zombie will not progress further. Manual
    intervention (reactive-re-deploy) is needed to resume the progression of
    the zombie.

    (ENG-24246)

  - ncs: When a Reactive FASTMAP or a nano service is committed through the
    commit queue, the commit queue maintains related data under the service
    instance path (e.g. adds the pending commit queue items under
    plan/commit-queue or sets the failed leaf). These changes cannot be
    monitored by kickers.

    (ENG-24247)


NSO-5.3 [November 29, 2019]
===========================

Deprecated:

  - ncs: The NSO build toolchain is being modernized. This impacts the
    oldest version of glibc which is supported for use on Linux. As of
    NSO-5.4 release, the minimum version of glibc supported for Linux will
    be glibc-2.19.

    (ENG-22666)

  - cluster: Deprecate the device cluster feature of NSO. The feature will
    be removed in NSO 5.5 release. Customers using conventional device
    cluster are encouraged to use LSA cluster instead.

    (ENG-21955)

  - python-api: Python 3.4 has been deprecated and will be removed in NSO
    5.5. You should upgrade your Python environment and make sure everything
    works with Python 3.5 or higher.

    (ENG-22280)

  - ncs: Certain operations can be made to run in a backwards compatibility
    mode, making them behave as before, i.e., handling leaf-lists as single
    elements. The flags for controlling this behaviour are deprecated,
    and will be removed in NSO-5.4.
    For the iteration functions in the CDB and MAAPI APIs, the flag
    ITER_WANT_LEAF_LIST_AS_LEAF can be used to get the old behaviour, see
    the confd_lib_cdb(3) and confd_lib_maapi(3) manual pages.
    For data providers, the flag CONFD_DAEMON_FLAG_LEAF_LIST_AS_LEAF can be
    used to get the old behaviour, see the confd_lib_dp(3) manual page.

    (ENG-15312)

  - rest-api: The legacy REST API is deprecated since NSO 5.1 (released in
    April 2019) and is scheduled to be removed in NSO 5.3 (tentative release
    date June 2020).
    Users of the legacy REST API should use the RESTCONF API instead. The
    RESTCONF API is a standardized REST interface as defined in RFC 8040 and
    provides a number of improvements over the proprietary and legacy REST
    interface including the support for auto-generating Swagger/OpenAPI
    documents from YANG. Please see the NSO Book Northbound APIs: Migrating
    from REST to the RESTCONF API. We understand that this may require some
    adjustments to external systems that are integrated with NSO, please
    reach out to ask-nso-plm@cisco.com if you have any questions or concerns
    on this topic.

    (ENG-20521)

Removals:

  - ncs: otp_test_engine.so was removed from the NSO release, as it is not
    needed.

    (ENG-22411, RT:39385, PS-34462, CSCvr80117)

  - ncs: apply_trans_with_result() call in MAAPI has been removed in NSO
    5.3. It is suggested to use the new apply_trans_params() call instead.

    (ENG-21695)

  - cdb: cdb_cli_diff_iterate() has been removed.
    cdb_get_modifications_cli() should be used instead.

    (ENG-22327)

  - cdb: cdb_load_file() and cdb_load_str() and their corresponding
    alternatives in the Python and JAVA APIs have been removed.
    maapi_load_config() can be used as an alternative. As a consequence of
    this removal the confd_load -C flag has been removed, it can in most
    common scenarios be replaced with the flags -l -m -O

    (ENG-21673, RT:22320, PS-7148)

  - python-api: Python 2.7 is no longer supported. It will still be possible
    to use Python 2.7 until the next release, but no support will be given.
    Python 2.7 will be completely removed in NSO 5.4. Please use Python 3.5
    or higher.

    (ENG-22278)

  - restconf: It is no longer possible to use JSON-RPC for login and then
    use the returned session cookie for RESTCONF requests. This behaviour
    was unsupported and has been broken for a long time and is now removed.

    (ENG-22429)

  - restconf: The deprecated RESTCONF query parameters limit and offset have
    now been removed.

    (ENG-20873)

Non-backwards compatible enhancements:

  - ncs: Nano service zombies can now be activated with two different
    actions:  re-deploy or the reactive-re-deploy actions. The
    reactive-re-deploy is the new action, however, the definition of
    re-deploy has been changed.
    The difference between the two actions is which user the action uses.
    The re-deploy uses the current user that initiated the action whilst the
    reactive-re-deploy action keeps using the same user that last modified
    the zombie service.
    Refer to the "Zombie services" section in the Nano Services chapter of
    the Development Guide for details.

    (ENG-22622)

  - ncs: NSO's built in SSH server now supports ssh-ed25519 host and user
    keys. NSO now also supports ssh-ed25519 host keys for NETCONF NED
    connections.

    (ENG-22430, RT:38264, PS-33333)

  - ncs: NSO's default configuration, in the ncs.conf file written by the
    installer, for SSH host keys is now "ssh-ed25519" instead of the
    previous "ssh-rsa". To be able to connect to the built-in SSH server,
    the SSH client therefore must have support for "ssh-ed25519" as host key
    algorithm when the default configuration is in effect.
    This means OpenSSH is now required to be version 6.5 or later, and the
    python library paramiko, used by netconf-console, is required to be
    version 2.2 or later.

    (ENG-22320)

  - ncs: Add dry-run option to the resurrect action for Nano Service zombies
    to show what will be done when resurrecting a zombie.

    (ENG-22212)

  - ncs: NSO is now built with CiscoSSL version 1.1.1d.7.1.113 which is
    based on OpenSSL 1.1.1.d. Please note that the corresponding ConfD
    version of libconfd has OpenSSL dynamically linked in and is based on
    OpenSSL 1.0.0.j.

    (ENG-21623)

  - ncs: Error handling for external-command used for encryption strings has
    changed. If the external command fails during startup, the startup will
    abort. If the command fails during a reload the error will be logged and
    the previously loaded keys will be kept in the system.

    (ENG-21444)

  - c-api: Support for 256 bit encrypted strings was added:
    tailf:aes-256-cfb-128-encrypted-string. Internal NSO usage of
    tailf:aes-cfb-128-encrypted-string is now using
    tailf:aes-256-cfb-128-encrypted-string. Make sure you configure a
    encrypted-strings/AES256CFB128 256 bit encryption key for the upgrade to
    succeed.

    (ENG-21206)

  - cli: Setting the use-expose-ns-prefix to false in ncs.conf would not
    result in correct hiding of prefixes in /devices/device/config. Prefixes
    would still be displayed for "false" name conflicts, ie conflicts
    between nodes in different namespaces in different NEDs. This has now
    been fixed, and the default value for use-expose-ns-prefix has been
    changed from "true" to "false" starting in release 5.3.

    (ENG-22481)

  - cli: The default for the ncs.conf setting use-expose-ns-prefix has been
    changed from true to false with the result that prefixes are not
    displayed for nodes under /devices/device/config by default. To retain
    the old behaviour set the use-expose-ns-prefix to true.

    (ENG-22297)

  - java-api: Support for the following key exchange algorithms has been
    added in the ganymed-ssh-2 library used by the Java-based NEDs:
    - diffie-hellman-group14-sha256
    - diffie-hellman-group16-sha512
    - diffie-hellman-group18-sha512

    (ENG-21932, RT:37256, RT:38539, PS-32337, PS-33609, SR:687208341)

  - java-api: The Java API is now built with a Java 8 compiler and will
    require a and will require a minimum of a java 8 VM.

    (ENG-20799)

  - java-api: Java 6 & 7 are removed as supported Java versions as there are
    no support of them in the Java community. NSO is now built with Java 8.

    (ENG-20208, RT:37926, PS-33000)

Enhancements:

  - ncs: Nano services post-actions now register the start of the action in
    the post-action-status as a create-init or delete-init respectively.

    (ENG-22634)

  - ncs: The Nano services PLAN variable only point to the plan location in
    the create case. In the delete case this plan is located in the
    zombie-list.
    The PLAN variable now correctly reflects the plan location in either
    case.

    (ENG-22582)

  - ncs: Progress trace events outputted in the CLI, that have a start and
    stop, are now printed as one line if they occur right after each other.
    For example, the following two events:
     2019-11-15T14:47:22.100 run dependency-triggered validation...
     2019-11-15T14:47:22.122 run dependency-triggered validation done [0.022
    sec]
    will now be printed as:
     2019-11-15T14:47:22.100 run dependency-triggered validation... done
    [0.022 sec]

    (ENG-22581)

  - ncs: There are now progress trace events for when data kickers are
    checked and when changesets are distributed to slave nodes.

    (ENG-22551)

  - ncs: Optimized performance of an internal function to look up elements
    of the data model in concurrent access scenarios.

    (ENG-22420)

  - ncs: Previously you would have to restart all subscriptions to NETCONF
    notifications for a change to the
    /devices/device/netconf-notifications/received-notifications/max-size
    leaf to take effect. Now a change will take effect immediately without
    the need to restart any subscriptions.

    (ENG-22290)

  - ncs: Improved performance of loading, adding, and removing kickers for
    systems that have a lot of kickers on the same node.

    (ENG-22260)

  - ncs: Removal of kickers created as part of nano-services has been
    optimized.

    (ENG-22253)

  - ncs: Whenever a transaction wants to commit and has to wait for other
    writers, the length of the queue is now logged in the developer log.

    (ENG-22249)

  - ncs: Abort the creation of a nano service's instances when an old
    external plan already exists for the new instance.

    (ENG-22211)

  - ncs: When generating a link to NSO compliance report, an https:// link
    will now be generated if the NSO WebUI server has SSL transport enabled.

    (ENG-22030, RT:38720, PS-33793, SR:687369979)

  - ncs: Add support for dynamic plan locations in nano services.

    (ENG-22015, RT:38687, PS-33760, CSCvr08539)

  - ncs: Added support to have duration calculated from progress trace
    events emitted by the NEDs. Two new methods in the Maapi Java class,
    reportDeviceProgressStart and reportDeviceProgressStop, have been added
    for this.

    (ENG-21938, RT:38481, PS-33550)

  - ncs: When changing NSO version of a lower node in an LSA cluster the
    device on the upper node needs to be migrated. Added
    'lsa-additional-ned-id' parameter to the /devices/device/migrate action
    so that NED identities derived from the 'ned:lsa-netconf' identity could
    be migrated.
    Added 'ned-id' parameter to /devices/device/delete-config action which
    makes it possible to delete the configuration for a specific NED
    identity. This is useful, for example, when you want to remove a NED
    identity configured under the 'lsa-additional-ned-id' list.
    Improved error handling and checks concerning modifying or deleting NED
    identities.

    (ENG-21895, RT:38560, PS-33632)

  - ncs: The diffie-hellman-group14-sha256 and diffie-hellman-group18-sha512
    key exchange algorithms are now supported by the built-in SSH server and
    the NETCONF NED SSH client.

    (ENG-21893, RT:37944, PS-33019)

  - ncs: Optimized validation of instance identifiers with "require-instance
    true" that do not have "tailf:path-filters".  Such nodes used to be
    validated at every commit (during the "global validation" phase), but
    are now validated only when their target nodes have been modified.

    (ENG-21828, RT:38313, PS-33382, CSCvq72028)

  - ncs: Performance has been improved in cases where a configuration entry
    has hundreds of (or more) service backpointers.

    (ENG-21813)

  - ncs: Nano-services: The plan component states now contain the same
    modified and directly-modified oper data containers as the service
    itself, to show which stacked services and which devices were affected
    by the Nano state.

    (ENG-21807)

  - ncs: Add support for using the password of the local user as a secondary
    password by setting the leaf 'same-secondary-password' in an authgroup.

    (ENG-21775, RT:38154, PS-33229, SR:687096549)

  - ncs: Nano-service post-actions can now implement input by using the
    predefined grouping ncs:post-action-input-params. This grouping
    describes both the service opaque key/value list, as well as the plan
    component key/value list. These values can then be accessible from
    inside the executing action.

    (ENG-21739)

  - ncs: The performance of NSO, when dumping out a big configuration, e.g.
    with NETCONF get-config, on a system with many 'when' statements and
    many top-level nodes, was low in ConfD-7.1 compared to older NSO
    versions. The performance has now been improved and expected to be on
    par with older versions.

    (ENG-21723, RT:37994, PS-33069, CSCvq44777)

  - ncs: Nano-services: actions residing in the nano service can now also be
    used as post-actions during delete phase when the service is a zombie.
    Previously this did not work but now these actions are called in the
    temporary service transaction that is used by the delete staging of the
    service. This implies that the service data is readable in the
    transaction that is submitted to the action.

    (ENG-21675)

  - ncs: Removed extra when evaluation when reading leaf from an internal
    data provider, for example CDB.

    (ENG-21672)

  - ncs: In NSO a lot of transactions are created with another transaction
    as back end. Before when-expressions were evaluated in all transactions,
    now only in the front most transaction are evaluated. This leads to some
    performance gain for normal services and more performance gain for nano
    services. The effect depends on the number and complexity of
    when-expressions in the YANG model.

    (ENG-21547)

  - ncs: Given that utilize-replay was configured false for a NETCONF
    notification stream, when configuring it true NSO now ignores any
    notifications that occurred while utilize-replay was false.

    (ENG-21420, RT:37424, PS-32503)

  - ncs: Add support for invoking actions under /devices/device/live-status
    using the configured live-status-protocol NEDs in addition to invoking
    them using the main NED. The NED to use is determined automatically
    based on the XML namespace of the action.

    (ENG-21232, RT:37505, PS-32582)

  - ncs: The handling of the instance-identifier YANG type is improved when
    CDB upgrade in phase0.

    (ENG-21227)

  - ncs: Add optimization for leafref handling, that would rewrite XPath
    expression, when the leafref path contains subpath, in which the list's
    key is a leafref, points to the target node inside the same instance.

    (ENG-21146, RT:35156, PS-30227)

  - ncs: A new development feature for processing/filtering log files using
    an external command is now available. See the "External Logging" chapter
    of the NSO Development guide for details.

    (ENG-20564, RT:36565, RT:36640, RT:35448, RT:37328, PS-31645, PS-31720,
    PS-30522, PS-32407)

  - ncs: A number of improvements around `packages package ... redeploy`
    behaviour:
    - templates are now reloaded as a part of redeploy
    - the updates are now minimal, so only the components that have changed
    are reloaded. For example, if only templates have been updated but not
    the Python code, then the Python VM is not restarted, but only the
    updated templates are reloaded.

    (ENG-20488)

  - ncs: Add special handling to allow NSO to manage Juniper JunOS devices
    in RFC-compliant mode over NETCONF. When a JunOS device is detected to
    run in RFC-compatible mode, NSO determines the capabilities from the
    list of schemas announced in the ietf-netconf-monitoring model and
    disables special handling used for JunOS devices managed over
    conventional JunOS XML API.
    NSO supports RFC-compliant mode of operation for JunOS devices with
    software version 18.4 or greater and both RFC-compliant and
    YANG-compliant configuration parameters set. Managing the JunOS devices
    with RFC-compliant behaviour switched off is still supported over the
    conventional JunOS XML protocol, using the juniper-junos NED.

    (ENG-18935, RT:34063, PS-29235)

  - ncs: NSO implements Network Management Datastore Architecture (NMDA) as
    defined in RFC 8342 and supports the mandatory datastores running,
    intended, and operational, and the optional datastores startup and
    candidate.  The NETCONF and RESTCONF protocol implementations in NSO are
    also extended to support NMDA as defined in RFC 8526 and RFC 8527
    respectively.
    Current implementation does not support the origin metadata annotation.

    (ENG-18294, RT:34066, PS-29232)

  - aaa: As designed, the FASTMAP code runs without an access check. This
    allows administrators to grant indirect but controlled access to user to
    execute device configuration changes on devices that they are not
    allowed to configure directly.
    The leaf /nacm/enforce-nacm-on-services has been introduced to allow NSO
    administrators to control this behavior: they can now enforce NACM rules
    even on changes done by services.
    Refer to the "NACM Rules and Services" section in the AAA chapter of the
    Administration Guide for details.

    (ENG-20296, RT:35225, PS-30296, SR:685387296)

  - c-api: Removed a backwards compatibility support method for passing
    display hint strings towards clients, since the method became obsolete.

    (ENG-21520)

  - c-api: cdb_get_modifications_cli() now supports the new flag
    ITER_WANT_CLI_ORDER. The flag is required to get modifications in CLI
    order if the change was triggered using cdb_trigger_subscription().

    (ENG-20569, RT:33366, PS-28851)

  - cli: The C-style command "show configuration <path>" now accepts range
    expressions in the <path> argument. This makes it possible to issue
    commands such as "show configuration interface vlan1-3". The same
    support has been added to the "compare running brief <path>" command in
    the J-style CLI.

    (ENG-22317, RT:39270, PS-34345, CSCvr62495)

  - cli: A new pipe target has been added to show commands called "icount".
    It instructs the command to count the matching instances. For example,
    # show running-config aaa authentication users user | icount
    Found 4 instances.
    # show running-config aaa authentication users user * gid 1000 | icount
    Found 4 instances.
    # show running-config aaa authentication users user a* gid 1000 | icount
    Found 1 instance.
    # show running-config aaa authentication users user a* | select gid 1000
    | icount
    Found 1 instance.

    (ENG-22289)

  - cli: The CLI has been adapted to support NMDA, through the new
    (optional) command 'show operational-state'.

    (ENG-22268)

  - cli: The C-style configuration diff (e.g. commit dry-run outformat
    native), where the change-set would contain lists annotated with
    diff-dependencies (tailf:cli-diff-after) would in some cases take a very
    long time to calculate. This has now been optimized.

    (ENG-21796, RT:38157, PS-33232, CSCvq66028, SR:686987935)

  - cli: A new option has been added to the pattern CLI command parameter
    type called "unhide". It allows a space separated list of hide groups to
    be specified. It will be visible during completion of the parameters.

    (ENG-21767, RT:38139, PS-33214)

  - cli: The C-style southbound diff (eg. commit dry-run outformat native),
    where the change-set would contain lists annotated with
    diff-dependencies (tailf:cli-diff-before/after etc.) would in some cases
    take a very long time to calculate. This has been optimised in those
    cases where the dependency XPath expression would not contain any
    predicates and/or other comparisons/function calls.

    (ENG-21551)

  - cli: Two new ncs.conf settings have been added for controlling how
    completion alternatives are displayed. It is called
    /cli/show-action-completions{true/false}, and
    /cli/action-completions-format{string}. If set to true then all
    completions related to actions will be shown separately under the header
    configured as action-completions-format. Default is false.

    (ENG-21392, RT:37446, PS-32525, SR:686647299)

  - cli: When using ordered-by user lists performance in the CLI could
    quickly degrade if a lot of entries exist in that list. The performance
    surrounding has been improved.

    (ENG-21335, RT:36676, PS-31756)

  - cli: Command info texts were added to all the intermediate built-in
    commands which missed them.

    (ENG-19633)

  - ha: When a new node with role "slave" is added, more logging has been
    added to shows what kind of data that is being synced. Look for "HA:
    syncing"

    (ENG-19857, RT:34742, PS-29808, SR:685250845)

  - java-api: Reading device configuration using the from-transaction or
    to-transaction handlers provided to the NED code became slower when the
    transaction involved multiple devices and the configuration was accessed
    simultaneously from several NED threads. This has been improved so the
    access time does not grow with the number of devices in the transaction.

    (ENG-21711, RT:38008, PS-33083, CSCvq41478, SR:686863577)

  - java-api: A data provider may now choose to return a ConfXMLParam[] from
    the getIteratorObject callback, and a List<ConfXMLParam[]> from the
    getIteratorObjectList callback.

    (ENG-21233, RT:37066, PS-32148)

  - java-api: The logging API has been upgraded from log4j 1.2.17 to log4j2
    2.11.1. There are some fundamental changes between log4j and log4j2
    which includes: Configuration files need to be called log4j2.xml or
    .properties instead of log4j.xml.
    The syntax of said configuration files is different.
    Support for old log4j methods exist through a wrapper, however they are
    deprecated. The core API of log4j2 may be changed in minor releases of
    log4j2, which might require changes in our code.

    (ENG-19895, RT:35238, PS-30309)

  - json-rpc: JSON-RPC action input parameters are intended to be treated in
    a similar fashion as config data. This is accomplished by the parameter
    'action_path' to the operation 'new_trans'.

    (ENG-18324)

  - netconf: Added support for RFC 8639 "Subscription to YANG Notifications"
    and RFC 8640 "Dynamic Subscription to YANG Events and Datastores over
    northbound NETCONF".
    The "ietf-subscribed-notifications" YANG module is exported only to
    NETCONF and compiled with features: encode-xml, replay, xpath, and
    subtree, and also deviated to not support storage of subtree filters in
    the configuration.
    The legacy "create-subscription" RPC from RFC 5277 is still supported.

    (ENG-22486)

  - netconf: Enabled support for notification interleaving in the NSO
    NETCONF server.

    (ENG-22160, RT:38947, PS-34019)

  - netconf: The fix for ENG-16113 (NACM fix) led to performance degradation
    in some cases. The performance is now roughly the same as before that
    fix.

    (ENG-22053, RT:38806, PS-33877, CSCvr15505)

  - python-api: The classes 'Subscriber', 'OperSubscriber' and
    'TwoPhaseSubscriber' are moved from the 'experimental' module to the
    'cdb' module, and are now officially supported. Existing code using
    these must be updated with the new location of the classes.

    (ENG-22303)

  - python-api: NSO Python VM startup has been synchronized, so that the NSO
    will not complete phase 2 at startup or complete package reload in case
    of in-service upgrade until the Python VMs for all packages have been
    started and initialized. An additional oper-status
    'python-uninitialized' for a Python package has been defined reported
    when the Python VM corresponding to the package not running (similarly
    to 'java-uninitialized' for Java packages).

    (ENG-20132, RT:35571, PS-30645)

  - python-api: Added support for Python upgrade components. See "The NSO
    Python VM" in the Development Guide for details.

    (ENG-19515, RT:37252, RT:34734, PS-32333, PS-29801)

  - python-api: A new method maagic.List.filter() is added to utilize the
    list filter functionality introduced in NSO 5.1.

    (ENG-19490, RT:29874, PS-9764)

  - rest-api: REST requests and responses are now audit logged.
    After a basic protocol sanity check the REST request is audit logged
    with HTTP method, path, and version.
    When the request is done and the server sends a response, it is audit
    logged with HTTP method, path, version, and duration.

    (ENG-22322, RT:36798, RT:36935, RT:36514, PS-31879, PS-32017, PS-31594)

  - restconf: RESTCONF requests and responses are now audit logged.
    After a basic protocol sanity check the RESTCONF request is audit logged
    with HTTP method, path, and version.
    When the request is done and the server sends a response, it is audit
    logged with HTTP method, path, version, and duration.

    (ENG-22323, RT:36798, RT:36514, RT:36935, PS-31879, PS-31594, PS-32017)

  - smart-licensing: The smart licensing component was upgraded to the
    latest maintained version.

    (ENG-21865, CSCvq80015)

  - toolchain: The 'netconf-console' script has been adapted to support
    NMDA. Two new options, '--get-data' and '--edit-data' have been added.

    (ENG-22358)

  - toolchain: Python 2 is no longer required when using ncsc
    --ncs-compile-mib-bundle

    (ENG-21951, RT:38485, PS-33554, SR:686917564)

  - toolchain: The compiler 'ncsc' will now check that specified YANG
    features actually exist, unless '--ignore-unknown-features' is
    specified.

    (ENG-13019, RT:29176, PS-9435)

  - web-server: A number of fixed HTTP headers can now be configured in the
    confd/ncs.conf file, as well as any arbitrary HTTP header. This can be
    done both in the 'webui' part as well as in the 'restconf' part of the
    configuration, independently.

    Note: The X-Frame-Options header didn't work as it wasn't possible to
    modify its default value. Hence it had to be renamed to x-frame-options,
    which is a backwards incompatible change.

    (ENG-21327)

  - webui-one: In the web-ui, the behaviour when trying to set a value to an
    empty string is changed. If an empty string is not a valid value, it
    will result in the old value being deleted. As an example, if an integer
    leaf has the value 8, trying to set the value to an empty string will
    result in the leaf being deleted.

    (ENG-22492)

  - webui-one: Settings version number on main .css and .jss files on webui.
    This will force the browser to use the new files and not cached ones.

    (ENG-22465)

  - webui-one: Merge search- and label-field into one input field.

    (ENG-22210)

  - webui-one: Added additional help resources in webui-one's help dialog.

    (ENG-22119)

  - webui-one: Validation errors and validation warnings are separated into
    two tabs in the commit manager.

    (ENG-22096)

  - webui-one: Added a link to the parent container/list of a leaf with a
    warning or error in the Commit Manager.

    (ENG-22047)

  - webui-one: Add possibility to choose which columns to show/hide in
    service manager

    (ENG-22012)

  - webui-one: If there are conflicts in the current transaction, they will
    be shown in the errors tab in the Commit manager. A button called
    "resolve-conflicts" will also be visible, allowing the user to resolve
    the conflicts.

    (ENG-21946)

  - webui-one: Action buttons and action output in device/service manager
    are updated for better readability and clearer status.

    (ENG-21894)

  - webui-one: In the case when the device manager uses a text filter or
    device group filter. The filter criteria will be presented above the
    device list.

    (ENG-21890)

  - webui-one: Plan design is updated for better readability

    (ENG-21838)

  - webui-one: Added indicators to hint at what type of content exists on
    the page in the Configuration editor, regardless of the current view
    options.

    (ENG-21484)

  - webui-one: Redesign of empty leaf type

    (ENG-21296)

  - webui-one: Make alarms on dashboard into clickable links

    (ENG-20748)

  - webui-one: Added a button to clear the action output result.

    (ENG-20607, RT:37527, RT:36342, PS-32604, PS-31421)

  - webui-one: Added filter search functionality to the service and device
    manager.

    (ENG-20220)

  - webui-prime: When a service point is selected in the Service manager and
    if a text filter is applied to the list, the path to the service point
    and the filter criteria will be presented above the service list.

    (ENG-22168)

Non-backwards compatible corrections:

  - ncs: When maapi_diff_iterate() was called, it was not specified what
    happened if a list entry was both moved and created,  or moved and
    modified. The old behaviour was that if the entry was created and moved,
    the callback was invoked twice, once with MOP_CREATED and once with
    MOP_MOVED_AFTER.  But if the entry was modified and moved, the callback
    was only invoked with MOP_MOVED_AFTER.
    This has now changed so that also in the latter case the callback is
    invoked twice, first with MOP_MODIFIED and then with MOP_MOVED_AFTER.
    The behaviour is now documented in confd_lib_maapi(3).
    The old behaviour also lead to a bug; if a service was ordered-by user,
    and a service instance was both modified and moved, the service code
    would not be invoked.

    (ENG-22478, RT:39426, PS-34503)

  - ncs: The NACM tests for NETCONF and XML loading have been optimized and
    modified so that they follow the behaviour in RFC 8341.  Specifically,
    access is now always checked for the effective operation, rather than
    the incoming operation.

    (ENG-22421)

  - ncs: Encrypted strings that are of types
    tailf:aes-256-cfb-128-encrypted-string,
    tailf:aes-cfb-128-encrypted-string and tailf:des3-cbc-encrypted-string
    starting with "$9$", "$8$" and "$7$" respectively are now rejected if
    entered in the wrong context.

    (ENG-22255)

  - ncs: When NSO decoded base64-encoded values, it would silently ignore
    any character outside the base64-alphabet.  This behaviour is illegal
    according to RFC 4648, and it can lead to surprising effects.  This bug
    has been fixed.

    (ENG-22018)

  - ncs: Update order of preferred SSH algorithms according to
    specification.

    (ENG-21936)

  - ncs: Nano Services component execution order was reversed and this has
    been changed to the order in which they are stored and shown. This is a
    backwards incompatible change, however the implementation of the Nano
    service manager will (by reevaluation) adapt for this change. This
    implies that the outcome of a commit/re-deploy in normal circumstances
    are the same.

    (ENG-21766)

  - ncs: NSO ignored standard length statement in hex-string type. This has
    been corrected now.

    (ENG-21680, RT:37877, PS-32951, CSCvq33373)

  - ncs: Previously there was an internal error instead of a proper one when
    trying to apply a template without a working transaction. This has now
    been fixed.
    Renamed misspelled error code NCS_ACTION_NO_TRANSCTION to
    NCS_ACTION_NO_TRANSACTION.

    (ENG-21503, RT:37629, RT:38265, PS-32706, PS-33334, CSCvp97140)

  - ncs: It was not possible to set a leaf of type binary with a
    tailf:display-hint to a base64 encoded value over NETCONF or RESTCONF.
    This bug has been fixed.

    (ENG-20708, RT:35664, PS-30740)

  - cdb: Mixed subscribers can now receive configuration and operational
    change notifications arbitrarily interleaved with each other. This comes
    as a consequence of fixing a crash in diff iteration that could happen
    on mixed overlapping subscriptions where the next notification was
    queued before the subscriber synced the subscription. If this is a
    problem, use separate sockets for operational and configuration
    subscriptions. With this change cdb_sync_subscription_socket() now
    rejects CDB_DONE_PRIORITY for operational notifications as initially
    intended.

    (ENG-21957, RT:38609, PS-33681, CSCvq97822)

  - netconf: NETCONF notifications have been corrected so that they respect
    if augmented modules are not exported.

    (ENG-21504, RT:37595, PS-32672)

  - netconf: The netconf-console command now identifies (and returns exit
    status 1) if the server crashed before returning any result.

    (ENG-21489)

  - netconf: The netconf-console command now differentiates between a
    missing xmllint command (exit status 127) and returned bad XML (exit
    status !=0).

    (ENG-21334)

  - rest-api: A user session is now created for every REST API request that
    passes a basic protocol sanity check. Prior to this change the user
    session was created when it was needed, which lead to that some actions
    could be performed without a trace.
    Some bad requests still do not create a user session, this is a trade
    off to avoid flooding the audit log.

    (ENG-22428)

  - rest-api: Deny unauthorized OPTIONS requests.
    HTTP OPTIONS were allowed for unauthorized requests. This could lead to
    information leaks where an unauthenticated attacker could poke resources
    to check for existence.
    HTTP OPTIONS are now denied if they are not authenticated.

    (ENG-22413, CSCvs16485)

  - restconf: Deny unauthorized OPTIONS requests.
    HTTP OPTIONS were allowed for unauthorized requests. This could lead to
    information leaks where an unauthenticated attacker could poke resources
    to check for existence.
    HTTP OPTIONS are now denied if they are not authenticated.

    (ENG-22363, CSCvs16485)

  - restconf: Requesting a single list item should render the JSON output to
    be wrapped inside a list in the same way as requesting the complete
    (parent) list, see: rfc8040#appendix-B.3.9

    (ENG-22025, RT:38480, RT:39131, PS-33549, PS-34204, CSCvr09504)

  - restconf: A user session is now created for every RESTCONF request that
    passes a basic protocol sanity check. Prior to this change the user
    session was created when it was needed, which lead to that some actions
    could be performed without a trace.
    Some bad requests still do not create a user session, this is trade off
    to avoid flooding the audit log.
    Additionally the deprecated and defunct method of using JSON-RPC to
    login and using that session cookie for RESTCONF requests have been
    removed. See ENG-22429.

    (ENG-19138)

Corrections:

  - ncs: As design, FASTMAP code runs without access check. This allows
    administrators to grant indirect but controlled access to users to
    execute device configuration changes on devices that users are not
    allowed to configure directly.
    When Nano Services are created, modified or progressed forward as a
    Reactive FASTMAP service this design decision is honoured. However, in
    case of zombie revive-redeploy it was not. This made the create / delete
    inconsistent and might have resulted in corrupted CDB. Now zombie
    revive-redeploy runs without access check as well.

    (ENG-22623)

  - ncs: For Nano services the aggregated device-list was not correctly
    maintained as the sum of all plan/component/state device-lists. This has
    been fixed.

    (ENG-22558)

  - ncs: An internal error will no longer be displayed to the user when the
    file transfer has finished using the /devices/device/scp-to or
    /devices/device/scp-from action.

    (ENG-22512, RT:39414, PS-34491)

  - ncs: NSO would try to set the users groups when executing a sub command
    as root. This has been fixed.

    (ENG-22468, RT:39464, PS-34542, CSCvr89095)

  - ncs: An incomplete list iteration using MAAPI left resources allocated
    on the server side as long as the transaction was still alive. This led
    to increased memory usage in the NSO server. A call to
    maapi_destroy_cursor() now cleans up resources on the server as well as
    the client. Resources are also cleaned up when a Java MaapiCursor is
    garbage collected. For this fix to have any effect, both the client and
    the server need to be updated.

    (ENG-22461, RT:39314, PS-34389, CSCvr87895)

  - ncs: Deletion of multiple instances of a nano service in one commit will
    now update the backpointer list and refcount correctly for the changed
    data.

    (ENG-22438, RT:39378, PS-34455, CSCvr85119)

  - ncs: Fix issue where the connection closed by device due to inactivity
    and reconnected with a different connection ID would abort the ongoing
    operation.

    (ENG-22427, RT:38640, PS-33712, CSCvr83762, SR:687307912)

  - ncs: Modifying a service instance does no longer result in an internal
    error when a schema node that is not below a mountpoint, and the service
    has written to, has been deleted or a list key has changed in the path
    to the node.

    (ENG-22390)

  - ncs: Corrected a bug where a mandatory leaf under a choice would not be
    removed when doing a delete on the leaf through the CLI or JSON-RPC.

    (ENG-22316)

  - ncs: The reactive-re-deploy action will use the commit parameters
    identical to the latest commit involving the service. If the latest
    commit were committed with the 'commit-queue error-option' parameter,
    the reactive-re-deploy would give an internal error. This has now been
    fixed.

    (ENG-22307)

  - ncs: Dependencies were not triggered for Generic NEDs when abort()
    method was called even if the ordered-diff flag was activated in the
    package-meta-data.xml. Hence the order of the NedEditOp array was
    incorrect in this case. This is now fixed.

    (ENG-22250)

  - ncs: NETCONF notification kickers could stop kicking if the user session
    was lost. This could happen if an action accidentally closed the user
    session. A lost user session is now recreated and the action retried.

    (ENG-22243, RT:39079, PS-34152)

  - ncs: Fixed an issue where NSO included unaccounted for time in the
    progress log when a transaction was aborted.

    (ENG-22242, RT:36578, PS-31658, CSCvr47372, SR:686282349)

  - ncs: When a customer's name in, /ncs:customers/customer, contained
    double quote  this lead to an error when the list was displayed in
    operational mode.

    (ENG-22241, RT:38976, PS-34048, CSCvr51463, SR:687211225)

  - ncs: The cipher AES CFB 128 is now using the EVP interface for all key
    sizes.

    (ENG-22234)

  - ncs: Fixed an issue where NED compiling a data model which included a
    uses statement, containing an augment statement, augmenting a config
    false node would fail.

    (ENG-22221, RT:37406, PS-32485, CSCvp70155)

  - ncs: Write a log entry to the zombie and external plan service-log when
    a zombie re-deploy is aborted.

    (ENG-22214)

  - ncs: Fix issue where a resurrect for a zombie instance doesn't work for
    nano services with external plans.

    (ENG-22213)

  - ncs: A bug in the template engine caused the effects of the processing
    instructions, for example set-root-node, to apply after the closing
    parent XML tag in case this tag represents a YANG container node. NSO
    now makes sure that the effect of the processing instruction stays
    within the scope of the parent XML tag.

    (ENG-22209, RT:39087, PS-34160, CSCvr41982, SR:687543971)

  - ncs: There was a bug in NETCONF delete on leafs with when- and
    default-expressions, this bug also affected any other delete with
    "delayed_when" enabled such as maapi_set_delayed_when. For the user it
    looked like the leaf with the when-expression had already been deleted.

    (ENG-22162)

  - ncs: Fixed cases where multiple simultaneous write transactions could
    result in unnecessary back-off and log entries saying "the datastore
    running is locked in CDB"

    (ENG-22142)

  - ncs: Loading Juniper style files using one of maapi_load_config(), "load
    merge" in the CLI or loading rollback files now honors ordering of items
    when updating ordered-by user lists.

    (ENG-22132, RT:38113, PS-33189, CSCvr25873)

  - ncs: If a module had two leaf-lists of leafrefs to different targets,
    tab completion in the CLI would not work. This bug was introduced in 5.1
    and is now fixed.

    (ENG-22075, RT:38860, PS-33931, CSCvr21270)

  - ncs: Nano service manager alarm submission has been improved.

    (ENG-22037)

  - ncs: A Nano-service state create callback that produced config and set
    the status back to not-reached would be subject to erroneous ref-counts
    in the config. This has been fixed

    (ENG-22003, RT:38700, PS-33773, CSCvr06751)

  - ncs: When doing a 'package reload' if one of the package's components
    didn't come up due to an error it could prevent other components from
    going up too. This has been fixed so that different components of the
    package are reloaded independently (unless they depend on each other in
    other ways than being defined as a part of the same package).

    (ENG-21978, RT:38611, PS-33683, CSCvr00370)

  - ncs: It is now possible to use the init script to start and restart the
    NSO daemon via systemctl and reload all packages in an unsafe manner by
    overriding warnings if any. Usage;
      /etc/init.d/ncs start-with-package-reload-force
      /etc/init.d/ncs restart-with-package-reload-force or
      NCS_RELOAD_PACKAGES=force /etc/init.d/ncs start
      NCS_RELOAD_PACKAGES=force /etc/init.d/ncs restart

    (ENG-21958, RT:38610, PS-33682, CSCvq97886)

  - ncs: A redeploy of a nano service, after NED migration and/or removal of
    packages, could render an internal error.

    (ENG-21947)

  - ncs: The ned-id could be changed for CLI and generic devices even if
    configuration existed. CLI and generic devices now behaves the same as
    NETCONF devices.

    (ENG-21941, RT:38559, PS-33631)

  - ncs: This affects LSA cluster only. When using the action
    /devices/device/delete-config on an LSA device on the upper node, the
    configuration was deleted on the lower node as well. The action now
    commits the deletion with the commit flags: no-networking and no-lsa.

    (ENG-21922)

  - ncs: NSO did not qualify the namespace for input params in action/rpc's
    that were augmented from another module.

    (ENG-21885, RT:38283, PS-33352, CSCvq85582)

  - ncs: When committing through the commit-queue via the REST/RESTCONF API,
    the response received might not have been in the expected format
    specified by the Accept header. In addition, if the response would have
    indicated failed devices in the queue item, the JSON response would be
    incorrectly formatted. These issues have now been fixed.

    (ENG-21869, RT:38411, PS-33480, CSCvq80649, SR:687221077)

  - ncs: If creating a NETCONF notification subscription to a lower LSA node
    before adding the LSA additional NED identity derived from the
    'ned:lsa-netconf' identity, notifications will not be received until NSO
    is restarted or the subscription changed. This has now been fixed.

    (ENG-21866)

  - ncs: Devices with no configuration and no capabilities would have the
    ned-id set to NETCONF, when migrating from 4.6 and 4.7 to 5.x. The
    ned-id is now correctly set to the correct new ned-id. For this to work
    however the issue 'NEDCOM-294' needs to be part of the used NED version.
    See the CHANGES note of the used NEDs

    (ENG-21848)

  - ncs: If for some reason the servicepoint daemon for a template service
    would crash it would not be restarted. The servicepoint registration
    would disappear and further transactions involving the servicepoint
    would fail.

    (ENG-21825, RT:38319, PS-33388, CSCvq71816, SR:687081504)

  - ncs: Fix a bug in nano services where the self component was not deleted
    until a manual redeploy of the zombie was triggered due to its init
    state waiting for all other components to get deleted.

    (ENG-21820, RT:38301, PS-33370, CSCvq71259)

  - ncs: Loading configuration with maapi_load_config() in a read-only
    transaction caused the transaction to crash and print an internal error
    to the error log. maapi_load_config() is now instead returning an
    appropriate error.

    (ENG-21817, RT:38261, PS-33330)

  - ncs: A package with failed Python VM would not recover on 'packages
    package ... redeploy'. This has been fixed.

    (ENG-21810, RT:38271, PS-33340, CSCvq68732)

  - ncs: If NSO was abruptly taken down while initializing a NETCONF
    notification stream, it could corrupt the associated stream file in a
    way that made restarting NSO fail.

    (ENG-21806, RT:38068, RT:38285, PS-33143, PS-33354, CSCvq68405)

  - ncs: For some types in a YANG module (leaf-list or typedefs of
    leafrefs), NSO would trigger a CDB upgrade if the YANG module was
    recompiled, even though it wasn't changed.

    (ENG-21804, RT:38416, RT:38158, PS-33485, PS-33233)

  - ncs: Previously when NSO received a NETCONF notification that was
    missing a key of a list an internal error would occur. This has now been
    fixed. When receiving this kind of notification it will now be ignored
    and then logged in the devel.log.

    (ENG-21799, RT:38275, PS-33344, CSCvq66994, SR:687188255)

  - ncs: When reloading a package that has both a template and a Python
    component, an error in the template could be masked by a successfully
    started Python component. This has been fixed so the error in the
    template will be reported, if any.

    (ENG-21783, RT:38187, PS-33258, CSCvq98795)

  - ncs: <?if-ned-id?> processing instruction only applied to the first XML
    tag in the block, and would not apply to other tags until the closing
    <?end?> instruction. This has been fixed.
    Error messages were added for <?if-ned-id?> processing instruction
    appearing outside the device configuration subtree and for the
    <?elif-ned-id?> processing instruction with a ned-id shadowed by one of
    the previous clauses.

    (ENG-21782, RT:38187, PS-33258)

  - ncs: Previously non-recurring tasks in the NSO scheduler would not
    report whether or not they were currently running in the
    '/scheduler/task/is-running' leaf.

    (ENG-21778, RT:38165, PS-33238, CSCvq60572)

  - ncs: Loading configuration with the '/devices/device/load-native-config'
    action on a NETCONF device does no longer return an internal error if
    the file with the configuration data does not contain proper XML.
    Instead a more descriptive error is returned.

    (ENG-21774, RT:38164, PS-33237, CSCvq59613)

  - ncs: ncs-backup has been improved to handle files being modified during
    the backup procedure.

    (ENG-21756, RT:38060, RT:38389, PS-33135, PS-33458, CSCvq78666,
    SR:687086811)

  - ncs: Under certain conditions an internal error could occur when failing
    to connect to a NETCONF device. This could be observed in various
    places. For example when executing the /devices/device/sync-from action,
    or if the transaction suddenly died when viewing the live-status tree of
    a device.

    (ENG-21744, RT:38062, RT:38265, PS-33137, PS-33334, CSCvq49812)

  - ncs: Trying to set a value under /devices/global-settings before NSO had
    reached phase2 (fully started) would cause an internal error.

    (ENG-21737, RT:38063, PS-33157)

  - ncs: When rollback7 was missing in the sequence 0-9, and the user tried
    to rollback 9, only 8 and 9 would be rolled back. Now 0-6 are rolled
    back as well.

    (ENG-21718, RT:37633, PS-32711, CSCvq42394)

  - ncs: NSO leaked memory when wildcards were given in some CLI show
    commands.

    (ENG-21688, RT:37779, PS-32853)

  - ncs: Some clients were not prepared for configuration changes affecting
    the log subsystem. Those clients are now prepared for this scenario.

    (ENG-21685, RT:37709, PS-32785, CSCvq33976)

  - ncs: Various NETCONF NED builder improvements and corrections:
    - improved progress reporting in long-running actions using progress
    trace
    - fixed bug where duplicate files were included in the tar archive
    created by export-ned action
    - fixed NED builder failures in the case when no locations were
    available for a YANG module, and in the case when package upgrade was
    triggered while the NED builder was running

    (ENG-21677)

  - ncs: The registered DP callbacks for a servicepoint are now displayed in
    both the 'ncs-state' model and 'ncs --status' as leaf-list.

    (ENG-21669)

  - ncs: Previously reading the 'ned-id-list' leaf-list in the service
    private data returned a binary, not the expected type string. This has
    now been fixed. If the service instance still returns a binary, it needs
    to be re-deployed.

    (ENG-21655, RT:37809, PS-32881, CSCvq26596)

  - ncs: 'ncsc --compile-bundle' would crash with internal error for certain
    changes in YANG models when used together with the '--verbose' flag.

    (ENG-21648, RT:37787, PS-32859)

  - ncs: Setting /devices/device/commit-queue/enabled-by-default to true did
    not override the global setting
    /devices/commit-queue/enabled-by-default.

    (ENG-21620, RT:37701, PS-32777, CSCvq16859)

  - ncs: In CDM, service YANG models could not have references into device
    YANG models.

    (ENG-21618)

  - ncs: `xsd:dateTime_string` for NETCONF events are now rendered
    correctly.

    (ENG-21599, RT:37685, PS-32761, CSCvq12812)

  - ncs: A leaf with default value having an ancestral when-statement
    re-evaluating to true now have the proper default value instead of a
    resurrected non-default value.

    (ENG-21584)

  - ncs: NSO now waits for any ongoing commits in the commit queue to finish
    (queue items with executing status) when a node is shutting down, before
    a new slave is allowed to synchronize to the master, and when entering
    read-only mode. When the read-only mode is set and during the time the
    new slave is synchronizing the queue is disabled and any action or
    commit towards the queue will result in an error.
    NETCONF notification subscriptions are now disabled when read-only mode
    is set and during the time when a new slave node is synchronizing to the
    master.
    Added enum 'read-only' to
    /devices/device/netconf-notifications/subscription/failure-reason.
    Obsoleted enum 'not-master' in
    /devices/device/netconf-notifications/subscription/failure-reason.

    (ENG-21565)

  - ncs: Nano service component state which produced configuration in a
    create callback and then failed would make erroneous ref-counts,
    back-pointers when reverting the change.

    (ENG-21537, RT:37184, RT:37627, RT:37662, PS-32264, PS-32704, PS-32740,
    CSCvq04772)

  - ncs: Nano services: For a component state with a post-action, if this
    state was previously executed but now back-tracked as only state to
    back-track, the post-action-status was not cleared (not-reached).

    (ENG-21536, RT:37614, PS-32691, CSCvq12486)

  - ncs: Setting or deleting an attribute on /ncs:devices container together
    with performing changes in /ncs:devices/ncs:device/ncs:config would
    prevent NSO from pushing the changes to devices.

    (ENG-21533, RT:37295, PS-32376, CSCvq02661, SR:686643031)

  - ncs: In certain cases, when a deletion of a nano service would fail, it
    could result in an internal error instead of the actual error being
    written as an alarm.

    (ENG-21501, RT:37609, PS-32686, CSCvp96122)

  - ncs: If a mandatory action parameter has "when" expression, when
    modifying a dependent node, NSO aborted that action due to 'the action
    param is not configured'. This behaviour is corrected now.

    (ENG-21400, RT:37455, PS-32534, CSCvp76406)

  - ncs: The NSO notification did not work if both 'file' and 'syslog' were
    set to 'false'. Notifications are now working for this scenario.

    (ENG-21395, RT:37861, RT:38025, RT:37399, PS-32935, PS-33100, PS-32478,
    CSCvp75137)

  - ncs: Plan-notifications did not work when service type was specified.
    This has now been corrected.

    (ENG-21356, RT:37125, PS-32207, CSCvp93705)

  - ncs: Fix regression introduced in NSO 5.1 where delete of must
    statements using deviations did not work.

    (ENG-21339, RT:37350, PS-32429, CSCvp64105)

  - ncs: When using same-pass option configured in authentication group for
    a NETCONF device, the connection to this device could fail with an
    internal error if the user logged out from NSO (user password became
    unavailable) just before the SSH authentication was performed due to a
    race condition. This has been fixed.

    (ENG-21319, RT:37240, PS-32321, CSCvp59489, SR:686642906)

  - ncs: NSO failed when converting identityref value if the import prefix
    was different from the module prefix. This has been fixed now.

    (ENG-21273, RT:37207, RT:37603, PS-32287, PS-32680, None)

  - ncs: Nano services that used plan-location could at service deletion
    miss to remove if all components could be backtracked in the current
    transaction. (Delete immediate). Service not using plan-location are not
    affected.

    (ENG-21260, RT:37199, PS-32279, CSCvp62353)

  - ncs: When-dependencies escaping multiple lists are now properly handled.

    (ENG-21235, RT:39805, RT:30749, RT:37174, PS-34882, PS-27024, PS-32254,
    None)

  - ncs: Templates on an upper node in an LSA deployment could not set
    configuration in the "http://tail-f.com/ns/ncs" namespace on the lower
    node.

    (ENG-21201, RT:37126, PS-32208, CSCvp42734)

  - ncs: Fix an issue where delete callbacks were not called when deleting a
    nano service instance.

    (ENG-21035, RT:36735, PS-31815, CSCvp16597)

  - ncs: Previously the 'sync-from' action would not sync a CLI device
    correctly for a user with read-only access. The action would give a
    successful response but CDB would not be populated with the device
    configuration.

    (ENG-21023, RT:36652, PS-31732, CSCvp07473, SR:686308909)

  - ncs: If a tailf:display-hint was used in a submodule that augmented
    another node in the same module, the display-hint would not be applied.
    This bug has been fixed.

    (ENG-20193, RT:35664, PS-30740)

  - ncs: Fixed performance degradation of leaf-list validation when the
    leaf-list is of type leafref pointing to a non key leaf.

    (ENG-20022, RT:35422, PS-30496)

  - ncs: Leaf with default value and validation popped up as deletion in
    diff_iterate with suppress_default. This behaviour has been corrected
    now.

    (ENG-19977)

  - ncs: Conflicts with regards to ordered-by-user lists are now detected.
    If two transactions modify an ordered-by-user list simultaneously the
    last one to commit may have conflicts that are non-resolvable, i.e. the
    transaction must be aborted.

    (ENG-19915, RT:35298, PS-30372, SR:685536295)

  - ncs: If the /scheduler/task/action-node is given as an XPath 1.0
    expression, the NSO scheduler will execute the action on the node set
    concurrently. Previously this could result in that the resulting history
    list item for the execution might be written with the same key (the
    start time of the action). Added a 'sequence-no' leaf as part of key to
    /scheduler/task/history to avoid items being overwritten.

    (ENG-19627)

  - ncs: In some cases when sync-to operation failed for a CLI or generic
    device it could result in a connection towards another CLI or generic
    device being terminated.

    (ENG-19204)

  - ncs: Subscribers now get delete notifications for default leafs in a
    default case when the case changes.

    (ENG-17921, RT:31991, PS-27863)

  - ncs: Allow ncs-netsim to be used in a folder that contains spaces in the
    path and also make it work with a PATH environment variable that
    includes paths with spaces in them.

    (ENG-11716, RT:26090, RT:39230, RT:39145, PS-8232, PS-34304, PS-34218)

  - c-api: Added support for the CLI turbo parser through
    'maapi_load_config_cmds'.

    (ENG-22408, RT:39315, PS-34390, CSCvr78607)

  - c-api: If a MAAPI client closed its socket during a
    maapi_iterate/maapi_diff_iterate session the user session was left
    unterminated. Now NSO terminates the user session.

    (ENG-22361, RT:39256, PS-34331, CSCvr72333)

  - c-api: The libconfd API library integration with OpenSSL's libcrypto
    used OpenSSL low level cryptography API functions such as
    AES_set_encrypt_key() instead of the, by OpenSSL recommended, high level
    EVP interface. The libconfd integration with libcrypto was rewritten to
    use OpenSSL's EVP API.

    (ENG-22176, RT:38945, PS-34017, CSCvr34645)

  - c-api: Passing a path with a superfluous trailing slash to
    confd_cs_node_cd() would trigger an error report from valgrind. This bug
    was introduced in NSO-5.1 and has now been fixed.

    (ENG-21836, RT:38357, PS-33426)

  - c-api: If NSO was killed or an unexpected error occurred during shared
    schema loading from C (and Python) the client process could terminate
    with SIGABRT due to an attempt to free a pointer using the wrong free
    function.

    (ENG-21715, RT:37735, PS-32809, CSCvq42206)

  - cdb: Combining config true and config false subscriptions on the same
    subscription socket no longer causes an internal error, if the client
    disconnects while notifications for both types are being delivered. This
    regression has been introduced in ENG-21957.

    (ENG-22469, RT:39496, PS-34574, CSCvr89145)

  - cdb: If the CLI session was terminated by losing the connection during
    "packages reload" it could in some cases crash NSO, now it aborts the
    upgrade properly.

    (ENG-22384, RT:39117, PS-34190, CSCvr76077, SR:687580362)

  - cdb: A regression was introduced when ENG-21752 was fixed that caused
    cdb_exists() to return an incorrect response for missing nodes under an
    active case. cdb_exist() now returns false if the node is missing.

    (ENG-22321, RT:39268, PS-34343, CSCvr63878)

  - cdb: A carefully crafted NETCONF notification containing a multiple-key
    list would crash NSO. The keys have to be in order and if the keys are
    out of order, or missing, the log will show the expected keys in order.
    For example, consider a NETCONF notification with a three-key list with
    the keys in order being: key1, key2 and key3. If a notification was sent
    with keys out of order, like key1, key3, key2 - the notification would
    be dropped and a log entry added: "keys \(key2,key3\) for list top_list
    are not found for notification from device my-device".

    (ENG-22283)

  - cdb: Leaves with a default value and a relative when expressions under a
    choice could get the when expression evaluated to false even though it
    should be true. This error was specific to reads using the CDB API.

    (ENG-22174, RT:38784, PS-33857, CSCvr34082)

  - cdb: When there is a CDB subscription in inactive mode
    (/ncs-config/enable-inactive set to true, the default), NSO correctly
    sends notification for children node when there is a deletion on parent
    node.

    (ENG-22058, RT:38688, PS-33761, CSCvr16348)

  - cdb: cdb_get_modifications_cli() did not generate CLI commands for
    reordered leaf-lists. The algorithm for evaluating the previous state of
    CDB was faulty for moved entries in leaf-lists. CLI commands are now
    generated for such cases.

    (ENG-21986, RT:38641, PS-33713, CSCvr02599)

  - cdb: If a leaf in an ongoing transaction was modified and another
    transaction deleted and committed the same leaf, the first transaction
    would be left in an invalid state leading to corrupt data when
    committed.

    (ENG-21921, RT:38382, PS-33450, CSCvq91943)

  - cdb: If the module containing base identity was not changed while the
    module containing identityref was changed, NSO crashed when upgrading
    YANG data model with 'undefined_identity' error. This crash has been
    fixed now.

    (ENG-21793, RT:38416, RT:38439, RT:38388, RT:38158, RT:39163, PS-33485,
    PS-33508, PS-33457, PS-33233, PS-34236, CSCvq64547)

  - cli: The ncs_cli program would be likely to crash if it was started with
    a command-line parameter exceeding 2k characters in length. There is no
    longer any limit imposed by the ncs_cli program on the size of the
    command-line parameters. The program will terminate with an error
    message if it fails to allocate the required memory and should not crash
    due to the length of the command-line parameters.

    (ENG-22524)

  - cli: When presenting tables of data across multiple nodes the CLI could
    crash if the internal data was using similar prefixes but with different
    namespaces. The fix  makes sure that the crash does not occur and also
    allows this operation to be performed.

    (ENG-22467, RT:39377, PS-34454, CSCvr89079)

  - cli: When processing range expression supplied as a value for a
    leaf-list with tailf:cli-range-list-syntax the boundaries check was
    performed after the range expression was expanded into a full list of
    values. Thus it was possible to exhaust memory by supplying very large
    invalid values for range expressions.
    Now the boundaries check is performed before any other range expression
    processing.

    (ENG-22426, RT:39413, PS-34490, CSCvr82926)

  - cli: Completion of a show command for a list instance would take a long
    time if some leaf in the list had a when or must expression that was not
    satisfied. The full list was searched to determine if any instance
    satisfied the expression. This has been changed such that, by default,
    only 50 instances are examined. The old behaviour can be achieved by
    setting the cli/match-completion-search-limit to unbounded. It can also
    be set to 0 for the quickest completion result.

    (ENG-22357)

  - cli: The CLI would bring down the entire node when completion was
    invoked and the list of completion candidates was exactly the width of
    the terminal minus 6 characters (an abnormal node name or key in most
    cases). This has been fixed.

    (ENG-22338)

  - cli: When setting the ncs.conf cli setting no-embedded-comments to true,
    values containing an exclamation mark (in the C-style CLI) would
    unnecessarily be quoted. Now, when setting noEmbeddedComments to true an
    exclamation marks in the value will not trigger quoting.

    (ENG-22301, RT:36788, PS-31869, CSCvr58483)

  - cli: The ncs.conf setting use-expose-ns-prefix did not work properly
    when displaying completion alternative for /devices/device/config. This
    has been fixed.

    (ENG-22205, RT:39070, PS-34143)

  - cli: Combining the leaf prompting confd.conf setting with containers in
    the CLI could result in erroneous prompting for non-leaf data nodes.
    This has been fixed.

    (ENG-22200)

  - cli: Auto-completion would in some cases not work correctly on nodes
    annotated with tailf:cli-key-format. This has been fixed.

    (ENG-22198, RT:39009, PS-34081)

  - cli: Leafs with name "disabled" could have been processed as boolean
    with regard to handling useShortEnable option, even if the actual leaf
    type is not boolean. This has been fixed.

    (ENG-22161)

  - cli: Modifying a range of instances of a list where the type of the key
    was a union would in some cases not work as expected depending on the
    order of how the sub-types were declared in the union in the YANG model.
    This has been fixed.

    (ENG-22156, RT:38932, PS-34004)

  - cli: The C-style configuration diff after modifying a leaf annotated
    with tailf:cli-hide-in-submode and tailf:cli-remove-before-change was in
    some cases not correct. This has been fixed.

    (ENG-22152, RT:38571, PS-33643, SR:687224055)

  - cli: CLI commands that ask for input (e.g. for a leaf value) were not
    recorded to audit.log correctly. This has been fixed, so now a CLI
    command that asks for value will be recorded in two lines: the first
    line - typed command, second line - the value supplied after the command
    asked for input.
    This does not concern callbacks, custom commands provided via CLI spec
    or any external binaries.

    (ENG-21994, RT:36812, RT:38631, PS-31893, PS-33703, CSCvr04525)

  - cli: Curly bracket diffs for leaf-list elements would first remove all
    elements, then insert all elements, including modifications. This has
    changed such that only the changes are displayed, i.e. deleted and added
    entries.

    (ENG-21982, RT:38622, PS-33694, CSCvr01721, SR:687339043)

  - cli: cdb_cli_diff and the command 'show configuration' would display a
    faulty command when a leaf of type boolean with the tailf:cli-boolean-no
    annotation was deleted.

    (ENG-21964, RT:38618, PS-33690)

  - cli: Re-directing a textfile containing a large number of commands to
    the ncs_cli executable, while providing the ncs_cli option
    '--interactive', would in some cases cause the CLI to hang. This has
    been fixed.
    Note that this fix includes a newer version of the protocol between
    ncs_cli and NSO, which means that older versions of clistart.c (as
    provided in the release) can not be used with this release.

    (ENG-21854, RT:36699, RT:38160, PS-31779, PS-33235, CSCvq78538)

  - cli: The CLI could encounter an "internal error" when an incorrect file
    was used with the "compare file" command in C-style CLI. Now the CLI
    will give a more sensible error message.

    (ENG-21853, RT:38380, PS-33448, CSCvq77967)

  - cli: Executing range expression in the CLI no longer leaks processes
    that never complete.

    (ENG-21812, RT:38270, PS-33339, CSCvq70192)

  - cli: The tab-completion and execution for RPC/action nodes didn't
    present similar results in the CLI. This has been corrected so the
    execution would behave more according to the tab-completion.

    (ENG-21762, RT:38193, PS-33264, CSCvq57911)

  - cli: The tailf:info tag would not present anything useful in the CLI for
    RPC/action-nodes. This has been corrected and can now be added to these
    nodes. Please note that any tailf:info on the mount-point-nodes won't be
    used for the RPC/action-node.

    (ENG-21758, RT:38176, PS-33247, CSCvq56249)

  - cli: Command completion would fail after entering an instance identifier
    value.

    (ENG-21751, RT:38141, PS-33216, CSCvq53220)

  - cli: The initialization of "user" parameter for ncs_cmd is updated to
    have "system" as the default value, the output of "ncs_cmd -h" is
    updated to indicate this behaviour.

    (ENG-21748, RT:38074, PS-33149)

  - cli: An internal error would be generated when the command 'show commit
    changes XXX' was run.

    (ENG-21742, RT:38055, RT:38225, PS-33130, PS-33297, CSCvq49045)

  - cli: The CLI would not display mandatory leaves with the
    tail:cli-boolean-no annotation when performing completion for the no
    command in C-style.

    (ENG-21717, RT:38013, PS-33088, CSCvq42316)

  - cli: Fix internal error when a param is used before other which makes
    impossible use it.

    (ENG-21693, RT:37943, PS-33018, CSCvq37216)

  - cli: Using the tailf:cli-case-insensitive extension on list keys
    wouldn't always show keys with different upper/lower-cases. This has
    been fixed.

    (ENG-21668, RT:37795, PS-32867, CSCvq27893)

  - cli: The C-style 'show parser dump' command would display an internal
    error if any data model contained an action or RPC having a parameter
    with an tailf:display-when annotation referencing the value of some
    other parameter.

    (ENG-21613, RT:37750, PS-32824, CSCvq16472)

  - cli: The CLI would be restarted when entering ambiguous commands stacked
    with a semicolon in C-style. This has been fixed.

    (ENG-21590, RT:38689, RT:37728, RT:38958, PS-33762, PS-32804, PS-34030,
    CSCvq12232)

  - cli: Deleting a leaf of type boolean with default value "true" and the
    annotation tailf:cli-boolean-no no longer results in the erroneous
    display of "no ..." for that leaf.

    (ENG-21574, RT:36875, PS-31957, CSCvq10490)

  - cli: The configuration diff (as displayed by 'commit dry-run outformat
    native') after re-ordering the instances of an 'ordered-by user' list
    annotated with tailf:cli-show-obu-comments, tailf:cli-sequence-commands
    and its substatement tailf:cli-reset-siblings would in some cases
    display the list in an incorrect order.

    (ENG-21548, RT:37588, PS-32665)

  - cli: When doing "compare running brief" in shared configuration mode in
    Juniper style an internal error was encountered. This has been fixed.

    (ENG-21508, RT:37573, PS-32650, CSCvp98358)

  - cli: The CLI would not provide proper TAB completion for wildcard or
    range expressions in parameters to actions, provided the action
    parameter was a list where the key element was of type "union". This has
    been fixed.

    (ENG-21436)

  - cli: The CLI turbo parser has been corrected, so that it will not delete
    'tailf:cli-prefix-key' leafs without the full path to the list instance
    they belong to.

    (ENG-21401)

  - cli: The CLI would crash on completion of a leaf-list where the type of
    the key was an enumeration. This has been fixed.

    (ENG-21397, RT:39302, PS-34377)

  - cli: The CLI would incorrectly accept a command to set a leaf without a
    value even when leaf prompting was disabled. This has been fixed. A new
    CLI session state command has also been introduced called leaf-prompting
    that can be set to true or false per session.

    (ENG-21361)

  - cli: When the maapi tool (or any other command using MAAPI API) is used
    as an external command to set data, sometimes data was not set in the
    correct internal transaction. This has been corrected.

    (ENG-21290, RT:37229, PS-32310, CSCvp55114)

  - cli: Updated the delete behavior for CLI and JSON-RPC. Does not delete
    nodes if child nodes cannot be deleted due to NACM rules. This includes
    a speed improvement on load configuration where there is a delete on old
    configuration.

    (ENG-21267)

  - cli: The combination of presence container, annotation
    tailf:cli-flatten-container and tailf:cli-reset-container did not work
    together properly. This has now been fixed.

    (ENG-21202, RT:37110, PS-32192)

  - cli: The tailf:cli-diff-delete-before annotation on container/list
    members had not been taken into account when the parent had been
    annotated with tailf:cli-recursive-delete. This is fixed.

    (ENG-21039)

  - cli: Using "tailf:export none" on a YANG module would sometimes still
    expose data nodes within the CLI. This has been fixed.

    (ENG-20819, RT:36635, PS-31715)

  - cli: The extension tailf:display-groups would in certain cases in the
    CLI be visible on the wrong data node or fail to tab-complete. This has
    been fixed.

    (ENG-20780, RT:36403, PS-31483)

  - cli: Running the command "show commit list 0" would display all commits
    instead of no commits. Now it will display an empty list instead.

    (ENG-20104, RT:35582, PS-30656)

  - cli: After a package upgrade where a new leaf was added, and a prior
    commit dry-run had been run where the parent of the leaf was modified,
    the new leaf would not be displayed during commit dry-run.

    (ENG-19979, RT:35401, PS-30475)

  - cli: When calling operational-commands from config-mode in the CLI the
    range-expressions didn't always work as expected. This has been fixed.

    (ENG-19483, RT:33913, PS-29165)

  - cli: Comments in saved configurations would not be attributed correctly
    to "enabled" leaves when re-loaded if the use-short-enabled was set to
    true in the ncs.conf file. Comments are now attributed correctly to
    "enabled" leaves when loaded from a saved configuration file.

    (ENG-18063, RT:32132, PS-27972)

  - cli: It was not possible to enter the sub-mode of a container annotated
    with tailf:cli-add-mode or a list, if the only child of the node was an
    action. This has been fixed.

    (ENG-13948, RT:16903, RT:38272, PS-4841, PS-33341)

  - cs_trans: The order of nodes in copy instance does matter when
    performing a CLI copy command. Now, CLI copy command shall succeed
    regardless of the order of nodes.

    (ENG-22473, RT:39469, PS-34547, CSCvr89789)

  - cs_trans: Update delete behavior for CLI/JSON-RPC to handle deletes of
    non-presence containers containing a mix of leafs and choices with case
    statements including more non-presence containers. Deletion of
    non-presence containers could crash write transactions.

    (ENG-22183, RT:38784, PS-33857)

  - cs_trans: A performance regression introduced in ENG-19859 affected CLI
    output generation with large lists. The list traversal only use XPath
    filtering if a filter is given.

    (ENG-22164, RT:38966, PS-34039, CSCvr32111)

  - cs_trans: Service input configuration was not always validated In
    transactions to create/modify the service. Resulting in services being
    invoked with invalid configuration, i.e. without mandatory true leafs
    set. Validation was not done for subtrees which contained 'when'
    statements, even though the expression evaluated true. Only transactions
    started with MAAPI_FLAG_DELAYED_WHEN were effected.
    MAAPI_FLAG_DELAYED_WHEN is default for NETCONF <edit-config> operations.
    All service input configuration is now validated.

    (ENG-22063, RT:38563, PS-33635, CSCvr17507)

  - cs_trans: commit dry-run could in certain cases remove changes from the
    change set if those changes were done to an ordered-by user list.

    (ENG-21956, RT:38220, RT:38554, RT:38993, PS-33292, PS-33626, PS-34065,
    CSCvq97459, SR:Internal)

  - documentation: The audit log configuration documentation now clearly
    states that user actions performed in CLI or on northbound interfaces
    are logged.

    (ENG-22339)

  - documentation: Documentation describing the CLI turbo parser has been
    added.

    (ENG-22331, RT:39298, RT:39424, PS-34373, PS-34501, CSCvr67564)

  - documentation: Updated documentation to remove mentions of syslog via
    UDP functionality removed by ENG-16844.

    (ENG-22252, RT:39153, PS-34226, CSCvr88985, SR:687451647)

  - examples: Add module name prefix to URL resources in RESTCONF
    instructions. Prefixing resources with module name is required by RFC
    8040 RESTCONF Protocol.

    (ENG-21654, RT:38134, PS-33209)

  - java-api: Fixed a problem where it was not possible to execute an action
    on an old version of a NED, when there was a newer version of that NED
    loaded.

    (ENG-22228)

  - java-api: The lookup of ned-id when accessing transactions from NED
    callbacks was broken in NED migrate scenario. This scenario has been
    fixed and the NED will now always assume the ned-id it implements.

    (ENG-22215)

  - java-api: Fixed an issue with Maapi.setValues() giving an error when a
    tag with the hash value between 2^31 and 2^32-1 was used in the provided
    ConfXMLParam structure.

    (ENG-22000)

  - java-api: The equals() methods of Navu nodes would sometimes incorrectly
    return true for two nodes sharing the same position in the schema but
    belonging to different list entries in the data tree. This has been
    fixed, two Navu nodes must now have identical ConfPaths to be considered
    equal.
    An issue where InstancePath.equals() would sometimes incorrectly return
    false has also been fixed.

    (ENG-21424, RT:37442, PS-32521, CSCvp79290, SR:686599746)

  - java-api: Fixed a bug where the context Classloader was not correctly
    set for a NED instance. In addition to that, each NedWorker thread name
    now includes the relevant ned-id which can be seen in the
    ncs-java-vm.log.

    (ENG-19600)

  - json-rpc: Transaction changeset involving unhidden groups was formed
    incorrectly.

    (ENG-21716, RT:38790, RT:37980, PS-33863, PS-33055, CSCvq42259)

  - json-rpc: Action calls involving augmented modules lacked namespace
    information.

    (ENG-20640, RT:36317, PS-31396)

  - netconf: A bug in the XML parser would sometimes fail valid requests
    with the error message "... is not a valid prefix". This has been fixed.

    (ENG-22360, RT:35847, RT:38495, RT:38707, RT:38542, PS-30924, PS-33564,
    PS-33780, PS-33612, CSCvr72297)

  - netconf: When ENG-20524 was fixed NSO could no longer re-order
    ordered-by user lists (i.e. using attribute yang:insert) towards
    ConfD-6.7.3, 6.6.3 or older which doesn't expect the keys in the xpath
    expression in the yang:key to be prefixed. To mitigate this, NSO now
    looks in capabilities sent from device, if those contain
    tailf-confd-monitoring with a revision older than 2019-10-30, it will
    fall back to old behaviour, i.e. no prefixing of keys.

    (ENG-21940, RT:39234, RT:37970, RT:38528, PS-34308, PS-33045, PS-33598)

  - netconf: When in an LSA cluster, when NETCONF notifications were
    replayed on the upper node, NSO previously failed. This has now been
    corrected.

    (ENG-21785, RT:38143, PS-33218, CSCvq62174)

  - netconf: copy-config operation with-defaults report-all-tagged now
    includes xmlns declaration for the ws prefix used in the result.

    (ENG-21382, RT:37312, PS-32392, CSCvp71161)

  - netconf: Hidden fields were exposed in NETCONF notifications, they are
    no longer.

    (ENG-20917, RT:36736, PS-31816)

  - netconf: Redundant namespaces that could appear in RPC replies (to
    NETCONF filters) have been removed.

    (ENG-19723, RT:35054, PS-30124)

  - python-api: ncs-start-python-vm (configured from
    /ncs-config/python-vm/start-command) used to start the "python" command
    found in PATH. On some systems 'python' will start python2.
    ncs-start-python-vm will instead first attempt to start "python3"
    (version 3.4 and up) and then "python" if first command fails.

    (ENG-22208, RT:37769, PS-32843)

  - python-api: Redeploying a Python package twice in quick succession
    resulted in Python VM for the package going down and never recovering.
    This has been fixed.

    (ENG-21769, RT:38004, PS-33079, CSCvq59433)

  - python-api: The High Level MAAPI Action will only end user sessions it
    has started itself, when used in a context manager. This means it will
    not cause an 'Error: internal error' when invoked from the CLI.

    (ENG-21438, RT:37501, PS-32578, CSCvp93689)

  - rest-api: ETag header value is now enclosed in quotes conforming to
    RFC7232.

    (ENG-21283, RT:37247, PS-32328, CSCvp53815)

  - restconf: For an unsupported Accept header format, at return of a 406
    Not Acceptable, the correct content format (JSON or XML) is now used,
    based upon the presence of a Content-Type header in the request.

    (ENG-22399, RT:39380, PS-34457, CSCvr77175)

  - restconf: A RESTCONF PATCH request with an invalid key caused internal
    server error.

    (ENG-21898, RT:38466, PS-33535, CSCvq87986, SR:686992500)

  - restconf: Improved error handling of the YANG Patch functionality when
    wrong input is used for the 'operation' and/or 'where' elements.

    (ENG-21851, RT:38304, PS-33373, CSCvq76632)

  - restconf: According to the RFC 8072, a YANG Patch delete operation
    should not contain a value payload.
    This fix handles the case when such a combination exist anyway in a YANG
    Patch request.

    (ENG-21827, RT:38303, PS-33372, CSCvq72016)

  - restconf: Parameter dry-run did not work for YANG Patch requests, but
    with this fix it does work.

    (ENG-21692, RT:37930, PS-33004, CSCvq36041)

  - restconf: Requesting an unsupported encoding from RESTCONF now correctly
    returns a 406 Not Acceptable.

    (ENG-21600, RT:37737, PS-32811, CSCvq14099)

  - toolchain: New yanger behaviour: If there is a typedef leafref with a
    bad path, and there is no node using it, then yanger does not report
    that typedef as error when compiling. Yanger only reports the typedef if
    there is at least one node using it.

    (ENG-21900, RT:36899, RT:38440, PS-31980, PS-33509, CSCvr00001)

  - toolchain: The development tool netconf-console now works with Python
    2.6 again.

    (ENG-21768, RT:38070, PS-33145)

  - toolchain: If a leafref target had a deviation "not-supported", the ncsc
    compiler would fail with "internal error".  Now a proper error message
    is returned.

    (ENG-21497, RT:37598, PS-32675, CSCvp93772)

  - toolchain: If a path refers to the top node, yanger reports the error
    'the path refers to top node' when compiling the YANG model.

    (ENG-20279, RT:36026, RT:35674, PS-31105, PS-30750)

  - toolchain: A bug in the YANG compiler has been fixed, preventing
    compilation to crash.

    (ENG-19874)

  - toolchain: If a config true node was deviated to config false, the
    descendant nodes were still config true. This bug has been fixed so that
    the node's descendant nodes are now also config false.

    (ENG-17211, RT:30926, RT:38506, RT:34414, PS-27165, PS-33575, PS-29471)

  - toolchain: 'ncsc --mib2yang-std' and 'ncsc --ncs-compile-mib-bundle'
    used to generate invalid YANG modules when the DESCRIPTION or DEFVAL in
    the source MIBs contained backslashes. This has been fixed, backslashes
    are now escaped.

    (ENG-16776, RT:27343, PS-8678)

  - toolchain: When compiling a NED with --ncs-apply-deviations flag, if a
    deviation tried to modify the 'mandatory' statement for a top-level
    element the operation would fail. This has been fixed.

    (ENG-16732, RT:29436, RT:30306, PS-9561, PS-9979, SR:683224442)

  - web-server: The 'Content-Type' HTTP header will now also include a
    'charset=UTF-8' part for mime types 'text/*'.

    (ENG-22271)

  - web-server: The Content-Security-Policy HTTP header is now always sent.
    Note that its value may be changed (or turned off) in the ncs.conf
    configuration.

    (ENG-22270)

  - web-server: Some unused .xsd files were removed.

    (ENG-21794, RT:38249, PS-33318, CSCvq83494)

  - web-server:  For content types: 'text/*' , 'application/javascript' and
    'application/json' , a 'charset=UTF-8' part will be appended.

    (ENG-20985)

  - web-server: The HTTP 'strictTransportSecurity' header is now always sent
    with the default value (or any other configured value) as specified in
    the confd.conf file. Note: by setting the value to "empty" it will turn
    off the sending of this HTTP header.

    (ENG-20380)

  - web-server: The HTTP 'xFrameOptions' header is now always sent with the
    default value (or any other configured value) as specified in the
    ncs.conf file. Note: by setting the value to "empty" it will turn off
    the sending of this HTTP header.

    (ENG-19947)

  - web-server: The HTTP 'xContentTypeOptions' header is now always sent
    with the default value (or any other configured value) as specified in
    the ncs.conf file. Note: by setting the value to "empty" it will turn
    off the sending of this HTTP header.

    (ENG-19491)

  - webui-one: Changed the name of the 'Value' column in the Commit manager
    changes tab to 'New value'.

    (ENG-22616)

  - webui-one: The "<" and ">" characters are no longer causing the
    Configuration Editor to render a blank page when navigating into a list
    entry.

    (ENG-22305, RT:39102, PS-34175)

  - webui-one: The "|" character is no longer causing the Configuration
    Editor to render a blank page when navigating into a list entry.

    (ENG-22251, RT:39102, PS-34175, CSCvr90832)

  - webui-one: Leaf lists did not render correctly, when they had the type:
    enumeration.

    (ENG-22093)

  - webui-one: Listing devices in the Device Manager will now exclude hidden
    columns from the query.

    (ENG-21926, RT:38513, PS-33583, CSCvr11877, SR:687213789)

  - webui-one: Problems with setting action input leaf values located in a
    list-entry or in a case. This has been fixed.

    (ENG-21907)

  - webui-one: When the system contained multiple service points with the
    same name, the Service Manager would only show services for one of the
    service points. This has been fixed.

    (ENG-21843, RT:38363, PS-33432, CSCvq87608)

  - webui-one: Adding a key with an '@' character caused the Commit manager
    to treat the current transaction as if it was empty.

    (ENG-21815, RT:38297, PS-33366, CSCvq70335, SR:687190760)

  - webui-one: The Load/Save button in the Commit Manager got wrongfully
    disabled if there were no available rollback files.

    (ENG-21617)

  - webui-one: A valid transaction containing warnings can now be committed
    from the webui.

    (ENG-21606)

  - webui-one: Fixed a bug where the commit button could be clicked
    repeatedly which could potentially kill the session.

    (ENG-21592)

  - webui-one: A webui user could not run service re-deploy with
    no-out-of-sync-check checked. This has been fixed.

    (ENG-21353)

  - webui-one: A user could not navigate down in a action input list-entry.
    This has been fixed.

    (ENG-20552, RT:36256, PS-31335, SR:686097844)

  - webui-one: Rendering long list keys often resulted in poor or incorrect
    values displayed on the screen. This has now been fixed to either
    truncate or wrap the text depending on the context of the text.

    (ENG-18132)

  - webui-one: A binary, integer or string leaf that does not exist in the
    data tree, can now be set to its default value from the webui.

    (ENG-17575)

  - xpath: If a wildcard was used as a tag after a prefix (e.g.
    "/yanglib:*"), it wouldn't match any tags.  This bug has been fixed.

    (ENG-21995, RT:38669, PS-33748, CSCvr05544)

NSO-5.2 [June 26, 2019]
=======================
Deprecated:

  - CDB: cdb_load_file() has been deprecated and will be removed in NSO-5.3.
    Use maapi_load_config() with MAAPI_CONFIG_OPER_ONLY flag to load only
    operational data and ancestors to operational data nodes.
    This functionality is also available via the -O option to 'confd_load'.

    (ENG-17208)

  - ncs: apply_trans_with_result() call in maapi API has been deprecated
    NSO-5.1 and will be removed in NSO-5.3.
    It is suggested to use the new apply_trans_params() call instead.

    (ENG-20958)

  - ncs: Certain operations can be made to run in a backwards compatibility
    mode, making them behave as before, i.e., handling leaf-lists as single
    elements. The flags for controlling this behaviour are deprecated,
    and will be removed in NSO-5.3.
    For the iteration functions in the CDB and MAAPI APIs, the flag
    ITER_WANT_LEAF_LIST_AS_LEAF can be used to get the old behaviour, see
    the confd_lib_cdb(3) and confd_lib_maapi(3) manual pages.
    For data providers, the flag CONFD_DAEMON_FLAG_LEAF_LIST_AS_LEAF can be
    used to get the old behaviour, see the confd_lib_dp(3) manual page.

    (ENG-15312)

  - python-api: Support for Python 2 (2.7.x) is deprecated and will be
    removed in NSO-5.3.
    The Python Software Foundation will not support Python 2 past January
    2020 and even today 2.7 receives little to no attention.
    Software written specifically for Python 2 should be migrated to support
    Python 3.

    (ENG-20207)

  - rest-api: The legacy REST API is deprecated since NSO 5.1 (released in
    April 2019) and is scheduled to be removed in NSO 5.3 (tentative release
    date November 2019).
    Users of the legacy REST API should use the RESTCONF API instead. The
    RESTCONF API is a standardized REST interface as defined in RFC 8040 and
    provides a number of improvements over the proprietary and legacy REST
    interface including the support for auto-generating Swagger/OpenAPI
    documents from YANG. Please see the NSO Book Northbound APIs: Migrating
    from REST to the RESTCONF API. We understand that this may require some
    adjustments to external systems that are integrated with NSO, please
    reach out to ask-nso-plm@cisco.com if you have any questions or concerns
    on this topic.

    (ENG-20521)

  - restconf: RESTCONF query parameters "limit" and "offset" are deprecated
    and will be removed in NSO-5.3.
    The query parameters "limit" and "offset" which also exist in the
    REST API could also be used in RESTCONF. However these aren't
    standardized and didn't work as intended. Users of these query
    parameters should use the extension REST Query API instead.

    (ENG-20872)

Non-backwards compatible enhancements:

  - ncs: Previously when using the rollback functionality for the commit
    queue (i.e. when the error option 'rollback-on-error' or 'stop-on-error'
    was set for a queue item) a locked queue item with 'block-others' were
    created protecting the devices and services in the failed queue item
    until the rollback transaction (invoked by the
    '/devices/commit-queue/completed/queue-item/rollback' action) was being
    applied (see commit queue documentation for further details). This lock
    was rather coarse, blocking more than necessary.
    Instead of creating a new locked item as described above, a lock is now
    put directly on the failing queue item, letting it remain in the queue
    until manually unlocked or until the rollback transaction is being
    applied (either manually or automatically). Locking the failed queue
    item makes the lock more fine grained, only blocking the overlapping
    device changes and service instances.
    The devices in the queue item are only marked as out-of-sync if the
    queue item is manually unlocked or the rollback transaction detects that
    the changes made by the original transaction are not rolled back
    properly on the devices.
    Added new commit parameter for internal use by device and LSA clusters.

    (ENG-19726)

Enhancements:

  - ncs: Loading large packages, stored in gzipped format (ie .tar.gz or
    .tgz) would take a long time. This has been fixed. A workaround in older
    systems is to uncompress the packages before loading.

    (ENG-21325, RT:37304, PS-32046, CSCvq10574)

  - ncs: An optimization has been done that speeds up the no-overwrite check
    in cases when the device doesn't implement partial-show callback or
    returns more data than actually needed to perform no-overwrite check.

    (ENG-21317, RT:37168, PS-32248)

  - ncs: Added new method showPartial(NedWorker w, ConfPath[] paths,
    String[] cmdpaths) to NedCliBase Java class so that NEDs can do the
    filtration of the configuration tree more effectively when using
    partial-sync-from action or commit with the no-overwrite flag.
    The showPartial(NedWorker w, String[] cmdpaths) method in the same class
    is now marked as deprecated. If the new method is not implemented, the
    old one will still be called if the NED announces the
    http://tail-f.com/ns/ncs-ned/show-partial?path-format=FORMAT where
    FORMAT is cmd-path-full, path-modes-only, top-tag or
    cmd-path-modes-only-existing.

    (ENG-21313, RT:37168, PS-32248)

  - ncs: The internal function for looking up elements in the data model was
    rewritten to consume less memory in 5.1. While the rewrite mostly
    resulted in higher performance there were a few corner cases that became
    slower. This has now been fixed and the overall performance should be
    improved as a result. A new confd.conf setting has been added for
    controlling the level of compression used.
    ncs-config/compressed-schema-level {1..2}. Compression level 1 is the
    most memory efficient, but also significantly more time consuming. Level
    2 is somewhere between compressed and uncompressed in terms of memory
    usage but almost as fast as uncompressed.

    (ENG-21149, RT:37051, PS-32132, CSCvq10626)

  - ncs: Optimized some XPath evaluations when traversing large lists.

    (ENG-21122)

  - ncs: NSO will now store the device capabilities returned by the NED
    initNoConnect callback if the device has never connected before. If the
    NED support this callback, it makes the load-native-config action work
    without ever connecting to the device.

    (ENG-21092)

  - ncs: A bug in some devices, that caused the device to send an incorrect
    reply to get-config RPC with filter, caused NSO no-overwrite
    functionality to incorrectly report such device to be in-sync or
    out-of-sync in some scenarios. A workaround has been implemented for
    such device's behaviour.

    (ENG-21083, RT:35542, PS-30617, CSCvp22118, SR:685572756)

  - ncs: Added support for progress trace events being reported from a NED.
    Added /progress/trace/event/package.
    Added enum 'show-offline', 'show-stats', 'show-stats-list', 'is-alive',
    'keep-alive', 'reconnect', and 'cmd' to
    /progress/trace/event/device-phase.
    Added progress trace entries for events when transaction is being
    applied and device locks is taken/released in actions.

    (ENG-20983, RT:37145, RT:36951, PS-32227, PS-32033)

  - ncs: Added progress trace messages (also printed in devel.log)
    indicating the start and end of parsing configuration by the CLI engine
    in NSO when fetching configuration from CLI devices.

    (ENG-20427, RT:36062, PS-31141)

  - ncs: A new ncs-config parameter disable-schema-uri-for-agents is
    introduced to disable schema URI in the ietf-yang-library:modules-state
    resource response when ncs-config/restconf is enabled.
    ncs-config/disable-schema-uri-for-agents is a leaf-list that can be set
    to 'netconf' or/and 'rest'. If set to 'netconf' then NETCONF reply will
    not contain the schema URI. By default, it is set to not disable schema
    uri from any agent.
    Usage example:
      <disable-schema-uri-for-agents>netconf</disable-schema-uri-for-agents>
      <disable-schema-uri-for-agents>rest</disable-schema-uri-for-agents>

    (ENG-20082, RT:35399, PS-30473)

  - ncs: Add support for storing TLS data in database. It is possible to
    store one set of private key, certificate, and CA certificates. Support
    for password based encryption (PBE) of the private key is possible. If
    the private key is encrypted, the password must be supplied as well. For
    more details see the NSO book Web UI section Storing TLS data in
    database.

    (ENG-20065, RT:35872, PS-30950)

  - ncs: When using public keys for device authentication, NSO now supports
    private key files in OpenSSH and PKCS#8 formats in addition to the
    PKCS#1 format. The built-in SSH server also now supports key files in
    those formats.

    (ENG-19837, RT:34881, RT:36299, RT:36351, RT:36777, RT:37615, RT:35242,
    RT:36392, RT:37058, PS-29949, PS-31378, PS-31430, PS-31857, PS-32692,
    PS-30313, PS-31472, PS-32140)

  - ncs: By using the 'verbose' flag in sync-from/load-native-config actions
    additional parse information can be output in the 'info' leaf. This
    information will warn about unrecognized/unmodeled configuration.
    The feature is applicable for devices with NETCONF, CLI and generic NEDs
    (requires that the NED has it implemented) and available in the
    following actions:
    /devices/sync-from
    /devices/device/sync-from
    /devices/devices-group/sync-from
    /devices/device/load-native-config

    (ENG-19292, RT:34039, PS-29222)

  - ncs: Augment transaction information to
    'netconf-state/sessions/session'. Operator can use any northbound
    interface to get a list of all user sessions.

    (ENG-18981, RT:31371, PS-27426)

  - ncs: Added NETCONF NED Builder functionality that enables building a
    NETCONF NED from an RFC 6022 YANG Module for NETCONF Monitoring capable
    NETCONF device. For additional information refer to NETCONF NED Builder
    chapter in the NED Development guide and
    tailf-ncs-netconf-ned-builder.yang data model.

    (ENG-2)

  - building: CiscoSSL has been uppgraded to 6.2.341 that is based on
    OpenSSL 1.0.2r

    (ENG-20160)

  - cdb: It is now possible to use the cdb debug dump tool to get the
    contents of the .cdb files in XML format by using "ncs --cdb-debug-dump
    DIR xml"

    (ENG-21008)

  - cdb: ncs --cdb-debug-dump now
    - prints augmented namespaces symbolically rather than
      numerically.
    - prints ncs meta-data such as back-pointers and reference counters.

    (ENG-20838)

  - cdb: Upgrading from a 4.x release to 5.x release will initiate migration
    of the CDB database.
    For more information please see the NSO CDM migration white paper.

    (ENG-20486)

  - cli: The 'show configuration' command in the C-style CLI, and
    cdb_get_modifications_cli(), would be slow when the data model had a
    large number of when expressions on top-level nodes. This has been
    fixed.

    (ENG-20614, RT:36580, PS-31660)

  - cli: The performance of diff calculation has been improved to cover all
    the identified corner cases such as deleting almost all elements from a
    huge list or adding a big amount of elements into a list.

    (ENG-19688, RT:36676, PS-31756)

  - cli: A new Cisco style CLI parser has been created.
    This is a top-down, depth-first parser that is intended to be a faster
    alternative to the current NSO CLI while still giving exactly the same
    result in CDB.

    (ENG-18697, RT:33167, PS-28681)

  - cli: A new ncs.conf setting has been introduced to control leaf value
    alignment when displaying the configuration in C- and I- style. It is
    called /confdConfig/cli/c-config-align-leaf-values{true/false}. When
    generating CLI commands for NEDs it is always false, ie extra spaces
    between leaf name and value are no longer generated.

    (ENG-18252)

  - examples: Added example of NETCONF Call Home to the NSO example
    collection. The example demonstrates the built-in support for NETCONF
    SSH Call Home client protocol operations over SSH as defined in RFC
    8071(section 3.1).

    (ENG-20657)

  - java-api: log4j upgraded to version 1.2.17

    (ENG-19934, RT:35379, PS-30453)

  - java-api: MaapiCursor can now be created with an optional XPath filter
    allowing it to traverse a subset of a list.

    (ENG-19809)

  - java-api: A java data provider can now opt in to get a list filter
    passed down to it in order to perform filtering of lists directly in the
    data provider, for better performance. See "Using List Filters" in
    "Operational Data" in the User's Guide, and the javadoc.

    (ENG-19780)

  - java-api: Deprecated container/leaf/leaflist/list methods taking a
    prefix and added new methods taking namespace instead. Also added
    methods to specify a namespace in NavuContainer to be used when
    selecting a child to it and to find the ConfNamespace from a namespace
    id.

    (ENG-5462)

  - netconf: Introduced a new configuration
    attribute/confdConfig/logs/netconfLog/logReplyStatus making it possible
    to extend NETCONF logs with rpc-reply status information. See NSO Manual
    Pages for detailed information.

    (ENG-18982, RT:33593, PS-28956)

  - restconf: Support for the additional NSO query parameters is now
    advertised as capabilities.
    Support for the non-standard "unhide" query parameter is now
    advertised as a capability.
    The non-standard query parameter "format" which did not work
    as intended is now removed. RESTCONF users should use the
    Accept header.

    (ENG-20717)

  - webui-one: To avoid confusion, the view option 'hide configuration data'
    has been removed.

    (ENG-21455)

  - webui-one: Fixed better formatting of error messages in action results.

    (ENG-21439)

  - webui-one: Add link in leafref lists that points to the source of the
    leafref.

    (ENG-21435)

  - webui-one: Status colors on the action buttons in the service and device
    managers now fades to the neutral color. The time to fade is stored in
    the webui-model.

    (ENG-21434)

  - webui-one: In the device manager and service manager, the action results
    of compare-config and re-deploy dry-run are now presented as
    diff-tables.

    (ENG-21417)

  - webui-one: View options default settings have now been changed to
    'full-model'.

    (ENG-21413)

  - webui-one: The compare-config action is now available directly in the
    device manager.

    (ENG-21351)

  - webui-one: Added a new widget for date-and-time leafs.

    (ENG-21294)

  - webui-one: Adding the option to configure a timeout for resetting action
    result status indicators in the Device manager and Service manager.
    Default is set to 30 minutes.

    (ENG-21045)

  - webui-one: It's now possible to see dirty (modified) state on service-
    and device-manager list.

    (ENG-21044)

  - webui-one: The Configuration editor will now remember your last visited
    URL/keypath when navigating between different applications, via the
    shortcut panel or when using the keyboard shortcuts. Navigation via the
    Application hub takes you to the root path.

    (ENG-19388)

  - webui-one: Added plan view in service manager.

    (ENG-16965)

  - xpath: Optimize validation by caching the value for the current node, in
    the xpath evaluation phase.

    (ENG-21048)

Non-backwards compatible corrections:

  - ncs: In the cases where:
    - a device announced candidate, writable running and startup
    capabilities
    - a ConfD device announced transactions capability, writable running and
    startup capability, but no candidate capability
    NSO did not save the configuration to startup datastore even if
    'use-startup' setting has been set to 'true'. This has been fixed so
    that the configuration is saved to startup in the described scenarios,
    and it is now the default behaviour in order to maintain consistency
    with other devices that announce startup capability.
    If this behaviour is not desired, it can be disabled by setting the
    'use-startup' ned-setting to false for the corresponding devices.

    (ENG-20536, RT:35783, PS-30860, SR:685784369)

  - c-api: cdb_num_instances() and maapi_num_instances() now only support
    list or leaf-list nodes. If using cdb_num_instances() or
    maapi_num_instances() on non-list/leaf-list nodes, NSO returns error
    CONFD_ERR_UNAVAILABLE and error message "num_instances() not allowed on
    given node type".

    (ENG-19818, RT:34971, PS-30039)

  - rest-api: HTTP PATCH is not allowed to create a non-existing instance.

    (ENG-21000)

  - toolchain: A "must" statement is not allowed under "choice" in a YANG
    module. This used to be silently ignored, now an error is given.

    (ENG-21067)

Corrections:

  - ncs: When wildcards were given in some CLI show commands, NSO would leak
    some memory.  This bug has been fixed.

    (ENG-21637, RT:37779, PS-32853, CSCvq20683)

  - ncs: In some cases when a stacked service has no callbacks invoked due
    to it being restored or only private data being modified in FASTMAP, the
    commit queue and service log might still report these services as a part
    of the transaction even though they are not. This has now been fixed.

    (ENG-21521, RT:37568, PS-32645, CSCvq00367)

  - ncs: Package reloads and removals may leave kickers in a state where the
    kick-node of kicker refers to a node that is no longer present in the
    schema. This can cause various user actions to fail if the underlying
    transaction touches a subtree that is monitored by the invalid kicker.
    In this case a log entry is written to the devel.log and to ncserr.log
    about the invalid kicker. The log entry gives some advice about how the
    problem can be handled by the user.

    (ENG-21460, RT:37548, PS-32625)

  - ncs: Previously an internal error could occur when un-deploying a
    service instance with three leafs as keys. This has now been fixed.

    (ENG-21433, RT:37508, PS-32585, CSCvp83375)

  - ncs: Previously if a NED package was removed during a package reload
    from a running NSO instance, an internal error could be seen in various
    places, for example when applying a template, receiving NETCONF
    notifications, getting the schema from JSONRPC, etc. The error would
    occur until NSO was restarted or the package was re-added. This has now
    been fixed.

    (ENG-21423, RT:37443, PS-32522, CSCvp79265)

  - ncs: LSA devices with tailf:action in augmented modules could cause an
    internal error when invoking the action from the upper LSA node. This
    has been fixed.

    (ENG-21403, RT:37463, PS-32542, CSCvp77732, SR:686600507)

  - ncs: use_transaction_id setting set to false would disable the
    no-overwrite check, which is not intended. This has been fixed.
    Also, a no-overwrite commit will now invalidate the transaction ID. This
    is necessary because a transaction ID is a value representative of the
    whole configuration of the device, while no-overwrite only checks a part
    of the device's configuration to be in-sync before the commit, so we
    cannot claim that the device is in-sync or out-of-sync after the commit.

    (ENG-21402)

  - ncs: Compiler returns a more descriptive error message on an illegal
    refine statement.

    (ENG-21287, RT:37466, RT:37213, PS-32545, PS-32293, SR:686573229)

  - ncs: Compiler returns a more descriptive error message on a bad
    tailf:non-strict-leafref path.

    (ENG-21286, RT:37213, PS-32293, SR:686573229)

  - ncs: With optimization of the filtering in the DB it was possible to get
    duplicate list data if unmodified data was left in the current
    transaction. This has been fixed.

    (ENG-21234)

  - ncs: An action scheduled to run at a specific time using the NSO
    scheduler would run with a few seconds delay (until the top of the
    minute) than the actual time it was scheduled to run. This has now been
    fixed.

    (ENG-21209, RT:37158, PS-32238, CSCvp44606)

  - ncs: Previously the get-modifications actions could return an error that
    the forward diffset was invalid when in fact is was not. The error
    occurred since when expressions was evaluated for every operation it was
    trying to apply in the diffset. The when expressions is now evaluated
    once the whole diffset has been applied.

    (ENG-21198, RT:37111, PS-32193, CSCvp40635)

  - ncs: Namespaces in additional LSA ned-ids were not visible under LSA
    node's live-status. This has been fixed.

    (ENG-21197, RT:37130, PS-32212, CSCvp40628)

  - ncs: Corrected internal error when loading device configuration in  xml
    format when no ned-id had been specified.

    (ENG-21188, RT:37077, PS-32159, CSCvp37624)

  - ncs: The tailf-nso-nc-X.Y package (also referred to as lsa-common) has
    now a working Makefile so it can be rebuilt.

    (ENG-21173)

  - ncs: In some cases a failed NETCONF notification subscription would not
    be re-established. This has been fixed.

    (ENG-21170, RT:36998, PS-32081, CSCvp62381)

  - ncs: Unexpected errors while adding a slave to a master no longer causes
    the system to be left in locked state.

    (ENG-21144, RT:36452, PS-31532)

  - ncs: The tailf-nso-nc-5.1 package did not expose the correct YANG files
    necessary for NED dependency compilations using
    ncsc --ncs-depend-package. This has been fixed.

    (ENG-21127)

  - ncs: Running "commit dry-run" (e.g. from the CLI) on a service with an
    order-by-user list no longer modifies the transaction and makes the
    commit fail.

    (ENG-21105, RT:36957, PS-32039, CSCvp27348, SR:686447279)

  - ncs: Previously the commit-queue prune/delete actions were not
    guaranteed to be synchronous. As long as the devices that are
    pruned/deleted are local the action will now be synchronous.
    These actions are affected:
    /devices/commit-queue/prune
    /devices/commit-queue/queue-item/prune
    /devices/commit-queue/queue-item/delete

    (ENG-21102)

  - ncs: An edit-config RPC with a payload falsifying an augmented
    when-statement now correctly raise an error.

    (ENG-21060, RT:36931, PS-32013)

  - ncs: The format of the path printed in the trace log for CLI and generic
    devices for SHOW_STATS, SHOW_STATS_LIST, SHOW_STATS_PATH calls was
    erroneous, namely the list keys were omitted from the path. This has
    been fixed so the path includes the keys.

    (ENG-21056, RT:36068, PS-31147)

  - ncs: The evaluation of the xpath expression in 'result-expr' of a
    post-action in nano-services was always failing.

    (ENG-21033, RT:36733, PS-31813, CSCvp62379)

  - ncs: Fixed broken loading of leaf of type instance-identifier in device
    model (under /devices/device/config) in XML format.

    (ENG-21017)

  - ncs: CLI tab-completions in ncs_cli for paths like
      - /progress/trace/filter/service-type
      - /services/plan-notifications/service-type
      - /services/logging/logger/service-type
    etc., were broken.

    (ENG-20979, RT:36672, PS-31752, CSCvp01178)

  - ncs: The dependencies of 'when' expressions were not propagated
    correctly through the tree of config data.

    (ENG-20879, RT:35690, PS-30766)

  - ncs: Previously NSO could get an internal error when parsing a template
    process instruction with the wrong syntax. This has now been fixed.

    (ENG-20849, RT:36695, PS-31775, CSCvo91765)

  - ncs: Processing instructions in service templates can now have variables
    in xpath expressions. The values for such variables should be provided
    in a service callback, from Java/Python etc.
    The following PI's have this ability:
     * set
     * set-context-node
     * set-root-node
     * copy-tree
     * if
     * foreach
     * for (only in the 'condition' part of the expression)

    (ENG-20830, RT:36478, PS-31558, CSCvo78474, SR:686154084)

  - ncs: If an action or RPC is invoked within a transaction, the input
    parameters are now validated in the context of that transaction. This
    means that for example leafrefs to items created in that transaction are
    accepted as valid (which was previously not the case).

    (ENG-20813)

  - ncs: When copy config from XML file, NSO triggered delete set-hook for
    one list instance 3 times. This has been fixed now. NSO shall trigger
    delete set-hook only once for each list instance.

    (ENG-20681, RT:36446, PS-31526)

  - ncs: Augmenting an 'action' to a symlink path causing 'Internal Error'
    when calling action. This has been fixed now.

    (ENG-20668, RT:36404, PS-31484)

  - ncs: Previously when doing a set operation in FASTMAP (as opposed to a
    shared set operation) the original value was stored in such a format in
    the reverse diffset that it couldn't be "upgraded" to the new value if
    the type was changed by a model upgrade. This has now been fixed. For
    already stored values (in the old format) we will drop the value if it
    doesn't adhere to the new type. There are of course cases where it will
    not be possible to restore the old value even with the new format (i.e.
    when the new type is more strict than the old one).

    (ENG-20651, RT:36416, PS-31496)

  - ncs: When a default value is already in use and two write operations are
    requested by a northbound agent that changes the default value and then
    resets the value back to the default value respectively in one commit,
    one of the set-hooks was not invoked. This is fixed by adding the
    missing set-hooks.

    (ENG-20430, RT:35891, PS-30969)

  - ncs: Rollback from CLI is no longer affected by other transactions
    creating rollback files while the command is issued.

    (ENG-20404, RT:35743, PS-30819)

  - ncs: Previously if a transaction was aborted it would not be visible in
    the audit network log. That was corrected.

    (ENG-20368)

  - ncs: NSO will now properly terminate processes and clean up
    sessions/locks for actions being interrupted in the CLI.
    Interruptible devices actions:
    /devices/device/scp-to
    /devices/device/scp-from
    /devices/sync-from
    /devices/device/sync-from
    /devices/sync-to
    /devices/device/sync-to
    /devices/partial-sync-from
    /devices/connect
    /devices/device/connect
    /devices/disconnect
    /devices/device/disconnect
    /devices/check-sync
    /devices/device/check-sync
    /devices/device/compare-config
    /devices/check-yang-modules
    /devices/device/check-yang-modules
    /devices/device/load-native-config (action added in NSO 5.1)
    Interruptible commit-queue actions:
    /devices/commit-queue/wait-until-empty
    /devices/commit-queue/queue-item/wait-until-completed
    /devices/commit-queue/add-lock
    Interruptible service actions:
    check-sync
    deep-check-sync

    (ENG-19620, RT:34629, RT:34865, PS-29693, PS-29933)

  - aaa: NACM rules will not be reloaded from CDB when changes are limited
    to attributes.

    (ENG-21522, RT:37285, PS-32366, CSCvq00606)

  - c-api: CONFD_TRANS_CB_FLAG_FILTERED is no longer ignored for NETCONF
    subfilters.

    (ENG-21430, RT:37459, PS-32538, CSCvp82016)

  - c-api: Added support on string conversion functions to honour
    smiv2:display-hint clause when yang data type is string.

    (ENG-20969, RT:36746, PS-31826)

  - c-api: Fixed an overflow issue for uint64 type on ConfD API's
    confd_str2val function.

    (ENG-20927, RT:36756, PS-31836)

  - c-api: CDB subscription (on container) notification did not send when
    modified on parent list. This has been fixed now.

    (ENG-20336, RT:34250, PS-29368)

  - cdb: Some requests to read data from CDB oper with a filter would lead
    to a crash.  This bug has been fixed.

    (ENG-21291, RT:37354, RT:37248, PS-32433, PS-32329, CSCvp55236)

  - cdb: Write sessions against CDB operational will no longer hang if a
    write occurs during HA synchronization.

    (ENG-21218, RT:36803, PS-31884, CSCvp45643)

  - cdb: Loading upgrade XML files on a model with 'when' expressions will
    no longer fail.

    (ENG-21215, RT:37075, PS-32157, CSCvp45473, SR:686540985)

  - cdb: The CDB operational data was not updated correctly when upgrading.
    This has been fixed now.

    (ENG-21077)

  - cdb: Reading a node under a re-created case from CDB_PRE_COMMIT_RUNNING
    now returns the correct value.

    (ENG-20821, RT:36629, PS-31709)

  - cdb: If base identity moved and/or identity name changed, NSO failed at
    handling identity in phase0 of CDB upgrading. This has been fixed now.

    (ENG-20591, RT:36199, PS-31278)

  - cdb: NSO now handles schema upgrades from non-presence to presence
    container correctly.

    (ENG-20550, RT:35984, PS-31063)

  - cdb: cdb_set_values() returned CONFD_OK when set value to operational
    data under a nonexistent config list instance. This has now been changed
    to CONFD_ERR_BADPATH with error message "/path/to/list{key} does not
    exist".

    (ENG-20121, RT:35585, PS-30659)

  - cdb: When a CDB subscriber ran 'cdb_set_timeout' in a session started
    with 'cdb_start_session2', the timeout would not always be removed when
    the session ended. When the timeout hit, the socket would be closed.
    Now, when the session is ended, the timeout is removed.

    (ENG-20031, RT:34495, PS-29558)

  - cdb: cdb_is_default(), cdb_get_list() and cdb_exists() did not work
    correctly on leaf-lists when the leaf-list was uninstantiated and had a
    default value.

    (ENG-19262, RT:35888, RT:34359, PS-30966, PS-29414)

  - cdb: Reading default values and checking non-presence container
    existence now check when expressions.

    (ENG-19160, RT:34155, PS-29286)

  - cli: The C-style southbound configuration diff as a result of inserting
    a new list-instance in a non-empty ordered-by user list annotated with
    tailf:cli-show-long-obu-diffs, and thus changing the order of the list,
    was in some cases incorrect. This has been fixed.

    (ENG-21496, RT:37589, PS-32666, CSCvp93725, SR:686813497)

  - cli: List keys would appear in C-Style CLI configs even when they were
    annotated with 'tailf:cli-ignore-modified'. This has been fixed so that
    these list keys are not shown.

    (ENG-21374, RT:37370, PS-32448, CSCvp73069)

  - cli: A more appropriate error message is shown in the CLI when the user
    is trying to remove a mandatory leaf.

    (ENG-21168, RT:37019, PS-32100)

  - cli: An action or RPC with input parameter of leaf-list type would cause
    'show parser dump' to enter an infinite loop expanding the command with
    repeated leaf-list entry. This has now been fixed.

    (ENG-21162, RT:37052, PS-32133)

  - cli: When displaying configuration changes in curly bracket format
    changes to comments and attributes would not be displayed. This has been
    fixed such that they can be displayed if the "display annotations" and
    the "display tags" pipe targets are present.
    When displaying the changes to a device using commit dry-run it would
    sometimes display containers that only had changes to attributes such as
    back-pointers. This has been fixed.

    (ENG-21155)

  - cli: Using the tailf:cli-value-display-templates for config=true data
    caused problem when creating rollback files. However, using
    tailf:cli-value-display-templates is discouraged for config=true data.

    (ENG-21153, RT:37040, PS-32121)

  - cli: Modifying a service and then committing the changes would in rare
    case lead to an internal error. This has been fixed.

    (ENG-21152, RT:37043, PS-32124)

  - cli: The templatize command did not work correctly for data models
    containing leaf-lists. This has been fixed.

    (ENG-21125)

  - cli: If the screen length was set to 0, to indicate that no pagination
    should take place, it would be reset to the actual screen length when
    the terminal was resized. This has been fixed such that it remains 0 if
    explicitly set to 0.

    (ENG-21058, RT:36888, PS-31970)

  - cli: The CLI failed with an internal error when displaying a table
    longer than the tableLookAhead setting, and in combination with a
    de-select pipe target.

    (ENG-20925, RT:36790, PS-31871)

  - cli: The wrong completion alternatives were shown after entering the
    values for a leaf-list with the tailf:cli-full-command annotation. This
    has been fixed.

    (ENG-20913, RT:36732, PS-31812)

  - cli: When issuing show commands with selection filters in the CLI list
    instances without any data would still be displayed, when displayed as a
    table.

    (ENG-20912, RT:35690, PS-30766)

  - cli: Fixed a number of potential race conditions in rollback file
    selection.

    (ENG-20909)

  - cli: The CLI would time out with an IDLE TIMEOUT message even when the
    user was typing. The idle timeout would only be reset on TAB/SPACE
    completion or when a command was executed. This has been fixed such that
    the idle timeout is reset whenever the user types.

    (ENG-20837, RT:36662, PS-31742)

  - cli: The CLI could crash when combining NACM rules that block read
    access to specific nodes and also having dependency towards these nodes
    on data that is accessible to the user.

    (ENG-20824, RT:36784, RT:36661, PS-31865, PS-31741)

  - cli: The southbound diff calculation for CLI NEDs would result in
    excessive xpath evaluation, in particular when expressions would be
    evaluated in namespaces not associated with a device. This has been
    fixed.

    (ENG-20817, RT:37388, RT:36492, PS-32467, PS-31572, CSCvp01536)

  - cli: An action or RPC with input parameter of leaf-list type would cause
    'show parser dump' to enter an infinite loop expanding the command with
    repeated leaf-list entry. This has now been fixed.

    (ENG-20672, RT:35364, PS-30438)

  - cli: Handling of asterisk in list keys has been corrected.

    (ENG-20605, RT:36376, PS-31455)

  - cli: The optimization made in ENG-19149 (speed up the diff calculation
    for the case where almost all elements in a huge list are deleted)
    caused a slow down of calculating diff for adding huge amount of
    elements into a list.

    (ENG-20571, RT:36956, RT:35389, PS-32038, PS-30463)

  - cli: The XML displayed when running the 'show configuration | display
    xml' was not correct when the edits involved an insert into an
    ordered-by user list.

    (ENG-20524, RT:36140, PS-31218)

  - cli: The performance regarding the 'sync-to' action has been improved in
    some cases were the configuration diff would contain a large number of
    nodes annotated with tailf:cli-diff-dependency.

    (ENG-20504)

  - cli: Handling of nodes with tailf:cli-show-no, that the user cannot
    access, has been corrected.

    (ENG-19855, RT:35152, PS-30223)

  - cli: Completion for list keys with non-integer type has been updated to
    produce correct commands.
    Description of the tailf:cli-suppress-range has been corrected.

    (ENG-19776, RT:35142, PS-30213)

  - cli: The pipe target de-select did not work as expected when a
    non-presence container was selected.

    (ENG-19643, RT:34931, PS-29999)

  - cli: Improved security by encoding the parameters passed to OS commands.

    (ENG-18954, RT:33459, RT:35120, PS-28876, PS-30191)

  - cli: The idle timeout would not be honored waiting for the user to
    respond to a MORE prompt. From now on, if the user doesn't respond to a
    MORE prompt in the given timeout the MORE session will be terminated and
    the user returned to the CLI main prompt.

    (ENG-18015, RT:24628, PS-7800)

  - erlang-api: API documentation for transaction, data and validation
    callbacks is corrected.

    (ENG-21161, RT:37057, PS-32138)

  - java-api: NavuContainer.equals() always returned true for module level
    containers, this has been fixed.

    (ENG-21219)

  - java-api: The convenience method CdbSession.index(String, Object...) did
    not work. This has been fixed.

    (ENG-21090)

  - java-api: SnmpVarbind was not able to handle all ints in the unsigned
    32bit range as OID. This has now been fixed.

    (ENG-20601, RT:36374, PS-31453)

  - java-api: If a service package has a jar that apparently does its own
    classloading, there is a 'ClassNotFound' exception when that service is
    instantiated for the first time. This has now been fixed.

    (ENG-20485, RT:36092, PS-31171)

  - java-api: "MaapiException - not able to parse" seen if sharedCreate was
    called on a list inside of a multi-key list, since the keys were added
    twice. This has now been fixed.

    (ENG-19283, RT:34334, PS-29436)

  - java-api: A bug which caused a disconnect when using synchronous HA
    notifications has been addressed.

    (ENG-19252)

  - java-api: In a package upgrade scenario where the namespace of a module
    was changed, the old configuration tree could not always be read. This
    is now possible using the new classes ConfCdbUpgradePath and
    CdbUpgradeSession. For more information, see the development guide and
    javadoc.

    (ENG-18558, RT:32883, PS-28477)

  - java-api: HaException sometimes gave a misleading message and included
    the error code inside the message string. The message has been fixed and
    the error code is now available through the getErrorCode() method.

    (ENG-14103, RT:30204, PS-9936)

  - json-rpc: Intense testing of the JSON-RPC API could provoke the system
    to crash due to not being able to allocate more memory.

    (ENG-21156)

  - json-rpc: An invalid JSON-RPC payload could cause an internal error.
    This has been fixed.

    (ENG-20921)

  - json-rpc: If a device was unreachable when trying to access live-status,
    invalid JSON would be returned. An informative error is now returned
    instead.

    (ENG-20919)

  - netconf: Previously the source address for a NETCONF Call Home
    connection was incorrectly assigned which may have resulted in
    connection failures. This has now been fixed.
    To avoid using stale data, the NETCONF Call Home client now discard all
    pooled sessions for a device when establishing a new connection.

    (ENG-21543)

  - netconf: Enabling authorization callback no longer causes action
    invocation using NETCONF to fail.

    (ENG-21082, RT:36514, PS-31594)

  - netconf: Reading a leaf with tailf:link inside a case will no longer
    return a value if the case the leaf resides in is inactive.

    (ENG-20823, RT:36657, PS-31737)

  - netconf: Previously netconf "replace" operation was failing with
    "data-missing" on a "mandatory" node with "when" statement.
    This has been fixed by ENG-20879.

    (ENG-20650, RT:36401, PS-31481)

  - netconf: Session does not hang forever when terminated in the middle of
    copy-config routine.

    (ENG-20040, RT:34400, PS-29469)

  - netconf: The NETCONF server now correctly honors all NACM rules defined.

    (ENG-16113, RT:26856, RT:32772, RT:34670, RT:35534, PS-25992, PS-28381,
    PS-29736, PS-30609)

  - python-api: Fixed multiple issues with keypath parsing. Most notably,
    empty strings could not be used as keys and space characters were
    sometimes incorrectly interpreted as keys.

    (ENG-21097, RT:36986, PS-32069, CSCvp25395)

  - python-api: The maapi functions get_object(), get_values(), set_object()
    and set_values() no longer crashes when given huge amounts of input
    data.

    (ENG-20790, RT:36579, PS-31659, CSCvp11811, SR:686184098)

  - python-api: It is now possible to read structured values with
    _ncs.maapi.get_values().

    (ENG-20680, RT:36439, PS-31519)

  - restconf: If an action was augmented under a top node, it was not
    possible to invoke it. Additionally, when this happened, a stack trace
    was sent instead of an error message because of an unhandled JSON parser
    error. No more stack traces are sent for JSON parser errors, but proper
    error messages, and it is possible to invoke augmented actions under top
    nodes.

    (ENG-20631, RT:36397, PS-31477, SR:686109227)

  - restconf: Empty line between events added according to SSE W3C
    Recommendations. The 'eventTime' field value is quoted properly.

    (ENG-20523)

  - restconf: Server now responds with correct `400 Bad Request` error when
    receiving invalid JSON.

    (ENG-5700)

  - toolchain: If a device model changed the type of a leaf to a leafref
    with a deviation, the ncsc compiler would fail with "internal error".
    This bug has been fixed.

    (ENG-21598, RT:37582, PS-32659)

  - toolchain: If a leafref target had a deviation "not-supported", the ncsc
    compiler would fail with "internal error".  This bug has been fixed.

    (ENG-21497, RT:37598, PS-32675, CSCvp93772)

  - toolchain: If an "identity" was marked with "if-feature", and the
    feature was not implemented, the identity would still be present in the
    schema.  This bug has been fixed.

    (ENG-21196, RT:37098, PS-32180)

  - toolchain: ncs-project export now support four digit version numbers.

    (ENG-21115, RT:36997, PS-32080, CSCvp62382, SR:686507378)

  - toolchain: If a deviation changed the type of an augmented leaf to use a
    typedef defined in the deviation module, the YANG compiler would fail
    with "internal error". This has been fixed.

    (ENG-20970, RT:37582, RT:36796, PS-32659, PS-31877)

  - toolchain: If a leafref's path had a reference to itself, ncsc would go
    into an infinite loop.  This bug has been fixed.

    (ENG-20219, RT:35716, PS-30792)

  - toolchain: 'ncsc --mib2yang-std' in some cases generated YANG modules
    with missing imports. This has been fixed.

    (ENG-16806, RT:27343, PS-8678)

  - web-server: An invalid port number in the HTTP Host header, sent by a
    client, could cause an internal error. This has been fixed.

    (ENG-20941)

  - webui-one: The user would sometimes receive a "page not found" message
    when navigating using the browsers address bar in Firefox. This has been
    fixed.

    (ENG-21328)

  - webui-one: The user would sometimes receive an error message when trying
    to create a list-entry in a case.
    This has been fixed.

    (ENG-21217)

  - webui-one: Sometimes when a user navigated from a service in
    ServiceManager to the Configuration Editor, YANG widgets with
    when-statements did not show.

    (ENG-20463)

  - xpath: XPath expressions used to optimize list traversal that span both
    CDB configuration and operational data now returns results as expected.

    (ENG-21483, RT:37593, RT:37404, PS-32670, PS-32483)

  - xpath: when and must expressions from YANG files referencing list keys
    with identities now evaluate properly when the prefix from the module
    imports is different from the module prefix.

    (ENG-21211)

NSO-5.1 [April 11, 2019]
========================

Deprecated:

  - ncs: apply_trans_with_result() call in maapi API has been deprecated. It
    is suggested to use the new apply_trans_params() call instead.

    (ENG-20958)

  - python-api: Support for Python 2 (2.7.x) is deprecated and will be
    removed in NSO-5.3.
    The Python Software Foundation will not support Python 2 past January
    2020 and even today 2.7 receives little to no attention.
    Software written specifically for Python 2 should be migrated to support
    Python 3.

    (ENG-20207)

  - rest-api: The REST API is deprecated and will be removed in NSO-5.3.
    Users of the REST API should use the RESTCONF API instead,
    see NSO Northbound APIs: Migrating from REST to the
    RESTCONF API.

    (ENG-20521)

  - restconf: RESTCONF query parameters "limit" and "offset" are deprecated
    and will be removed in NSO-5.3.
    The query parameters "limit" and "offset" which also exist in the
    REST API could also be used in RESTCONF. However these aren't
    standardized and didn't work as intended. Users of these query
    parameters should use the extension REST Query API instead.

    (ENG-20872)

Removals:

  - ncs: Support for syslog via UDP has been removed in order to comply with
    Cisco security requirements. The default syslog functionality via libc
    syslog(3) is still available.

    (ENG-16844)

  - java-api: The NavuCdbXXXSubscribers and all its helper classes have been
    removed.
    Plain CDB subscribers should be used instead.

    (ENG-17530)

  - toolchain: The package packages/tools/discovery and the service
    packages/services/openstack have been removed from the NSO release.

    (ENG-20051)

  - web-server: Support for the SSL v3 protocol has been removed. TLS v1 is
    no longer supported by default, but can be enabled via
    /ncs-config/webui/transport/ssl/protocols.

    (ENG-19067)

  - webui-prime: The old webui (webui prime) is now removed and no longer
    supported.

    (ENG-20095)

Non-backwards compatible enhancements:

  - ncs: When audit-log-commit is enabled, it no longer by default adds
    entries on the form:
        commit thandle <N> <path> default set (<value>)
    The reason for this is that adding this can have a performance impact,
    depending on the data model.
    A new ncs.conf parameter, audit-log-commit-defaults has been added,
    which can be set to 'true' to get the old behavior.

    (ENG-20766)

  - ncs: When NSO fails to allocate more memory, exit() is called instead of
    abort(), and no core is generated. This behaviour has now been changed.
    The new default is to call abort(). Which potentially can generate a
    core file if the OS is configured that way. For example with "ulimit -c
    unlimited". When the environment variable NCS_DUMP is set a crash dump
    file is generated instead. So by setting or unsetting the variable
    different behaviour can be achieved.

    (ENG-20256, RT:35291, RT:35715, RT:35493, PS-30364, PS-30791, PS-30567)

  - ncs: The list /devices/device-module has been replaced with a list
    /devices/ned-ids/ned-id. It lists all modules supported by each ned-id.

    (ENG-20116)

  - ncs: Rollback files are now transferred from master to slave HA nodes in
    compressed chunks for efficiency and to prevent timeouts on high latency
    networks. Please note that this change is not backward compatible within
    an HA setup since it is necessary that all nodes in the HA cluster
    include this change to avoid failures when syncing.

    (ENG-19783, RT:34742, PS-29808, SR:685250845)

  - ncs: If multiple fxs files for a given namespace were present in package
    load-dirs, NSO would choose to load one of them in an unpredictable way.
    This has been fixed - now the fxs file with the latest YANG revision is
    loaded.

    (ENG-19245)

  - ncs: No-overwrite and partial-sync-from logic has been changed to
    optimize performance in some common cases. No-overwrite will only fetch
    a single list entry instead of the whole list where possible. In both
    no-overwrite and partial-sync-from cases NSO will be able request a more
    specific path in case of CLI NEDs that require mode-paths.
    NOTE that the semantics of the default partialShow capability advertised
    by NEDs implementing this functionality have changed. This change is
    compatible with all NEDs except alu-sr. This means that upgrading to
    this version of NSO, if partial-sync-from or no-overwrite functionality
    is used with alu-sr devices, then alu-sr NED needs to also be upgraded
    to at least alu-sr 7.4.3 or greater.

    (ENG-19030)

  - ncs: The YANG module "tailf-ncs-netmod-netconf", which contained the
    datamodel from RFC 5277 in YANG format for both NSO and NETCONF devices,
    has been removed. It has been replaced with a module "netmod_netconf"
    which is not supposed to be exposed to users. NETCONF devices that
    advertise support for RFC 5277 in their <hello> message has the data
    from this module automatically mounted under
    "/devices/device/live-status" (just like in the previous solution).

    (ENG-17983)

  - ncs: Device Group RPCs have been moved to
    '/devices/device-group/ned-id/rpc' to support multiple NED versions.

    (ENG-17521)

  - ncs: A new optional log file, AuditNetworkLog, has been introduced. If
    enabled, this log files contains condensed information about changes
    that has been pushed to devices, together with a header containing
    identifying information. The NED Trace file headers have been updated to
    contain the same information.

    (ENG-17094, RT:34181, PS-29324)

  - ncs: A number of crypto algorithms have been removed from the available
    and default sets for SSL/TLS, SSH and SNMP  in order to comply with
    Cisco security requirements. In particular:
    For the NSO-internal SSH implementation, the only key exchange algorithm
    enabled in the default ncs.conf is diffie-hellman-group14-sha1
    (diffie-hellman-group1-sha1 can be added via
    /ncs-config/ssh/algorithms/kex).
    For the SNMP agent, MD5 for authentication (usmHMACMD5AuthProtocol,
    /snmp/usm/local/user/auth/md5) and DES for privacy (usmDESPrivProtocol,
    /snmp/usm/local/user/priv/des) are no longer supported. When upgrading
    to
    this version of NSO, usm users utilizing any of these algorithms will be
    removed from the configuration.

    (ENG-16576)

  - ncs: NSO now supports full data model isolation between different NEDs
    and NSO itself.  This means that NSO can now handle NEDs with different
    (potentially incompatible) revisions of the same YANG modules.
    NSO now uses YANG schema mount (RFC 8528) to inform clients about which
    data models are used for the different devices.
    Please see the document "Upgrading to NSO 5.1" for details.

    (ENG-4)

  - aaa: The AAA check for replay of north-bound NETCONF notifications has
    been optimized. This enhancement is non-backwards compatible in a HA
    setup, where slave nodes need to have this fix to be compatible with a
    master node running with this fix.

    (ENG-20179)

  - aaa: Added /ncs-config/aaa/max-password-length, to make it possible to
    reject authentication attempts using very long passwords without
    attempting verification. The default value is 1024.

    (ENG-18876)

  - nct: The following commands no longer use the REST-interface for
    communicating with NSO and instead use ssh and 'ncs_cli': 'nct ha', 'nct
    packages', 'nct upgrade'. The only command that requires the
    REST-interface now is 'nct move-device', and parts of 'nct check' - for
    checking the REST-interface. This change effects both input parameter
    requirements (no longer require REST config, but requires SSH instead)
    and output format the the above commands.

    (ENG-125, RT:30301, PS-9977)

  - netconf: The ncs.conf setting 'inactive' has been deprecated. The
    capability is advertised if /ncs-config/enable-inactive is set.

    (ENG-19985)

  - packages: Added /devices/device/migrate, /devices/migrate and
    /devices/device-group/ned-id/migrate actions. The action makes it
    possible to change the NED identity and migrate all configuration data
    of the device to a new data model. The action will also report all paths
    that have been modified and the services affected by those changes.

    (ENG-17525)

  - toolchain: tailf:validate for a node with tailf:link was ignored, and
    'must' for such a node was rejected by the compiler. Now both
    tailf:validate and 'must' are allowed, and work as expected.

    (ENG-19689, RT:34962, PS-30030)

  - toolchain: When tailf:validate was used as substatement to 'must',
    causing invocation of the validation callback instead of evaluation of
    the 'must' expression, no dependency analysis was done for the 'must'
    expression, and dependencies for tailf:validate had to be given
    explicitly via tailf:dependency as usual.
    Now dependencies are calculated for the 'must' expression, and used for
    invocation of the validation callback, unless explicit dependencies (or
    tailf:no-dependency) have been given for tailf:validate. The dependency
    calculation will also have the effect that the compiler will report
    problems with the 'must' expression (e.g. references to undefined nodes)
    that were previously ignored in this case.

    (ENG-19505, RT:34055, PS-29233)

  - toolchain: The algorithm that generates integer values for YANG
    identifiers has been modified to generate a different value for
    "java-uninitialized", to avoid the conflict with "nas-enable".

    (ENG-19431)

  - toolchain: If a "must" or "when" statement on a config true node
    contains an XPath expression that refers to config false data, ncsc will
    now print a warning, since such expressions cannot be expected to work.
    See section 7.19.5 of RFC 7950.
    If you want to treat this new warning as a warning even when
    --fail-on-warnings is used,  pass -W YANG_ERR_XPATH_REF_BAD_CONFIG to
    ncsc.

    (ENG-17111)

Enhancements:

  - ncs: Limit the performance impact introduced when fixed missing when
    evaluation on non presence containers and leafs with default values
    (ENG-20493). For this optimization to take effect all FXS files needs to
    be re-compiled.

    (ENG-20685)

  - ncs: Validation of leafrefs and other must expressions have been
    optimized.  When a leafref or a node with a certain class of must
    expressions has been created, the validation time is now O(1) instead of
    O(N), where N is the size of the leafref/must dependency node set.
    The validation performance when a leafref target node has been deleted
    has also been optimized.

    (ENG-20575)

  - ncs: Transaction identifiers are now persisted between restarts and
    monotonically increasing, in contrast to previous version when
    transaction identifiers were reset on system restart.

    (ENG-20548)

  - ncs: NSO system installation now installs keys used for
    encrypted-strings in a separate file, ncs.crypto_keys alongside
    ncs.conf. Upgrading an installation will migrate the keys from ncs.conf
    to ncs.crypto_keys. If run interactively the user will be prompted
    before updating ncs.conf.

    (ENG-20405)

  - ncs: Audit-network-log now contains additional information if a
    transaction fails.

    (ENG-20368)

  - ncs: Headers in audit network log and NED traces now contains the
    hostname of the host that produced them.

    (ENG-20367)

  - ncs: Improved handling of reverse diff-sets for services. This will
    speed up update and delete of services.

    (ENG-20352, RT:35270, PS-30342, SR:685501480)

  - ncs: Added new commit parameter 'wait-device' that allows to take device
    locks internally in NSO before entering transaction critical section.
    This allows to avoid situation where the transaction is aborted because
    the devices affected by this transaction are busy with some other task
    inside NSO, such as sync-from or compare-config. For more detailed
    description refer to NSO User Guide -> Life-cycle Operations -> Commit
    Flags.
    New call apply_trans_params() added in maapi API in Java, Python and
    Erlang. This call is specific to NSO and allows to specify commit
    parameters in a user-friendly format.

    (ENG-20253, RT:35363, PS-30437, SR:685623028)

  - ncs: If a NETCONF device has the "ned-id tailf-ncs-ned:netconf", it is
    now possible to connect to the device even if the device doesn't
    advertise any data models compiled for that ned-id. This makes it
    possible to connect to a NETCONF device, and then inspect its
    capabilities and modules (in /devices/device/capability), and based on
    that information set the correct ned-id for the device.

    (ENG-20117)

  - ncs: A "get-port" command has been added to ncs-netsim(1), to simplify
    retrieval of the port a netsim device is listening on for a given
    protocol.

    (ENG-20053)

  - ncs: Previously, if a prepare/commit failed on a non-transactional
    device, then NSO would fetch the whole device's configuration before
    initiating abort/revert in order to be able to calculate the reverse
    diff-set. This has been changed so NSO will use partial-show feature if
    available to only fetch the part of configuration it is interested in.
    If the device does not support the partial-show feature, then the
    behaviour is unchanged.

    (ENG-20038)

  - ncs: When device connection or authentication parameters change, if
    there is an open session in the pool, NSO would create a new connection
    without closing the pooled session so it would only be closed on
    expiration (after session-pool idle-time). This has been improved so NSO
    will close a pooled session with non-matching parameters before starting
    a new one.

    (ENG-19856)

  - ncs: TransactionId and Hostname are added in the rollback file to give
    possibility to correlate rollback files with development and service
    logs. Service may use pre/post_modification callbacks to log transaction
    id in order to achieve that.

    (ENG-19853, RT:32153, PS-27960, SR:684020551)

  - ncs: Added progress trace entries for events between device show and
    calculating southbound diffs, in sync-to and abort/revert cases.

    (ENG-19685, RT:34930, PS-29998, SR:685388397)

  - ncs: During sync-from or sync-to, after NSO fetched the running
    configuration if the device closed the connection e.g. due to an idle
    timeout, then the transaction id retrieval would fail. This has been
    improved so that NSO will detect broken session and try to re-establish
    connection if necessary.

    (ENG-19534)

  - ncs: It is now possible to load encrypted-strings keys using an external
    command instead of storing them in ncs.conf to allow for use with
    external key management systems. New system installations are configured
    with this feature reading encrypted-string keys from ncs.crypto_keys
    using the ncs_crypto_keys command.

    (ENG-19346, RT:19899, RT:29036, RT:35872, RT:36286, PS-6131, PS-9364,
    PS-30950, PS-31365)

  - ncs: Nano Services official release. This formerly experimental feature
    is now finalized. Some syntactical changes and some enhancement have
    been made. See Nano Services chapter in Developer Guide for more
    information on this feature.

    (ENG-19341)

  - ncs: Added leaf /devices/global-settings/commit-queue/async and
    container /devices/global-settings/commit-queue/sync. This makes it
    possible to configure the commit queue operation mode globally to avoid
    setting the 'commit-queue/sync' commit parameter for every transaction.

    (ENG-19145)

  - ncs: Improved logging for FASTMAP services.

    (ENG-19037)

  - ncs: Augment transaction information to
    'netconf-state/sessions/session'. Operator can use any northbound
    interface to get a list of all user sessions.

    (ENG-18981, RT:31371, PS-27426)

  - ncs: All Tail-f YANG modules now have a license text.

    (ENG-18925)

  - ncs: Added configurable XML parser limits under
    /ncs-config/parser-limits effective for NETCONF, RESTCONF etc.

    (ENG-18894, RT:33514, PS-28902)

  - ncs: Introduced new live-status NED API. Java NEDs may register for the
    new showStatsPath() callback instead by announcing a special capability.
    For more information refer to NED Development Guide, chapter Network
    Element Drivers (NEDs), section Statistics.
    Deprecated old showStats() and showStatsList() live-status API. New
    implementations should implement showStatsPath() callback.
    Improved TTL handling for live-status tree. In particular, a bug where
    polling a nested list at regular intervals could prevent cache for the
    outer list from expiring has been fixed.

    (ENG-18888, RT:33409, PS-28853)

  - ncs: An error where the commit failed due to overlapping service or
    device configuration, received from a LSA device, is now considered
    transient in the commit queue. The commit queue will wait until the
    remote queue item has finished before retrying the commit towards the
    LSA device.

    (ENG-18801)

  - ncs: A new leaf 'operation' is added to plan-state-change notifications.
    This is to be able to retrieve also the operation that was reason for
    the state transition. Specifically notifications will now also be
    generated when the status of the state changes to 'not-reached' and when
    the state/component is deleted.

    (ENG-18724, RT:33171, PS-28686)

  - ncs: A proper path with keys is now included in the error message from
    package upgrade errors.

    (ENG-18632)

  - ncs: ncs --status namespace list is now sorted and only contains
    unmounted namespaces. ncs --status module list entries are sorted on
    module name and grouped by mount-id.

    (ENG-18609)

  - ncs: The internal runtime representation of data models (loaded fxs
    files) has been modified to consume much less memory. The actual
    improvements depends on data model. Measurements on different models has
    indicated that the new representation consumes in the range of 10% to
    20% of the previous implementation, leading to significant memory
    reduction for systems with large data models.

    (ENG-18567)

  - ncs: Added 'config-locked' admin-state for a device. This state prevents
    any changes to device's configuration while still allowing to connect to
    the device, see live-status and perform RPCs, which may be useful in
    software upgrade scenarios.
    In addition to this, scp-from and scp-to as well as commit no-networking
    did not respect the device's admin-state setting. This has been fixed.

    (ENG-18537)

  - ncs: The NSO LSA solution now makes it possible to add packages compiled
    with different ned-ids using the
    /devices/device/device-type/lsa-additional-ned-id. There is also a new
    optional package that is the complete tailf-ncs model devices compiled
    and possible to add to a lsa deployment. With this package the
    underlying lsa-nodes data and functionality becomes visible from the top
    node.

    (ENG-18426)

  - ncs: Added API functions for sending of YANG 1.1 "inline" notifications:
    confd_notification_send_path() for C API, new DpNotifStream.send()
    methods for Java API, _confd.dp.notification_send_path() for Python API,
    and econfd:notification_send/4 for Erlang API.

    (ENG-18258, RT:33080, RT:32451, PS-28607, PS-28173)

  - ncs: It is necessary to lock-down parts of the NSO configuration. To do
    so, copy/merge the <java-vm>, <python-vm> and <smart-license> sections
    of /opt/ncs/ncs-<vsn>/etc/ncs/ncs.conf.install to your /etc/ncs/ncs.conf
    (assuming default "system install" locations).
    This mandatory step upgrading from release below version:
    NSO-4.6
    NSO-4.2.7
    NSO-4.5.5
    NSO-4.3.8
    NSO-4.4.5.1

    (ENG-18130)

  - ncs: The query API now allows any XPath expression as a sort parameter
    (instead of just paths to leafs). For example "count(service-list)" or
    "sum(alarm-summary/*)".

    (ENG-18045)

  - ncs: Added action /devices/device/load-native-config that loads
    configuration data in native format into a transaction. This action is
    only applicable for devices with NETCONF, CLI and generic NEDs.

    (ENG-17881)

  - ncs: Authentication groups are extended to support action callbacks to
    retrieve southbound user and credentials for a local user, device and
    the authgroup that device belongs to.

    (ENG-17868)

  - ncs: Fixed potential issues related to address space layout
    randomization (ASLR).

    (ENG-17676)

  - ncs: Ensured use of approved and effective random number generation to
    comply with Cisco security requirements.
    Improved random number generation to always use cryptographically strong
    random bytes.

    (ENG-17675)

  - ncs: The wait-for-lock and the no-wait-for-lock options are now device
    settings as well. They can be set as a device profile, device and global
    setting. The no-wait-for-lock option is set in the global settings by
    default. If neither wait-for-lock and no-wait-for-lock options are
    provided together with an  action, the device setting is used.

    (ENG-17673, RT:31600, PS-27577, SR:683769247)

  - ncs: Re-create ncs-project directories when running the 'all' make
    target.

    (ENG-17596, RT:31495, PS-27502)

  - ncs: Improve validate command to validate the combination of change sets
    made in the config shared and private mode sessions.

    (ENG-17449, RT:30104, PS-9883)

  - ncs: Added /devices/commit-queue/queue-item/services to display list of
    services committed in the queue item.

    (ENG-17189)

  - ncs: Logging of user sessions have been made more explicit so that apart
    from logging authentication/login, creation and termination (together
    with reason) is also logged to the audit log. New logsyms have been
    added for session logging.

    (ENG-16643)

  - aaa: Added tailf:suppress-echo for
    /aaa/authentication/users/user/password, to prevent the password hash
    from being logged when /ncs-config/logs/audit-log-commit was enabled.

    (ENG-18777, RT:35898, RT:33211, PS-30976, PS-28702)

  - c-api: The struct confd_trans_ctx now contains a "traversal-id", which
    can be used by a data provider to keep track of concurrent list
    traversals for a single list in a single transaction.

    (ENG-19560)

  - c-api: It is now possible to give a filter (XPath expression) to a maapi
    cursor when traversing a list,  in order to retrieve only list entries
    that match the filter.

    (ENG-19532)

  - c-api: Henceforth, NSO daemon accepts and works with IPC connections
    from API libraries that are one major release older. As a special case
    for version 5.1, NSO daemon was made compatible with libconfd 6.4. Thus
    NSO-5.1 accepts connections from clients that use libconfd 6.4.x API.

    (ENG-19110)

  - c-api: A data provider can now opt in to get a list filter passed down
    to it in order to perform filtering of lists directly in the data
    provider, for better performance. See "Using List Filters" in
    "Operational Data" in the User's Guide.

    (ENG-18652)

  - cdb: ncs --cdb-debug-dump now
    - prints augmented namespaces symbolically rather than
      numerically.
    - prints ncs meta-data such as back-pointers and reference counters.

    (ENG-20838)

  - cdb: Upgrading from a 4.x release to 5.x release will initiate migration
    of the CDB database.
    For more information please see the NSO CDM migration white paper.

    (ENG-20486)

  - cdb: Upgrade failure due to out of disk space is now handled
    non-destructively and there is no need to restore the database after a
    failed upgrade.

    (ENG-15111, RT:28577, RT:34924, PS-9154, PS-29992)

  - cli: A new CLI YANG extension has been added,
    'tailf:cli-suppress-leafref-in-diff'. Normally, a node of the type
    leafref or alternatively a node annotated with tailf:non-strict-leafref
    will have these dependencies considered when the CLI is generating
    C-style configuration diffs, and place the referring node before or
    after its target, depending on the operation. This extension will
    suppress this behaviour so that these dependencies will not be
    considered.

    (ENG-20118)

  - cli: The tailf:cli-run-template-enter annotation was not available for
    list nodes when the tailf:cli-suppress-mode was also used. This has been
    changed.

    (ENG-19266, RT:34365, PS-29421)

  - cli: An optimization has been made to speed up the corner case when
    deleting almost all elements in a huge list. The diff calculation for
    that case scales better now.

    (ENG-19149, RT:33347, PS-28828, SR:684526647)

  - cli: Two new pipe targets have been added when showing operational data.
    They are called 'display local-time' and 'display universal-time'. When
    used any time-date values will be converted into local time (local-time)
    or UTC (universal-time).

    (ENG-18969)

  - cli: When deactivating a leaf-list entry, CLI did not display inactive
    leaf-list entry for show command although deactivating takes effect in
    the CDB. This has now been improved by enabling CLI to display inactive
    leaf-list entry.

    (ENG-18921, RT:32440, PS-28168)

  - cli: The CLI will not directly abort to error messages in case there is
    a subsystem failure or connection timeout. Instead it will try to
    present as much info as possible and push out the error message
    afterwards.

    (ENG-18861, RT:33411, PS-28888)

  - cli: The 'insert' and 'move' config mode commands now supports
    'ordered-by user' leaf-lists.

    (ENG-18747, RT:33175, PS-28670)

  - cli: Handling of Unicode in the CLI has been improved.

    (ENG-18308, RT:32476, PS-28185)

  - cli: A new CLI command option has been added in the J-style CLI for
    loading configuration relative to the edit position. It is invoked in
    configure mode as load <merge|overwrite> <file> [relative]
    A similar command is already present in the C-style CLI called rload.

    (ENG-18081, RT:32270, PS-28045)

  - cli: Combining when-expressions and leaf-lists now recalculates data
    node presentation during TAB/SPACE-completion in the CLI.

    (ENG-16549, RT:23734, PS-7566)

  - cli: Parameters to commands in clispec-files can now be specified using
    environment variables by using the syntax $(env:varname). For example,
    $(env:HOME) is expanded to the value of the environment variable called
    HOME.

    (ENG-15950)

  - documentation: REST API is deprecated so until it is finally removed
    there will be this REST to RESTCONF migration guide in the
    documentation.

    (ENG-20489, RT:36186, PS-31264)

  - documentation: Added description of create-device, add-device and
    ncs-xml-init-remote options to ncs-netsim man page.

    (ENG-19812)

  - documentation:
    * Improve documentation of syslog messages, with better formatting and
    including the level.
    * Improve documentation of alarms, with better formatting, adding
    messages, recommended action and conditions for the alarm being cleared.

    (ENG-19811)

  - documentation: Fixed various spelling errors.

    (ENG-19695, RT:35023, PS-30094)

  - documentation: Added documentation for "packages reload force" in NSO
    Administration Guide -> NSO Packages -> Loading packages.

    (ENG-18425, RT:32758, PS-28393)

  - documentation: Enhanced life-cycle documentation in the NSO user guide.
    All device and service actions are now described.

    (ENG-3715)

  - erlang-api: econfd:init_cursor/4 is added which takes a filter (XPath
    expression) used to limit returned entries when traversing a list.

    (ENG-19810)

  - erlang-api: Support for the list filter functionality has been added to
    the erlang API. See "Using List Filters" in "Operational Data" in the
    User's Guide.

    (ENG-19779)

  - erlang-api: The record confd_trans_ctx now contains a "traversal-id",
    which can be used by a data provider to keep track of concurrent list
    traversals for a single list in a single transaction.

    (ENG-19690)

  - erlang-api: The missing function econfd_maapi:get_authorization_info/2
    was added.

    (ENG-19279)

  - java-api: MaapiCursor can now be created with an optional XPath filter
    allowing it to traverse a subset of a list.

    (ENG-19809)

  - java-api: A java data provider can now opt in to get a list filter
    passed down to it in order to perform filtering of lists directly in the
    data provider, for better performance. See "Using List Filters" in
    "Operational Data" in the User's Guide, and the javadoc.

    (ENG-19780)

  - java-api: Data providers now support multiple concurrent iterators
    within a single transaction.

    (ENG-19691)

  - java-api: Added keep alive callback for NEDs (CLI and generic) when
    communicating from NSO to devices. The keep alive communication can be
    configured for NSO to periodically perform activity to keep the session
    open. It can also be configured to fail the connection if device has not
    been responsive for a given number of keep alive intervals. This is
    useful when for example CLI sessions have low idle timeouts configured
    and you for different reasons don't want to change these. The settings
    can be configured for a specific device, device-profile or as global
    settings.

    (ENG-19081, RT:33687, PS-29011, SR:684660734)

  - json-rpc: "deps" is now available in choice and case entries of
    "get_schema" response.

    (ENG-19712)

  - json-rpc: The JSON-RPC query api now has one more "result_as" type
    called "xpath_expression". When using this result type the XPath
    expression will be evaluated and the result will be returned as a JSON
    type. I.e. "1 + 1" will return 2 (not "2"). However, note that a path
    expression always returns a string regardless of what the YANG datatype
    the path might point to.

    (ENG-19164)

  - json-rpc: "evaluated_when_entry" is now available in choice and case
    entries of "get_schema" response if "evaluate_when_entries" is true.

    (ENG-18815)

  - json-rpc: show_config now supports result_as json2, variant of json
    output that stops on lists and use prefix instead of module name as
    prefix.

    (ENG-18056)

  - netconf: Added IP address, port and SSH key to NCS_NOTIF_CALL_HOME_INFO
    notification for an already known device. The port is also included when
    the device is unknown.
    Removed requirement that an IP address is configured for a device which
    has its admin-state indicating call-home.

    (ENG-20579, RT:36323, PS-31402)

  - netconf: The NETCONF lock RPC has been extended with a parameter
    "wait-time". If this parameter is given, and the lock is already held by
    some other session, the server waits for the specified amount of seconds
    for the lock to be released. If the lock cannot be granted within the
    specified amount of time, a "lock-denied" error is returned.  See the
    YANG module "tailf-netconf-extensions" for details.

    (ENG-20126)

  - netconf: Memory consumption is greatly reduced in some scenarios where
    there is garbage data present in NETCONF messages.

    (ENG-19509, RT:33606, PS-28971)

  - netconf: Added YANG module tailf-netconf-with-transaction-id, which adds
    an input leaf "with-transaction-id" to edit-config, copy-config, commit
    and start-transaction. If this leaf is present, the result will include
    the transaction id, also available at
    /netconf-state/datastores/datastore/transaction-id.

    (ENG-19425, RT:34636, PS-29700)

  - netconf: The performance of NETCONF copy-config to a SFTP URL was
    improved.

    (ENG-19404, RT:34400, RT:34384, PS-29469, PS-29453)

  - netconf: Introduced a new configuration attribute to extend NETCONF logs
    with rpc-reply status information. See NSO Manual Pages for detailed
    information.

    (ENG-18982, RT:33593, PS-28956)

  - netconf: NSO now supports NETCONF Call Home client protocol operations
    over SSH as defined in RFC 8071.
    With NETCONF SSH Call Home, the NETCONF client listens for TCP
    connection requests from NETCONF servers. The SSH client protocol is
    started when the connection is accepted. The SSH client validates the
    server's presented host key with credentials stored in NSO. If no
    matching host key is found the TCP connection is closed immediately.
    Otherwise the SSH connection is established, and NSO is enabled to
    communicate with the device. The SSH connection is kept open until the
    devices itself terminates the connection, a NSO user disconnects the
    device, or the idle connection timeout is triggered (configurable in the
    ncs.conf file).
    NSO will generate an asynchronous notification event whenever there is a
    connection request. An application can subscribe to these events and,
    for example, add an unknown device to the device tree with the
    information provided, or invoke actions on the device if it is known.
    If an SSH connection is established, any outstanding configuration in
    the commit queue for the device will be pushed. Any NETCONF notification
    stream for the device will also be reconnected.
    NETCONF Call Home is enabled and configured under
    /ncs-config/netconf-call-home in the ncs.conf file. By default NETCONF
    Call Home is disabled.
    A device can be connected through the NETCONF Call Home client only if
    /devices/device/state/admin-state is set to call-home. This state
    prevents any southbound communication to the device unless the
    connection has already been established through the NETCONF Call Home
    client protocol.

    (ENG-18938, RT:31492, RT:26239, PS-27498, PS-8280)

  - python-api: secondary_index and xpath_expr are now available as
    _ncs.maapi.init_cursor keyword arguments.

    (ENG-19951)

  - python-api: Added an optional seventh argument to cb_action()
    implementation with confd.dp.Action.action decorator that enables read
    access to data from current read-only transaction.

    (ENG-19821)

  - python-api: Support for the list filter functionality has been added to
    the python API. See "Using List Filters" in "Operational Data" in the
    User's Guide.

    (ENG-19778)

  - python-api: Make it easier to use maagic.List.move() where you had to
    specify the 'to' keys in form of a list with Values. Now you can specify
    the 'to' key in form of a simple list or even a single Python value
    (e.g. the string "key1").

    (ENG-19402, RT:34615, PS-29679)

  - restconf: Support for the additional NSO query parameters is now
    advertised as capabilities.
    Support for the non-standard "unhide" query parameter is now
    advertised as a capability.
    The non-standard query parameter "format" which did not work
    as intended is now removed. RESTCONF users should use the
    Accept header.

    (ENG-20717)

  - restconf: Introduced a new configuration attribute to require module
    name in compliance with RFC 8040, section 3.5.3.
    '/ncs-config/restconf/require-module-name/enabled (boolean) [true]'

    (ENG-20626)

  - restconf: Use X-Forwarded-(Host|Port) for modules-state schema URL.
    If user wants to configure schema URLs dynamically, e.g. being behind a
    reverse-proxy, allow this by configuring schema-server-url in ncs.conf
    and defining @X_FORWARDED_HOST@ and @X_FORWARDED_PORT@ to configure via
    X-Forwarded-Host and X-Forwarded-Port headers.

    (ENG-20496, RT:36158, PS-31236)

  - restconf: yanger - Add support for remote augment to the yanger RESTCONF
    Swagger plugin.

    (ENG-19959, RT:35908, RT:36167, RT:35065, PS-30986, PS-31245, PS-30135,
    SR:685385943)

  - smart-licensing: The Cisco smart licensing component of NSO has been
    upgraded to a version with support for Java 11.

    (ENG-19725)

  - toolchain: The development tool netconf-console has been updated to
    support Python 3 and now requires at least Python 2.6.

    (ENG-20677)

  - toolchain: Added support for handling interrupt signal (CTRL-C) when
    waiting for notifications on netconf-console.

    (ENG-19619)

  - toolchain: YANG compiler will issue a warning if both
    tailf:cli-display-separated and tailf:cli-incomplete-command are set on
    a node.
    Also a warning will be issued if tailf:cli-incomplete-command is set on
    an empty presence container.

    (ENG-19309)

  - toolchain: ncsc now takes a parameter --max-status current | deprecated,
    that can be used to implement only nodes with the given status.

    (ENG-18902)

  - toolchain: Added "ncsc --conformance" so that a YANG module can be
    compiled with conformance "import" instead of the default "implement".

    (ENG-18467)

  - web-server: Added the HTTP Strict Transport Security response header to
    the web server to protect users from navigating away from the hosted
    service to an HTTP supported website. This is (for example) to prevent
    malware or phishing attacks.

    (ENG-19492)

  - web-server: JSON-RPC log has been moved from
    /ncs-config/logs/developer-log into a separate log in
    /ncs-config/logs/jsonrpc-log. The format of the log is now more concise.
    The full traffic trace for JSON-RPC/REST/RESTCONF can be enabled from
    /ncs-config/logs/webui-access-log/traffic-log. See the ncs.conf(5)
    manual page for details.

    (ENG-19083)

  - web-server: Added the X-Content-Type-Options response header to the web
    server. This is a marker used by the server to indicate that the MIME
    (Multipurpose Internet Mail Extensions) types advertised in the
    Content-Type headers should not be changed and be followed.

    (ENG-18576)

  - web-server: Added the X-XSS-Protection response header to the web
    server. This is to prevent pages from loading if they detect an XSS
    (Cross-Site Scripting) attack.

    (ENG-18574)

  - webui-one: Added a link for direct navigation to the root level of the
    Configuration editor.

    (ENG-20804)

  - webui-one: Changed the links to configuration data in device manager.
    Device configuration is accessed in the 'configuration' column. Device
    metadata is reached using the 'name' column.

    (ENG-20495)

  - webui-one: Added an Alarm widget to the WebUI dashboard. This widget
    summarizes the critical, major and minor alarms currently in the system.

    (ENG-20464)

  - webui-one: Added help screen that describes leaf widgets and keyboard
    shortcuts.

    (ENG-20172)

  - webui-one: It is now possible to view only configuration in the
    Configuration editor. The 'configuration only' mode is as available in
    the 'view options' drop-down menu and will hide all parts of the model
    that does not have a set value. This includes leafs, containers, lists
    and leaf-lists. It can be thought of as the equivalent of using the
    'show config' command in the command line interface.

    (ENG-19845)

  - webui-one: The Configuration editor will now remember your last visited
    URL/keypath when navigating between different applications, via the
    shortcut panel or when using the keyboard shortcuts. Navigation via the
    Application hub takes you to the root path.

    (ENG-19388)

  - webui-one: If a user navigates to an operational data only view with the
    view options for operational data set to hidden, a warning stating that
    "All operational data is currently hidden" will be displayed alongside a
    button that will change the view options to show the operational data.

    (ENG-19302)

  - webui-one: Minor bug fixes and improvements for our leafref and union
    widget. Case insensitive fuzzy finder, keyboard navigation, focus
    control, works better in modals.

    (ENG-19280)

  - webui-one: Lists and leaf-lists has been redesigned to reduce the number
    of headers when rendering the configuration model.

    (ENG-19200)

  - webui-one: Added the ability to hide and show columns in the device
    manager.

    (ENG-19021)

  - webui-one: Added alarm column to the device manager.

    (ENG-18977)

  - webui-one: The Commit manager now has support for displaying the commit
    queue.

    (ENG-18961)

  - webui-one: Added a graphical rendering of the plan component in the
    Configuration editor. You can now see the over all progress of the plan
    as well as the progress of individual components.

    (ENG-18960)

  - webui-one: Changed the name of the "Model Browser" application to
    "Configuration Editor" to better represent the purpose of the
    application.

    (ENG-18913)

  - webui-one: All commit options are now supported when using the commit
    manager.

    (ENG-18863)

  - webui-one: Choices with when set to false were still rendered on the
    page. This has now been fixed.

    (ENG-18642, RT:31965, PS-27889, SR:684337591)

  - webui-one: The breadcrumb navigation path is now preceded with a slash,
    "/", indicating root level.

    (ENG-18627)

  - webui-one: Added keyboard shortcuts to the Configuration Editor to more
    easily change what type of data is displayed. See the help modal in the
    webui for further details.

    (ENG-18548)

  - webui-one: The way a choice/case is represented in the webui has changed
    to use tabs instead of a select drop-down list.

    (ENG-18495)

  - webui-one: It is now possible to to see information about actions. In
    'more functionality' mode (former 'delete mode') you can see an
    information icon on the action links. Clicking the information icon
    opens a modal, showing additional information.

    (ENG-18198)

  - webui-one: The connectivity button/columns in device and service
    manager, which derived their state from several action results, has been
    replaced with single actions. The actions are aligned with the nso
    actions. Action results can be viewed directly in the lists.

    (ENG-18193)

  - webui-one: Added a button to run the 'connect' action to a device if the
    user tries to navigate to a device's config without connecting to it
    first.

    (ENG-18136)

  - webui-one: It is now possible to see the minimum and maximum allowed
    elements in a list.

    (ENG-17980)

  - webui-one: Commit manager now has functionality to load/save
    transactions from/to file. There is also support for manually writing
    configuration data in json or xml and have it merged into the
    transaction.

    (ENG-17735)

Non-backwards compatible corrections:

  - ncs: Corrected an issue where deleting and creating an operational list
    element in the same transaction, existing descendants to the element
    were not deleted. This applies on only normal transactions, but not on
    operational transactions.

    (ENG-20706)

  - ncs: An augmented YANG node with the tailf:cdb-oper {persistent = true}
    could have a volatile operational node as a parent (not persistently
    stored). This implied that the operational data was lost at a restart of
    the system. Now an error is issued at load-time and the system is
    prevented from starting if this is the case.

    (ENG-20098)

  - ncs: XML validation did not strictly apply the namespace declarations.
    E.g. the NETCONF server would treat <filter> as a parameter to
    <get-config> and <config> as a parameter to <edit-config> even if the
    "xmlns" attribute for the <filter> and <config> nodes specified a
    different namespace. This has been fixed.

    (ENG-19428)

  - ncs: Sending of NETCONF notifications could fail if the schema for the
    notification payload had nodes with the same "local name" augmented from
    multiple modules. This has been fixed.
    The correction is considered non-backwards compatible since the earlier
    incorrect processing of node namespaces may also have allowed sending of
    notifications that did not conform to the schema, and now such
    notifications will be rejected.

    (ENG-19356, RT:34547, PS-29610)

  - ncs: Writing a key leaf is now considered as an error. The keys of a
    list are implicitly set when a new list entry is created. It has
    previously been possible to explicitly set a key leaf after it's been
    created with undefined behavior as a result. With this change existing
    implementations of callbacks, transforms, actions, services etc. that
    set the key leafs explicitly will no longer work.

    (ENG-19305)

  - ncs: NSO did not verify that the data sent with DpNotifStream.send()
    actually corresponded to a YANG "notification" statement. This has been
    fixed - now an error is logged to devel.log, and nothing is sent, if
    this requirement is not fulfilled.

    (ENG-19114)

  - cli: Change introduced for how cli-show-templates are displayed when
    issuing CLI show commands containing ranges, has been reverted. The
    problem that was originally addressed by the changes should instead be
    solved by using a conditional expression in the show-template for the
    list instance.
    For more information about expressions in show-template, see
    cli-template-string in the YANG CLI extensions man pages.

    (ENG-20167, RT:35539, PS-30614)

  - cli: Fix issue of CLI 'show running-config' command displays '0' instead
    of the string with range values.

    (ENG-19557, RT:34832, PS-29900)

  - cli: The tailf:cli-value-display-template annotation was used when
    formatting key values for use in completion. This caused the completion
    code to fail. This has been fixed.

    (ENG-18290, RT:32468, RT:35596, PS-28186, PS-30670)

  - cli: It is now possible to annotate a node with both tailf:hidden full
    and tailf:hidden <other>. In this case <other> can be unhidden, but
    since the node is hidden full, it is not accessible over NETCONF and
    RESTCONF.

    (ENG-12918, RT:28721, PS-9213)

  - java-api: In SyslogNotification, the prio and logno fields were
    confused, namely getPrio() method would return the value for logno and
    getLogNo() would return the value for prio. This has been fixed.

    (ENG-20490)

  - json-rpc: JSON-RPC method 'get_trans_changes' shall not show hidden
    nodes.

    (ENG-20286, RT:35636, PS-30712)

  - json-rpc: Corrected flags of get_schema in JSON-RPC.

    (ENG-20035)

  - json-rpc: Corrected the number of reported error in 'validate_commit'
    response, which is the value of 'ncs-config/max-validation-errors
    (uint32 | unbounded)' config attribute.

    (ENG-18988, RT:33750, PS-29043)

  - netconf: The replayLogCreationTime and replayLogAgedTime generated from
    the built-in replay store now adheres to RFC 5277. Please note that this
    change is backwards incompatible in a HA setup, where slave nodes need
    to have this fix to be compatible with a master node running with this
    fix.

    (ENG-19466, RT:34658, PS-29724)

  - netconf: Implemented 'netconf-capability-change' notification ('NETCONF'
    stream; see RFC 6470 section 2.2). The 'capabilities-changed' error is
    now fired only if capabilities list was effectively changed (capability
    added, modified or deleted; see also RFC 7895 section 2.1.1).

    (ENG-19231, RT:33896, PS-29145)

  - netconf: NSO now uses YANG Schema Mount
    (draft-ietf-netmod-schema-mount-10) for mounting of the devices' YANG
    models. One effect of this is that the device models are no longer
    advertised as being implemented by NSO's NETCONF and RESTCONF servers.
    Instead, the devices' YANG modules are advertised using an instantiation
    of the YANG library under each device, as mandated by YANG Schema Mount.

    (ENG-18144)

  - python-api: Using Maagic to create a keyed list entry in an input or
    output section of an action now need the key(s) to be specified in the
    create() call.

    (ENG-18102)

  - rest-api: HTTP PATCH is not allowed to create a non-existing instance.

    (ENG-21000)

  - restconf: Correct the body format of yang-patch-status response message
    in success cases.

    (ENG-20606, RT:36346, PS-31425)

  - restconf: REST/RESTCONF rejects the requests include multiple names in
    one JSON object.

    (ENG-19760, RT:35118, PS-30189)

  - restconf: RESTCONF does not allow PATCH method to create new resource
    instance to compliance with RFC 8040.

    (ENG-18737)

  - restconf: Added 'ietf-restconf' module prefix to top and root resources
    in JSON responses.

    (ENG-18675, RT:33106, PS-28667)

  - restconf: Corrected the 'Allow' header in the response to the 'OPTIONS'
    method.

    (ENG-16723, RT:28114, PS-8965)

  - restconf: Corrected the result of 'fields' query parameter in
    REST/RESTCONF requests.

    (ENG-16163)

  - snmp-agent: When storing SNMPv2-TC::DateAndTime values, these were
    incorrectly interpreted in two ways. Deciseconds were interpreted as
    1/100000s of a second and the minutes portion of negative timezone
    offsets were interpreted as positive offsets. This has been fixed.

    (ENG-18731, RT:33197, PS-28723)

  - toolchain: If --fail-on-warnings were given to ncsc, and a YANG module
    was compiled with a file name that didn't match the module name, a
    warning would be printed, but it wasn't treated as an error. This bug
    has been fixed.

    (ENG-19960)

  - toolchain: confdc / yanger no longer accepts "description", "reference",
    and "status" under "input" and "output".

    (ENG-18943)

  - web-server: The 'Server' header is now disabled by default. The Operator
    can set 'Server' header in HTTP response by using
    '/ncs-config/webui/custom-headers' config.

    (ENG-19424, RT:34641, PS-29705)

  - xpath: when and must expressions from YANG files now evaluate properly
    when the prefix from the module imports is different from the module
    prefix.

    (ENG-18103, RT:32274, PS-28061)

Corrections:

  - ncs: If an action or RPC is invoked within a transaction, the input
    parameters are now validated in the context of that transaction. This
    means that for example leafrefs to items created in that transaction are
    accepted as valid (which was previously not the case).

    (ENG-20813)

  - ncs: Fix a bug where a lingering process can hold a device lock until
    NSO is restarted. The devices could get locked when a sync-from was
    issued.

    (ENG-20779, RT:36983, RT:36501, PS-32066, PS-31581, SR:686159031)

  - ncs: An issue where NSO could try to write to CDB in slave mode has been
    corrected. This affected tailf-hcc package in combination with newer
    versions of the quagga NED.

    (ENG-20721, RT:36287, RT:36334, PS-31366, PS-31413)

  - ncs: Following a no-networking commit, if a sync-to failed for a device,
    the last-transaction-id for that device was reset to the current
    trans-id from the device. The correct behavior is to leave it as
    invalid. This has been fixed.

    (ENG-20692, RT:36434, PS-31514)

  - ncs: New processing instruction, if-ned-id, added to templates to choose
    parts of the template based on the ned-id.

    (ENG-20664)

  - ncs: Wrong handling of names in devices which were mounted at non
    top-tags this led to an internal error. This has been corrected.

    (ENG-20588)

  - ncs: Template loader will not complain about ambiguity for presence and
    non-presence containers.

    (ENG-20586)

  - ncs: The fetch-ssh-host-key action would not use the key exchange
    algorithm diffie-hellman-group-exchange-sha256 even if it was available.
    This has been fixed.

    (ENG-20511)

  - ncs: In rare circumstances entries in an ordered-by user list could be
    lost. This happened when the list had more than 128 entries, a hash
    collision occurred and the length of the values causing the collision
    was not equal.

    (ENG-20509, RT:36245, PS-31324, SR:686100229)

  - ncs: When a device that had a netconf subscription was deleted (or
    renamed) NSO could leak read-write transactions. This has been fixed.

    (ENG-20508)

  - ncs: when expressions are now checked on ancestor non presence
    containers on create, get, set and delete operations.

    (ENG-20493, RT:35690, PS-30766)

  - ncs: Loading JSON data with a YANG list in a different namespace could
    in some cases confuse the JSON parser and result in an "unknown element"
    error. This has been fixed.

    (ENG-20461)

  - ncs: Previously NSO could get an internal error when re-deploying a
    service that was first deployed in NSO 4.4 or earlier, containing an
    delete operation on a leaf-list. This has now been fixed.

    (ENG-20328, RT:35857, PS-30935)

  - ncs: JSON output with instance-identifiers pointing to instances with :
    in their keys no longer fail with internal error.

    (ENG-20298, RT:35853, PS-30931, SR:685908555)

  - ncs: Using the leaf-list backwards compatibility flag no longer cause a
    crash when iterating over a list in a subscriber.

    (ENG-20250, RT:35744, PS-30820)

  - ncs: Fixed handling case changes in nested choices when parent mandatory
    choice gets implicitly deleted and set back in the same transaction that
    was causing internal errors previously.

    (ENG-20228, RT:35503, PS-30577)

  - ncs: Setting single slash as value to a leaf with type union of
    instance-identifier and XPath would cause internal error. This has now
    been fixed.

    (ENG-20109, RT:35576, PS-30650)

  - ncs: maapi commands no longer fail with "not unique" error if there is a
    notification with the same name as the top-level element in the path
    when given without a prefix.

    (ENG-20093, RT:35536, PS-30611)

  - ncs: Previously dry-run in native format was not available when the
    device was locked/southbound-locked even though the NED supported
    producing the native diff when not connected. This has now been fixed.

    (ENG-20083, RT:35515, PS-30590, SR:685690402)

  - ncs: Using plan notification subscriptions for nano service instances
    resulted in an internal error. This has been fixed.

    (ENG-20037)

  - ncs: If a YANG list had multiple keys where at least one was a string,
    NSO would not order long strings (longer than 32 characters)
    alphabetically. This bug has been fixed.

    (ENG-20019)

  - ncs: Previously the CDB replication (which it is when high-availability
    mode is enabled, see /ncs-config/ha) of the CDB operational store has
    always been done asynchronously. This could lead to unexpected issues
    after a failover.
    The replication of the CDB operational store can now be done either
    asynchronously or synchronously. This is configured under
    /ncs-config/cdb/operational/replication-mode. The default is for the
    replication to be done synchronously.
    With the asynchronous replication, an API call writing operational data
    will return as soon as the updates have been sent to the connected
    slaves. With the default synchronous replication, the API call will
    block until the updates have been completely propagated to the slaves.
    Synchronous replication will come with a performance penalty for writing
    of operational data.

    (ENG-20006)

  - ncs: Previously creation of a service that sets up a plan component
    would fail with an internal error, if the user does not have read access
    to the service tree. The problem can be seen with a stacked service
    where the user has full access to the customer-facing service, but not
    to the lower-level service and the lower-level service sets plan data.
    This has now been fixed.

    (ENG-20002, RT:35439, PS-30513)

  - ncs: Fixed an issue that caused internal errors when cases under a
    nested choice were re-created and an annotation was added to the parent
    container.

    (ENG-19957)

  - ncs: Writing an explicit default value to a leaf with default value no
    longer cause dependent when-statements to be evaluated.

    (ENG-19953, RT:35284, PS-30356, SR:685493763)

  - ncs: In some cases opening a new NETCONF session towards a device within
    an existing SSH connection could prevent YANG modules announced via IETF
    YANG library capability from being recognized, resulting in an error
    claiming the device lacking known YANG modules. This has been fixed.

    (ENG-19948, RT:35371, PS-30445, SR:685641678)

  - ncs: Previously the dry-run output of a commit and the 'sync-to' action
    in XML and native formats would not be escaped properly to form valid
    XML. This has now been fixed.
    In NETCONF, the dry-run output in XML format was escaped even though the
    node has type anyxml. This has now been fixed.

    (ENG-19852, RT:33636, PS-28999)

  - ncs: Too much internal memory was used to store data models containing
    the tailf:cli-diff-dependency annotation. This has been fixed.

    (ENG-19847)

  - ncs: When a JSON payload had a toplevel data tag, NSO would reject list
    entries with keys out of order (with a "missing element" error). This
    has been fixed.

    (ENG-19840, RT:34972, PS-30040)

  - ncs: If the YANG representation changes so the data in the reverse
    diff of a service instance no longer match the schema, NSO should
    discard the data and call the create callback to create everything as
    new.
    Previously NSO would not discard the paths for move operations if the
    schema changed, but instead would crash, making it impossible to
    re-deploy/un-deploy the service instance. This has now been fixed.

    (ENG-19831, RT:35165, PS-30236)

  - ncs: Previously shared created/set operational data would cause an
    internal error when re-deploying a service. This has now been fixed.

    (ENG-19830, RT:35880, RT:35191, PS-30958, PS-30262)

  - ncs: tailf:symlink and tailf:link once again work for leaf-lists
    targets.

    (ENG-19817, RT:35190, PS-30261)

  - ncs: Tab completion on action parameters with type leafref and nested
    choice would make CLI restart. This has now been fixed.

    (ENG-19771, RT:35132, PS-30203)

  - ncs: Better handling when a new slave fails to synchronize with the
    master. Now the slave will be asked to retry performing the
    synchronization.

    (ENG-19650, RT:34752, PS-29819)

  - ncs: get-next operations toward an external data provider could contain
    a Keypath which should have been pruned by a corresponding
    when-expression (i.e no get-next operation should have been generated
    for this particular Keypath).

    (ENG-19611, RT:34376, PS-29443)

  - ncs: Previously when
    /devices/global-settings/commit-queue/enabled-by-default was set to true
    in an XML file that NSO loaded while starting up, NSO failed to start.
    This has now been fixed.

    (ENG-19561, RT:34374, PS-29445)

  - ncs: Service progress monitoring (SPM) crashed when starting NSO in read
    only mode. Also, SPM didn't always handle HA role changes correctly.
    These two defects have been fixed.

    (ENG-19555)

  - ncs: When a node started, and at the same time was given an HA role
    (master/slave/none), there was a risk of deadlock. This has been fixed.

    (ENG-19553, RT:34634, PS-29698)

  - ncs: Previously reporting progress events with MAAPI did not work from
    within FASTMAP code. This has now been fixed.
    Transaction id and session id are now displayed in CLI progress event
    print-outs when entering a new transaction phase.
    Sometimes duplicate progress trace log entries could be found in the
    devel.log. These have now been removed. As a side-effect this could also
    slightly improve performance in some cases.
    When NSO executed something in parallel, this could make the CLI
    progress trace event print-outs look incorrect. This has now been fixed.
    Added notification event class for progress events (with commit progress
    events as subset).

    (ENG-19549, RT:34697, RT:34874, PS-29762, PS-29942)

  - ncs: There was a very small risk that a HA master reverted to none when
    connecting with a slave. This has been corrected.

    (ENG-19539, RT:34819, PS-29887)

  - ncs: The removal of "stale" entries from the "object cache" for external
    data providers has been optimized.

    (ENG-19494)

  - ncs: In LSA setup, invoking re-deploy reconcile with
    keep-non-service-config option on the upper LSA node could incorrectly
    bump the refcounter on the corresponding service instance on the lower
    LSA node. This has been fixed.

    (ENG-19493, RT:34671, PS-29737, SR:685247140)

  - ncs: Previously reading the local-user leaf in a commit queue lock item
    after reboot of NSO could result in an internal error. This has now been
    fixed.

    (ENG-19484, RT:34725, PS-29792)

  - ncs: Previously the keep alive call for NEDs (CLI and generic) could be
    invoked while another call is executing. This has now been fixed.

    (ENG-19474)

  - ncs: Loading JSON data with empty containers and namespace changes no
    longer cause invalid "unknown element" errors to be reported.

    (ENG-19473, RT:35557, RT:34952, RT:34673, PS-30632, PS-30020, PS-29739)

  - ncs: The Nano service internal kicker has a new implementation. It is
    therefore removed from the data-kicker list.

    (ENG-19464, RT:34411, PS-29474, SR:685077464)

  - ncs: Re-evaluating a when-expression to true caused enclosed mandatory
    leaves, present in CDB, to incorrectly being marked as unset.

    (ENG-19462, RT:34679, PS-29745)

  - ncs: When partial-sync-from was invoked on the service node in cluster
    and concerned the devices located on different device nodes in cluster,
    then the service node would wait for one device node to complete
    operation before dispatching the work to another device node. This has
    been fixed so that the partial-sync-from operation is executed
    simultaneously on all device nodes.

    (ENG-19441)

  - ncs: Corrected error when two services set the same attribute.

    (ENG-19430, RT:34538, PS-29601, SR:685136715)

  - ncs: A data structure used for storing locks has been replaced in order
    to avoid a potential crash.

    (ENG-19340, RT:34515, RT:36072, RT:36308, RT:36883, PS-29578, PS-31151,
    PS-31386, PS-31965, SR:685116574)

  - ncs: When scp-from action was used without the "preserve" parameter, an
    internal error could occur in specific cases. This has been fixed.

    (ENG-19289)

  - ncs: Previously length constraints for alarm texts was not enforced.
    This has now been fixed.
    Changed alarm text for 'revision-error' alarm to not violate the length
    constraint.

    (ENG-19288, RT:34392, PS-29468)

  - ncs: Previously for some file transfers with the 'scp-to' action the
    entire file was not written on the remote host. This has now been fixed.
    Use /devices/device/write-timeout as timeout when writing data to the
    remote host with the 'scp-to' and 'scp-from' action.
    Added better reporting if 'scp-to' or 'scp-from' action timed out or
    connection was closed during transfer.

    (ENG-19274, RT:34277, PS-29369, SR:684773640)

  - ncs: An issue that could result in the system to freeze for large diff
    calculations have been addressed.

    (ENG-19214, RT:32571, PS-28331, SR:684199436)

  - ncs: Using CDATA inside PCDATA could cause incorrect validation errors.
    This has been fixed.

    (ENG-19186, RT:34202, PS-29327)

  - ncs: The processing of the "object cache" for external data providers
    has been optimized to compensate for the performance degradation caused
    by the changed leaf-list implementation.

    (ENG-19178, RT:34121, PS-29272)

  - ncs: If multiple notification kickers run the same action at the same
    time, only one would succeed. This has been fixed.

    (ENG-19173)

  - ncs: Previously there existed a race condition in the commit queue where
    a queue item would start executing just before a queue item with
    overlapping devices ahead of it in the queue was finished. This would
    result in the commit queue crashing with an internal error.

    (ENG-19143)

  - ncs: A config data provider using the backward-compatibility flag
    leafListAsLeaf could cause a commit to fail if the duration of the WRITE
    phase exceeded the object cache timeout. This has been fixed.

    (ENG-19141, RT:34119, PS-29271)

  - ncs: Fixed scenario where kickers could stop working after a HA
    failover.

    (ENG-19117, RT:33682, PS-29062)

  - ncs: With multiple levels of choices (where the upper level had a
    default case) and a lower case was deleted, the upper default was not
    reset. This has been fixed.

    (ENG-19116)

  - ncs: Previously some actions in NSO reported an internal error when the
    node was in read-only mode or slave HA state. These should now either
    return a proper error message or execute normally dependent on if the
    action is read-only or not.

    (ENG-19100, RT:32807, PS-28403)

  - ncs: There was a bug in template evaluation engine in a situation where
    an <?if?> processing instruction appeared in another <?if?> block that
    has an <?else?> statement, the <?else?> statement could be evaluated
    incorrectly. This has been fixed.

    (ENG-19097, RT:33972, PS-29188)

  - ncs: When partial-sync-from was invoked and the subtree requested to be
    synced included an ordered-by user list in some cases the sync could
    fail with an internal error. This has been fixed.

    (ENG-19076, RT:33903, PS-29141, SR:684772791)

  - ncs: Improved performance when processing when-expressions.

    (ENG-19058, RT:33871, RT:35291, PS-29125, PS-30364)

  - ncs: If a YANG 1.1 leaf-list with default value(s) was deleted (i.e.
    reset to default) with rollbacks enabled, the subsequent commit would
    fail with "internal error". This has been fixed.

    (ENG-18986, RT:34359, RT:33757, PS-29414, PS-29045)

  - ncs: Validation of a leaf-list with a leafref would give incorrect
    results if the type was an externally defined typedef. This has been
    fixed.

    (ENG-18971, RT:33710, PS-29015)

  - ncs: Inactive flag was not reset on a non-presence container upon
    sync-from when the element had been activated on device. This has been
    fixed.

    (ENG-18709, RT:32719, PS-28417, SR:684259787)

  - ncs: Unsupported SSH keys are skipped by the SSH daemon.

    (ENG-18637, RT:34232, RT:34731, RT:33068, PS-29345, PS-29798, PS-28599)

  - ncs: Problems related to `when`,`mandatory` and default values have been
    resolved.  These problems include:
    * A mandatory leaf not being deleted when the `when` expression for an
    enclosing non presence changed value from `true` to `false`
    * Subscription notifications were not delivered when a mandatory leaf
    was deleted
    *  Similar to above the `min-element` for a list was not handled when
    its existence was changed
    * a leaf with a default value would be seen as deleted when an ancestor
    node was deleted, resulting in too much data from a diff calculation and
    thus extra config being sent to a device

    (ENG-18543, RT:31641, RT:32744, RT:32899, RT:34179, PS-27610, PS-28375,
    PS-28480, PS-29304, SR:684328368)

  - ncs: Previously for actions taking a device/queue lock when reading from
    the device (sync-to, check-sync, compare-config) the 'block-others' flag
    has been put on the queue lock preventing any commit with the device
    being pushed through the commit queue. For these actions the
    block-others flag is not necessary and has been removed.

    (ENG-18437, RT:32688, PS-28324)

  - ncs: Fixed a problem where applying a rollback, on configuration without
    having full privileges for all changes, would cause an internal error
    message.

    (ENG-18279, RT:32492, PS-28197)

  - ncs: NSO would in some cases try to validate inactive data. This bug has
    been fixed.

    (ENG-17970)

  - ncs: Fixed internal error when an SNMP agent does not respond.

    (ENG-17865)

  - ncs: Mixing when/must expressions with default values could cause the
    default value to overwrite a correct set value. This has been fixed.

    (ENG-17417, RT:31165, RT:33119, RT:30732, PS-27304, PS-28626, PS-27015)

  - ncs: Previously when applying a template in an action callback, the
    'debug template' pipe flag in the CLI did not work. It now works as long
    as the user session requesting the action and applying the template is
    the same.

    (ENG-17106, RT:30740, RT:33973, PS-27026, PS-29189, SR:683399529)

  - ncs: Changed the data type accordingly in order to display timezone=0 in
    a correct way.

    (ENG-17018, RT:30525, PS-10108)

  - ncs: Simultaneous modification of data-nodes belonging to different case
    statements under the same choice by several transactions are now
    detected and marked as conflicting nodes.

    (ENG-16872, RT:29850, PS-9755)

  - ncs: Removed dependency between CLI and WebUI, to be able to use the CLI
    if the WebUI is not included.

    (ENG-16706, RT:26687, PS-8438)

  - ncs: Having a NACM rule with 'deny' on the 'delete'-operation for child
    nodes to a list, would cause a problem when deleting list instances
    created in one transaction. Doing a delete, through JSON RPC or CLI,
    would result in not deleting all of the created list instances as was
    expected.
    Now the delete is performed and all list instances are removed, if the
    NACM rules permits it.

    (ENG-16638, RT:25735, PS-8135)

  - ncs: Fixed a problem where trying to show a hidden node in JSON format,
    in a transaction where the node should be shown using the 'unhide'
    option, did not show the content of the node.

    (ENG-16110, RT:25364, RT:33329, PS-8024, PS-28788)

  - ncs: Some error messages for invalid NETCONF parameter settings in
    ncs.conf gave incorrect paths for related parameters. This has been
    fixed.

    (ENG-2739, RT:28806, PS-26969)

  - aaa: When default action is "deny" and rules are ordered like below:
    allow /a/b/c
    deny /a/b/*
    allow /a/b
    rules processing was incorrect, allowing access to siblings of /a/b/c
    node during completion. This is fixed.
    Note that in presence of module-specific rules access to siblings of
    /a/b/c during completion may be allowed despite "deny" rules, and this
    is not possible to change.
    During traversal all access rights are applied correctly.

    (ENG-19343, RT:34506, PS-29569)

  - aaa: RPC requests would always fail when an authorization callback for
    data authorization had been registered, and the execute access check was
    not filtered out. This has been fixed.

    (ENG-18566, RT:32906, PS-28518)

  - building: If a device has an empty YANG module and some other module
    imports that module, NSO device compilation would fail. This bug has
    been fixed.

    (ENG-20818)

  - building: ncsc now handles deref() of a leafref that doesn't refer to a
    key.

    (ENG-19535, RT:34798, PS-29866)

  - c-api: The C-API library (also used by the Python API) could not handle
    integer-values above 2^31-1 (used when avoiding known hash collisions)
    for the node elements in a hkeypath. This has been fixed.

    (ENG-20020, RT:35467, PS-30541)

  - c-api: An action handler implemented in C or Python could run out of
    stack space if called with a very long list as an input parameter. This
    has been fixed by allocating the temporary memory on the heap.

    (ENG-19314, RT:34485, PS-29548, SR:685128339)

  - c-api: Very long leaf lists could cause stack overflow in some
    configurations. The new behavior use stack for small leaf-lists and heap
    for large ones.

    (ENG-19194, RT:34241, PS-29359)

  - c-api: confd_pp_kpath(), confd_xpath_pp_kpath() and
    confd_format_keypath() now print enum values as strings instead of
    enum<integer> for leaf-list paths.

    (ENG-19014, RT:33758, PS-29066)

  - c-api: Fixed exists() handling in CAPI for keyless lists.

    (ENG-18577, RT:32809, PS-28421)

  - cdb: Memory consumption optimization for handling cdb_op deletes in
    operational db.

    (ENG-20603, RT:35715, PS-30791)

  - cdb: NSO didn't handle schema upgrades from non-presence to presence
    container correctly. This has been fixed.

    (ENG-20550, RT:35984, PS-31063)

  - cdb: Writing operational data to a leaf with a config prefix path
    containing a when-statement now works.

    (ENG-20251, RT:35760, PS-30836)

  - cdb: Various operations, such as sync-from, were slowed by handling of
    the inactive attribute. This has been fixed.

    (ENG-19480)

  - cdb: cdb_get_modifications could in some situations return extra
    C_XMLBEGIN tag values. This has been fixed.

    (ENG-19395, RT:34554, PS-29618)

  - cdb: A subscription on a leaf having a default value will now generate a
    proper notification on creation or deletion somewhere above in the model
    tree.

    (ENG-19210, RT:34250, PS-29368)

  - cdb: YANG choice with default didn't always work correctly. This has
    been fixed.

    (ENG-19031, RT:33726, PS-29023)

  - cdb: If a YANG 1.1 leaf-list with defaults was created when the defaults
    were "in use", and CdbSubscription.diffIterate() was used with the
    ITER_WANT_LEAF_LIST_AS_LEAF flag, the 'oldValue' parameter for
    CdbDiffIterate.iterate() was null instead of providing the defaults.
    This has been fixed.

    (ENG-19003, RT:33712, PS-29046)

  - cdb: Fixing scenario where NSO could crash due to incorrect handling of
    closing the socket for CDB sessions waiting for a lock.

    (ENG-18952, RT:33638, PS-28988)

  - cdb: Reading the top node in a nested choice, without any containers or
    lists in between, would not return the tag in string format but instead
    a hash number. This only occurred when deleting a nested case and in
    pre_commit_running.

    (ENG-18600, RT:32909, PS-28532)

  - cdb: CdbSession.exists() for a leaf-list element (i.e.
    "/path/to/leaf-list{element-value}") would always return "false". This
    has been fixed.

    (ENG-18559)

  - cdb: Type empty leafs with validation constraints are now intact after
    upgrade.

    (ENG-18211, RT:32127, RT:32570, PS-27947, PS-28255)

  - cdb: Removing a namespace by deleting a fxs file and restarting will now
    always change the transaction id.

    (ENG-17960, RT:32001, PS-27857)

  - cdb: It was possible to get corrupted data when adding enums from the
    start of the enum definition.

    (ENG-16708)

  - cdb: cdb_get_modifications() now includes key values for operational
    leafs with a configuration list parent.

    (ENG-5813, RT:34557, PS-29621)

  - cli: The CLI would time out with an IDLE TIMEOUT message even when the
    user was typing. The idle timeout would only be reset on TAB/SPACE
    completion or when a command was executed. This has been fixed such that
    the idle timeout is reset whenever the user types.

    (ENG-20837, RT:36662, PS-31742)

  - cli: When combining NACM rules that blocks read access to specific nodes
    and also having dependency towards these nodes on data that is
    accessible to the user the CLI could crash. This has been fixed.

    (ENG-20824, RT:36661, RT:36784, PS-31741, PS-31865)

  - cli: Custom CLI commands with parameters of type XPath would cause the
    CLI to crash during TAB completion if instanceDescription was set to
    false. This has been fixed.

    (ENG-20655, RT:36112, PS-31191)

  - cli: Completion of 'wait-device' commit parameter has been updated so
    that it does not suggest device names that are already entered.

    (ENG-20613)

  - cli: Handling of asterisk in list keys has been corrected.

    (ENG-20605, RT:36376, PS-31455)

  - cli: The annotation tailf:cli-suppress-echo in combination with
    tailf:cli-multi-value resulted in an internal error when a value with
    more than one component was entered in the CLI. This has been fixed.

    (ENG-20563, RT:36303, PS-31381)

  - cli: The XML displayed when running the 'show configuration | display
    xml' was not correct when the edits involved an insert into an
    ordered-by user list. This has been fixed.

    (ENG-20524, RT:36140, PS-31218)

  - cli: The performance regarding the 'sync-to' action has been improved in
    some cases were the configuration diff would contain a large number of
    nodes annotated with tailf:cli-diff-dependency.

    (ENG-20504)

  - cli: When producing a diff in the CLI with a group/user that has
    restricted access to certain data nodes the CLI could crash if the
    modified data had diff-dependency extensions. This has been fixed.

    (ENG-20475, RT:36149, PS-31227)

  - cli: A configuration saved in curly braces format (J-style) would not
    load properly if prefixes were displayed and the tailf:alt-name
    annotation was used. This has been fixed.

    (ENG-20473, RT:36057, PS-31136)

  - cli: A bug which caused lots of spurious error printouts about "unknown
    transaction handler" when executing "show configuration", "commit
    --dry-run" and similar commands has been fixed.

    (ENG-20444)

  - cli: A cli-diff-dependency annotated on a leaf with a default value
    would in some cases not trigger when displaying the configuration diff
    (e.g. 'commit dry-run outformat native') when the leaf had been deleted.
    This has been fixed.

    (ENG-20422)

  - cli: When using aaa-rules to block view but allow create/edit of data
    the J-Style CLI would block all access to the specified data. This has
    been fixed.

    (ENG-20418, RT:35838, PS-30915)

  - cli: Leafs with the tailf:cli-preformatted annotation were not saved
    with quotes in curly braces format. This has been fixed.

    (ENG-20369)

  - cli: When trying to delete elements of a leaf-list and the key had the
    same name as the leaf-list the CLI would sometimes present faulty naming
    information in the diff. This has been fixed.

    (ENG-20355, RT:35931, PS-31009)

  - cli: Using 'unhide' in the CLI caused an "internal error" message. This
    was due to group names not being handled correctly.

    (ENG-20350)

  - cli: confdc -c <file>.cli would sometimes report an error 'is
    incorrectly quoted' for attributes where the equal sign (=) was followed
    by a space. This bug was introduced in 6.7.3 and has now been fixed. A
    workaround is to remove the space between the equal sign character and
    the quote character.

    (ENG-20332, RT:35895, PS-30973)

  - cli: When the CLI accesses data and applies filters at a much higher
    level the CLI could sometimes crash. This has been fixed.

    (ENG-20242, RT:35531, PS-30606)

  - cli: Handling of action abort is brought in sync with handling of commit
    abort, that is, when an action is not confirmed or user pressed Ctrl-C
    during action execution, an abort message is logged in audit.log.

    (ENG-20202, RT:34672, PS-29738)

  - cli: Configuration diff calculation has been corrected for presence
    containers with cli-flatten-container and cli-compact-syntax extensions.

    (ENG-20131)

  - cli: Handling of node paths that exist in multiple namespaces has been
    corrected.

    (ENG-20096)

  - cli: Using tailf:cli-multi-value and tailf:cli-max-words on a leaf with
    type union could in some cases treat the next sibling node name as part
    of the current value being set. This has now been fixed.

    (ENG-20054, RT:35535, PS-30610)

  - cli: The configuration diff as displayed by the command 'commit dry-run
    outformat native' after changing the value of a node annotated with
    tailf:cli-sequence-commands and tailf:cli-reset-siblings, would in some
    cases be incorrect if this node was also subject to a dependency
    (tailf:cli-diff-set-before). This has been fixed.

    (ENG-20049, RT:35495, RT:35520, PS-30569, PS-30595)

  - cli: Filtering of refcounter- and backpointer-attributes in the CLI
    during diff-creation has been deemed unnecessary and damaging. This has
    been removed and thus fixed.

    (ENG-19955, RT:34680, RT:36040, RT:35821, RT:35117, PS-29746, PS-31119,
    PS-30898, PS-30188)

  - cli: An action with input parameter of list type would cause 'show
    parser dump' to enter an infinite loop expanding the command with
    repeated list entry. This has now been fixed.

    (ENG-19935, RT:35364, PS-30438)

  - cli: If a CLI user was repeatedly sending "configure" command trying to
    enter config mode while all the available concurrent read-write
    configuration sessions were occupied, it could sometimes "steal" a
    configuration session and block out another CLI user that previously
    held the last configuration session. This race condition issue has now
    been fixed.

    (ENG-19918, RT:31915, PS-27803)

  - cli: Handling of delete operation on a leaf with default value and
    tailf:cli-diff-delete-* dependencies has been corrected.

    (ENG-19903)

  - cli: Handling of nodes with tailf:cli-show-no, that the user cannot
    access, has been corrected.

    (ENG-19855, RT:35152, PS-30223)

  - cli: The configuration diff as displayed by 'commit dry-run outformat
    native' would in some cases be incorrect when using diff-dependencies
    and leafrefs in certain interacting combinations in the YANG model. This
    has been fixed.

    (ENG-19849, RT:34073, PS-29253)

  - cli: Some performance degradation was observed as a consequence of a
    closer reporting of annotations when displaying the configuration in
    Cisco style. It was seen when displaying the configuration, i.e. show
    running-config and when saving the configuration in C-style. The
    implementation of this feature has now been reworked to improve the
    performance.

    (ENG-19835, RT:35129, PS-30200)

  - cli: Trying to delete a list-instance in the C-style CLI (e.g. 'no ...')
    while including a leaf annotated with tailf:cli-hide-in-submode would in
    some cases result in an internal error. This has been fixed.

    (ENG-19804, RT:35169, PS-30240)

  - cli: Error messages related to file operations has been improved,
    containing the file name where it is possible.

    (ENG-19797)

  - cli: In case of a list with tailf:cli-delete-when-empty and
    tailf:cli-suppress-mode extensions, and with the
    tailf:cli-incomplete-command extension at the same time: when deleting
    such a data node, the diff calculation outputs an extra command line to
    add the data node itself even if it does not comply with
    tailf:cli-incomplete-command extension. This is to allow correct
    processing of correct configuration updates that result in such a diff
    while reporting an error if such updates are result of misconfiguration.

    (ENG-19781, RT:35141, PS-30212, SR:685504044)

  - cli: When using lists with multiple keys that also are leafrefs the CLI
    could fail during validation of the TAB-completion and incorrectly
    report an error. This has been fixed.

    (ENG-19759, RT:35095, PS-30166)

  - cli: Invoking an action with parameters augmented from another namespace
    resulted in an internal error. This has now been fixed.

    (ENG-19699)

  - cli: In case when an action has a list as input, and one leaf in the
    list has 'when' condition referring to another field of the same list
    the condition sometimes was not respected due to incomplete action
    parameters processing. This has been corrected.

    (ENG-19649, RT:34933, PS-30001, SR:684660186)

  - cli: The CLI performed a get_next() when doing completion (when hitting
    TAB or SPACE) even when there was a perfect match for the entered
    instance. This has now been changed such that a get_elem() is first
    attempted, and if the instance exists, no get_next() invocation is
    performed. If a list has a multi-element key, then this optimization is
    only applied to the last element of the key.

    (ENG-19642)

  - cli: The pipe command 'display json' did not work properly if the
    filtering command contained partial keys, range or explicit wildcard (*)
    to filter out list entries. This has now been fixed.

    (ENG-19595)

  - cli: When attempting to re-deploy dry-run outformat native on a service,
    an internal error was encountered. This has now been fixed.

    (ENG-19516, RT:34584, RT:35283, PS-29648, PS-30355)

  - cli: Group information (gids) was not properly transferred to programs
    started through the CLI and the WebUI when the user lacked gids. This
    has been fixed.

    (ENG-19481, RT:34598, PS-29662)

  - cli: When 'useShortEnabled' is set to "true" the CLI completion
    suggestion is based on the value that is set in the configuration.

    (ENG-19479, RT:34713, PS-29779)

  - cli: Commit aborted by user is logged in the audit log file.

    (ENG-19461, RT:34672, PS-29738)

  - cli: Show command would generate an internal error for certain types of
    match filters. This has been fixed.

    (ENG-19452, RT:34194, RT:34730, PS-29323, PS-29797)

  - cli: Tab completion and pattern parsing did not work correctly when the
    tailf:cli-key-format annotation was used to merge multiple key values
    into a single string. Also the ncs.conf setting
    /ncs-config/cli/allow-implicit-wildcard was ignored for cli-key-format
    values when set to false. This has been fixed.

    (ENG-19423, RT:34601, PS-29665)

  - cli: Commands aborted early due to access denied are logged in the audit
    log file.

    (ENG-19304, RT:33679, PS-29007)

  - cli: Programs invoked through the CLI, such as custom CLI commands, or
    startup scripts, were not executed correctly if the TERM variable was
    unset or set to empty. This has been fixed.

    (ENG-19221, RT:34162, PS-29284)

  - cli: The configuration diff as displayed by ex. 'commit dry-run
    outformat native' would in some cases be incorrect if the change-set
    contained a node of the type leafref and a node annotated with the
    extension 'tailf:cli-diff-add-after' under the same container parent.
    This has been fixed.

    (ENG-19193, RT:34073, PS-29253)

  - cli: In the case when a container has both tailf:cli-compact-syntax and
    tailf:cli-flatten-container the output of "show" command is finalized
    properly, showing all the data requested.

    (ENG-19154, RT:25687, PS-8120)

  - cli: A container with 'tailf:cli-compact-syntax' and with two children
    (containers), both with 'tailf:cli-flatten-container', would cause a
    faulty diff. This has been corrected.

    (ENG-19146)

  - cli: When the "defaultConfirmOption" element was set to "no" and calling
    a command defined in the clispec, in the non-interactive mode, the CLI
    did not automatically provide "yes" in the "confirmText" prompts. This
    has now been fixed.

    (ENG-19120, RT:32573, PS-28258)

  - cli: The configuration diff (as displayed by 'commit dry-run outformat
    native') after re-ordering the instances of a 'ordered-by user' list
    annotated with tailf:cli-show-obu-comments, tailf:cli-sequence-commands
    and its substatement tailf:cli-reset-siblings would in some cases
    display the list in an incorrect order. This has been fixed.

    (ENG-19112)

  - cli: A glitch in the caching mechanism of the CLI could result in
    reduced performance. This has been fixed.

    (ENG-19086)

  - cli: Additional synchronization has been implemented as part of user
    interrupt (Ctrl-C) handling.

    (ENG-19085, RT:33816, PS-29085)

  - cli: The CLI would sometimes present duplicate printouts of data nodes
    with modes. This has been fixed.

    (ENG-19074, RT:33876, PS-29147, SR:684713804)

  - cli: Displaying an inline notification defined in a container or list
    that had been augmented from another namespace would result in an
    'internal error'. This has now been fixed.

    (ENG-19055, RT:33080, PS-28607)

  - cli: Using 'describe' in the CLI could cause an "internal error" message
    when used with hidden group names. The 'describe' command is now updated
    to handle this.

    (ENG-19045, RT:33865, PS-29111)

  - cli: When the CLI session limit was reached, SSH login connections did
    not automatically close after timeout. This has now been fixed.

    (ENG-19042, RT:32471, PS-28179)

  - cli: CLI behaviour was inconsistent with regard to cases when clispec
    had defined commands with paths equal to data paths from the YANG model.
    Now this is modified so that commands from clispec take precedence over
    YANG model (and built-in commands) if the input matches clispec command
    exactly. The man page for clispec is also updated to reflect this
    behaviour change.

    (ENG-19027, RT:33703, PS-29032)

  - cli: The memory consumption when showing huge leaf-lists has been
    optimized.

    (ENG-19025, RT:33482, PS-28908)

  - cli: When executing 'show configuration' and piping to display in JSON
    format, CLI aborted with an internal error. This has now been fixed.

    (ENG-19016, RT:33418, PS-28842)

  - cli: Improved security by encoding the parameters passed to OS commands.

    (ENG-18954, RT:33459, RT:35120, PS-28876, PS-30191)

  - cli: The describe command for certain built in commands would fail. This
    has been fixed.

    (ENG-18942, RT:33584, PS-28947)

  - cli: Rollback files were not correct when deleting string values
    containing the sequence \[0-9]+. This has been fixed.

    (ENG-18933)

  - cli: It was not possible to get sibling nodes of a leaf-list in
    completion if the leaf-list had cli-flat-list-syntax extension set and
    the parent node had cli-sequence-commands extension set. This has been
    fixed. To have proper completion the leaf-list should also have
    cli-disallow-value extension with names of all sibling nodes, see
    updated User Guide.

    (ENG-18915, RT:33560, PS-28935)

  - cli: Configuration files on curly bracket format would not load properly
    if they contained a leaf-list of type instance-identifier, and the last
    character in the instance-identifier was a ]. This has been fixed.

    (ENG-18887)

  - cli: The configuration diff, displayed by 'commit dry-run outformat
    native', as produced by deleting instances in a list annotated with
    'tailf:cli-recursive-delete' while the list contained a container not
    annotated with the above statement, would in some cases be incorrect.
    This has been fixed.

    (ENG-18877)

  - cli: Sometimes when setting and unsetting data within a choice the CLI
    would miss out on reporting a delete operation. This has been fixed.

    (ENG-18834)

  - cli: Leaf-lists of string type with tailf:cli-range-list-syntax can have
    both integer ranges and string values as part of the same expression,
    e.g. "1-3,t1,t2". The CLI has been fixed in cases where this did not
    work properly.

    (ENG-18800)

  - cli: Presence container with only action children is now considered as
    editable during configuration, as it should be.

    (ENG-18754, RT:32838, PS-28432)

  - cli: With the new implementation of leaf-list after 'NSO 4.5', the
    performance of set leaf-list with many instances got much slower in the
    case that there is a when expression inside a non-presence container
    that depends on the leaf-list. This has now been fixed.

    (ENG-18586, RT:32958, PS-28536)

  - cli: The abbreviated unique command 'commit dry-run outformat n' did not
    auto-completed to its full command 'commit dry-run outformat native'.
    This has been fixed. The problem was only with this command.

    (ENG-18323, RT:32608, PS-28272)

  - cli: The J-Style CLI wouldn't suppress pagination for the pipe-command
    repeat. This has been fixed.

    (ENG-18304, RT:34361, RT:32580, PS-29417, PS-28244)

  - cli: XPath parameters to clispec commands would not display properly for
    some XPath expressions. This has been fixed.

    (ENG-17803, RT:31697, PS-27698)

  - cli: Handling of hidden actions from clispec, sharing mount point with
    actions from data model has been corrected.

    (ENG-17387, RT:31148, PS-27275)

  - cli: When sending the ctrl-v escape code to enter a verbatim/quote
    character in the CLI and then sending the paste-buffer the CLI could
    hang. This has been fixed.

    (ENG-16762, RT:32004, RT:30445, PS-27870, PS-10058, SR:683308927)

  - cli: Handling of leaves with tailf:cli-drop-node-name in submode has
    been corrected.

    (ENG-16597, RT:30855, RT:29903, PS-27116, PS-9777)

  - cli: A proper error is now returned when the maapi.cli_diff_cmd()
    function is called with invalid transaction id.

    (ENG-16518, RT:28442, PS-9100)

  - cli: The 'help' command now performs pagination correctly, showing all
    the output in pages.

    (ENG-16413, RT:29784, PS-9731)

  - cli: The CLI would not remove duplicates when prompting for a leafref
    leaf value. This has been fixed.

    (ENG-15114, RT:28621, PS-9173)

  - cli: The pipe command 'display json' did not handle filters on keys in
    lists properly, if filtering with a non-existing key, explicit wildcard,
    or implicit wildcard. This has now been fixed.

    (ENG-14211, RT:22197, RT:32661, RT:33275, RT:24525, PS-7096, PS-28316,
    PS-28770, PS-7767)

  - cli: Namespaces that were not exported to any northbound interface were
    still visible in the CLI if they were not rooted at the top level, for
    example elements augmented into an exported namespace. This has been
    fixed.

    (ENG-5723, RT:15205, RT:34221, RT:36502, PS-20874, PS-29339, PS-31582)

  - documentation: Clarify that NED traces contains everything that is being
    sent to a device.

    (ENG-20554)

  - documentation: Corrected supported methods of 'unhide' query param for
    REST API.

    (ENG-20312, RT:30188, PS-9924)

  - documentation: Removed mention of legacy AAA model.

    (ENG-20209)

  - documentation: Autogenerated documentation now includes all of the
    exported data types and functions from econfd.erl.

    (ENG-20021, RT:35485, PS-30559)

  - documentation: Added reference to the RESTCONF Token authentication in
    the Admin Guide, from the RESTCONF chapter.

    (ENG-19718, RT:35020, PS-30090)

  - documentation: Clarify that the contents of the NETCONF trace is not
    filtered in any way and that it may contain potentially sensitive
    information.

    (ENG-19454)

  - documentation: Note and README file is added regarding the yang files
    implemented internally.

    (ENG-17782, RT:28371, PS-9077)

  - documentation: Corrected the description of the append_list_entry JSON
    API method.

    (ENG-16220, RT:29003, PS-9349)

  - documentation: Corrected <reset-query> examples in NSO User Guide.

    (ENG-16138, RT:30106, PS-9885)

  - documentation: A note regarding sorting of the uncommitted rows has been
    added.

    (ENG-15856, RT:28002, PS-8925)

  - java-api: The string representation of a ConfKey is now quoted when it
    contains a % character.

    (ENG-20101)

  - java-api: A bug which caused a disconnect when using synchronous HA
    notifications has been addressed.

    (ENG-19252)

  - java-api: An internal error could occur in some cases when working with
    strings containing unicode characters in the Java API. This has been
    fixed.

    (ENG-18974, RT:33842, RT:33617, PS-29105, PS-28977)

  - java-api: If executing an action from a REST API, and the action
    callback threw an exception, the REST request got an error including the
    stack trace.
    This has been changed so that the stack trace will no longer be
    propagated in this case.

    (ENG-18694, RT:33040, PS-28567, SR:684401755)

  - java-api: When invoking ConfValue.getValueByString() with the path to a
    "leaf-list of enum" or "enum" type node, and a string not matching any
    of the enums, a NullPointerException was thrown.
    Now a MaapiException is given instead, saying that the string-to-enum
    conversion failed instead.

    (ENG-18645, RT:33000, PS-28608)

  - java-api: Calling NavuNode.getName() on root caused a
    ArrayIndexOutOfBoundsException to be thrown. This has been fixed.

    (ENG-18317, RT:32563, PS-28254)

  - java-api: A NullPointerException was thrown when reading empty oper data
    list. This has been fixed.

    (ENG-16598)

  - java-api: HaException sometimes gave a misleading message and contained
    its error code inside the message string. The message has been fixed and
    the error code is now available through the getErrorCode() method.

    (ENG-14103, RT:30204, PS-9936)

  - json-rpc: An invalid JSON-RPC payload could cause an internal error.
    This has been fixed.

    (ENG-20921)

  - json-rpc: If a device was unreachable when trying to access live-status,
    invalid JSON would be returned. An informative error is now returned
    instead.

    (ENG-20919)

  - json-rpc: The format of empty children in 'case' for 'get_schema' method
    has been corrected. Empty children should be an empty array - [] instead
    of the empty string "".

    (ENG-20453)

  - json-rpc: The get_leafref_values method in JSON-RPC for leafrefs in list
    keys (with multiple keys) would not give the expected response. This has
    been fixed.

    (ENG-19924, RT:35304, PS-30378)

  - json-rpc: Lists were returned on the root node of the result, if the
    lists parent container was otherwise empty. This has been fixed.

    (ENG-19913)

  - json-rpc: It is no longer possible to set NSO internal attributes using
    the set_attrs method.

    (ENG-19125)

  - json-rpc: When an AAA rule <rpc-name>*<rpc-name> was set to permit a
    user or group to execute any RPC, JSON-RPC invocation still resulted in
    "Permission denied". This has been corrected.

    (ENG-18723, RT:33046, PS-28701)

  - netconf: When a SSH NETCONF client was abruptly killed, the TCP
    connection was not closed properly. This has been fixed.

    (ENG-19832, RT:34681, RT:35369, PS-29747, PS-30443)

  - netconf: The session number is now present again in the NETCONF trace
    file.

    (ENG-19533, RT:34772, PS-29839)

  - netconf: When a TCP NETCONF client was abruptly killed, the NETCONF
    session was not removed properly. This has been fixed.

    (ENG-19442, RT:34681, RT:35369, RT:34523, PS-29747, PS-30443, PS-29586)

  - netconf: A create/delete operation on a list key is now allowed only if
    the parent (list-) level is also a create/delete operation.

    (ENG-19162, RT:33880, PS-29126)

  - netconf: When an edit-config was received with an element with operation
    "remove", and the element had child elements in the payload, the NETCONF
    server would return a 'data-missing' error. This bug has been fixed.

    (ENG-19132, RT:33881, PS-29127)

  - netconf: If the NETCONF server received a message with bad framing
    according to RFC 6242, it would in some cases not close the session.
    This bug has been fixed.

    (ENG-18963, RT:33522, PS-28924)

  - netconf: In some cases fragmented data wasn't handled correctly which
    could cause a NETCONF session to hang unresponsive. This has been fixed.

    (ENG-18595, RT:32891, PS-28514)

  - netconf: When a NETCONF notification subscription was set up, without
    stopTime, or with a stopTime in the future, and if a new notification
    was generated at the exact point in time when the replay server had
    finished traversing the replay store files, but had not yet turned the
    stream out of "replay mode", the new notification was stored in the
    replay store without being sent to the subscriber. This has been fixed.

    (ENG-15844, RT:27970, RT:28566, PS-8913, PS-26962)

  - netconf: If an XPath filter selects nodes in an user-ordered list, the
    selected list entries were not always returned in the right order.  This
    bug has been fixed.

    (ENG-3953, RT:20052, PS-6196)

  - python-api: Accessing 'uinfo' and 'groups' from a
    _ncs.dp.AuthorizationCtxRef, or 'groups', 'logno' and 'reason' from a
    _ncs.dp.AuthCtxRef no longer crashes the Python VM.

    (ENG-20338, RT:35916, PS-30994)

  - python-api: Converting paths to string now allows for longer strings
    than 2048 characters.

    (ENG-20329, RT:35357, PS-30431)

  - python-api: Subscriber instances without should_post_iterate() now run
    post_iterate() as the documentation states.

    (ENG-20194)

  - python-api: When using maagic.Action to call an action the maagic.Action
    class could, in some cases, fail to convert the resulting tag value
    array to an in-memory maagic object. This has been fixed.

    (ENG-20091)

  - python-api: Multiple Python 3 specific memory leaks plugged.

    (ENG-19936, RT:35241, PS-30312)

  - python-api: _ncs.pp_kpath(), _ncs.pp_kpath_len() and
    _ncs.xpath_pp_kpath() no longer truncate paths longer than 2048 bytes.

    (ENG-19933, RT:35357, PS-30431)

  - python-api: The ncs.dp.Action.action decorator now reuses the IP address
    and path arguments in addition to the previous port argument when
    connecting through MAAPI.

    (ENG-19752)

  - python-api: _ncs.Value.as_decimal64() no longer truncates the returned
    value to 32bit.

    (ENG-19680, RT:34950, PS-30018)

  - python-api: If the cb_move_after() data callback was implemented,
    calling maapi.Maapi.move_ordered() or maagic.List.move() with MOVE_AFTER
    or MOVE_BEFORE the process would hang indefinitely. This has been fixed.

    (ENG-19536, RT:34096, PS-29254)

  - python-api: When reading a non-empty leaf with maagic, an unnecessary
    get_elem() call was made to the data providers. This has been fixed.

    (ENG-19267, RT:34298, PS-29385)

  - python-api: An action callback handler implemented using the
    ncs.dp.Action.action decorator, called without transaction, did
    unnecessarily start a new user session. This has been fixed.

    (ENG-19228, RT:34302, PS-29388)

  - python-api: The 'dp.Action.action' decorator didn't always use the
    correct port when connecting to NSO. This has been fixed.

    (ENG-18895, RT:33542, PS-28927)

  - rest-api: Strings occurring in error messages in JSON format were not
    properly quoted when they contained special characters like newline and
    linefeed. This has been fixed.

    (ENG-18865, RT:32936, PS-28509, SR:684368961)

  - rest-api: Do not allow actions defined under non existent list entries
    to be invoked.

    (ENG-18617, RT:33040, PS-28567, SR:684401755)

  - rest-api: Changed so that we do not invoke unhide callback for action.

    (ENG-16585, RT:30188, PS-9924)

  - rest-api: Rollback functionality for the candidate datastore in the REST
    API did not work in some cases. This has been fixed.

    (ENG-16088, RT:28578, PS-9155)

  - restconf: The RESTCONF performance has been improved compared to the
    corresponding NETCONF operation.

    (ENG-20674, RT:36348, PS-31427)

  - restconf: REST/RESTCONF query failed to produce JSON output.

    (ENG-20076, RT:35543, PS-30618)

  - restconf: Spurious XML tags, belonging to empty containers, could occur
    in the output of a query. This has been fixed.

    (ENG-20075, RT:35543, PS-30618, SR:685700044)

  - restconf: Disallow DELETE operation on list level (in accordance with
    RFC 8040).

    (ENG-19750, RT:35088, PS-30158)

  - restconf: When retrieving 'config false' data, any enclosing list key is
    now also included in the replied content.

    (ENG-19166, RT:34064, PS-29321)

  - restconf: Improved user session handling and AAA checks for RESTCONF
    Event Notifications.

    (ENG-19139)

  - restconf: Fixed timeout problem when stopping NSO while having open
    RESTCONF event notification connections.

    (ENG-18538)

  - restconf: Lost a closing tag if a data provider that did not
    consistently return the first element, when requested repeatedly, was
    used.

    (ENG-18505, RT:32504, PS-28215)

  - restconf: Streaming connections are now terminated gracefully when a
    content generator process exits abnormally.
    Fixed an internal error which was seen on execution of live-status
    command towards StarOS device using Cisco-StarOS NED version 5.3.0.

    (ENG-18350, RT:33324, RT:32596, PS-28780, PS-28319)

  - restconf: Corrected the validation of the "content" query parameter
    which is only valid on data and datastore resources.

    (ENG-14099)

  - restconf: Refactored handling parameters when updating/creating items
    via RESTCONF. Now if an element has value null/"null"/[null] it is no
    longer ignored by the system, and instead processed correctly, with both
    existence and type checks. Making the system respond with correct
    response codes.

    (ENG-7171, RT:30230, PS-9947)

  - smart-licensing: The LSA feature is no longer reported in smart
    licensing.

    (ENG-19227)

  - smart-licensing: The HA sync mechanism of the Smart Licensing component
    couldn't handle empty files. This has been fixed.

    (ENG-19163, RT:34189, PS-29315, SR:684960597)

  - snmp-agent: If an SNMPv2-Trap-PDU or InformRequest-PDU with proper
    credentials was received by the SNMP Agent, it would permanently occupy
    a space in a 32 item long queue. I.e. if more than 32 such PDUs were
    received, the Agent would become non-responsive. The Agent can handle
    this now.

    (ENG-19554, RT:34733, PS-29800)

  - snmp-agent: Removed stdout printouts on SNMP logs.

    (ENG-18896, RT:33047, PS-28933)

  - snmp-agent: While processing getnext requests, the SNMP agent would
    invoke data providers several times on the same keypath, for keypaths
    having no value in nested lists. This has been fixed.

    (ENG-18683, RT:32236, PS-28029)

  - toolchain: When applying deviations, 'ncsc --ncs-compile-bundle' did not
    apply deviations to modules augmenting the deviated module, which would
    result in a failure to load the NED if a module augmented a node that
    was removed by a deviation. This has been fixed.

    (ENG-19693)

  - toolchain: Device compilation would insert the extension
    tailf:ned-ignore-compare-config for leaf-lists of type
    tailf:aes-cfb-128-encrypted-string or tailf:des3-cbc-encrypted-string,
    even though this extension is only allowed for leafs. This has been
    fixed.

    (ENG-19671, RT:34897, PS-29965)

  - toolchain: ncsc now keeps constraints of action inputs for actions under
    the live-status tree.

    (ENG-19506)

  - toolchain: If a device model had an action in config with a leafref to
    config false nodes, the model could not be loaded.  This bug has been
    fixed.

    (ENG-19406, RT:36103, RT:34593, PS-31182, PS-29657, SR:685187325)

  - toolchain: The YANG compiler allowed that 'if-feature' evaluation
    removed all 'enum' or 'bit' statements in an 'enumeration' or 'bits'
    type definition, even though the resulting module was invalid. This has
    been fixed - now an error is generated in this case.

    (ENG-19339, RT:34505, PS-29568)

  - toolchain: The YANG compiler would allow a deviation to remove a leaf
    that was a list key, even though the deviated module was invalid (since
    the 'key' statement specified a leaf that didn't exist anymore) and
    caused a crash at load time. This has been fixed - now such deviations
    are rejected by the compiler.

    (ENG-19122, RT:34072, PS-29230)

  - toolchain: The ncs-project tool had a problem exporting bundles where
    the version of a local build had an all integer SHA.

    (ENG-19115)

  - toolchain: The tailf:display-when statement that is valid for
    tailf:action was not accepted by the compiler for YANG 1.1 'action'.
    This has been fixed.

    (ENG-19047, RT:33864, PS-29110)

  - toolchain: The order of union member types was reversed when compiling a
    YANG-1.1 module, which could cause incorrect member selection when the
    type definitions overlapped. This has been fixed.

    (ENG-19017, RT:33701, PS-29030)

  - toolchain: Revision compilation could fail when an rpc or action was
    added or modified, even though the revision-merge information for
    rpc/action is not used. This has been fixed.

    (ENG-17763, RT:31369, RT:29716, PS-27666, PS-9699)

  - web-server: An invalid port number in the HTTP Host header, sent by a
    client, could cause an internal error. This has been fixed.

    (ENG-20941)

  - web-server: X-Frame-Options was missing for files served from a custom
    login directory even if enabled. This has been fixed.

    (ENG-19450, RT:34650, PS-29716)

  - web-server: If the ChaCha20-Poly1305 cipher suite is available from
    system OpenSSL - it is not picked by WebUI for use, due to
    implementation incompatibilities between OpenSSL and OTP.

    (ENG-18745)

  - web-server: Static resource serving now verifies the HTTP method used.

    (ENG-18596, RT:32391, PS-28122)

  - webui-one: Two sessions where sometimes created when logging in. This
    has been fixed.

    (ENG-20822)

  - webui-one: The Service Instances widget in the dashboard did not update
    automatically when services were created or deleted. This has been
    fixed.

    (ENG-20763)

  - webui-one: The Device widget in the dashboard did not update
    automatically when devices were created or deleted. This has been fixed.

    (ENG-20762)

  - webui-one: The Session widget in the dashboard did not update
    automatically when users logged on or off. This has been fixed.

    (ENG-20761)

  - webui-one: Applications with the same name as a package always got the
    URL of the package. This has been fixed.

    (ENG-20745)

  - webui-one: Opening a new webui-one window cleared the subscriptions from
    the old window. This has been fixed.

    (ENG-20711)

  - webui-one: Sometimes when a user navigated from a service in
    ServiceManager to the Configuration Editor, YANG widgets with when
    statements did not show. A reload was needed. This has been fixed.

    (ENG-20463)

  - webui-one: The commit manager warnings page only displays transaction
    validation errors and not warnings. This has now been fixed.

    (ENG-20188)

  - webui-one: A choice containing an empty case triggered a state where the
    schema was not completely loaded. This has been fixed.

    (ENG-19920)

  - webui-one: Deleted list item in an action input was still present when
    running the action. This has been fixed.

    (ENG-19870, RT:35234, PS-30305)

  - webui-one: Leaf-lists where not included in parameters when running an
    action. This has been fixed.

    (ENG-19844, RT:35218, PS-30289)

  - webui-one: Navigating up and down in a list could under certain
    conditions cause the schema to not load completely. This has been fixed.

    (ENG-19706)

  - webui-one: get_schema was sometimes called multiple times for the same
    path, before previous calls had finished. This has been fixed.

    (ENG-19648)

  - webui-one: Schemas for lists were sometimes unnecessarily reloaded due
    to an invalid schema path. This has been fixed.

    (ENG-19647)

  - webui-one: Lists ignored when statements. This has now been fixed.

    (ENG-19586, RT:34856, PS-29924)

  - webui-one: Pressing the Enter key in a textarea in a Modal dialog,
    caused the modal to close. This has been fixed.

    (ENG-19398)

  - webui-one: Refreshing the webui could sometimes lock the multi-checkbox
    widget. This has now been fixed.

    (ENG-19134)

  - webui-one: The Service Instances Dashboard widget only showed the
    service count for the selected service point in the Service Manager.
    This has now been fixed.

    (ENG-18953)

  - webui-one: Combo boxes in the Configuration Editor have been replaced,
    the new version has better cross-browser compatibility and consistent
    behaviour.

    (ENG-18920)

  - webui-prime: Service Points did not render correctly when the user was
    connected via a slow internet connection. This has now been fixed.

    (ENG-19082, RT:33382, PS-28823)

  - xpath: derived-from() and derived-from-or-self() now handles identity
    strings without a prefix.

    (ENG-20204)

Known_Issues:

  - cli: During the development of NSO-5.1 it was noticed that a slight
    degradation of performance of the CLI has occurred. This is due to the
    introduction of new and safer data structure within the internals of
    ConfD/NSO. The new data structures however required more frequent
    lookups of data towards the database. There is a standing issue to
    mitigate this in an upcoming patch release and for most parts of the
    CLI this won’t be an issue.

    (ENG-21091)
