'\" t
.\"     Title: ncs
.\"    Author: 
.\" Generator: DocBook XSL Stylesheets v1.78.1 <http://docbook.sf.net/>
.\"      Date: 05/14/2024
.\"    Manual: NCS Manual
.\"    Source: Cisco Systems, Inc.
.\"  Language: English
.\"
.TH "NCS" "1" "05/14/2024" "Cisco Systems, Inc." "NCS Manual"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
ncs \- command to start and control the NCS daemon
.SH "SYNOPSIS"
.HP \w'\fBncs\fR\ 'u
\fBncs\fR [\-\-conf\ \fIConfFile\fR] [\-\-cd\ \fIDir\fR] [\-\-addloadpath\ \fIDir\fR] [\-\-nolog] [\-\-smp\ \fINr\fR] [\-\-foreground\ [\-v\ |\ \-\-verbose]\ [\-\-stop\-on\-eof]] [\-\-with\-package\-reload] [\-\-ignore\-initial\-validation] [\-\-full\-upgrade\-validation] [\-\-disable\-compaction\-on\-start] [\-\-start\-phase0] [\-\-epoll\ {true\ |\ false}]
.HP \w'\fBncs\fR\ 'u
\fBncs\fR {\-\-wait\-phase0\ [\ \fITryTime\fR]  | \-\-start\-phase1 | \-\-start\-phase2 | \-\-wait\-started\ [\ \fITryTime\fR]  | \-\-reload | \-\-areload | \-\-status | \-\-check\-callbacks\ [\fINamespace\fR\ |\ \fIPath\fR] | \-\-loadfile\ \fIFile\fR | \-\-rollback\ \fINr\fR | \-\-debug\-dump\ \fIFile\fR\ [Options...]  | \-\-cli\-j\-dump\ \fIFile\fR | \-\-loadxmlfiles\ \fIFile\fR... | \-\-mergexmlfiles\ \fIFile\fR... | \-\-stop} [\-\-timeout\ \fIMaxTime\fR]
.HP \w'\fBncs\fR\ 'u
\fBncs\fR {\-\-version | \-\-cdb\-debug\-dump\ \fIDirectory\fR\ [Options...]  | \-\-cdb\-compact\ \fIDirectory\fR}
.SH "DESCRIPTION"
.PP
Use this command to start and control the NCS daemon\&.
.SH "STARTING NCS"
.PP
These options are relevant when starting the NCS daemon\&.
.PP
\fB\-c\fR, \fB\-\-conf\fR ConfFile
.RS 4
ConfFile is the path to a ncs\&.conf file\&. If the
\-c File
argument is not given to
ncs, first
$PWD
is searched for a file called
ncs\&.conf, if not found
$NCS_DIR/etc/ncs/ncs\&.conf
is chosen\&.
.RE
.PP
\fB\-\-cd\fR Dir
.RS 4
Change working directory
.RE
.PP
\fB\-\-addloadpath\fR Dir
.RS 4
Add Dir to the set of directories NCS uses to load fxs, clispec, NCS packages and SNMP bin files\&.
.RE
.PP
\fB\-\-nolog\fR
.RS 4
Do not log initial startup messages to syslog\&.
.RE
.PP
\fB\-\-smp\fR Nr
.RS 4
Number of threads to run for Symmetric Multiprocessing (SMP)\&. The default is to enable SMP support, with as many threads as the system has logical processors, if more than one logical processor is detected\&. Giving a value of 1 will disable SMP support, while a value bigger than 1 will enable SMP support, where NCS will at any given time use at most as many logical processors as the number of threads\&.
.RE
.PP
\fB\-\-foreground [ \-v | \-\-verbose ] [ \-\-stop\-on\-eof ] \fR
.RS 4
Do not start as a daemon\&. Can be used to start NCS from a process manager\&. In combination with \-v or \-\-verbose, all log messages are printed to stdout\&. Useful during development\&. In combination with \-\-stop\-on\-eof, NCS will stop if it receives EOF (ctrl\-d) on standard input\&. Note that to stop NCS when run in foreground, send EOF (if \-\-stop\-on\-eof was used) or use ncs \-\-stop\&. Do not terminate with ctrl\-c, since NCS in that case won\*(Aqt have the chance to close the database files\&.
.RE
.PP
\fB\-\-with\-package\-reload\fR
.RS 4
When NCS starts, if the private package directory tree already exists, NCS will load the packages from this directory tree and not search the load\-path for packages\&. If the \-\-with\-package\-reload option is given when starting NCS, the load\-path will be searched and the packages found there copied to the private package directory tree, replacing the previous contents, before loading\&. This should always be used when upgrading to a new version of NCS in an existing directory structure, to make sure that new packages are loaded together with the other parts of the new system\&.
.sp
When NCS is started from the /etc/init\&.d scripts, that get generated by the \-\-system\-install option to the NCS installer, the environment variable NCS_RELOAD_PACKAGES can be set to \*(Aqtrue\*(Aq to attempt a package reload\&.
.RE
.PP
\fB\-\-with\-package\-reload\-force\fR
.RS 4
When reloading packages NCS will give a warning when the upgrade looks "suspicious", i\&.e\&. may break some functionality\&. This is not a strict upgrade validation, but only intended as a hint to NSO administrator early in the upgrade process that something might be wrong\&. Please refer to Loading Packages section in NSO Administration Guide for more information\&.
.sp
If all changes indicated by the warnings are intended, this option allows to override warnings and proceed with the upgrade\&. This option is equivalent to setting NCS_RELOAD_PACKAGES environment variable to \*(Aqforce\*(Aq\&.
.RE
.PP
\fB\-\-ignore\-initial\-validation\fR
.RS 4
When CDB starts on an empty database, or when upgrading, it starts a transaction to load the initial configuration or perform the upgrade\&. This option makes NCS skip any validation callpoints when committing these initial transaction\&. (The preferred alternative is to use start\-phases and register the validation callpoints in phase 0, see the user guide)\&.
.RE
.PP
\fB\-\-full\-upgrade\-validation\fR
.RS 4
Perform a full validation of the entire database if the data models have been upgraded\&. This is useful in order to trigger external validation to run even if the database content has not been modified\&.
.RE
.PP
\fB\-\-disable\-compaction\-on\-start\fR
.RS 4
Do not compact CDB files when starting the NCS daemon\&.
.RE
.PP
\fB\-\-start\-phase0\fR
.RS 4
Start the daemon, but only start internal subsystems and CDB\&. Phase 0 is used when a controlled upgrade is done\&.
.RE
.PP
\fB\-\-epoll { true | false }\fR
.RS 4
Determines whether NCS should use an enhanced poll() function (e\&.g\&. Linux epoll(7))\&. This can improve performance when NCS has a high number of connections, but there may be issues with the implementation in some OS/kernel versions\&. The default is true\&.
.RE
.SH "COMMUNICATING WITH NCS"
.PP
When the NCS daemon has been started, these options are used to communicate with the running daemon\&.
.PP
By default these options will perform their function by connecting to a running NCS daemon over the loopback interface on the standard port\&. If the environment variable
\fBNCS_IPC_PORT\fR
and/or
\fBNCS_IPC_ADDR\fR
are set then the address/port in those variables will be used to communicate with the NCS daemon\&. (Must be used if the daemon is not listening on its standard port on localhost, see the
/ncs\-config/ncs\-ipc\-address/ip
setting in the
\m[blue]\fBncs\&.conf(5)\fR\m[]
man\-page, and the section on IPC in the Admin Guide)\&.
.PP
\fB\-\-wait\-phase0 [ TryTime ]\fR
.RS 4
This call hangs until NCS has initialized start phase0\&. After this call has returned, it is safe to register validation callbacks, upgrade CDB etc\&. This function is useful when NCS has been started with \-\-foreground and \-\-start\-phase0\&. It will keep trying the initial connection to NCS for at most TryTime seconds (default 5)\&.
.RE
.PP
\fB\-\-start\-phase1\fR
.RS 4
Do not start the subsystems that listen to the management IP address\&. Must be called after the daemon was started with \-\-start\-phase0\&.
.RE
.PP
\fB\-\-start\-phase2\fR
.RS 4
Must be called after the management interface has been brought up, if \-\-start\-phase1 has been used\&. Starts the subsystems that listens to the management IP address\&.
.RE
.PP
\fB\-\-wait\-started [ TryTime ]\fR
.RS 4
This call hangs until NCS is completely started\&. This function is useful when NCS has been started with \-\-foreground\&. It will keep trying the initial connection to NCS for at most TryTime seconds (default 5)\&.
.RE
.PP
\fB\-\-reload\fR
.RS 4
Reload the NCS daemon configuration\&. All log files are closed and reopened, which means that
\fBncs \-\-reload\fR
can be used from e\&.g\&. logrotate(8), but it is more efficient to use
\fBncs_cmd \-c reopen_logs\fR
for this purpose\&. Note: If we update a \&.fxs file it is not enough to do a reload; the "packages reload" action must be invoked, or the daemon must be restarted with the
\fB\-\-with\-package\-reload\fR
option\&.
.RE
.PP
\fB\-\-areload\fR
.RS 4
Asynchronously reload the NCS daemon configuration\&. This can be used in scripts executed by the NCS daemon\&.
.RE
.PP
\fB\-\-stop\fR
.RS 4
Stop the NCS daemon\&.
.RE
.PP
\fB\-\-status\fR
.RS 4
Prints status information about the NCS daemon on stdout\&. Among the things listed are: loaded namespaces, current user sessions, callpoints (and whether they are registered or not), CDB status, and the current start\-phase\&. Start phases are reported as "status:" and can be one of starting (which is pre\-phase0), phase0, phase1, started (i\&.e\&. phase2), or stopping (which means that NCS is about to shutdown)\&.
.RE
.PP
\fB\-\-debug\-dump File [Options\&.\&.\&.]\fR
.RS 4
Dump debug information from an already running NCS daemon into a
\fIFile\fR\&. The file only makes sense to NCS developers\&. It is often a good idea to include a debug dump in NCS trouble reports\&.
.sp
Additional options are supported as following
.PP
\fB\-\-collect\-timeout Seconds\fR
.RS 4
Extend the timeout when collecting information to build the debug dump\&. The default timeout is 10 seconds\&.
.RE
.PP
\fB\-\-compress\fR
.RS 4
Compress the debug dump to
\fIFile\&.gz\fR
.RE
.RE
.PP
\fB\-\-cli\-j\-dump File\fR
.RS 4
Dump cli structure information from the NCS daemon into a file\&.
.RE
.PP
\fB\-\-check\-callbacks [Namespace | Path]\fR
.RS 4
Walks through the entire data tree (config and stat), or only the Namespace or Path, and verifies that all read\-callbacks are implemented for all elements, and verifies their return values\&.
.RE
.PP
\fB\-\-loadfile File\fR
.RS 4
Load configuration in curly bracket format from File\&.
.RE
.PP
\fB\-\-rollback Nr\fR
.RS 4
Rollback configuration to saved configuration number Nr\&.
.RE
.PP
\fB\-\-loadxmlfiles File \&.\&.\&.\fR
.RS 4
Load configuration in XML format from Files\&. The configuration is completely replaced by the contents in Files\&.
.RE
.PP
\fB\-\-mergexmlfiles File \&.\&.\&.\fR
.RS 4
Load configuration in XML format from Files\&. The configuration is merged with the contents in Files\&. The XML may use the \*(Aqoperation\*(Aq attribute, in the same way as it is used in a NETCONF <edit\-config> operation\&.
.RE
.PP
\fB\-\-timeout MaxTime\fR
.RS 4
Specify the maximum time to wait for the NCS daemon to complete the command, in seconds\&. If this option is not given, no timeout is used\&.\&.
.RE
.SH "STANDALONE OPTIONS"
.PP
\fB\-\-cdb\-debug\-dump Directory [Options\&.\&.\&.]\fR
.RS 4
Print debug information about the CDB files in
\fIDirectory\fR
to stdout\&. This is a completely stand\-alone feature and the only thing needed is the \&.cdb files (no running NCS daemon or \&.fxs files etc)\&.
.sp
Additional options may be provided to alter the output format and content\&.
.PP
\fBfile_debug\fR
.RS 4
Dump raw file contents with keypaths\&.
.RE
.PP
\fBfile_debug_hkp\fR
.RS 4
Dump raw file contents with hashed keypaths\&.
.RE
.PP
\fBns_debug\fR
.RS 4
Dump fxs headers and namespace list\&.
.RE
.PP
\fBschema_debug\fR
.RS 4
Dump extensive schema information\&.
.RE
.PP
\fBvalidate_utf8\fR
.RS 4
Only emit paths and content with invalid UTF\-8\&.
.RE
.PP
\fBxml\fR
.RS 4
Dump file contents as XML files, without output to stdout\&. The files will be named A\&.xml, O\&.xml and S\&.xml if data is available\&.
.RE
.sp
The output may also be filtered by file type using the
\fIskip_conf\fR,
\fIskip_oper\fR
and
\fIskip_snap\fR
options to filter out configuration, operational and snapshot databases respectively\&.
.RE
.PP
\fB\-\-cdb\-compact Directory\fR
.RS 4
Compact CDB files in
\fIDirectory\fR\&. This is a completely stand\-alone feature and the only thing needed is the \&.cdb files (no running NCS daemon or \&.fxs files etc)\&.
.RE
.PP
\fB\-\-version\fR
.RS 4
Reports the ncs version without interacting with the daemon\&.
.RE
.PP
\fB\-\-timeout MaxTime\fR
.RS 4
See above
.RE
.SH "ENVIRONMENT"
.PP
When NCS is started from the /etc/init\&.d scripts, that get generated by the \-\-system\-install option to the NCS installer, the environment variable NCS_RELOAD_PACKAGES can be set to \*(Aqtrue\*(Aq to attempt a package reload\&.
.SH "DIAGNOSTICS"
.PP
If NCS starts, the exit status is 0\&. If not it is a positive integer\&. The different meanings of the different exit codes are documented in the "NCS System Management" chapter in the user guide\&. When failing to start, the reason is stated in the NCS daemon log\&. The location of the daemon log is specified in the ConfFile as described in
\m[blue]\fBncs\&.conf(5)\fR\m[]\&.
.SH "SEE ALSO"
.PP
\fBncs.conf\fR(5)
\- NCS daemon configuration file format
.SH "AUTHOR"
.br
.RS 4
Author.
.RE
.SH "COPYRIGHT"
.br
Copyright \(co 2021, 2022, 2023, 2024 Cisco Systems, Inc. All rights reserved.
.br
